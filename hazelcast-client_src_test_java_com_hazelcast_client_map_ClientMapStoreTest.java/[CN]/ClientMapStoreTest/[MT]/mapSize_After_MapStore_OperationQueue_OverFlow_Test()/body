{
  Config config=new Config();
  MapConfig mapConfig=new MapConfig();
  MapStoreConfig mapStoreConfig=new MapStoreConfig();
  final MapStoreBackup store=new MapStoreBackup();
  final int delaySeconds=4;
  mapStoreConfig.setEnabled(true);
  mapStoreConfig.setImplementation(store);
  mapStoreConfig.setWriteDelaySeconds(delaySeconds);
  mapConfig.setName(MAP_NAME);
  mapConfig.setMapStoreConfig(mapStoreConfig);
  config.addMapConfig(mapConfig);
  HazelcastInstance server=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance client=HazelcastClient.newHazelcastClient();
  final IMap map=client.getMap(MAP_NAME);
  final int max=50001;
  for (int i=0; i < max; i++) {
    map.putAsync(i,i);
  }
  Thread.sleep(1000 * (delaySeconds + 1));
  assertEquals(max - 1,map.size());
}
