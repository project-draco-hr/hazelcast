{
  Properties props=getDefaultProperties();
  props.setProperty(Environment.CACHE_REGION_FACTORY,HazelcastCacheRegionFactory.class.getName());
  props.remove(CacheEnvironment.CONFIG_FILE_PATH_LEGACY);
  props.put(CacheEnvironment.HAZELCAST_INSTANCE_NAME,"hibernate");
  props.put(CacheEnvironment.SHUTDOWN_ON_STOP,"true");
  final SessionFactory sf=createSessionFactory(props);
  final HazelcastInstance hz=Hazelcast.getDefaultInstance();
  assertTrue(hz == HazelcastAccessor.getHazelcastInstance(sf));
  sf.close();
  assertFalse(hz.getLifecycleService().isRunning());
}
