{
  if (state == ACTIVE) {
    throw new IllegalStateException("Transaction is already active");
  }
  checkThread();
  if (threadFlag.get() != null) {
    throw new IllegalStateException("Nested transactions are not allowed!");
  }
  setThreadFlag(Boolean.TRUE);
  startTime=Clock.currentTimeMillis();
  backupAddresses=transactionManagerService.pickBackupAddresses(durability);
  state=ACTIVE;
}
