{
  Config config=new Config();
  final int insCount=4;
  final String name0="defQueue0";
  final String name1="defQueue1";
  final HazelcastInstance[] instances=StaticNodeFactory.newInstances(config,insCount);
  final CountDownLatch latch=new CountDownLatch(1);
  new Thread(){
    public void run(){
      try {
        latch.await(5,TimeUnit.SECONDS);
        sleep(3000);
        getQueue(instances,name0).offer("item0");
      }
 catch (      InterruptedException ignored) {
      }
    }
  }
.start();
  boolean b=instances[0].executeTransaction(new TransactionOptions().setTransactionType(TransactionOptions.TransactionType.LOCAL),new TransactionalTask<Boolean>(){
    public Boolean execute(    TransactionalTaskContext context) throws TransactionException {
      TransactionalQueue<String> q0=context.getQueue(name0);
      TransactionalQueue<String> q1=context.getQueue(name1);
      String s=null;
      latch.countDown();
      try {
        s=q0.poll(10,TimeUnit.SECONDS);
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
        fail(e.getMessage());
      }
      assertEquals("item0",s);
      q1.offer(s);
      return true;
    }
  }
);
  assertTrue(b);
  assertEquals(0,getQueue(instances,name0).size());
  assertEquals("item0",getQueue(instances,name1).poll());
}
