{
  in.clear();
  while (b.hasRemaining()) {
    sslEngineResult=sslEngine.unwrap(b,in);
    if (sslEngineResult.getHandshakeStatus() == SSLEngineResult.HandshakeStatus.NEED_TASK) {
      Runnable task;
      while ((task=sslEngine.getDelegatedTask()) != null) {
        task.run();
      }
    }
 else     if (sslEngineResult.getHandshakeStatus() == SSLEngineResult.HandshakeStatus.FINISHED || sslEngineResult.getStatus() == SSLEngineResult.Status.BUFFER_UNDERFLOW) {
      return in;
    }
  }
  return in;
}
