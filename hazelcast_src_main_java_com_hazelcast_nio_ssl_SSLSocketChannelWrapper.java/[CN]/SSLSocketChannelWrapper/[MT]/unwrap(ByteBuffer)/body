{
  applicationBuffer.clear();
  while (b.hasRemaining()) {
    sslEngineResult=sslEngine.unwrap(b,applicationBuffer);
    if (sslEngineResult.getStatus() == SSLEngineResult.Status.BUFFER_OVERFLOW) {
      return applicationBuffer;
    }
    if (sslEngineResult.getHandshakeStatus() == SSLEngineResult.HandshakeStatus.NEED_TASK) {
      if (DEBUG) {
        log("Handshake NEED TASK");
      }
      Runnable task;
      while ((task=sslEngine.getDelegatedTask()) != null) {
        if (DEBUG) {
          log("Running task: " + task);
        }
        task.run();
      }
    }
 else     if (sslEngineResult.getHandshakeStatus() == SSLEngineResult.HandshakeStatus.FINISHED || sslEngineResult.getStatus() == SSLEngineResult.Status.BUFFER_UNDERFLOW) {
      return applicationBuffer;
    }
  }
  return applicationBuffer;
}
