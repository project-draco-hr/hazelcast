{
  try {
    if (packet.isHeaderSet(Packet.HEADER_OP)) {
      operationService.handle(packet);
    }
 else     if (packet.isHeaderSet(Packet.HEADER_EVENT)) {
      eventService.handle(packet);
    }
 else     if (packet.isHeaderSet(Packet.HEADER_WAN_REPLICATION)) {
      wanReplicationService.handle(packet);
    }
 else     if (packet.isHeaderSet(Packet.HEADER_BIND)) {
      connectionManager.handle(packet);
    }
 else {
      logger.severe("Unknown packet type! Header: " + packet.getHeader());
    }
  }
 catch (  Throwable t) {
    inspectOutputMemoryError(t);
    logger.severe("Failed to process packet:" + packet,t);
  }
}
