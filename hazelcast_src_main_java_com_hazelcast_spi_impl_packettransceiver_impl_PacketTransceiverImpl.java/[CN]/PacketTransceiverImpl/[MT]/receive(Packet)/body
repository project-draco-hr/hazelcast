{
  try {
    if (packet.isHeaderSet(HEADER_OP)) {
      operationPacketHandler.handle(packet);
    }
 else     if (packet.isHeaderSet(HEADER_EVENT)) {
      eventPacketHandler.handle(packet);
    }
 else     if (packet.isHeaderSet(HEADER_WAN_REPLICATION)) {
      wanReplicationPacketHandler.handle(packet);
    }
 else     if (packet.isHeaderSet(HEADER_BIND)) {
      connectionPacketHandler.handle(packet);
    }
 else {
      logger.severe("Unknown packet type! Header: " + packet.getHeader());
    }
  }
 catch (  Throwable t) {
    inspectOutputMemoryError(t);
    logger.severe("Failed to process packet:" + packet,t);
  }
}
