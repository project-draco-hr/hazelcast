{
  final int k=2;
  final int size=10;
  final String mapName="testEvictionPerPartition";
  Config cfg=new Config();
  cfg.setProperty(GroupProperties.PROP_PARTITION_COUNT,"1");
  final MapConfig mc=cfg.getMapConfig(mapName);
  mc.setEvictionPolicy(EvictionPolicy.LRU);
  mc.setEvictionPercentage(50);
  final MaxSizeConfig msc=new MaxSizeConfig();
  msc.setMaxSizePolicy(MaxSizeConfig.MaxSizePolicy.PER_PARTITION);
  msc.setSize(size);
  mc.setMaxSizeConfig(msc);
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(k);
  final HazelcastInstance[] instances=factory.newInstances(cfg);
  final int pnum=instances[0].getPartitionService().getPartitions().size();
  int insertCount=size * pnum * 2;
  final Map map=instances[0].getMap(mapName);
  for (int i=0; i < insertCount; i++) {
    if (i == insertCount - 1) {
      sleepMillis(1100);
    }
    map.put(i,i);
  }
  assertTrueEventually(new AssertTask(){
    @Override public void run() throws Exception {
      assertTrue(map.size() < size);
    }
  }
);
}
