{
  int size=1000;
  Config cfg=new Config();
  MapConfig mc=cfg.getMapConfig("testMapRecordEviction");
  mc.setTimeToLiveSeconds(1);
  final CountDownLatch latch=new CountDownLatch(size);
  mc.addEntryListenerConfig(new EntryListenerConfig().setImplementation(new EntryAdapter(){
    public void entryEvicted(    EntryEvent event){
      latch.countDown();
    }
  }
).setLocal(true));
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(2);
  final HazelcastInstance[] instances=factory.newInstances(cfg);
  final IMap map=instances[0].getMap("testMapRecordEviction");
  for (int i=0; i < size; i++) {
    map.put(i,i);
  }
  assertOpenEventually(latch);
  assertTrueEventually(new AssertTask(){
    @Override public void run() throws Exception {
      assertEquals(0,map.size());
    }
  }
);
}
