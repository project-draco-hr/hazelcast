{
  if (systemLogService.shouldLog(INFO)) {
    systemLogService.logObject(request,INFO,"ReturnResponse");
  }
  if (request.local) {
    final TargetAwareOp targetAwareOp=(TargetAwareOp)request.attachment;
    if (request.response == OBJECT_REDO) {
      targetAwareOp.setRedoResult(redoType);
    }
 else {
      targetAwareOp.setResult(request.response);
    }
  }
 else {
    Packet packet=obtainPacket();
    packet.setFromRequest(request);
    packet.operation=ClusterOperation.RESPONSE;
    packet.responseType=RESPONSE_SUCCESS;
    packet.longValue=request.longValue;
    if (request.value != null) {
      packet.setValue(request.value);
    }
    if (request.response == OBJECT_REDO) {
      packet.lockAddress=null;
      packet.responseType=RESPONSE_REDO;
      packet.redoData=redoType != null ? redoType.getCode() : REDO_UNKNOWN.getCode();
      if (systemLogService.shouldInfo()) {
        systemLogService.info(request,"Returning REDO response");
      }
    }
 else     if (request.response != null) {
      if (request.response instanceof Boolean) {
        if (request.response == Boolean.FALSE) {
          packet.responseType=RESPONSE_FAILURE;
        }
      }
 else       if (request.response instanceof Long) {
        packet.longValue=(Long)request.response;
      }
 else {
        Data data;
        if (request.response instanceof Data) {
          data=(Data)request.response;
        }
 else {
          data=toData(request.response);
        }
        if (data != null && data.size() > 0) {
          packet.setValue(data);
        }
      }
    }
    if (conn != null) {
      conn.getWriteHandler().enqueueSocketWritable(packet);
    }
 else {
      return sendResponse(packet,request.caller);
    }
  }
  return true;
}
