{
  try {
    if (!running && multicastSocket.isClosed()) {
      return;
    }
    try {
      multicastSocket.close();
    }
 catch (    Throwable ignored) {
    }
    running=false;
    if (!stopLatch.await(5,TimeUnit.SECONDS)) {
      logger.warning("Failed to shutdown MulticastService in 5 seconds!");
    }
  }
 catch (  Throwable e) {
    logger.warning(e);
  }
}
