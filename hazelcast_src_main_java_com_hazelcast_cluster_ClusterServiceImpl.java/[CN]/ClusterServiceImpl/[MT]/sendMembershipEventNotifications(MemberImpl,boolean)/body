{
  final int eventType=added ? MembershipEvent.MEMBER_ADDED : MembershipEvent.MEMBER_REMOVED;
  final MembershipEvent membershipEvent=new MembershipEvent(member,eventType);
  final Collection<MembershipAwareService> membershipAwareServices=nodeEngine.getServices(MembershipAwareService.class);
  if (membershipAwareServices != null && !membershipAwareServices.isEmpty()) {
    final MembershipServiceEvent event=new MembershipServiceEvent(member,eventType);
    for (    final MembershipAwareService service : membershipAwareServices) {
      nodeEngine.getExecutionService().execute(ExecutionService.SYSTEM_EXECUTOR,new Runnable(){
        public void run(){
          if (added) {
            service.memberAdded(event);
          }
 else {
            service.memberRemoved(event);
          }
        }
      }
);
    }
  }
  final EventService eventService=nodeEngine.getEventService();
  Collection<EventRegistration> registrations=eventService.getRegistrations(SERVICE_NAME,SERVICE_NAME);
  eventService.publishEvent(SERVICE_NAME,registrations,membershipEvent,member.hashCode());
}
