{
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(new Config());
  final IMap map1=h1.getMap("default");
  Transaction tx=h1.getTransaction();
  map1.lock(1);
  tx.begin();
  map1.put(1,1);
  tx.rollback();
  final BlockingQueue<Boolean> q=new LinkedBlockingQueue<Boolean>();
  new Thread(new Runnable(){
    public void run(){
      try {
        q.put(map1.tryLock(1));
      }
 catch (      Throwable e) {
      }
    }
  }
).start();
  Boolean locked=q.poll(5,TimeUnit.SECONDS);
  assertNotNull(locked);
  Assert.assertFalse("should not acquire lock",locked);
  map1.unlock(1);
}
