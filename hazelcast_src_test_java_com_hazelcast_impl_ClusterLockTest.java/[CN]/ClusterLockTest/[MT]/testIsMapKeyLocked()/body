{
  Config config=new Config();
  final HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  final HazelcastInstance h2=Hazelcast.newHazelcastInstance(config);
  final HazelcastInstance h3=Hazelcast.newHazelcastInstance(config);
  final IMap map=h1.getMap("testIsMapKeyLocked");
  final IMap map2=h2.getMap("testIsMapKeyLocked");
  assertFalse(map.isLocked("key"));
  assertFalse(map2.isLocked("key"));
  map.lock("key");
  assertTrue(map.isLocked("key"));
  assertTrue(map2.isLocked("key"));
  final CountDownLatch latch=new CountDownLatch(1);
  Thread thread=new Thread(new Runnable(){
    public void run(){
      IMap map3=h3.getMap("testIsMapKeyLocked");
      assertTrue(map3.isLocked("key"));
      try {
        while (map3.isLocked("key")) {
          Thread.sleep(100);
        }
      }
 catch (      InterruptedException e) {
        throw new RuntimeException(e);
      }
      latch.countDown();
    }
  }
);
  thread.start();
  Thread.sleep(100);
  map.unlock("key");
  assertTrue(latch.await(3,TimeUnit.SECONDS));
}
