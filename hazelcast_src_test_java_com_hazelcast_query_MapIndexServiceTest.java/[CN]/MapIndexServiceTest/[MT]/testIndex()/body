{
  CMap cmap=mockCMap("default");
  MapIndexService mapIndexService=new MapIndexService(false);
  Map<Expression,Index> indexes=mapIndexService.getIndexes();
  assertFalse(mapIndexService.hasIndexedAttributes());
  Expression nameExpression=Predicates.get("name");
  Expression ageExpression=Predicates.get("age");
  Expression salaryExpression=Predicates.get("salary");
  mapIndexService.addIndex(nameExpression,false,0);
  mapIndexService.addIndex(ageExpression,true,1);
  mapIndexService.addIndex(salaryExpression,true,2);
  assertTrue(indexes.containsKey(nameExpression));
  assertTrue(indexes.containsKey(ageExpression));
  assertTrue(indexes.containsKey(salaryExpression));
  assertTrue(mapIndexService.hasIndexedAttributes());
  for (int i=0; i < 20000; i++) {
    Employee employee=new Employee(i + "Name",i % 80,(i % 2 == 0),100 + (i % 1000));
    Record record=newRecord(cmap,i,"key" + i,employee);
    record.setIndexes(mapIndexService.getIndexValues(employee),mapIndexService.getIndexTypes());
    mapIndexService.index(record);
  }
  long total=Runtime.getRuntime().totalMemory();
  long free=Runtime.getRuntime().freeMemory();
  System.out.println("Used Memory:" + ((total - free) / 1024 / 1024));
  for (int i=0; i < 10000; i++) {
    long start=System.currentTimeMillis();
    QueryContext queryContext=new QueryContext("default",new SqlPredicate("salary=161 and age >20 and age <23"),mapIndexService);
    Set<MapEntry> results=mapIndexService.doQuery(queryContext);
    assertEquals(10,results.size());
  }
  cmap.getNode().connectionManager.shutdown();
}
