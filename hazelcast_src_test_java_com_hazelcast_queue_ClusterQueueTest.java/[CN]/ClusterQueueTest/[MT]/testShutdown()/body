{
  Config config=new Config();
  StaticNodeFactory factory=createNodeFactory(2);
  final HazelcastInstance[] instances=factory.newInstances(config);
  final HazelcastInstance h1=instances[0];
  final HazelcastInstance h2=instances[1];
  final IQueue q1=h1.getQueue("default");
  final IQueue q2=h2.getQueue("default");
  for (int i=0; i < 40; ) {
    assertTrue(q1.offer("item" + i++,100,TimeUnit.SECONDS));
    assertTrue(q2.offer("item" + i++,100,TimeUnit.SECONDS));
  }
  h1.getLifecycleService().shutdown();
  for (int i=40; i < 100; ) {
    assertTrue(q2.offer("item" + i++,100,TimeUnit.SECONDS));
  }
  for (int i=0; i < 100; i++) {
    assertEquals("item" + i,q2.poll());
  }
}
