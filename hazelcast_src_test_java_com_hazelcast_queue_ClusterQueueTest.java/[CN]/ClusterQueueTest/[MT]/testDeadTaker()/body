{
  Config config=new Config();
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(2);
  final HazelcastInstance[] instances=factory.newInstances(config);
  final HazelcastInstance h1=instances[0];
  final HazelcastInstance h2=instances[1];
  warmUpPartitions(h1,h2);
  final IQueue q1=h1.getQueue("default");
  final IQueue q2=h2.getQueue("default");
  new Thread(new Runnable(){
    public void run(){
      try {
        q2.take();
      }
 catch (      HazelcastInstanceNotActiveException ignored) {
      }
catch (      InterruptedException e) {
        e.printStackTrace();
      }
    }
  }
).start();
  final Thread thread=new Thread(new Runnable(){
    public void run(){
      try {
        Thread.sleep(5000);
        h2.getLifecycleService().kill();
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
    }
  }
);
  thread.start();
  thread.join(30 * 1000);
  q1.offer("item");
  assertEquals(1,q1.size());
  assertEquals("item",q1.poll());
}
