{
  Config config=new Config();
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(2);
  final HazelcastInstance[] instances=factory.newInstances(config);
  final HazelcastInstance h1=instances[0];
  final HazelcastInstance h2=instances[1];
  final Queue<String> q1=h1.getQueue("q");
  final Queue<String> q2=h2.getQueue("q");
  for (int i=0; i < 5; i++) {
    q1.offer("item" + i);
  }
  assertEquals(5,q1.size());
  assertEquals(5,q2.size());
  assertEquals("item0",q2.poll());
  assertEquals("item1",q2.poll());
  assertEquals("item2",q2.poll());
  assertSizeEventually(2,q1);
  assertSizeEventually(2,q2);
  h1.getLifecycleService().shutdown();
  assertSizeEventually(2,q2);
}
