{
  while (running) {
    Object obj=null;
    try {
      queue.drainTo(bulk,BULK_SIZE);
      final int size=bulk.size();
      if (size > 0) {
        for (int i=0; i < size; i++) {
          obj=bulk.remove();
          checkPeriodics();
          process(obj);
        }
      }
 else {
        obj=queue.poll(100,TimeUnit.MILLISECONDS);
        checkPeriodics();
        if (obj != null) {
          process(obj);
        }
      }
    }
 catch (    final InterruptedException e) {
      Node.get().handleInterruptedException(Thread.currentThread(),e);
    }
catch (    final Throwable e) {
      logger.log(Level.FINEST,e + ",  message: " + e+ ", obj="+ obj,e);
      e.printStackTrace();
      System.out.println(bulk + " Exception when handling " + obj);
    }
  }
  bulk.clear();
  queue.clear();
}
