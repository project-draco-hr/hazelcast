{
  if (Clock.currentTimeMillis() < (lastExpiration + EXPIRATION_CLEANUP_INTERVAL_MILLIS)) {
    return;
  }
  if (canExpire.compareAndSet(true,false)) {
    try {
      executionService.execute(NEAR_CACHE_EXECUTOR_NAME,new Runnable(){
        public void run(){
          try {
            lastExpiration=Clock.currentTimeMillis();
            for (            Map.Entry<Data,NearCacheRecord> entry : cache.entrySet()) {
              if (entry.getValue().isExpired(maxIdleMillis,timeToLiveMillis)) {
                Data key=entry.getKey();
                NearCacheRecord record=cache.remove(key);
                if (record != null) {
                  updateSizeEstimator(-calculateCost(record));
                  stats.incrementExpirations();
                }
              }
            }
          }
  finally {
            canExpire.set(true);
          }
        }
      }
);
    }
 catch (    RejectedExecutionException e) {
      canExpire.set(true);
    }
catch (    Exception e) {
      throw rethrow(e);
    }
  }
}
