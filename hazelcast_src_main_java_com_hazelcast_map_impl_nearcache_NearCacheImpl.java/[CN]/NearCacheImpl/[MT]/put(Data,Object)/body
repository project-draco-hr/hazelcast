{
  fireCacheExpiration();
  if (evictionPolicy == NONE && cache.size() >= maxSize) {
    return;
  }
  if (evictionPolicy != NONE && cache.size() >= maxSize) {
    fireCacheEviction();
  }
  Object candidate;
  if (value == null) {
    candidate=NULL_OBJECT;
  }
 else   if (inMemoryFormat == InMemoryFormat.OBJECT) {
    candidate=serializationService.toObject(value);
  }
 else {
    candidate=serializationService.toData(value);
  }
  NearCacheRecord record=new NearCacheRecord(key,candidate);
  NearCacheRecord previous=cache.put(key,record);
  updateSizeEstimator(calculateCost(record));
  if (previous != null) {
    updateSizeEstimator(-calculateCost(previous));
  }
}
