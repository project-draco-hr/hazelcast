{
  fireTtlCleanup();
  if (evictionPolicy == NONE && cache.size() >= maxSize) {
    return;
  }
  if (evictionPolicy != NONE && cache.size() >= maxSize) {
    fireEvictCache();
  }
  if (value == null) {
    value=NULL_OBJECT;
  }
 else {
    value=inMemoryFormat.equals(InMemoryFormat.OBJECT) ? serializationService.toObject(value) : serializationService.toData(value);
  }
  final NearCacheRecord record=new NearCacheRecord(key,value);
  NearCacheRecord previous=cache.put(key,record);
  updateSizeEstimator(calculateCost(record));
  if (previous != null) {
    updateSizeEstimator(-calculateCost(previous));
  }
}
