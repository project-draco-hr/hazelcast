{
  SemaphoreConfig semaphoreConfig=new SemaphoreConfig("default",10);
  Config config=new Config();
  config.setProperty(GroupProperties.PROP_CONNECTION_MONITOR_INTERVAL,"1");
  config.setProperty(GroupProperties.PROP_CONNECTION_MONITOR_MAX_FAULTS,"1");
  config.addSemaphoreConfig(semaphoreConfig);
  HazelcastInstance instance1=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance instance2=Hazelcast.newHazelcastInstance(config);
  ISemaphore semaphore1=instance1.getSemaphore("test");
  ISemaphore semaphore2=instance2.getSemaphore("test");
  assertEquals(10,semaphore1.availablePermits());
  semaphore1.tryAcquireAttach(5);
  semaphore1.reducePermits(1);
  instance1.getLifecycleService().kill();
  Thread.sleep(500);
  assertEquals(9,semaphore2.availablePermits());
}
