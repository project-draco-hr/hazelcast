{
  SemaphoreConfig semaphoreConfig=new SemaphoreConfig("default",10);
  Config config=new Config();
  config.addSemaphoreConfig(semaphoreConfig);
  HazelcastInstance instance1=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance instance2=Hazelcast.newHazelcastInstance(config);
  ISemaphore semaphore1=instance1.getSemaphore("test");
  ISemaphore semaphore2=instance2.getSemaphore("test");
  semaphore2.tryAcquireAttach(5);
  int result=semaphore1.availablePermits();
  int expectedResult=5;
  assertEquals(expectedResult,result);
  final CountDownLatch latch=new CountDownLatch(1);
  instance1.getCluster().addMembershipListener(new MembershipListener(){
    public void memberAdded(    MembershipEvent membershipEvent){
    }
    public void memberRemoved(    MembershipEvent membershipEvent){
      latch.countDown();
    }
  }
);
  instance2.getLifecycleService().shutdown();
  assertTrue(latch.await(5,TimeUnit.SECONDS));
  expectedResult=10;
  result=semaphore1.availablePermits();
  assertEquals(expectedResult,result);
}
