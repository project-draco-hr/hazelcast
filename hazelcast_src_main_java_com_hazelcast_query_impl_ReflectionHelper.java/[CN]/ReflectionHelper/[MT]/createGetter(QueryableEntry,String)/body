{
  Object obj;
  if (attribute.startsWith(QueryEntry.KEY_ATTRIBUTE_NAME)) {
    obj=entry.getKey();
    if (attribute.length() > QueryEntry.KEY_ATTRIBUTE_NAME.length()) {
      attribute=attribute.substring(QueryEntry.KEY_ATTRIBUTE_NAME.length() + 1);
    }
  }
 else {
    obj=entry.getValue();
  }
  Class clazz=obj.getClass();
  final String cacheKey=clazz.getName() + ":" + attribute;
  Getter getter=getterCache.get(cacheKey);
  if (getter != null)   return getter;
  try {
    Getter parent=null;
    List<String> possibleMethodNames=new ArrayList<String>(3);
    for (    final String name : attribute.split("\\.")) {
      Getter localGetter=null;
      possibleMethodNames.clear();
      possibleMethodNames.add(name);
      final String camelName=Character.toUpperCase(name.charAt(0)) + name.substring(1);
      possibleMethodNames.add("get" + camelName);
      possibleMethodNames.add("is" + camelName);
      if (name.equals("this")) {
        localGetter=new ThisGetter(parent,obj);
      }
 else {
        for (        String methodName : possibleMethodNames) {
          try {
            final Method method=clazz.getMethod(methodName);
            method.setAccessible(true);
            localGetter=new MethodGetter(parent,method);
            clazz=method.getReturnType();
            break;
          }
 catch (          NoSuchMethodException ignored) {
          }
        }
        if (localGetter == null) {
          try {
            final Field field=clazz.getField(name);
            localGetter=new FieldGetter(parent,field);
            clazz=field.getType();
          }
 catch (          NoSuchFieldException ignored) {
          }
        }
        if (localGetter == null) {
          Class c=clazz;
          while (!Object.class.equals(c)) {
            try {
              final Field field=c.getDeclaredField(name);
              field.setAccessible(true);
              localGetter=new FieldGetter(parent,field);
              clazz=field.getType();
              break;
            }
 catch (            NoSuchFieldException ignored) {
              c=c.getSuperclass();
            }
          }
        }
      }
      if (localGetter == null) {
        throw new IllegalArgumentException("There is no suitable accessor for '" + name + "' on class '"+ clazz+ "'");
      }
      parent=localGetter;
    }
    getter=parent;
    if (!(getter instanceof ThisGetter)) {
      getterCache.putIfAbsent(cacheKey,getter);
    }
    return getter;
  }
 catch (  Throwable e) {
    throw new QueryException(e);
  }
}
