{
  out.writeInt(type);
  if (classDefinition != null) {
    out.writeInt(classDefinition.getClassId());
    out.writeInt(classDefinition.getVersion());
    byte[] classDefBytes=((BinaryClassDefinition)classDefinition).getBinary();
    out.writeInt(classDefBytes.length);
    out.write(classDefBytes);
  }
 else {
    out.writeInt(NO_CLASS_ID);
  }
  int size=bufferSize();
  out.writeInt(size);
  if (size > 0) {
    out.write(buffer);
  }
  out.writeInt(getPartitionHash());
}
