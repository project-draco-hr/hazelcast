{
  try {
    return Unsafe.getUnsafe();
  }
 catch (  SecurityException se) {
    return AccessController.doPrivileged(new PrivilegedAction<Unsafe>(){
      @Override public Unsafe run(){
        try {
          Class<Unsafe> type=Unsafe.class;
          try {
            Field field=type.getDeclaredField("theUnsafe");
            field.setAccessible(true);
            return type.cast(field.get(type));
          }
 catch (          Exception e) {
            for (            Field field : type.getDeclaredFields()) {
              if (type.isAssignableFrom(field.getType())) {
                field.setAccessible(true);
                return type.cast(field.get(type));
              }
            }
          }
        }
 catch (        Throwable t) {
          throw ExceptionUtil.rethrow(t);
        }
        throw new RuntimeException("Unsafe unavailable");
      }
    }
);
  }
}
