{
  HazelcastInstance hazelcastInstance=createNodeFactory(1).newHazelcastInstance(new Config());
  ITopic<String> topic=hazelcastInstance.getTopic("removeMessageListener");
  final CountDownLatch latch=new CountDownLatch(4);
  final CountDownLatch cp=new CountDownLatch(2);
  final String message="Hazelcast Rocks!";
  MessageListener<String> messageListener1=new MessageListener<String>(){
    public void onMessage(    Message<String> msg){
      if (msg.getMessageObject().startsWith(message)) {
        latch.countDown();
        cp.countDown();
      }
    }
  }
;
  MessageListener<String> messageListener2=new MessageListener<String>(){
    public void onMessage(    Message<String> msg){
      if (msg.getMessageObject().startsWith(message)) {
        latch.countDown();
        cp.countDown();
      }
    }
  }
;
  final String id1=topic.addMessageListener(messageListener1);
  topic.addMessageListener(messageListener2);
  topic.publish(message + "1");
  Thread.sleep(50);
  topic.removeMessageListener(id1);
  cp.await();
  topic.publish(message + "2");
  Thread.sleep(100);
  Assert.assertEquals(1,latch.getCount());
}
