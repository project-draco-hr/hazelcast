{
  HazelcastInstance hazelcastInstance=new StaticNodeFactory(1).newInstance(new Config());
  ITopic<String> topic=hazelcastInstance.getTopic("removeMessageListener");
  final CountDownLatch latch=new CountDownLatch(2);
  final CountDownLatch cp=new CountDownLatch(1);
  MessageListener<String> messageListener=new MessageListener<String>(){
    public void onMessage(    Message<String> msg){
      System.out.println("Received " + msg + " at "+ this);
      latch.countDown();
      cp.countDown();
    }
  }
;
  final String message="message_" + messageListener.hashCode() + "_";
  topic.addMessageListener(messageListener);
  topic.publish(message + "1");
  cp.await();
  topic.removeMessageListener(messageListener);
  topic.publish(message + "2");
  Thread.sleep(50);
  Assert.assertEquals(1,latch.getCount());
  hazelcastInstance.getLifecycleService().shutdown();
}
