{
  try {
    HazelcastInstance hazelcastInstance=createHazelcastInstance();
    ITopic<String> topic=hazelcastInstance.getTopic("removeMessageListener");
    final CountDownLatch latch=new CountDownLatch(2);
    final CountDownLatch cp=new CountDownLatch(1);
    MessageListener<String> messageListener=new MessageListener<String>(){
      public void onMessage(      Message<String> msg){
        latch.countDown();
        cp.countDown();
      }
    }
;
    final String message="message_" + messageListener.hashCode() + "_";
    final String id=topic.addMessageListener(messageListener);
    topic.publish(message + "1");
    cp.await();
    topic.removeMessageListener(id);
    topic.publish(message + "2");
    assertTrueEventually(new AssertTask(){
      @Override public void run(){
        assertEquals(1,latch.getCount());
      }
    }
);
  }
  finally {
    shutdownNodeFactory();
  }
}
