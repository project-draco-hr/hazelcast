{
  if (initialState == ClusterState.SHUTTING_DOWN) {
    throw new IllegalArgumentException("Initial state cannot be SHUTTING_DOWN!");
  }
  clusterServiceLock.lock();
  try {
    final ClusterState currentState=getState();
    if (currentState != ClusterState.ACTIVE) {
      throw new IllegalStateException("Initial state is already set! " + "Current state: " + currentState + ", Given state: "+ initialState);
    }
    this.state=initialState;
  }
  finally {
    clusterServiceLock.unlock();
  }
}
