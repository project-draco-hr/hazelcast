{
  HazelcastInstance i1=Hazelcast.newHazelcastInstance(null);
  HazelcastInstance i2=Hazelcast.newHazelcastInstance(null);
  HazelcastInstance i3=Hazelcast.newHazelcastInstance(null);
  List<HazelcastInstance> members=new ArrayList<HazelcastInstance>();
  members.add(i1);
  members.add(i2);
  members.add(i3);
  HazelcastClient client=HazelcastClient.getHazelcastClient(new InetSocketAddress("192.168.70.1",5704),new InetSocketAddress("192.168.70.1",5702),new InetSocketAddress("192.168.70.1",5703));
  Map map=client.getMap("default");
  int counter=0;
  while (counter < 4) {
    map.put("key",counter);
    assertEquals(counter,realMap.get("key"));
    int id=client.getConnectionManager().getConnection().getAddress().getPort() - 5702;
    members.get(id).shutdown();
    Thread.sleep(2000);
    counter++;
  }
}
