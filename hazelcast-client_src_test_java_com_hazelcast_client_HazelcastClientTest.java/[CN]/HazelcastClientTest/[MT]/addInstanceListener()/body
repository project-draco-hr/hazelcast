{
  final CountDownLatch destroyedLatch=new CountDownLatch(1);
  final CountDownLatch createdLatch=new CountDownLatch(1);
  final IMap<Integer,Integer> instance=getHazelcastClient().getMap("addInstanceListener");
  InstanceListener listener=new InstanceListener(){
    public void instanceDestroyed(    InstanceEvent event){
      assertEquals(InstanceEventType.DESTROYED,event.getEventType());
      assertEquals(instance,event.getInstance());
      destroyedLatch.countDown();
    }
    public void instanceCreated(    InstanceEvent event){
      assertEquals(InstanceEventType.CREATED,event.getEventType());
      IMap<Integer,Integer> map=(IMap<Integer,Integer>)event.getInstance();
      assertEquals(instance.getName(),map.getName());
      assertEquals(1,map.size());
      createdLatch.countDown();
    }
  }
;
  getHazelcastClient().addInstanceListener(listener);
  instance.put(1,1);
  assertEquals(1,instance.size());
  assertTrue(createdLatch.await(2,TimeUnit.SECONDS));
  instance.destroy();
  assertTrue(destroyedLatch.await(2,TimeUnit.SECONDS));
  getHazelcastClient().removeInstanceListener(listener);
}
