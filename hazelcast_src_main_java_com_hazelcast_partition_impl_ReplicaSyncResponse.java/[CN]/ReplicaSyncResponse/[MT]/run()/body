{
  NodeEngineImpl nodeEngine=(NodeEngineImpl)getNodeEngine();
  InternalPartitionServiceImpl partitionService=(InternalPartitionServiceImpl)nodeEngine.getPartitionService();
  int partitionId=getPartitionId();
  int replicaIndex=getReplicaIndex();
  try {
    if (tasks != null && tasks.size() > 0) {
      logApplyReplicaSync(partitionId,replicaIndex);
      for (      Operation op : tasks) {
        try {
          ErrorLoggingResponseHandler responseHandler=new ErrorLoggingResponseHandler(nodeEngine.getLogger(op.getClass()));
          op.setNodeEngine(nodeEngine).setPartitionId(partitionId).setReplicaIndex(replicaIndex).setResponseHandler(responseHandler);
          op.beforeRun();
          op.run();
          op.afterRun();
        }
 catch (        Throwable e) {
          logException(op,e);
        }
      }
      tasks.clear();
    }
  }
  finally {
    partitionService.finalizeReplicaSync(partitionId,replicaIndex,replicaVersions);
  }
}
