{
  this.instance=instance;
  logger=this.instance.node.getLogger(ManagementCenterService.class.getName());
  managementCenterConfig=this.instance.node.config.getManagementCenterConfig();
  if (managementCenterConfig == null) {
    throw new IllegalStateException("ManagementCenterConfig should not be null!");
  }
  this.instance.getLifecycleService().addLifecycleListener(this);
  this.instance.getCluster().addMembershipListener(this);
  maxVisibleInstanceCount=this.instance.node.groupProperties.MC_MAX_INSTANCE_COUNT.getInteger();
  commandHandler=new ConsoleCommandHandler(this.instance);
  String tmpWebServerUrl=managementCenterConfig.getUrl();
  webServerUrl=tmpWebServerUrl != null ? (!tmpWebServerUrl.endsWith("/") ? tmpWebServerUrl + '/' : tmpWebServerUrl) : null;
  updateIntervalMs=(managementCenterConfig.getUpdateInterval() > 0) ? managementCenterConfig.getUpdateInterval() * 1000 : 5000;
  taskPoller=new TaskPoller();
  stateSender=new StateSender();
  serializationService=instance.node.getSerializationService();
  final Address address=instance.node.address;
  identifier=new ManagementCenterIdentifier(instance.node.initializer.getVersion(),instance.getConfig().getGroupConfig().getName(),address.getHost() + ":" + address.getPort());
}
