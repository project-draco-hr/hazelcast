{
  final int callId=callIdIncrementer.incrementAndGet();
  future.getRequest().setCallId(callId);
  ConcurrentMap<Integer,ClientCallFuture> callIdMap=connectionCallMap.get(connection);
  if (callIdMap == null) {
    callIdMap=new ConcurrentHashMap<Integer,ClientCallFuture>();
    final ConcurrentMap<Integer,ClientCallFuture> current=connectionCallMap.putIfAbsent(connection,callIdMap);
    if (current != null) {
      callIdMap=current;
    }
  }
  callIdMap.put(callId,future);
  if (future.getHandler() != null) {
    registerEventHandler(future,connection);
  }
}
