{
  AuthenticationRequest auth=new AuthenticationRequest(credentials,principal);
  auth.setReAuth(reAuth);
  auth.setFirstConnection(firstConnection);
  final SerializationService serializationService=getSerializationService();
  connection.write(serializationService.toData(auth));
  final Data addressData=connection.read();
  Address address=(Address)serializationService.toObject(addressData);
  connection.setEndpoint(address);
  final Data data=connection.read();
  Object response=serializationService.toObject(data);
  if (response instanceof GenericError) {
    throw new AuthenticationException(((GenericError)response).getMessage());
  }
  return response;
}
