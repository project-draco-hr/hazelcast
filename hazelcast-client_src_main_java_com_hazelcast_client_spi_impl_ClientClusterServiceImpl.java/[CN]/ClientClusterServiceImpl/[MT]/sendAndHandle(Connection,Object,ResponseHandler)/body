{
  ResponseStream stream;
  try {
    final SerializationService serializationService=getSerializationService();
    final Data request=serializationService.toData(obj);
    conn.write(request);
    stream=new ResponseStreamImpl(serializationService,conn);
  }
 catch (  IOException e) {
    ((ClientPartitionServiceImpl)client.getClientPartitionService()).refreshPartitions();
    if (redoOperation || obj instanceof RetryableRequest) {
      sendAndHandle(obj,handler);
      return;
    }
    throw new HazelcastException(e);
  }
  try {
    handler.handle(stream);
  }
 catch (  Exception e) {
    throw new ClientException(e);
  }
 finally {
    stream.end();
  }
}
