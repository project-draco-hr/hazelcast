{
  Thread currentThread=Thread.currentThread();
  ThreadContext threadContext=contexts.get(currentThread);
  if (threadContext == null) {
    try {
      threadContext=new ThreadContext(currentThread);
      contexts.put(currentThread,threadContext);
      Iterator<Entry<Thread,ThreadContext>> threads=contexts.entrySet().iterator();
      while (threads.hasNext()) {
        Entry<Thread,ThreadContext> entry=threads.next();
        if (!entry.getKey().isAlive()) {
          entry.getValue().destroy();
          threads.remove();
        }
      }
    }
 catch (    OutOfMemoryError e) {
      OutOfMemoryErrorDispatcher.onOutOfMemory(e);
      throw e;
    }
    if (contexts.size() > 1000) {
      final String msg=contexts.size() + " ThreadContexts are created!! You might have too many threads. Is that normal?";
      Logger.getLogger(ThreadContext.class.getName()).log(Level.WARNING,msg);
    }
  }
  return threadContext;
}
