{
  ThreadContext ctx=getOrCreate();
  final TransactionImpl current=ctx.transactions.get(name);
  if (current != null && current != transaction) {
    throw new IllegalStateException("Current thread has already an ongoing transaction!");
  }
  ctx.transactions.put(name,transaction);
}
