{
  boolean changed=false;
  Address oldAddress;
  for (; ; ) {
    Address[] oldAddresses=addresses;
    oldAddress=oldAddresses[replicaIndex];
    if (partitionListener != null) {
      if (oldAddress == null) {
        changed=newAddress != null;
      }
 else {
        changed=!oldAddress.equals(newAddress);
      }
    }
    Address[] newAddresses=createNewAddresses(replicaIndex,newAddress,oldAddresses);
    if (ADDRESSES_UPDATER.compareAndSet(this,oldAddresses,newAddresses)) {
      break;
    }
  }
  if (changed) {
    PartitionReplicaChangeEvent event=new PartitionReplicaChangeEvent(partitionId,replicaIndex,oldAddress,newAddress);
    partitionListener.replicaChanged(event);
  }
}
