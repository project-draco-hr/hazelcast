{
  super(sc);
  KeyStore ks=KeyStore.getInstance("JKS");
  KeyStore ts=KeyStore.getInstance("JKS");
  final char[] passPhrase=System.getProperty("javax.net.ssl.keyStorePassword").toCharArray();
  final String keyStoreFile=System.getProperty("javax.net.ssl.keyStore");
  ks.load(new FileInputStream(keyStoreFile),passPhrase);
  ts.load(new FileInputStream(keyStoreFile),passPhrase);
  KeyManagerFactory kmf=KeyManagerFactory.getInstance("SunX509");
  kmf.init(ks,passPhrase);
  TrustManagerFactory tmf=TrustManagerFactory.getInstance("SunX509");
  tmf.init(ts);
  SSLContext sslContext=SSLContext.getInstance("TLS");
  sslContext.init(kmf.getKeyManagers(),tmf.getTrustManagers(),null);
  sslEngine=sslContext.createSSLEngine();
  sslEngine.setUseClientMode(client);
  sslEngine.setEnableSessionCreation(true);
  SSLSession session=sslEngine.getSession();
  in=ByteBuffer.allocate(64 * 1024);
  int appBufferMax=session.getApplicationBufferSize();
  int netBufferMax=session.getPacketBufferSize();
  out=ByteBuffer.allocate(appBufferMax);
  cTOs=ByteBuffer.allocate(netBufferMax);
  sTOc=ByteBuffer.allocate(netBufferMax);
  write(out);
  while (sslEngineResult.getHandshakeStatus() != SSLEngineResult.HandshakeStatus.FINISHED) {
    if (sslEngineResult.getHandshakeStatus() == SSLEngineResult.HandshakeStatus.NEED_UNWRAP) {
      sTOc.clear();
      while (socketChannel.read(sTOc) < 1) {
        Thread.sleep(50);
      }
      sTOc.flip();
      unwrap(sTOc);
      if (sslEngineResult.getHandshakeStatus() != SSLEngineResult.HandshakeStatus.FINISHED) {
        out.clear();
        write(out);
      }
    }
 else     if (sslEngineResult.getHandshakeStatus() == SSLEngineResult.HandshakeStatus.NEED_WRAP) {
      out.clear();
      write(out);
    }
 else {
      Thread.sleep(500);
    }
  }
  in.clear();
  in.flip();
}
