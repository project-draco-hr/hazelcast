{
  assertFitsInt(size);
  final long bytesFree=storage.length - toStorageIndex(heapTop);
  if (size > bytesFree) {
    throw new OutOfMemoryError(String.format("Asked to allocate %d, free bytes left %d",size,bytesFree));
  }
  final long addr=heapTop;
  lastAllocatedAddress=heapTop;
  heapTop+=size;
  usedMemory+=size;
  allocatedAddrs.put(addr,size);
  return addr;
}
