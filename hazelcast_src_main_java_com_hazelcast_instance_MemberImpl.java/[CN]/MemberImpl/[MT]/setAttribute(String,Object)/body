{
  if (!localMember)   throw new UnsupportedOperationException("Attributes on remote members must not be changed");
  if (value != null) {
    attributes.put(key,value);
  }
 else {
    attributes.remove(key);
  }
  if (instance != null) {
    NodeEngineImpl nodeEngine=instance.node.nodeEngine;
    OperationService os=nodeEngine.getOperationService();
    MemberAttributeChangedOperation operation;
    if (value != null) {
      operation=new MemberAttributeChangedOperation(MapOperationType.PUT,key,value);
    }
 else {
      operation=new MemberAttributeChangedOperation(MapOperationType.REMOVE,key,null);
    }
    String uuid=nodeEngine.getLocalMember().getUuid();
    operation.setCallerUuid(uuid).setNodeEngine(nodeEngine);
    try {
      for (      Member m : nodeEngine.getClusterService().getMembers()) {
        MemberImpl member=(MemberImpl)m;
        InvocationBuilder inv=os.createInvocationBuilder(ClusterServiceImpl.SERVICE_NAME,operation,member.getAddress());
        inv.invoke();
      }
    }
 catch (    Throwable t) {
      throw ExceptionUtil.rethrow(t);
    }
  }
}
