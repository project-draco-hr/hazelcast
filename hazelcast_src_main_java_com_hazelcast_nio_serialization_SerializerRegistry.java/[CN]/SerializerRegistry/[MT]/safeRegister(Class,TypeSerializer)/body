{
  if (isInternalDataSerializable(type) && serializer.getClass() != DataSerializer.class) {
    throw new IllegalArgumentException("Internal DataSerializable[" + type + "] "+ "serializer cannot be overridden!");
  }
  TypeSerializer f=typeMap.putIfAbsent(type,serializer);
  if (f != null && f.getClass() != serializer.getClass()) {
    throw new IllegalStateException("Serializer[" + f + "] has been already registered for type: "+ type);
  }
  f=idMap.putIfAbsent(serializer.getTypeId(),serializer);
  if (f != null && f.getClass() != serializer.getClass()) {
    throw new IllegalStateException("Serializer [" + f + "] has been already registered for type-id: "+ serializer.getTypeId());
  }
}
