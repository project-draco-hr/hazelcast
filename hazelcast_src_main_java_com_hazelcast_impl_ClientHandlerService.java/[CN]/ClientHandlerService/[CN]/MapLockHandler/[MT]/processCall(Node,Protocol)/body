{
  String name=protocol.args[0];
  long timeout=-1;
  if (protocol.command.equals(Command.MTRYLOCK)) {
    if (protocol.args.length > 0)     timeout=Long.valueOf(protocol.args[1]);
 else     timeout=0;
  }
  boolean locked=true;
  Data key=null;
  if (protocol.buffers != null && protocol.buffers.length > 0) {
    key=new Data(protocol.buffers[0].array());
  }
  IMap<Object,Object> map=(IMap)factory.getMap(name);
  if (key == null) {
    map.lockMap(timeout,TimeUnit.MILLISECONDS);
  }
 else {
    if (timeout == -1) {
      map.lock(key);
    }
 else     if (timeout == 0) {
      locked=map.tryLock(key);
    }
 else {
      locked=map.tryLock(key,timeout,TimeUnit.MILLISECONDS);
    }
  }
  return protocol.success(String.valueOf(locked));
}
