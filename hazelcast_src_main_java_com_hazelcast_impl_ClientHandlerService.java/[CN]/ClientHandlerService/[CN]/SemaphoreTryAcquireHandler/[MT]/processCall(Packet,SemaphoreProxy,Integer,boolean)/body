{
  try {
    boolean acquired;
    if (attach) {
      acquired=semaphoreProxy.tryAcquireAttach(permits,packet.timeout,TimeUnit.MILLISECONDS);
      if (acquired) {
        getClientEndpoint(packet.conn).attachDetachPermits(packet.name,permits);
      }
    }
 else {
      acquired=semaphoreProxy.tryAcquire(permits,packet.timeout,TimeUnit.MILLISECONDS);
    }
    packet.setValue(toData(acquired));
  }
 catch (  Throwable e) {
    packet.setValue(toData(new ClientServiceException(e)));
  }
}
