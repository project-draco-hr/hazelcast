{
  ClientEndpoint clientEndpoint=getClientEndpoint(packet.conn);
  if (attach) {
    semaphoreProxy.attach(permits);
    clientEndpoint.attachDetachPermits(semaphoreProxy.getName(),permits);
  }
 else {
    semaphoreProxy.detach(permits);
    clientEndpoint.attachDetachPermits(semaphoreProxy.getName(),-permits);
  }
}
