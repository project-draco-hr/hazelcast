{
  ClientEndpoint clientEndpoint=mapClientEndpoints.get(packet.conn);
  if (clientEndpoint == null) {
    clientEndpoint=new ClientEndpoint(node,packet.conn);
    mapClientEndpoints.put(packet.conn,clientEndpoint);
  }
  CallContext callContext=clientEndpoint.getCallContext(packet.threadId);
  ClientOperationHandler clientOperationHandler=clientOperationHandlers[packet.operation.getValue()];
  if (clientOperationHandler == null) {
    clientOperationHandler=unknownOperationHandler;
  }
  if (packet.operation != CLIENT_AUTHENTICATE && !clientEndpoint.isAuthenticated()) {
    logger.log(Level.SEVERE,"A Client " + packet.conn + " must authenticate before any operation.");
    node.clientHandlerService.removeClientEndpoint(packet.conn);
    if (packet.conn != null)     packet.conn.close();
    return;
  }
  ClientRequestHandler clientRequestHandler=new ClientRequestHandler(node,packet,callContext,clientOperationHandler,clientEndpoint.getSubject());
  clientEndpoint.addRequest(clientRequestHandler);
  node.executorManager.executeNow(clientRequestHandler);
}
