{
  if (response == null) {
    long waitMillis=unit.toMillis(timeout);
    if (waitMillis > 0) {
synchronized (this) {
        while (waitMillis > 0 && response == null) {
          long start=Clock.currentTimeMillis();
          wait(waitMillis);
          long elapsed=Clock.currentTimeMillis() - start;
          waitMillis-=elapsed;
        }
      }
    }
  }
  return resolveResponse();
}
