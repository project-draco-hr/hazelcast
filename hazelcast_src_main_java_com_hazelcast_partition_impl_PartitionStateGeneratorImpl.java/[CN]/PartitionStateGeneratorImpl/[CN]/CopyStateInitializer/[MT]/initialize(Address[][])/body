{
  if (state.length != currentState.length) {
    throw new IllegalArgumentException("Partition counts do not match!");
  }
  for (int partitionId=0; partitionId < state.length; partitionId++) {
    final InternalPartition p=currentState[partitionId];
    Address[] replicas=new Address[InternalPartition.MAX_REPLICA_COUNT];
    state[partitionId]=replicas;
    for (int replicaIndex=0; replicaIndex < InternalPartition.MAX_REPLICA_COUNT; replicaIndex++) {
      replicas[replicaIndex]=p.getReplicaAddress(replicaIndex);
    }
  }
}
