{
  final int groupSize=groups.size();
  final int maxTries=freePartitions.size() * groupSize * 10;
  int tries=0;
  Integer partitionId=freePartitions.poll();
  while (partitionId != null && tries++ < maxTries) {
    NodeGroup group=groups.poll();
    if (group.addPartition(index,partitionId)) {
      partitionId=freePartitions.poll();
    }
    groups.offer(group);
  }
}
