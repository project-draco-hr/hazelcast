{
  lastHandle=Clock.currentTimeMillis();
  if (!connection.live()) {
    return;
  }
  if (socketWriter == null) {
    logger.log(Level.WARNING,"SocketWriter is not set, creating SocketWriter with CLUSTER protocol!");
    createWriter(Protocols.CLUSTER);
  }
  if (lastWritable == null) {
    lastWritable=poll();
    if (lastWritable == null && buffer.position() == 0) {
      ready=true;
      return;
    }
  }
  try {
    writeBuffer();
  }
 catch (  Throwable t) {
    logger.severe("Fatal Error at WriteHandler for endPoint: " + connection.getEndPoint(),t);
    connection.getSystemLogService().logConnection("Fatal Error at WriteHandler for endPoint " + "[" + connection.getEndPoint() + "]: "+ t.getMessage());
  }
 finally {
    ready=false;
    registerWrite();
  }
}
