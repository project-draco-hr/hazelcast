{
  while (buffer.hasRemaining() && lastWritable != null) {
    boolean complete=socketWriter.write(lastWritable,buffer);
    if (complete) {
      lastWritable=poll();
    }
 else {
      break;
    }
  }
  if (buffer.position() > 0) {
    buffer.flip();
    try {
      socketChannel.write(buffer);
    }
 catch (    Exception e) {
      lastWritable=null;
      handleSocketException(e);
      return;
    }
    if (buffer.hasRemaining()) {
      buffer.compact();
    }
 else {
      buffer.clear();
    }
  }
}
