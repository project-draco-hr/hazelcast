{
  int targetPartitionId=this.targetPartitionId;
  while (targetPartitionId == Operation.GENERIC_PARTITION_ID) {
    final int partitionCount=getContext().getPartitionService().getPartitionCount();
    targetPartitionId=new Random().nextInt(partitionCount);
    if (!TARGET_PARTITION_ID_UPDATER.compareAndSet(this,-1,targetPartitionId)) {
      targetPartitionId=this.targetPartitionId;
    }
  }
  return targetPartitionId;
}
