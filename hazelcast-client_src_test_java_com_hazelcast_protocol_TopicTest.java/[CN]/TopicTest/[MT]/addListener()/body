{
  OutputStream out=doOp("TLISTEN default",null,socket);
  out.flush();
  assertTrue(read(socket).contains("OK"));
  final String message="m";
  new Thread(new Runnable(){
    public void run(){
      try {
        Socket socket=connect0();
        OutputStream out=doOp("TPUBLISH default #1","" + message.getBytes().length,socket);
        out.write(message.getBytes());
        out.write("\r\n".getBytes());
        out.flush();
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
  }
).start();
  assertTrue(read(socket).contains(message));
}
