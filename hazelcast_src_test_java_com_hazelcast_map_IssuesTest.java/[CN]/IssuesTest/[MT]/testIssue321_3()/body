{
  int n=1;
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(n);
  final IMap<Integer,Integer> imap=factory.newHazelcastInstance().getMap("testIssue321_3");
  final BlockingQueue<com.hazelcast.core.EntryEvent<Integer,Integer>> events=new LinkedBlockingQueue<com.hazelcast.core.EntryEvent<Integer,Integer>>();
  final EntryAdapter<Integer,Integer> listener=new EntryAdapter<Integer,Integer>(){
    @Override public void entryAdded(    com.hazelcast.core.EntryEvent<Integer,Integer> event){
      events.add(event);
    }
  }
;
  imap.addEntryListener(listener,true);
  Thread.sleep(50L);
  imap.addEntryListener(listener,false);
  imap.put(1,1);
  final com.hazelcast.core.EntryEvent<Integer,Integer> event1=events.poll(10,TimeUnit.SECONDS);
  final com.hazelcast.core.EntryEvent<Integer,Integer> event2=events.poll(10,TimeUnit.SECONDS);
  assertNotNull(event1);
  assertNotNull(event2);
  assertNotNull(event1.getValue());
  assertNull(event2.getValue());
}
