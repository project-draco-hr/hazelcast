{
  int portableVersion=PortableVersionHelper.getVersion(p,version);
  ClassDefinition cd=lookup(p.getFactoryId(),p.getClassId(),portableVersion);
  if (cd == null) {
    ClassDefinitionWriter classDefinitionWriter=new ClassDefinitionWriter(this,p.getFactoryId(),p.getClassId(),portableVersion);
    p.writePortable(classDefinitionWriter);
    cd=classDefinitionWriter.registerAndGet();
  }
  return cd;
}
