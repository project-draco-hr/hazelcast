{
  InternalPartitionService partitionService=getNodeEngine().getPartitionService();
  NodeEngine nodeEngine=getNodeEngine();
  MapServiceContext mapServiceContext=mapService.getMapServiceContext();
  MapContextQuerySupport mapQuerySupport=mapServiceContext.getMapContextQuerySupport();
  int partitionStateVersion=partitionService.getPartitionStateVersion();
  Collection<Integer> initialPartitions=mapServiceContext.getOwnedPartitions();
  Set<QueryableEntry> entries=null;
  if (!partitionService.hasOnGoingMigrationLocal()) {
    entries=mapContainer.getIndexService().query(predicate);
  }
  result=mapQuerySupport.newQueryResult(initialPartitions.size());
  if (entries != null) {
    result.addAll(entries);
  }
 else {
    fullTableScan(initialPartitions,nodeEngine.getGroupProperties());
  }
  Collection<Integer> finalPartitions=mapServiceContext.getOwnedPartitions();
  if (initialPartitions.equals(finalPartitions)) {
    result.setPartitionIds(finalPartitions);
  }
  if (mapContainer.getMapConfig().isStatisticsEnabled()) {
    LocalMapStatsImpl localStats=mapServiceContext.getLocalMapStatsProvider().getLocalMapStatsImpl(name);
    localStats.incrementOtherOperations();
  }
  checkPartitionStateChanges(partitionService,partitionStateVersion);
}
