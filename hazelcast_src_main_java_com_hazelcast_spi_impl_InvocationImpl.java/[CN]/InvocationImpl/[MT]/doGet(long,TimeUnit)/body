{
  long timeout=unit.toMillis(time);
  if (timeout < 0)   timeout=0;
  while (timeout >= 0) {
    final Object response=pollResponse(timeout);
    if (response == NULL) {
      return null;
    }
 else     if (response == RETRY) {
      Thread.sleep(tryPauseMillis);
      if (timeout != Long.MAX_VALUE) {
        timeout-=tryPauseMillis;
      }
      if (timeout > 0) {
        invoke();
      }
    }
 else {
      return response;
    }
  }
  throw new TimeoutException();
}
