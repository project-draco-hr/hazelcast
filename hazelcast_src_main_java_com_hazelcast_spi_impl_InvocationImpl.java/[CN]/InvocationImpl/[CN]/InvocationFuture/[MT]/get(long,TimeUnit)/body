{
  try {
    Object response=waitForResponse(timeout,unit);
    Object resolvedResponse=resolveResponse(response);
    done=true;
    if (resolvedResponse instanceof Response) {
      if (op instanceof BackupAwareOperation && callback == null) {
        final Object obj=waitForBackupsAndGetResponse((Response)resolvedResponse);
        if (obj == RETRY_RESPONSE) {
          final Future f=resetAndReInvoke();
          return f.get(timeout,unit);
        }
        return obj;
      }
 else {
        return ((Response)resolvedResponse).response;
      }
    }
    return resolvedResponse;
  }
  finally {
    cleanup();
  }
}
