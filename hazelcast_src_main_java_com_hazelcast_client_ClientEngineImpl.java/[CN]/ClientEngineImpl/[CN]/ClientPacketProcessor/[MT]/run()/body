{
  Connection conn=packet.getConn();
  ClientEndpoint endpoint=getEndpoint(conn);
  ClientRequest request=null;
  try {
    request=loadRequest();
    if (endpoint.isAuthenticated() || request instanceof AuthenticationRequest) {
      processRequest(endpoint,request);
    }
 else {
      handleUnauthenticatedRequest(conn,endpoint,request);
    }
  }
 catch (  Throwable e) {
    handleRequestFailure(endpoint,request,e);
  }
}
