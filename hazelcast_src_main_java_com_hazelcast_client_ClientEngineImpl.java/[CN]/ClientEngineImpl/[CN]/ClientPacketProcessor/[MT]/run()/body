{
  final Connection conn=packet.getConn();
  final ClientEndpoint endpoint=getEndpoint(conn);
  try {
    final Data data=packet.getData();
    final ClientRequest request=(ClientRequest)serializationService.toObject(data);
    if (endpoint.isAuthenticated() || request instanceof AuthenticationRequest) {
      request.setEndpoint(endpoint);
      if (request.getServiceName() != null) {
        final Object service=nodeEngine.getService(request.getServiceName());
        if (service == null) {
          throw new IllegalArgumentException("No service registered with name: " + request.getServiceName());
        }
        request.setService(service);
      }
      request.setClientEngine(ClientEngineImpl.this);
      request.process();
    }
 else {
      String message="Client " + conn + " must authenticate before any operation.";
      logger.log(Level.SEVERE,message);
      sendResponse(endpoint,new AuthenticationException(message));
      removeEndpoint(conn);
    }
  }
 catch (  Throwable e) {
    logger.log(Level.SEVERE,e.getMessage(),e);
    sendResponse(endpoint,e);
  }
}
