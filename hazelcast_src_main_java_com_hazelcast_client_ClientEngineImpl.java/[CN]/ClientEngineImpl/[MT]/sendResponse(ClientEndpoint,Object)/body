{
  if (response instanceof Throwable) {
    Throwable t=(Throwable)response;
    StringWriter s=new StringWriter();
    t.printStackTrace(new PrintWriter(s));
    response=new GenericError(s.toString(),0);
  }
  final Data resultData=response != null ? serializationService.toData(response) : NULL;
  Connection conn=endpoint.getConnection();
  conn.write(new DataAdapter(resultData,serializationService.getSerializationContext()));
}
