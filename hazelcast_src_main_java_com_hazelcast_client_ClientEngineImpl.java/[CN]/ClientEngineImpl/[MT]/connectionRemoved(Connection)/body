{
  if (connection.isClient() && connection instanceof TcpIpConnection && nodeEngine.isActive()) {
    final ClientEndpoint endpoint=endpoints.get(connection);
    if (endpoint != null && node.getLocalMember().getUuid().equals(endpoint.getPrincipal().getOwnerUuid())) {
      removeEndpoint(connection,true);
      if (!endpoint.isFirstConnection()) {
        return;
      }
      NodeEngine nodeEngine=node.nodeEngine;
      final Collection<MemberImpl> memberList=nodeEngine.getClusterService().getMemberList();
      for (      MemberImpl member : memberList) {
        final ClientDisconnectionOperation op=new ClientDisconnectionOperation(endpoint.getUuid());
        op.setNodeEngine(nodeEngine).setServiceName(SERVICE_NAME).setService(this).setResponseHandler(ResponseHandlerFactory.createEmptyResponseHandler());
        if (member.localMember()) {
          nodeEngine.getOperationService().runOperation(op);
        }
 else {
          nodeEngine.getOperationService().send(op,member.getAddress());
        }
      }
    }
  }
}
