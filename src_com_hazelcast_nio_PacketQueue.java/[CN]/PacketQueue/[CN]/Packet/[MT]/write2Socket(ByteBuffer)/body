{
  int totalWritten=0;
  socketBB.put(bbSizes.array(),0,bbSizes.limit());
  socketBB.put(bbHeader.array(),0,bbHeader.limit());
  totalWritten+=bbSizes.limit();
  totalWritten+=bbHeader.limit();
  if (key.size() > 0) {
    totalWritten+=key.copyToBuffer(socketBB);
  }
  if (value.size() > 0) {
    totalWritten+=value.copyToBuffer(socketBB);
  }
  if (totalSize != totalWritten) {
    throw new RuntimeException(totalSize + " is totalSize but written: " + totalWritten);
  }
}
