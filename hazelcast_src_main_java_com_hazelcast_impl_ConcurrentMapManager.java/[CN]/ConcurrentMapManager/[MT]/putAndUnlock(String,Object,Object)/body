{
  ThreadContext tc=ThreadContext.get();
  Data dataKey=toData(key);
  CMap cmap=getMap(name);
  LocalLock localLock=cmap.mapLocalLocks.get(dataKey);
  boolean shouldUnlock=localLock != null && localLock.getThreadId() == tc.getThreadId() && localLock.getCount() == 1;
  MPut mput=tc.getCallCache(node.factory).getMPut();
  if (shouldUnlock) {
    mput.txnalPut(CONCURRENT_MAP_PUT_AND_UNLOCK,name,key,value,-1,-1);
    cmap.mapLocalLocks.remove(dataKey);
  }
 else {
    mput.txnalPut(CONCURRENT_MAP_PUT,name,key,value,-1,-1);
    localLock.decrementAndGet();
  }
  mput.clearRequest();
}
