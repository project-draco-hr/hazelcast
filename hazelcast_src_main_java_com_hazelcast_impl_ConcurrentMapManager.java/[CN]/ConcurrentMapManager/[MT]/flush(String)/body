{
  CMap cmap=getMap(name);
  if (cmap != null && cmap.store != null && cmap.writeDelayMillis > 0) {
    final Set<Record> dirtyRecords=new HashSet<Record>();
    for (    Record record : cmap.mapRecords.values()) {
      if (record.isDirty()) {
        PartitionInfo partition=partitionManager.getPartition(record.getBlockId());
        Address owner=partition.getOwner();
        if (owner != null && thisAddress.equals(owner)) {
          dirtyRecords.add(record);
          record.setDirty(false);
        }
      }
    }
    try {
      cmap.runStoreUpdate(dirtyRecords);
    }
 catch (    Throwable e) {
      for (      Record dirtyRecord : dirtyRecords) {
        dirtyRecord.setDirty(true);
      }
      Util.throwUncheckedException(e);
    }
  }
}
