{
  int blockId=getBlockId(key);
  Block block=blocks[blockId];
  if (block == null) {
    if (isMaster() && !isSuperClient()) {
      block=getOrCreateBlock(blockId);
      block.owner=thisAddress;
    }
 else     return null;
  }
  if (block.isMigrating())   return null;
  if (block.owner == null)   return null;
  if (block.owner.equals(thisAddress)) {
    if (block.isMigrating()) {
      if (name == null)       return block.migrationAddress;
      CMap map=getMap(name);
      Record record=map.getRecord(key);
      if (record == null)       return block.migrationAddress;
 else {
        Address recordOwner=record.owner;
        if (recordOwner == null)         return thisAddress;
        if ((!recordOwner.equals(thisAddress)) && (!recordOwner.equals(block.migrationAddress))) {
          record.owner=thisAddress;
        }
        return record.owner;
      }
    }
  }
 else   if (thisAddress.equals(block.migrationAddress)) {
    if (name == null)     return thisAddress;
    CMap map=getMap(name);
    Record record=map.getRecord(key);
    if (record == null)     return thisAddress;
 else     return record.owner;
  }
  return block.owner;
}
