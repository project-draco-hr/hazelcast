{
  CMap cmap=getOrCreateMap(request.name);
  if (!cmap.isNotLocked(request)) {
    setRedoResponse(request,REDO_MAP_LOCKED);
  }
 else   if (cmap.overCapacity()) {
    setRedoResponse(request,REDO_MAP_OVER_CAPACITY);
  }
 else {
    Record record=ensureRecord(request);
    boolean dirty=(record != null) && record.isDirty();
    cmap.put(request);
    if (record != null) {
      record.setDirty(dirty);
      if (!dirty) {
        record.setLastStoredTime(Clock.currentTimeMillis());
      }
    }
    request.value=null;
    request.response=Boolean.TRUE;
  }
}
