{
  final int permits=(int)request.longValue;
  final Boolean attach=SemaphoreProxy.DATA_TRUE.equals(request.value);
  final Address attachAddress=attach ? request.caller : null;
  if (semaphore.tryAcquire(permits,attachAddress)) {
    doResponse(request,semaphore,SemaphoreProxy.ACQUIRED,true);
  }
 else {
    request.lockThreadId=ThreadContext.get().getThreadId();
    schedule(request);
  }
}
