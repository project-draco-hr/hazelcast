{
  ThreadContext threadContext=ThreadContext.get();
  TransactionImpl txn=threadContext.getCallContext().getTransaction();
  if (txn != null && txn.getStatus() == Transaction.TXN_STATUS_ACTIVE) {
    try {
      boolean locked;
      if (!txn.has(name,key)) {
        MLock mlock=new MLock();
        locked=mlock.lockAndGetValue(name,key,DEFAULT_TXN_TIMEOUT);
        if (!locked)         throwCME(key);
        Object oldObject=null;
        Data oldValue=mlock.oldValue;
        if (oldValue != null) {
          oldObject=threadContext.isClient() ? oldValue : threadContext.toObject(oldValue);
        }
        txn.attachRemoveOp(name,key,null,(oldObject == null));
        return (oldObject != null);
      }
 else {
        return (txn.attachRemoveOp(name,key,null,false) != null);
      }
    }
 catch (    Exception e1) {
      logger.log(Level.WARNING,e1.getMessage(),e1);
    }
    return false;
  }
 else {
    boolean removed=booleanCall(CONCURRENT_MAP_REMOVE_ITEM,name,key,value,0,-1);
    if (removed) {
      backup(CONCURRENT_MAP_BACKUP_REMOVE);
    }
    return removed;
  }
}
