{
  final Record record=cmap.getRecord(request);
  if (record != null && !record.testLock(request.lockThreadId,request.lockAddress)) {
    returnRedoResponse(request,REDO_MAP_LOCKED);
  }
 else {
    if (valueData != null) {
      if (record == null) {
        cmap.createAndAddNewRecord(request.key,valueData);
      }
 else {
        record.setValueData(valueData);
      }
    }
    doOperation(request);
    request.value=valueData;
    returnResponse(request);
  }
}
