{
  if (!isBlockInfoValid(blockInfo))   return;
  Block block=blocks[blockInfo.getBlockId()];
  if (block == null) {
    block=blockInfo;
    blocks[block.getBlockId()]=block;
  }
 else {
    if (thisAddress.equals(block.getOwner())) {
      if (block.isMigrating()) {
        if (!block.getMigrationAddress().equals(blockInfo.getMigrationAddress())) {
          throw new RuntimeException();
        }
      }
 else {
        if (blockInfo.getMigrationAddress() != null) {
          block.setMigrationAddress(blockInfo.getMigrationAddress());
        }
      }
    }
 else {
      block.setOwner(blockInfo.getOwner());
      block.setMigrationAddress(blockInfo.getMigrationAddress());
    }
  }
  if (block.getOwner() != null && block.getOwner().equals(block.getMigrationAddress())) {
    block.setMigrationAddress(null);
  }
}
