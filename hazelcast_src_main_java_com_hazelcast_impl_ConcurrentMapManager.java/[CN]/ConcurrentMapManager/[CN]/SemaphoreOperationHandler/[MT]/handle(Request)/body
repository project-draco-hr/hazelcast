{
  request.record=ensureRecord(request,null);
  if (request.record.getValue() == null) {
    final String name=(String)toObject(request.key);
    final SemaphoreConfig sc=node.getConfig().getSemaphoreConfig(name);
    int initialPermits=sc.getInitialPermits();
    if (sc.isFactoryEnabled()) {
      try {
        SemaphoreFactory factory=sc.getFactoryImplementation();
        if (factory == null) {
          String factoryClassName=sc.getFactoryClassName();
          if (factoryClassName != null && factoryClassName.length() != 0) {
            ClassLoader cl=node.getConfig().getClassLoader();
            Class factoryClass=Serializer.loadClass(cl,factoryClassName);
            factory=(SemaphoreFactory)factoryClass.newInstance();
          }
        }
        if (factory != null) {
          initialPermits=factory.getInitialPermits(name,initialPermits);
        }
      }
 catch (      Exception e) {
        logger.log(Level.SEVERE,e.getMessage(),e);
      }
    }
    request.record.setValue(new DistributedSemaphore(initialPermits));
  }
  doOperation(request);
}
