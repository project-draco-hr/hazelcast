{
  if (request.record.getValue() == null) {
    final int configInitialPermits=sc.getInitialPermits();
    SemaphoreFactory factory=sc.getFactoryImplementation();
    if (factory == null) {
      String factoryClassName=sc.getFactoryClassName();
      if (factoryClassName != null && factoryClassName.length() != 0) {
        ClassLoader cl=node.getConfig().getClassLoader();
        Class factoryClass=ClassLoaderUtil.loadClass(cl,factoryClassName);
        factory=(SemaphoreFactory)factoryClass.newInstance();
      }
    }
    if (factory != null) {
      int initialPermits=factory.getInitialPermits(name,configInitialPermits);
      request.record.setValue(new DistributedSemaphore(initialPermits));
    }
  }
}
