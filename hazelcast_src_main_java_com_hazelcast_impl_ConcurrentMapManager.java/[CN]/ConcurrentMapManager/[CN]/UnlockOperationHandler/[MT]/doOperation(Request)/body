{
  boolean unlocked=true;
  CMap cmap=getOrCreateMap(request.name);
  Record record=cmap.getRecord(request);
  if (record != null) {
    unlocked=record.unlock(request.lockThreadId,request.lockAddress);
    if (unlocked) {
      record.incrementVersion();
      request.version=record.getVersion();
      request.lockCount=record.getLockCount();
      if (record.getLockCount() == 0 && record.valueCount() == 0 && !record.hasScheduledAction()) {
        cmap.markAsEvicted(record);
      }
      cmap.fireScheduledActions(record);
    }
 else {
      if (record.hasScheduledAction()) {
        final Iterator<ScheduledAction> actions=record.getScheduledActions().iterator();
        while (actions.hasNext()) {
          final ScheduledAction action=actions.next();
          final Request actionReq=action.getRequest();
          if ((actionReq.operation == CONCURRENT_MAP_LOCK || actionReq.operation == CONCURRENT_MAP_TRY_LOCK_AND_GET) && actionReq.lockThreadId == request.lockThreadId && request.lockAddress.equals(actionReq.lockAddress)) {
            actions.remove();
          }
        }
      }
    }
  }
  if (unlocked) {
    request.response=Boolean.TRUE;
  }
 else {
    request.response=Boolean.FALSE;
  }
}
