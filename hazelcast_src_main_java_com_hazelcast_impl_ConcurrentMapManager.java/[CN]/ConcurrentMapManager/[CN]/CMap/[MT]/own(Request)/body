{
  if (req.key == null || req.key.size() == 0) {
    throw new RuntimeException("Key cannot be null " + req.key);
  }
  if (req.value == null) {
    req.value=new Data();
  }
  Record record=getRecord(req.key);
  boolean created=false;
  if (record == null) {
    record=toRecord(req);
    created=true;
  }
  updateIndexes(created,req,record);
  record.setVersion(req.version);
}
