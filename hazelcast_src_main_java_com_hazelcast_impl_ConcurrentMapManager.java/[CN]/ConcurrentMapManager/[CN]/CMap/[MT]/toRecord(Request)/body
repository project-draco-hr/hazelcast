{
  Record record=getRecord(req.key);
  if (record == null) {
    if (isMultiMap()) {
      record=createNewRecord(req.key,null);
      record.addValue(req.value);
    }
 else {
      record=createNewRecord(req.key,req.value);
    }
    req.key=null;
  }
 else {
    if (req.value != null) {
      if (record.getValue() != null) {
        record.getValue().setNoData();
      }
      if (isMultiMap()) {
        record.addValue(req.value);
      }
 else {
        record.setValue(req.value);
      }
    }
  }
  req.value=null;
  record.copyCount=(int)req.longValue;
  if (req.lockCount > 0) {
    record.lockAddress=req.lockAddress;
    record.lockThreadId=req.lockThreadId;
    record.lockCount=req.lockCount;
  }
  return record;
}
