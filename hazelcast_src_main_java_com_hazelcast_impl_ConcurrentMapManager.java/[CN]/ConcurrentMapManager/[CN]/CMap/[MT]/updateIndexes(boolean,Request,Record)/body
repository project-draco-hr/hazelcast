{
  if (request.indexes != null) {
    int indexCount=request.indexes.length;
    if (indexCount == 0)     throw new RuntimeException(node.getName() + " request countains no index " + request.indexes);
    if (mapIndexes.size() > indexCount) {
      throw new RuntimeException(node.getName() + ": indexCount=" + indexCount+ " but expected "+ mapIndexes.size());
    }
    long[] newIndexes=request.indexes;
    request.indexes=null;
    node.queryService.updateIndex(name,indexes,newIndexes,record,record.value.hashCode());
  }
 else {
    if (created || record.valueHash != record.value.hashCode()) {
      node.queryService.updateIndex(name,indexes,null,record,record.value.hashCode());
    }
  }
}
