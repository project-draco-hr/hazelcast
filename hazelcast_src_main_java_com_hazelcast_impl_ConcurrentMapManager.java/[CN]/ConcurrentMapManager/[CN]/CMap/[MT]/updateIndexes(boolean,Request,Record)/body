{
  int newValueHash=(record.getValue() != null) ? record.getValue().hashCode() : Integer.MIN_VALUE;
  if (request.indexes != null) {
    int indexCount=request.indexes.length;
    if (indexCount == 0)     throw new RuntimeException(node.getName() + " request countains no index " + request.indexes);
    if (mapIndexes.size() > indexCount) {
      throw new RuntimeException(node.getName() + ": indexCount=" + indexCount+ " but expected "+ mapIndexes.size());
    }
    long[] newIndexes=request.indexes;
    request.indexes=null;
    byte[] indexTypes=request.indexTypes;
    request.indexTypes=null;
    node.queryService.updateIndex(name,newIndexes,indexTypes,record,newValueHash);
  }
 else {
    if (created || record.getValueHash() != newValueHash) {
      node.queryService.updateIndex(name,null,null,record,newValueHash);
    }
  }
}
