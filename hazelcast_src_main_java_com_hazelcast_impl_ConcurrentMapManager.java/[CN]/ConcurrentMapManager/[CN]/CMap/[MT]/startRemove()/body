{
  long now=System.currentTimeMillis();
  Iterator<Record> itRemovedRecords=setRemovedRecords.iterator();
  while (itRemovedRecords.hasNext()) {
    Record record=itRemovedRecords.next();
    if (record.active) {
      itRemovedRecords.remove();
    }
 else     if (record.shouldRemove(now)) {
      itRemovedRecords.remove();
      removeAndPurgeRecord(record);
    }
  }
}
