{
  lock.lock();
  try {
    Map<Address,MemberImpl> currentMemberMap=membersMapRef.get();
    if (!shouldProcessMemberUpdate(currentMemberMap,members)) {
      return;
    }
    MemberImpl[] newMembers=new MemberImpl[members.size()];
    int k=0;
    for (    MemberInfo memberInfo : members) {
      MemberImpl member=currentMemberMap.get(memberInfo.getAddress());
      if (member == null) {
        member=createMember(memberInfo.getAddress(),memberInfo.getUuid(),thisAddress.getScopeId(),memberInfo.getAttributes());
        onHeartbeat(member);
      }
      newMembers[k++]=member;
    }
    setMembers(newMembers);
    if (!getMemberList().contains(thisMember)) {
      throw new HazelcastException("Member list doesn't contain local member!");
    }
    joinReset();
    heartBeater();
    node.setJoined();
    logger.info(membersString());
  }
  finally {
    lock.unlock();
  }
}
