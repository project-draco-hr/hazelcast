{
  if (!node.joined()) {
    return;
  }
  long now=Clock.currentTimeMillis();
  long clockJump=0L;
  if (lastHeartBeat != 0L) {
    clockJump=now - lastHeartBeat - heartbeatIntervalMillis;
    if (Math.abs(clockJump) > HEARTBEAT_LOG_THRESHOLD) {
      SimpleDateFormat sdf=new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSS");
      logger.info(format("System clock apparently jumped from %s to %s since last heartbeat (%+d ms)",sdf.format(new Date(lastHeartBeat)),sdf.format(new Date(now)),clockJump));
    }
    clockJump=Math.max(0L,clockJump);
    if (clockJump >= maxNoMasterConfirmationMillis / 2) {
      logger.warning(format("Resetting master confirmation timestamps because of huge system clock jump!" + " Clock-Jump: %d ms, Master-Confirmation-Timeout: %d ms",clockJump,maxNoMasterConfirmationMillis));
      resetMemberMasterConfirmations();
    }
  }
  lastHeartBeat=now;
  if (node.isMaster()) {
    heartBeaterMaster(now,clockJump);
  }
 else {
    heartBeaterSlave(now,clockJump);
  }
}
