{
  Connection conn=null;
  while (running) {
    try {
      RecordUpdate ru=(failureQ.size() > 0) ? failureQ.removeFirst() : q.take();
      if (conn == null) {
        conn=getConnection();
      }
      conn.getWriteHandler().enqueueSocketWritable(ru.toNewPacket());
      if (!conn.live()) {
        failureQ.addFirst(ru);
      }
    }
 catch (    InterruptedException e) {
      running=false;
    }
catch (    Throwable e) {
      e.printStackTrace();
    }
  }
}
