{
  Connection conn=null;
  while (running) {
    try {
      RecordUpdate ru=(failureQ.size() > 0) ? failureQ.removeFirst() : q.take();
      if (conn == null) {
        conn=getConnection();
        boolean authorized=node.clusterManager.checkAuthorization(groupName,password,conn.getEndPoint());
        if (!authorized) {
          conn.close();
          conn=null;
          if (logger != null) {
            logger.log(Level.SEVERE,"Invalid groupName or groupPassword! ");
          }
        }
      }
      if (conn != null && conn.live()) {
        conn.getWriteHandler().enqueueSocketWritable(ru.toNewPacket());
      }
 else {
        failureQ.addFirst(ru);
        conn=null;
      }
    }
 catch (    InterruptedException e) {
      running=false;
    }
catch (    Throwable e) {
      if (logger != null) {
        logger.log(Level.WARNING,e.getMessage(),e);
      }
      conn=null;
    }
  }
}
