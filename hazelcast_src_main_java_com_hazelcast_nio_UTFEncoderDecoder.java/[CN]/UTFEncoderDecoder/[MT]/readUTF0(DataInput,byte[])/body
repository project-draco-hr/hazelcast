{
  if (!QuickMath.isPowerOfTwo(buffer.length)) {
    throw new IllegalArgumentException("Size of the buffer has to be power of two, was " + buffer.length);
  }
  boolean isNull=in.readBoolean();
  if (isNull) {
    return null;
  }
  int length=in.readInt();
  int lengthCheck=in.readInt();
  if (length != lengthCheck) {
    throw new UTFDataFormatException("Length check failed, maybe broken bytestream or wrong stream position");
  }
  final char[] data=new char[length];
  if (length > 0) {
    int chunkSize=length / STRING_CHUNK_SIZE + 1;
    for (int i=0; i < chunkSize; i++) {
      int beginIndex=Math.max(0,i * STRING_CHUNK_SIZE - 1);
      readShortUTF(in,data,beginIndex,buffer);
    }
  }
  return stringCreator.buildString(data);
}
