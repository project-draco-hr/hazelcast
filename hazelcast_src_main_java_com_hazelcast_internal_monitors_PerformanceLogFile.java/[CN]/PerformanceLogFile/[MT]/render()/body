{
  try {
    if (logFile == null) {
      logFile=new File(format(pathname,index));
      renderHead=true;
    }
    if (writer == null) {
      FileOutputStream fos=new FileOutputStream(logFile,true);
      CharsetEncoder encoder=Charset.forName("UTF-8").newEncoder();
      writer=new BufferedWriter(new OutputStreamWriter(fos,encoder));
    }
    if (renderHead) {
      headRenderer.render(writer);
      renderHead=false;
    }
    bodyRenderer.render(writer);
    writer.flush();
    lastModified=logFile.lastModified();
    if (logFile.length() > maxRollingFileSizeBytes) {
      rollover();
    }
  }
 catch (  IOException e) {
    log(e);
    logFile=null;
    closeResource(writer);
    writer=null;
  }
catch (  RuntimeException e) {
    logger.severe("Failed to write PerformanceLogFile: " + logFile,e);
  }
}
