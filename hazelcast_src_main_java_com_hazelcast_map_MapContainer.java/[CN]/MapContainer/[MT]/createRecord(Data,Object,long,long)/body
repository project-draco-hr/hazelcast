{
  Record record=getRecordFactory().newRecord(key,value);
  record.setLastAccessTime(now);
  record.setLastUpdateTime(now);
  record.setCreationTime(now);
  final long configTTLSeconds=mapConfig.getTimeToLiveSeconds();
  final long configTTLMillis=mapServiceContext.convertTime(configTTLSeconds,TimeUnit.SECONDS);
  if (ttl < 0L && configTTLMillis > 0L) {
    record.setTtl(configTTLMillis);
  }
 else   if (ttl > 0L) {
    record.setTtl(ttl);
  }
  final RecordStatistics statistics=record.getStatistics();
  if (statistics != null) {
    final long expirationTime=(ttl == 0 ? Long.MAX_VALUE : (now + ttl));
    record.getStatistics().setExpirationTime(expirationTime);
  }
  return record;
}
