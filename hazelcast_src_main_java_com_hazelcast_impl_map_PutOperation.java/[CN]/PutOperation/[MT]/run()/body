{
  if (dataValue == null) {
    dataValue=toData(value);
  }
  OperationContext context=getOperationContext();
  ResponseHandler responseHandler=context.getResponseHandler();
  System.out.println(context.getNodeService().getThisAddress() + " Put txnId  " + txnId);
  MapService mapService=(MapService)context.getService();
  int partitionId=context.getPartitionId();
  PartitionContainer pc=mapService.getPartitionContainer(partitionId);
  if (txnId != null) {
    pc.addTransactionLogItem(txnId,new TransactionLogItem(name,dataKey,dataValue,false,false));
    responseHandler.sendResponse(null);
    return;
  }
  MapPartition mapPartition=pc.getMapPartition(name);
  Record record=mapPartition.records.get(dataKey);
  Object key=null;
  Object oldValue=null;
  Data oldValueData=null;
  if (record == null) {
    if (mapPartition.loader != null) {
      key=toObject(dataKey);
      oldValue=mapPartition.loader.load(key);
      oldValueData=toData(oldValue);
    }
    record=new DefaultRecord(null,partitionId,dataKey,dataValue,-1,-1,mapService.nextId());
    mapPartition.records.put(dataKey,record);
  }
 else {
    oldValueData=record.getValueData();
    record.setValueData(dataValue);
  }
  record.setActive();
  record.setDirty(true);
  if (mapPartition.store != null && mapPartition.writeDelayMillis == 0) {
    if (key == null) {
      key=toObject(dataKey);
    }
    mapPartition.store.store(key,record.getValue());
  }
  boolean callerBackup=takeBackup();
  Operation preResponseBackupOp=null;
  if (callerBackup) {
    preResponseBackupOp=new PutBackupOperation(name,dataKey,dataValue,ttl,false);
  }
  responseHandler.sendResponse(new Response(preResponseBackupOp,oldValueData,false));
}
