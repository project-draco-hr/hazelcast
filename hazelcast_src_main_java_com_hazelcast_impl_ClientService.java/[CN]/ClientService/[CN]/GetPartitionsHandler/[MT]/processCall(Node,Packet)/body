{
  PartitionService partitionService=factory.getPartitionService();
  if (packet.getKeyData() != null && packet.getKeyData().size() > 0) {
    Object key=toObject(packet.getKeyData());
    Partition partition=partitionService.getPartition(key);
    Data value=toData(new PartitionImpl(partition.getPartitionId(),(MemberImpl)partition.getOwner()));
    packet.setValue(value);
  }
 else {
    Set<Partition> partitions=partitionService.getPartitions();
    Set<Data> setData=new LinkedHashSet<Data>();
    for (Iterator<Partition> iterator=partitions.iterator(); iterator.hasNext(); ) {
      Partition partition=iterator.next();
      setData.add(toData(new PartitionImpl(partition.getPartitionId(),(MemberImpl)partition.getOwner())));
    }
    Keys keys=new Keys(setData);
    packet.setValue(toData(keys));
  }
}
