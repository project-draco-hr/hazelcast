{
  final ClientEndpoint clientEndpoint=node.clientService.getClientEndpoint(packet.conn);
  boolean includeValue=(int)packet.longValue == 1;
  if (getInstanceType(packet.name).equals(InstanceType.MAP)) {
    IMap<Object,Object> map=(IMap)node.factory.getOrCreateProxyByName(packet.name);
    clientEndpoint.addThisAsListener(map,packet.key,includeValue);
  }
 else   if (getInstanceType(packet.name).equals(InstanceType.LIST) || getInstanceType(packet.name).equals(InstanceType.SET)) {
    CollectionProxyImpl collectionProxy=(CollectionProxyImpl)node.factory.getOrCreateProxyByName(packet.name);
    MProxy mapProxy=((CollectionProxyReal)collectionProxy.getBase()).mapProxy;
    mapProxy.addEntryListener(clientEndpoint,includeValue);
  }
 else   if (getInstanceType(packet.name).equals(InstanceType.TOPIC)) {
    ITopic<Object> topic=(ITopic)node.factory.getOrCreateProxyByName(packet.name);
    final String packetName=packet.name;
    MessageListener<Object> messageListener=new MessageListener<Object>(){
      public void onMessage(      Object msg){
        Packet p=new Packet();
        p.set(packetName,ClusterOperation.EVENT,msg,null);
        clientEndpoint.sendPacket(p);
      }
    }
;
    topic.addMessageListener(messageListener);
    clientEndpoint.messageListeners.put(packet.name,messageListener);
  }
}
