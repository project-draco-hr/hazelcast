{
  stream.read();
  lastStream=stream;
  latch.countDown();
  while (active && !Thread.currentThread().isInterrupted()) {
    try {
      final Object event=stream.read();
      handler.handle(event);
    }
 catch (    Exception e) {
      try {
        stream.end();
      }
 catch (      IOException ignored) {
      }
      if (!(e instanceof IOException)) {
        active=false;
      }
 else {
        throw e;
      }
    }
  }
}
