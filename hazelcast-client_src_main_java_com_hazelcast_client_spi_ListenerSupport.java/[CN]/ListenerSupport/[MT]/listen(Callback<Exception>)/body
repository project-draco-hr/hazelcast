{
  future=context.getExecutionService().submit(new Runnable(){
    public void run(){
      while (active && !Thread.currentThread().isInterrupted()) {
        try {
          EventResponseHandler eventResponseHandler=new EventResponseHandler();
          if (partitionKey == null) {
            context.getInvocationService().invokeOnRandomTarget(registrationRequest,eventResponseHandler);
          }
 else {
            context.getInvocationService().invokeOnKeyOwner(registrationRequest,partitionKey,eventResponseHandler);
          }
        }
 catch (        Exception e) {
          if (callback != null) {
            callback.invoke(e);
          }
          if (e instanceof HazelcastInstanceNotActiveException) {
            try {
              Thread.sleep(context.getClientConfig().getConnectionAttemptPeriod());
            }
 catch (            InterruptedException ignored) {
            }
          }
        }
      }
    }
  }
);
  try {
    if (!latch.await(1,TimeUnit.MINUTES)) {
      throw new HazelcastException("Could not register listener!!!");
    }
  }
 catch (  InterruptedException ignored) {
  }
  return UuidUtil.buildRandomUuidString();
}
