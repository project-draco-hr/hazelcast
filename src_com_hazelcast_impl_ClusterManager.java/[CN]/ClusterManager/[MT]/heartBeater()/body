{
  long now=System.currentTimeMillis();
  List<MemberImpl> lsMembers=ClusterManager.lsMembers;
  if (isMaster()) {
    List<Address> lsDeadAddresses=null;
    for (    MemberImpl memberImpl : lsMembers) {
      final Address address=memberImpl.getAddress();
      if (!thisAddress.equals(address)) {
        try {
          Connection conn=ConnectionManager.get().getConnection(address);
          if (Node.get().joined()) {
            if (conn != null && conn.live()) {
              if ((now - memberImpl.getLastRead()) >= 5000) {
                conn=null;
                if (lsDeadAddresses == null) {
                  lsDeadAddresses=new ArrayList<Address>();
                  lsDeadAddresses.add(address);
                }
              }
            }
          }
          if (conn != null && conn.live()) {
            if ((now - memberImpl.getLastWrite()) > 500) {
              Invocation inv=obtainServiceInvocation("heartbeat",null,null,OP_HEARTBEAT,0);
              send(inv,address);
            }
          }
        }
 catch (        Exception e) {
          e.printStackTrace();
        }
      }
    }
    if (lsDeadAddresses != null) {
      for (      Address address : lsDeadAddresses) {
        doRemoveAddress(address);
        sendRemoveMemberToOthers(address);
      }
    }
  }
 else {
    if (getMasterAddress() != null) {
      MemberImpl masterMember=getMember(getMasterAddress());
      boolean removed=false;
      if (masterMember != null) {
        if ((now - masterMember.getLastRead()) >= 3000) {
          doRemoveAddress(getMasterAddress());
          removed=true;
        }
      }
      if (!removed) {
        Invocation inv=obtainServiceInvocation("heartbeat",null,null,OP_HEARTBEAT,0);
        send(inv,getMasterAddress());
      }
    }
  }
}
