{
  checkIfNotPagingPredicate(predicate);
  final NodeEngine nodeEngine=this.nodeEngine;
  final SerializationService serializationService=nodeEngine.getSerializationService();
  final Set<Integer> partitionIds=getAllPartitionIds(nodeEngine);
  final Set result=new QueryResultSet(serializationService,iterationType,dataResult);
  try {
    List<Future> futures=queryOnMembers(mapName,predicate,nodeEngine);
    addResultsOfPredicate(futures,result,partitionIds);
    if (partitionIds.isEmpty()) {
      return result;
    }
  }
 catch (  Throwable t) {
    nodeEngine.getLogger(getClass()).warning("Could not get results",t);
  }
  try {
    List<Future> futures=queryOnPartitions(mapName,predicate,partitionIds,nodeEngine);
    addResultsOfPredicate(futures,result,partitionIds);
  }
 catch (  Throwable t) {
    throw ExceptionUtil.rethrow(t);
  }
  return result;
}
