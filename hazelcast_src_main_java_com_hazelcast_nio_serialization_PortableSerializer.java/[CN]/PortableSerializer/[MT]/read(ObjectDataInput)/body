{
  if (!(in instanceof PortableDataInput)) {
    throw new IllegalArgumentException("ObjectDataInput must be instance of PortableDataInput!");
  }
  PortableDataInput input=(PortableDataInput)in;
  ByteBuffer headerBuffer=input.getHeaderBuffer();
  int pos=input.readInt();
  headerBuffer.position(pos);
  int factoryId=headerBuffer.getInt();
  int classId=headerBuffer.getInt();
  int version=headerBuffer.getInt();
  Portable portable=createNewPortableInstance(factoryId,classId);
  int portableVersion=findPortableVersion(factoryId,classId,portable);
  DefaultPortableReader reader=createReader(input,factoryId,classId,version,portableVersion);
  portable.readPortable(reader);
  reader.end();
  return portable;
}
