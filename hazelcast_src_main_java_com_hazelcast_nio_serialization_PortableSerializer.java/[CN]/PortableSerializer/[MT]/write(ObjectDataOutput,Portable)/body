{
  if (p.getClassId() == 0) {
    throw new IllegalArgumentException("Portable class id cannot be zero!");
  }
  if (!(out instanceof BufferObjectDataOutput)) {
    throw new IllegalArgumentException("ObjectDataOutput must be instance of BufferObjectDataOutput!");
  }
  ClassDefinition cd=context.lookupOrRegisterClassDefinition(p);
  BufferObjectDataOutput bufferedOut=(BufferObjectDataOutput)out;
  DefaultPortableWriter writer=new DefaultPortableWriter(this,bufferedOut,cd);
  p.writePortable(writer);
  writer.end();
}
