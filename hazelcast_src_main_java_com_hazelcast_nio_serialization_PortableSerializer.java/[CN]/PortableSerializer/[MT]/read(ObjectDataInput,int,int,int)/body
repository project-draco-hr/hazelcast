{
  if (!(in instanceof BufferObjectDataInput)) {
    throw new IllegalArgumentException("ObjectDataInput must be instance of BufferObjectDataInput!");
  }
  final Portable portable=createNewPortableInstance(factoryId,classId);
  final DefaultPortableReader reader;
  final ClassDefinition cd;
  final BufferObjectDataInput bufferedIn=(BufferObjectDataInput)in;
  int effectiveVersion=version;
  if (version < 0) {
    effectiveVersion=context.getVersion();
  }
  int currentVersion=findCurrentVersion(factoryId,classId,portable);
  cd=context.lookup(factoryId,classId,effectiveVersion);
  if (cd == null) {
    throw new HazelcastSerializationException("Could not find class-definition for " + "factory-id: " + factoryId + ", class-id: "+ classId+ ", version: "+ effectiveVersion);
  }
  if (currentVersion == effectiveVersion) {
    reader=new DefaultPortableReader(this,bufferedIn,cd);
  }
 else {
    reader=new MorphingPortableReader(this,bufferedIn,cd);
  }
  portable.readPortable(reader);
  reader.end();
  return portable;
}
