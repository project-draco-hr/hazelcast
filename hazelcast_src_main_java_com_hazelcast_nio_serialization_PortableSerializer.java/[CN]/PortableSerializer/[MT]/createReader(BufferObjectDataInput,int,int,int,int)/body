{
  int effectiveVersion=version;
  if (version < 0) {
    effectiveVersion=context.getVersion();
  }
  ClassDefinition cd=context.lookupClassDefinition(factoryId,classId,effectiveVersion);
  if (cd == null) {
    throw new HazelcastSerializationException("Could not find class-definition for " + "factory-id: " + factoryId + ", class-id: "+ classId+ ", version: "+ effectiveVersion);
  }
  DefaultPortableReader reader;
  if (portableVersion == effectiveVersion) {
    reader=new DefaultPortableReader(this,in,cd);
  }
 else {
    reader=new MorphingPortableReader(this,in,cd);
  }
  return reader;
}
