{
  this.service=service;
  try {
    final Iterator<PortableHook> hooks=ServiceLoader.iterator(PortableHook.class,FACTORY_ID);
    while (hooks.hasNext()) {
      PortableHook hook=hooks.next();
      final PortableFactory factory=hook.createFactory();
      if (factory != null) {
        register(hook.getFactoryId(),factory);
      }
    }
  }
 catch (  Exception e) {
    throw ExceptionUtil.rethrow(e);
  }
  if (portableFactories != null) {
    for (    Map.Entry<Integer,? extends PortableFactory> entry : portableFactories.entrySet()) {
      register(entry.getKey(),entry.getValue());
    }
  }
}
