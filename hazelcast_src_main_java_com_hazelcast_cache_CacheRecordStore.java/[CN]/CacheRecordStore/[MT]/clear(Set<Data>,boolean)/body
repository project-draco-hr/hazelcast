{
  if (isRemoveAll) {
    final long now=Clock.currentTimeMillis();
    final Set<Data> _keys=new HashSet<Data>(keys.isEmpty() ? records.keySet() : keys);
    try {
      deleteAllCacheEntry(_keys);
    }
  finally {
      final Set<Data> _keysToClean=new HashSet<Data>(keys.isEmpty() ? records.keySet() : keys);
      for (      Data key : _keysToClean) {
        final CacheRecord record=records.get(key);
        if (_keys.contains(key) && record != null) {
          boolean isExpired=record.isExpiredAt(now);
          if (isExpired) {
            processExpiredEntry(key,record);
          }
 else {
            deleteRecord(key);
            if (isStatisticsEnabled()) {
              statistics.increaseCacheRemovals(1);
            }
          }
        }
 else {
          keys.remove(key);
        }
      }
    }
  }
 else {
    records.clear();
  }
}
