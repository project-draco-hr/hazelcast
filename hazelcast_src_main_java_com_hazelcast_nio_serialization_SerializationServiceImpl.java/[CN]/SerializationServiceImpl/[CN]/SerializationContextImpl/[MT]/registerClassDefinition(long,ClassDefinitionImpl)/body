{
  if (versionedDefinitions.putIfAbsent(versionedClassId,cd) == null) {
    if (cd.getBinary() == null) {
      final ContextAwareDataOutput out=pop();
      try {
        cd.writeData(out);
        final byte[] binary=out.toByteArray();
        out.reset();
        compress(binary,out);
        cd.setBinary(out.toByteArray());
      }
  finally {
        push(out);
      }
    }
  }
}
