{
synchronized (factoryLock) {
    FactoryImpl factory=hazelcastInstanceProxy.getFactory();
    factory.restarted=true;
    shutdown(hazelcastInstanceProxy);
    HazelcastInstanceProxy newFactory=newHazelcastInstanceProxy(factory.node.config);
    Collection<HazelcastInstanceAwareInstance> proxies=factory.proxies.values();
    for (    HazelcastInstanceAwareInstance factoryAwareProxy : proxies) {
      factoryAwareProxy.setHazelcastInstance(newFactory.getHazelcastInstance());
    }
    return newFactory;
  }
}
