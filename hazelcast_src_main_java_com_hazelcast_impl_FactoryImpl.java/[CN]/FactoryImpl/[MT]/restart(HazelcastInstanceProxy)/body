{
synchronized (factoryLock) {
    FactoryImpl factory=hazelcastInstanceProxy.getFactory();
    factory.restarted=true;
    shutdown(hazelcastInstanceProxy);
    HazelcastInstanceProxy newFactory=newHazelcastInstanceProxy(factory.node.config);
    Collection<FactoryAwareProxy> proxies=factory.proxies.values();
    for (    FactoryAwareProxy factoryAwareProxy : proxies) {
      factoryAwareProxy.setFactory((FactoryImpl)newFactory.getHazelcastInstance());
    }
    return newFactory;
  }
}
