{
  FactoryImpl factory=null;
  boolean firstMember=false;
synchronized (factoryLock) {
    if (config == null) {
      config=new XmlConfigBuilder().build();
    }
    String name="_hzInstance_" + nextFactoryId++ + "_"+ config.getGroupConfig().getName();
    factory=new FactoryImpl(name,config);
    FactoryImpl old=factories.put(name,factory);
    if (old != null) {
      throw new RuntimeException();
    }
    if (!jmxRegistered) {
      ManagementService.register(factory,config);
      jmxRegistered=true;
    }
    firstMember=(factory.node.getClusterImpl().getMembers().size() == 1);
  }
  int initialWaitSeconds=factory.node.groupProperties.INITIAL_WAIT_SECONDS.getInteger();
  if (initialWaitSeconds > 0) {
    try {
      Thread.sleep(initialWaitSeconds * 1000);
    }
 catch (    InterruptedException e) {
    }
  }
  return factory.hazelcastInstanceProxy;
}
