{
synchronized (factoryLock) {
    String name="_hzInstance_" + nextFactoryId++;
    if (config == null) {
      config=new XmlConfigBuilder().build();
    }
    FactoryImpl factory=new FactoryImpl(name,config);
    FactoryImpl old=factories.put(name,factory);
    if (old != null)     throw new RuntimeException();
    if (!jmxRegistered) {
      ManagementService.register(factory,config);
      jmxRegistered=true;
    }
    int firstMemberWaitSeconds=factory.node.groupProperties.FIRST_MEMBER_WAIT_SECONDS.getInteger();
    if (firstMemberWaitSeconds > 0 && factory.node.getClusterImpl().getMembers().size() == 1) {
      try {
        Thread.sleep(firstMemberWaitSeconds * 1000);
      }
 catch (      InterruptedException e) {
      }
    }
    return factory.hazelcastInstanceProxy;
  }
}
