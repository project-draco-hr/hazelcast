{
  FactoryImpl factory=null;
  boolean firstMember=false;
synchronized (factoryLock) {
    String name="_hzInstance_" + nextFactoryId++;
    if (config == null) {
      config=new XmlConfigBuilder().build();
    }
    factory=new FactoryImpl(name,config);
    FactoryImpl old=factories.put(name,factory);
    if (old != null) {
      throw new RuntimeException();
    }
    if (!jmxRegistered) {
      ManagementService.register(factory,config);
      jmxRegistered=true;
    }
    firstMember=(factory.node.getClusterImpl().getMembers().size() == 1);
  }
  int firstMemberWaitSeconds=factory.node.groupProperties.FIRST_MEMBER_WAIT_SECONDS.getInteger();
  if (firstMemberWaitSeconds > 0 && firstMember) {
    try {
      Thread.sleep(firstMemberWaitSeconds * 1000);
    }
 catch (    InterruptedException e) {
    }
  }
  return factory.hazelcastInstanceProxy;
}
