{
synchronized (factoryLock) {
    HazelcastInstanceProxy hazelcastInstanceProxy=(HazelcastInstanceProxy)hazelcastInstance;
    FactoryImpl factory=(FactoryImpl)hazelcastInstanceProxy.getHazelcastInstance();
    factory.restarted=true;
    shutdown(factory);
    HazelcastInstanceProxy newFactory=newHazelcastInstanceProxy(factory.node.config);
    Collection<FactoryAwareProxy> proxies=factory.proxies.values();
    for (    FactoryAwareProxy factoryAwareProxy : proxies) {
      factoryAwareProxy.setFactory((FactoryImpl)newFactory.getHazelcastInstance());
    }
    return newFactory;
  }
}
