{
synchronized (factoryLock) {
    FactoryImpl factory=(FactoryImpl)hazelcastInstance;
    factory.restarted=true;
    shutdown(factory);
    HazelcastInstanceProxy newFactory=newHazelcastInstanceProxy(factory.node.config);
    Collection<FactoryAwareProxy> proxies=factory.proxies.values();
    for (    FactoryAwareProxy factoryAwareProxy : proxies) {
      factoryAwareProxy.setFactory(newFactory.factory);
    }
    return newFactory;
  }
}
