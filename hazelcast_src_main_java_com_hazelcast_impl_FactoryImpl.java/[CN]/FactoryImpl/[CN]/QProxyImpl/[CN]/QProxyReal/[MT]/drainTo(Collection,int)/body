{
  if (c == null)   throw new NullPointerException("drainTo null!");
  if (maxElements < 0)   throw new IllegalArgumentException("Negative maxElements:" + maxElements);
  if (maxElements == 0)   return 0;
  if (c instanceof QProxy) {
    QProxy q=(QProxy)c;
    if (q.getName().equals(getName())) {
      throw new IllegalArgumentException("Cannot drainTo self!");
    }
  }
  operationsCounter.incrementOtherOperations();
  int added=0;
  Object value=null;
  do {
    value=poll();
    if (value != null) {
      if (!c.add(value)) {
        throw new RuntimeException("drainTo is not able to add!");
      }
      added++;
    }
  }
 while (added < maxElements && value != null);
  return added;
}
