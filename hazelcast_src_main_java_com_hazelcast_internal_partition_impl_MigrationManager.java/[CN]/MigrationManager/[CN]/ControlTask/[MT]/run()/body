{
  partitionServiceLock.lock();
  try {
    migrationQueue.clear();
    if (!partitionStateManager.isInitialized()) {
      logger.info("Skipping control task since partition table state is reset");
      return;
    }
    if (partitionService.scheduleFetchMostRecentPartitionTableTaskIfRequired()) {
      if (logger.isFinestEnabled()) {
        logger.finest("FetchMostRecentPartitionTableTask scheduled");
      }
      migrationQueue.add(new ControlTask());
      return;
    }
    if (logger.isFinestEnabled()) {
      logger.finest("RepairPartitionTableTask scheduled");
    }
    migrationQueue.add(new RepairPartitionTableTask());
  }
  finally {
    partitionServiceLock.unlock();
  }
}
