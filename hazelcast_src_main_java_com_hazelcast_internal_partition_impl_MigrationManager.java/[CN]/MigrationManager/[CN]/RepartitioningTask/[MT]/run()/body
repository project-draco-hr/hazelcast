{
  if (!node.isMaster()) {
    return;
  }
  partitionServiceLock.lock();
  try {
    if (!isAllowed()) {
      return;
    }
    Address[][] newState=partitionStateManager.repartition();
    if (newState == null) {
      return;
    }
    if (!isAllowed()) {
      return;
    }
    lastRepartitionTime.set(Clock.currentTimeMillis());
    processNewPartitionState(newState);
    if (ASSERTION_ENABLED) {
      migrationQueue.add(new CheckPartitionTableTask());
    }
    if (!partitionService.syncPartitionRuntimeState() && logger.isFinestEnabled()) {
      logger.finest("All members not synced partition table after repartitioning");
    }
  }
  finally {
    partitionServiceLock.unlock();
  }
}
