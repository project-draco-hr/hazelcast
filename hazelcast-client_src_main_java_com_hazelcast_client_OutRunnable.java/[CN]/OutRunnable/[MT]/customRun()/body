{
  Call call=null;
  try {
    call=queue.poll(100,TimeUnit.MILLISECONDS);
    if (call == null) {
      return;
    }
    callMap.put(call.getId(),call);
    boolean oldConnectionIsNotNull=(connection != null);
    long oldConnectionId=-1;
    if (oldConnectionIsNotNull) {
      oldConnectionId=connection.getVersion();
    }
    connection=client.connectionManager.getConnection();
    if (restoredConnection(connection,oldConnectionIsNotNull,oldConnectionId)) {
      temp.add(call);
      queue.drainTo(temp);
      client.listenerManager.getListenerCalls().drainTo(queue);
      temp.drainTo(queue);
    }
 else {
      if (connection != null) {
        writer.write(connection,call.getRequest());
      }
 else {
        interruptWaitingCalls();
      }
    }
  }
 catch (  InterruptedException e) {
    throw e;
  }
catch (  Throwable io) {
    logger.info("OutRunnable got an exception:" + io.getMessage());
    enQueue(call);
    client.connectionManager.destroyConnection(connection);
  }
}
