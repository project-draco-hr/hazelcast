{
  Call call=queue.poll(100,TimeUnit.MILLISECONDS);
  try {
    if (call == null) {
      if (reconnectionCalls != null) {
        checkOnReconnect(call);
      }
      return;
    }
    if (call != RECONNECT_CALL) {
      callMap.put(call.getId(),call);
    }
    Connection oldConnection=connection;
    connection=client.getConnectionManager().getConnection();
    boolean wrote=false;
    if (restoredConnection(oldConnection,connection)) {
      resubscribe(call,oldConnection);
    }
 else     if (connection != null) {
      if (call != RECONNECT_CALL) {
        logger.log(Level.FINEST,"Sending: " + call);
        wrote=true;
        writer.write(connection,call.getRequest());
      }
    }
 else {
      clusterIsDown(oldConnection);
    }
    if (connection != null && wrote) {
      writer.flush(connection);
    }
    if (reconnectionCalls != null) {
      checkOnReconnect(call);
    }
  }
 catch (  Throwable io) {
    logger.log(Level.WARNING,"OutRunnable got exception:" + io.getMessage(),io);
    if (call != null) {
      enQueue(call);
    }
    clusterIsDown(connection);
  }
}
