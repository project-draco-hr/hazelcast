{
  MapOperationsCounter mapOperationStats=new MapOperationsCounter(100);
  long start=Clock.currentTimeMillis();
  long counter=0;
  boolean run=true;
  while (run) {
    counter++;
    mapOperationStats.incrementPuts(0);
    if (Clock.currentTimeMillis() - start > 105) {
      run=false;
    }
    Thread.sleep(1);
  }
  mapOperationStats.incrementPuts(0);
  counter++;
  LocalMapOperationStats stats=mapOperationStats.getPublishedStats();
  long interval=stats.getPeriodEnd() - stats.getPeriodStart();
  double statTps=stats.getNumberOfPuts() / interval;
  double totalTps=(double)counter / (Clock.currentTimeMillis() - start);
  assertTrue(statTps < totalTps + 5);
  assertTrue(statTps > totalTps - 5);
}
