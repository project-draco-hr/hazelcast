{
  boolean changed=false;
  Address oldAddress;
  for (; ; ) {
    Address[] oldAddresses=addresses;
    oldAddress=oldAddresses[replicaIndex];
    if (partitionListener != null) {
      if (oldAddress == null) {
        changed=(newAddress != null);
      }
 else {
        changed=!oldAddress.equals(newAddress);
      }
    }
    Address[] newAddresses=new Address[MAX_REPLICA_COUNT];
    arraycopy(oldAddresses,0,newAddresses,0,MAX_REPLICA_COUNT);
    newAddresses[replicaIndex]=newAddress;
    if (ADDRESSES_UPDATER.compareAndSet(this,oldAddresses,newAddresses)) {
      break;
    }
  }
  if (changed) {
    PartitionReplicaChangeEvent event=new PartitionReplicaChangeEvent(partitionId,replicaIndex,oldAddress,newAddress);
    partitionListener.replicaChanged(event);
  }
}
