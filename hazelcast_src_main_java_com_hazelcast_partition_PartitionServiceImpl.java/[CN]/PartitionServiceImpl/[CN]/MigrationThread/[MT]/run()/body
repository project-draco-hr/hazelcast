{
  try {
    while (!thread.isInterrupted()) {
      Runnable r;
      while (migrationActive.get() && (r=migrationQueue.poll(1,TimeUnit.SECONDS)) != null) {
        safeRun(r);
        if (partitionMigrationInterval > 0) {
          Thread.sleep(partitionMigrationInterval);
        }
      }
      final boolean hasNoTasks=migrationQueue.isEmpty();
      if (hasNoTasks && migrating) {
        migrating=false;
        logger.log(Level.INFO,"All migration tasks has been completed, queues are empty.");
      }
      if (!migrationActive.get() || hasNoTasks) {
        evictCompletedMigrations();
        Thread.sleep(sleepTime);
      }
    }
  }
 catch (  InterruptedException e) {
    logger.log(Level.FINEST,"MigrationThread is interrupted: " + e.getMessage());
  }
 finally {
    clearMigrationQueue();
  }
}
