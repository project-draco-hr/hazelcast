{
  final List<MembershipEvent> events=new LinkedList<MembershipEvent>();
  final Set<Member> eventMembers=Collections.unmodifiableSet(new LinkedHashSet<Member>(members));
  for (  MemberImpl member : members) {
    final MemberImpl former=prevMembers.remove(member.getUuid());
    if (former == null) {
      events.add(new MembershipEvent(client.getCluster(),member,MembershipEvent.MEMBER_ADDED,eventMembers));
    }
  }
  for (  MemberImpl member : prevMembers.values()) {
    events.add(new MembershipEvent(client.getCluster(),member,MembershipEvent.MEMBER_REMOVED,eventMembers));
    if (clusterService.getMember(member.getAddress()) == null) {
      connectionManager.removeEndpoint(member.getAddress());
    }
  }
  for (  MembershipEvent event : events) {
    clusterService.fireMembershipEvent(event);
  }
}
