{
  if (instanceFactory != null) {
    throw new IllegalStateException("There should not be multiple creation of TestHazelcastFactory!");
  }
  instanceFactory=new TestHazelcastFactory();
  ownerInstance=instanceFactory.newHazelcastInstance(config);
  if (config.getClassLoader() != null) {
    ClientConfig clientConfig=new ClientConfig();
    clientConfig.setClassLoader(config.getClassLoader());
    return instanceFactory.newHazelcastClient(clientConfig);
  }
 else {
    return instanceFactory.newHazelcastClient();
  }
}
