{
  String name=protocol.args[0];
  System.out.println("Received the addListener for " + name);
  boolean includeValue=Boolean.valueOf(protocol.args[1]);
  final Data key=protocol.buffers.length > 0 ? protocol.buffers[0] : null;
  final DataMapProxy dataMapProxy=mapService.createDistributedObjectForClient(name);
  final TcpIpConnection connection=protocol.conn;
  EntryListener<Data,Data> entryListener=new EntryListener<Data,Data>(){
    public void entryAdded(    EntryEvent<Data,Data> entryEvent){
      sendEvent(entryEvent);
    }
    public void entryRemoved(    EntryEvent<Data,Data> entryEvent){
      sendEvent(entryEvent);
    }
    public void entryUpdated(    EntryEvent<Data,Data> entryEvent){
      sendEvent(entryEvent);
    }
    public void entryEvicted(    EntryEvent<Data,Data> entryEvent){
      sendEvent(entryEvent);
    }
    public void sendEvent(    EntryEvent<Data,Data> entryEvent){
      System.out.println("Sending the event");
      if (connection.live()) {
        String[] args=new String[]{"map",dataMapProxy.getName(),entryEvent.getEventType().toString(),entryEvent.getMember().getInetSocketAddress().getHostName() + ":" + entryEvent.getMember().getInetSocketAddress().getPort()};
        List<Data> list=new ArrayList<Data>();
        list.add(node.serializationService.toData(entryEvent.getKey()));
        if (entryEvent.getValue() != null)         list.add(node.serializationService.toData(entryEvent.getValue()));
        if (entryEvent.getOldValue() != null)         list.add(node.serializationService.toData(entryEvent.getOldValue()));
        Protocol event=new Protocol(connection,Command.EVENT,args,list.toArray(new Data[]{}));
        System.out.println("Connection is " + connection);
        sendResponse(node,event,connection);
      }
 else {
        System.out.println("on Server removing the listener");
        dataMapProxy.removeEntryListener(this,key);
      }
    }
  }
;
  if (key == null)   dataMapProxy.addEntryListener(entryListener,includeValue);
 else   dataMapProxy.addEntryListener(entryListener,key,includeValue);
  return null;
}
