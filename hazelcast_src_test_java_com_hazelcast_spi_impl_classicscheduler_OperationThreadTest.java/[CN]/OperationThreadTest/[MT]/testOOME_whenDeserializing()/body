{
  handlerFactory=mock(OperationHandlerFactory.class);
  OperationHandler handler=mock(OperationHandler.class);
  when(handlerFactory.createGenericOperationHandler()).thenReturn(handler);
  initScheduler();
  DummyOperation operation=new DummyOperation(-1);
  Data data=serializationService.toData(operation);
  Packet packet=new Packet(data,operation.getPartitionId(),serializationService.getPortableContext());
  packet.setHeader(Packet.HEADER_OP);
  doThrow(new OutOfMemoryError()).when(handler).process(packet);
  final int oldCount=OutOfMemoryErrorDispatcher.getOutOfMemoryErrorCount();
  scheduler.execute(packet);
  assertTrueEventually(new AssertTask(){
    @Override public void run() throws Exception {
      assertEquals(oldCount + 1,OutOfMemoryErrorDispatcher.getOutOfMemoryErrorCount());
    }
  }
);
}
