{
  final List<HazelcastInstance> instances=getCreatedInstancesShuffledAfterWarmedUp();
  List<HazelcastInstance> survivingInstances=new ArrayList<HazelcastInstance>(instances);
  final List<HazelcastInstance> terminatingInstances=survivingInstances.subList(0,numberOfNodesToCrash);
  survivingInstances=survivingInstances.subList(numberOfNodesToCrash,instances.size());
  populateMaps(survivingInstances.get(0));
  final String log="Surviving: " + survivingInstances + " Terminating: "+ terminatingInstances;
  final Map<Integer,long[]> replicaVersionsByPartitionId=new HashMap<Integer,long[]>();
  final Map<Integer,Integer> smallestSurvivingReplicaIndexByPartitionId=new HashMap<Integer,Integer>();
  collect(numberOfNodesToCrash,instances,replicaVersionsByPartitionId,smallestSurvivingReplicaIndexByPartitionId);
  terminateInstances(terminatingInstances);
  waitAllForSafeState(survivingInstances);
  validateReplicaVersions(numberOfNodesToCrash,log,survivingInstances,replicaVersionsByPartitionId,smallestSurvivingReplicaIndexByPartitionId);
}
