{
  long threadId=currentThreadId();
  TransactionContext threadContext=threadContextMap.remove(threadId);
  if (threadContext == null) {
    throw new XAException("There is no TransactionContext for the current thread: " + threadId);
  }
switch (flags) {
case TMFAIL:
    List<TransactionContext> contexts=xidContextMap.remove(xid);
  if (contexts != null) {
    for (    TransactionContext context : contexts) {
      getTransaction(context).rollback();
    }
  }
break;
case TMSUCCESS:
case TMSUSPEND:
break;
default :
throw new XAException("Unknown flag!!! " + flags);
}
}
