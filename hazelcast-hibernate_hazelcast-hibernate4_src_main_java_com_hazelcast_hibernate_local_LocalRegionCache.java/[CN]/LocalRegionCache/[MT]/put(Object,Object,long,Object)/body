{
  while (true) {
    Expirable previous=cache.get(key);
    Value newValue=new Value(version,nextTimestamp(),value);
    if (previous == null) {
      if (cache.putIfAbsent(key,newValue) == null) {
        return true;
      }
    }
 else     if (previous.isReplaceableBy(txTimestamp,version,versionComparator)) {
      if (cache.replace(key,previous,newValue)) {
        return true;
      }
    }
 else {
      return false;
    }
  }
}
