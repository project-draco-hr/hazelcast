{
  this.hazelcastInstance=hazelcastInstance;
  try {
    config=hazelcastInstance != null ? hazelcastInstance.getConfig().findMapConfig(name) : null;
  }
 catch (  UnsupportedOperationException e) {
    log.finest(e);
  }
  versionComparator=metadata != null && metadata.isVersioned() ? metadata.getVersionComparator() : null;
  cache=new ConcurrentHashMap<Object,Expirable>();
  markerIdCounter=new AtomicLong();
  messageListener=createMessageListener();
  if (withTopic && hazelcastInstance != null) {
    topic=hazelcastInstance.getTopic(name);
    topic.addMessageListener(messageListener);
  }
 else {
    topic=null;
  }
}
