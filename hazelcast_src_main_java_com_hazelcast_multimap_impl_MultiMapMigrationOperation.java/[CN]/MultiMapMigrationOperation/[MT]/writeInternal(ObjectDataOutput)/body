{
  out.writeInt(map.size());
  for (  Map.Entry<String,Map> entry : map.entrySet()) {
    String name=entry.getKey();
    out.writeUTF(name);
    Map<Data,MultiMapWrapper> collections=entry.getValue();
    out.writeInt(collections.size());
    for (    Map.Entry<Data,MultiMapWrapper> collectionEntry : collections.entrySet()) {
      Data key=collectionEntry.getKey();
      key.writeData(out);
      MultiMapWrapper wrapper=collectionEntry.getValue();
      Collection<MultiMapRecord> coll=wrapper.getCollection(false);
      out.writeInt(coll.size());
      String collectionType=MultiMapConfig.ValueCollectionType.SET.name();
      if (coll instanceof List) {
        collectionType=MultiMapConfig.ValueCollectionType.LIST.name();
      }
      out.writeUTF(collectionType);
      for (      MultiMapRecord record : coll) {
        record.writeData(out);
      }
    }
  }
}
