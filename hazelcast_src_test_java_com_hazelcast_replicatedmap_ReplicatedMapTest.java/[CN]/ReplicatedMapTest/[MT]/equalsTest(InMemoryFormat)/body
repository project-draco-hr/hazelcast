{
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(2);
  Config cfg=new Config();
  cfg.getReplicatedMapConfig("default").setInMemoryFormat(inMemoryFormat);
  cfg.getReplicatedMapConfig("default").setReplicationDelayMillis(0);
  HazelcastInstance instance1=nodeFactory.newHazelcastInstance(cfg);
  HazelcastInstance instance2=nodeFactory.newHazelcastInstance(cfg);
  final ReplicatedMapProxy<Object,Integer> map1=(ReplicatedMapProxy)instance1.getReplicatedMap("default");
  final ReplicatedMapProxy<Object,Integer> map2=(ReplicatedMapProxy)instance2.getReplicatedMap("default");
  for (int i=0; i < 1000; i++) {
    map1.put(i,i);
  }
  final Comparator<Integer> comparator=new Comparator<Integer>(){
    @Override public int compare(    Integer o1,    Integer o2){
      return o1.compareTo(o2);
    }
  }
;
  HazelcastTestSupport.assertTrueEventually(new AssertTask(){
    public void run(){
      assertEquals(1000,map1.size());
      assertEquals(1000,map2.size());
      assertTrue(map1.equals(map2));
      assertTrue(map1.storageEquals(map2));
      assertEquals(map1.entrySet(),map2.entrySet());
      assertEquals(map1.values(comparator),map2.values(comparator));
    }
  }
);
}
