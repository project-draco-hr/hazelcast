{
  try {
    InputStream in=socket.getInputStream();
    OutputStream out=socket.getOutputStream();
    while (running) {
      int requestType=in.read();
      buffer.clear();
      boolean isOutOfMemory=false;
      if (isOutOfMemory) {
        dos.writeByte(STATE_OUT_OF_MEMORY);
      }
 else {
        dos.writeByte(STATE_ACTIVE);
        if (requestType == REQUEST_TYPE_CLUSTER_STATE) {
          writeState(dos);
        }
      }
      out.write(buffer.array(),0,buffer.position());
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
