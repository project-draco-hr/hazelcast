{
  final MapServiceContext mapServiceContext=mapContainer.getMapServiceContext();
  final MapStoreWrapper store=mapContainer.getMapStoreContext().getStore();
  final SerializationService serializationService=mapServiceContext.getNodeEngine().getSerializationService();
  final int writeDelaySeconds=mapContainer.getMapConfig().getMapStoreConfig().getWriteDelaySeconds();
  final long writeDelayMillis=TimeUnit.SECONDS.toMillis(writeDelaySeconds);
  boolean writeCoalescing=true;
  final WriteBehindStore mapDataStore=new WriteBehindStore(store,serializationService,writeDelayMillis,partitionId,writeCoalescing);
  final WriteBehindQueue writeBehindQueue=pickWriteBehindQueue(mapServiceContext,writeCoalescing);
  mapDataStore.setWriteBehindQueue(writeBehindQueue);
  mapDataStore.setWriteBehindProcessor(writeBehindProcessor);
  return (MapDataStore<K,V>)mapDataStore;
}
