{
  long overallTimeoutNanos=calculateTimeout(overallTimeout,overallTimeUnit);
  long perFutureTimeoutNanos=calculateTimeout(perFutureTimeout,perFutureTimeUnit);
  long deadline=System.nanoTime() + overallTimeoutNanos;
  for (  Future future : futures) {
    try {
      long timeoutNanos=calculateFutureTimeout(perFutureTimeoutNanos,deadline);
      executeWithDeadline(future,timeoutNanos,exceptionHandler);
    }
 catch (    TimeoutException e) {
      cancelAllFutures(futures);
      throw e;
    }
catch (    RuntimeException e) {
      cancelAllFutures(futures);
      throw e;
    }
catch (    Exception e) {
      cancelAllFutures(futures);
      throw new RuntimeException(e);
    }
  }
}
