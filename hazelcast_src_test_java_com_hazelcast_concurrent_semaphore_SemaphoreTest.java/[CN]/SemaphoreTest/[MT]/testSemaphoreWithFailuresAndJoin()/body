{
  final Config config=new Config();
  final TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(3);
  final HazelcastInstance instance1=factory.newHazelcastInstance(config);
  final HazelcastInstance instance2=factory.newHazelcastInstance(config);
  final ISemaphore semaphore=instance1.getSemaphore("test");
  final CountDownLatch countDownLatch=new CountDownLatch(1);
  Assert.assertTrue(semaphore.init(0));
  final Thread thread=new Thread(){
    public void run(){
      for (int i=0; i < 2; i++) {
        try {
          semaphore.acquire();
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
      }
      countDownLatch.countDown();
    }
  }
;
  thread.start();
  instance2.getLifecycleService().shutdown();
  semaphore.release();
  HazelcastInstance instance3=factory.newHazelcastInstance(config);
  ISemaphore semaphore1=instance3.getSemaphore("test");
  semaphore1.release();
  try {
    Assert.assertTrue(countDownLatch.await(15,TimeUnit.SECONDS));
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
 finally {
    thread.interrupt();
  }
}
