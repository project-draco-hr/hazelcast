{
  int mapSize=1000;
  int expectedNearCacheHits=400;
  String mapName="testGetAllWithNearCache";
  Config config=new Config();
  NearCacheConfig nearCacheConfig=new NearCacheConfig();
  config.getMapConfig(mapName).setNearCacheConfig(nearCacheConfig);
  TestHazelcastInstanceFactory hazelcastInstanceFactory=createHazelcastInstanceFactory(2);
  HazelcastInstance[] instances=hazelcastInstanceFactory.newInstances(config);
  IMap<Integer,Integer> map=instances[0].getMap(mapName);
  HashSet<Integer> keys=new HashSet<Integer>();
  for (int i=0; i < mapSize; i++) {
    map.put(i,i);
    keys.add(i);
  }
  for (int i=0; i < mapSize; i++) {
    map.get(i);
  }
  Map<Integer,Integer> allEntries=map.getAll(keys);
  for (int i=0; i < mapSize; i++) {
    assertEquals(i,(int)allEntries.get(i));
  }
  NearCacheStats stats=map.getLocalMapStats().getNearCacheStats();
  assertTrue(String.format("Near cache hits should be > %d but were %d",expectedNearCacheHits,stats.getHits()),stats.getHits() > expectedNearCacheHits);
}
