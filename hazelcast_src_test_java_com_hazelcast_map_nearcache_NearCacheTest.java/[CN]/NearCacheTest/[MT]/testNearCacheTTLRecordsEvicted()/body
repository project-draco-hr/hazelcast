{
  final int size=147;
  String mapName=randomMapName();
  Config config=getConfig();
  config.getMapConfig(mapName).setNearCacheConfig(newNearCacheConfig().setCacheLocalEntries(true).setTimeToLiveSeconds(MAX_TTL_SECONDS));
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(2);
  HazelcastInstance instance=factory.newHazelcastInstance(config);
  final IMap<Integer,Integer> map=instance.getMap(mapName);
  populateMap(map,size);
  for (int i=0; i < size; i++) {
    map.get(i);
  }
  assertEquals("we expected to have all map entries in the Near Cache",size,getNearCacheStats(map).getOwnedEntryCount());
  sleepSeconds(MAX_TTL_SECONDS + 1);
  assertTrueEventually(new AssertTask(){
    public void run(){
      map.get(0);
      assertTrue("we expected some entries to be evicted from the Near Cache",getNearCacheStats(map).getOwnedEntryCount() < size);
    }
  }
);
}
