{
  int threadCount=10;
  String mapName=randomName();
  Config config=getConfig();
  NearCacheConfig nearCacheConfig=newNearCacheConfig().setCacheLocalEntries(true);
  config.getMapConfig(mapName).setNearCacheConfig(nearCacheConfig.setInvalidateOnChange(false));
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(1);
  HazelcastInstance hazelcastInstance=factory.newHazelcastInstance(config);
  final IMap<Integer,Integer> map=hazelcastInstance.getMap(mapName);
  populateMap(map,MAX_CACHE_SIZE);
  final CountDownLatch countDownLatch=new CountDownLatch(threadCount);
  Runnable task=new Runnable(){
    @Override public void run(){
      populateNearCache(map,MAX_CACHE_SIZE);
      countDownLatch.countDown();
    }
  }
;
  ExecutorService executorService=newFixedThreadPool(10);
  for (int i=0; i < threadCount; i++) {
    executorService.execute(task);
  }
  assertOpenEventually(countDownLatch);
  for (int i=0; i < MAX_CACHE_SIZE; i++) {
    map.remove(i);
  }
  assertEquals(0,map.getLocalMapStats().getHeapCost());
}
