{
  out.writeInt(map.size());
  for (  Map.Entry<Data,Collection> entry : map.entrySet()) {
    entry.getKey().writeData(out);
    Collection coll=entry.getValue();
    out.writeInt(coll.size());
    for (    Object obj : coll) {
      Data data=serializationService.toData(obj);
      data.writeData(out);
    }
  }
}
