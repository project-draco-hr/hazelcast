{
  final Collection<Data> locks=lockStore != null ? lockStore.getLockedKeys() : Collections.<Data>emptySet();
  final ConcurrentMap<Data,Record> temp=new ConcurrentHashMap<Data,Record>(locks.size());
  for (  Data key : locks) {
    Record record=records.get(key);
    if (record != null) {
      temp.put(key,record);
    }
  }
  Set<Data> keysToDelete=records.keySet();
  keysToDelete.removeAll(temp.keySet());
  mapStoreDeleteAll(keysToDelete);
  records.clear();
  records.putAll(temp);
}
