{
  assertTrueEventually(new AssertTask(){
    public void run(){
      Map<Address,InternalPartitionServiceState> states=new HashMap<Address,InternalPartitionServiceState>();
      for (      HazelcastInstance instance : instances) {
        InternalPartitionServiceState state=getInternalPartitionServiceState(instance);
        if (state != InternalPartitionServiceState.SAFE) {
          states.put(getNode(instance).getThisAddress(),state);
        }
      }
      assertTrue("Instances not in safe state! " + states,states.isEmpty());
    }
  }
,timeoutInSeconds);
}
