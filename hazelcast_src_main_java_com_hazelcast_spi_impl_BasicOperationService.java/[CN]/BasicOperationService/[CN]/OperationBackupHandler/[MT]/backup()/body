{
  int requestedSyncBackupCount=backupAwareOp.getSyncBackupCount() > 0 ? min(InternalPartition.MAX_BACKUP_COUNT,backupAwareOp.getSyncBackupCount()) : 0;
  int requestedAsyncBackupCount=backupAwareOp.getAsyncBackupCount() > 0 ? min(InternalPartition.MAX_BACKUP_COUNT - requestedSyncBackupCount,backupAwareOp.getAsyncBackupCount()) : 0;
  int totalRequestedBackupCount=requestedSyncBackupCount + requestedAsyncBackupCount;
  if (totalRequestedBackupCount == 0) {
    return 0;
  }
  long[] replicaVersions=partitionService.incrementPartitionReplicaVersions(partitionId,totalRequestedBackupCount);
  int maxPossibleBackupCount=min(partitionService.getMemberGroupsSize() - 1,InternalPartition.MAX_BACKUP_COUNT);
  int syncBackupCount=min(maxPossibleBackupCount,requestedSyncBackupCount);
  int asyncBackupCount=min(maxPossibleBackupCount - syncBackupCount,requestedAsyncBackupCount);
  if (!op.returnsResponse()) {
    asyncBackupCount+=syncBackupCount;
    syncBackupCount=0;
  }
  int totalBackupCount=syncBackupCount + asyncBackupCount;
  if (totalBackupCount == 0) {
    return 0;
  }
  return makeBackups(replicaVersions,syncBackupCount,totalBackupCount);
}
