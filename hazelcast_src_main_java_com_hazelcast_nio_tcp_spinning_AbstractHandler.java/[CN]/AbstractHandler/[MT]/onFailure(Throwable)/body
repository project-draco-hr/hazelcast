{
  if (e instanceof OutOfMemoryError) {
    connectionManager.getIoService().onOutOfMemory((OutOfMemoryError)e);
  }
  connection.close("Closing connection due to exception in " + getClass().getSimpleName(),e);
  ConnectionType connectionType=connection.getType();
  if (connectionType.isClient() && !connectionType.isBinary()) {
    return;
  }
  StringBuilder sb=new StringBuilder();
  sb.append(Thread.currentThread().getName());
  sb.append(" Closing socket to endpoint ");
  sb.append(connection.getEndPoint());
  sb.append(", Cause:").append(e);
  Level level=connectionManager.getIoService().isActive() ? Level.WARNING : Level.FINEST;
  if (e instanceof IOException) {
    logger.log(level,sb.toString());
  }
 else {
    logger.log(level,sb.toString(),e);
  }
}
