{
  final int k=simpleTestNodeCount;
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(k);
  final HazelcastInstance[] instances=factory.newInstances(new Config());
  final AtomicInteger count=new AtomicInteger(0);
  final CountDownLatch latch=new CountDownLatch(k / 2);
  final ExecutionCallback callback=new ExecutionCallback(){
    public void onResponse(    Object response){
      if ((Boolean)response)       count.incrementAndGet();
      latch.countDown();
    }
    public void onFailure(    Throwable t){
    }
  }
;
  for (int i=0; i < k; i++) {
    final HazelcastInstance instance=instances[i];
    final IExecutorService service=instance.getExecutorService("testSubmitToKeyOwnerCallable");
    final String script="hazelcast.getCluster().getLocalMember().equals(member)";
    final HashMap map=new HashMap();
    final Member localMember=instance.getCluster().getLocalMember();
    map.put("member",localMember);
    int key=0;
    while (!localMember.equals(instance.getPartitionService().getPartition(++key).getOwner()))     ;
    if (i % 2 == 0) {
      final Future f=service.submitToKeyOwner(new ScriptCallable(script,map),key);
      assertTrue((Boolean)f.get(5,TimeUnit.SECONDS));
    }
 else {
      service.submitToKeyOwner(new ScriptCallable(script,map),key,callback);
    }
  }
  assertTrue(latch.await(30,TimeUnit.SECONDS));
  assertEquals(k / 2,count.get());
}
