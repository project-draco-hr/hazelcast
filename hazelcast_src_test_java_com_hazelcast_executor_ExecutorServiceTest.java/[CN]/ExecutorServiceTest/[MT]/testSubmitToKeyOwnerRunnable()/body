{
  final int k=simpleTestNodeCount;
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(k);
  final HazelcastInstance[] instances=factory.newInstances(new Config());
  final AtomicInteger count=new AtomicInteger(0);
  final CountDownLatch latch=new CountDownLatch(k);
  final ExecutionCallback callback=new ExecutionCallback(){
    public void onResponse(    Object response){
      if (response == null)       count.incrementAndGet();
      latch.countDown();
    }
    public void onFailure(    Throwable t){
    }
  }
;
  for (int i=0; i < k; i++) {
    final HazelcastInstance instance=instances[i];
    final IExecutorService service=instance.getExecutorService("testSubmitToKeyOwnerRunnable");
    final String script="if(!hazelcast.getCluster().getLocalMember().getUuid().equals(memberUUID)) " + "hazelcast.getAtomicLong('testSubmitToKeyOwnerRunnable').incrementAndGet();";
    final HashMap map=new HashMap();
    map.put("memberUUID",instance.getCluster().getLocalMember().getUuid());
    int key=0;
    while (!instance.getCluster().getLocalMember().equals(instance.getPartitionService().getPartition(++key).getOwner())) {
      Thread.sleep(1);
    }
    service.submitToKeyOwner(new ScriptRunnable(script,map),key,callback);
  }
  assertOpenEventually(latch);
  assertEquals(0,instances[0].getAtomicLong("testSubmitToKeyOwnerRunnable").get());
  assertEquals(k,count.get());
}
