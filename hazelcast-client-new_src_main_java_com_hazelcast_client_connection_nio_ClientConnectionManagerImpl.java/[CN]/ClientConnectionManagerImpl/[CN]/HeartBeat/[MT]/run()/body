{
  if (!alive) {
    return;
  }
  final long now=Clock.currentTimeMillis();
  for (  ClientConnection connection : connections.values()) {
    if (now - connection.lastReadTime() > heartBeatTimeout) {
      if (connection.isHeartBeating()) {
        LOGGER.warning("Heartbeat failed to connection : " + connection);
        connection.heartBeatingFailed();
        fireHeartBeatStopped(connection);
      }
    }
    if (now - connection.lastReadTime() > heartBeatInterval) {
      ClientMessage request=ClientPingCodec.encodeRequest();
      ClientInvocation clientInvocation=new ClientInvocation(client,request,connection);
      clientInvocation.setBypassHeartbeatCheck(true);
      clientInvocation.invoke();
    }
 else {
      if (!connection.isHeartBeating()) {
        LOGGER.warning("Heartbeat is back to healthy for connection : " + connection);
        connection.heartBeatingSucceed();
        fireHeartBeatStarted(connection);
      }
    }
  }
}
