{
  if (outRunnable.reconnection.get()) {
    Thread.sleep(10L);
    return;
  }
  Protocol protocol;
  try {
    Connection oldConnection=connection;
    connection=client.connectionManager.getConnection();
    if (restoredConnection(oldConnection,connection)) {
      if (outRunnable.sendReconnectCall(connection)) {
        logger.log(Level.FINEST,"restoredConnection");
        if (oldConnection != null) {
          redoUnfinishedCalls(oldConnection);
        }
      }
      return;
    }
    if (connection == null) {
      outRunnable.clusterIsDown(oldConnection);
      Thread.sleep(10);
    }
 else {
      protocol=reader.read(connection);
      this.lastReceived=Clock.currentTimeMillis();
      long callId=protocol.flag == null ? -1 : Long.valueOf(protocol.flag);
      Call call=callMap.remove(callId);
      if (call != null) {
        call.received=System.nanoTime();
        call.setResponse(protocol);
      }
 else {
        if (protocol.command.equals(Command.EVENT) || protocol.command.equals(Command.QEVENT) || protocol.command.equals(Command.MESSAGE)) {
          client.getListenerManager().enqueue(protocol);
        }
        if (callId != -1) {
          logger.log(Level.SEVERE,"In Thread can not handle: " + protocol.command + " : "+ protocol.flag);
        }
      }
    }
  }
 catch (  Throwable e) {
    e.printStackTrace();
    logger.log(Level.FINEST,"InRunnable [" + connection + "] got an exception:"+ e.toString(),e);
    outRunnable.clusterIsDown(connection);
  }
}
