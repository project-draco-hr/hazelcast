{
  Object current=txMap.get(key);
  boolean haveTxnPast=current != null;
  if (haveTxnPast) {
    if (!current.equals(oldValue)) {
      return false;
    }
    setInternal(getService().toData(key),getService().toData(newValue));
    txMap.put(key,newValue);
    return true;
  }
 else {
    boolean success=replaceIfSameInternal(getService().toData(key),getService().toData(oldValue),getService().toData(newValue));
    if (success)     txMap.put(key,newValue);
    return success;
  }
}
