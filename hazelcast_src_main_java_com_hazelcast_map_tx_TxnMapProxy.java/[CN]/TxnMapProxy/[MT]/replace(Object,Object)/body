{
  Object current=tempMap.get(key);
  boolean haveTxnPast=current != null;
  if (haveTxnPast) {
    if (current.equals(NULL)) {
      return null;
    }
    setInternal(getService().toData(key),getService().toData(value));
    tempMap.put(key,value);
    return current;
  }
 else {
    Data oldValue=replaceInternal(getService().toData(key),getService().toData(value));
    if (oldValue != null)     tempMap.put(key,value);
    return getService().toObject(oldValue);
  }
}
