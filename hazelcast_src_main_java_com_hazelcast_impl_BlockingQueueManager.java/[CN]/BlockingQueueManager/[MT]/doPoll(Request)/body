{
  Q q=getQ(req.name);
  if (q.blCurrentTake == null) {
    q.setCurrentTake();
  }
  if (!q.blCurrentTake.containsValidItem() && !q.blCurrentTake.isFull()) {
    if (req.hasEnoughTimeToSchedule()) {
      req.scheduled=true;
      if (req.local) {
        if (req.attachment == null) {
          throw new RuntimeException("Scheduled local but attachment is null");
        }
      }
      q.schedulePoll(req);
    }
 else {
      req.response=null;
    }
    return;
  }
  Data value=null;
  if (req.operation == ClusterOperation.BLOCKING_QUEUE_PEEK) {
    value=q.peek();
  }
 else {
    value=q.poll(req);
  }
  req.response=value;
}
