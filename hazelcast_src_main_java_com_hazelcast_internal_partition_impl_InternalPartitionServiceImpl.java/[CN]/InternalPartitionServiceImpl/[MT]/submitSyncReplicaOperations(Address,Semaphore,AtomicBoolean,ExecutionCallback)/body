{
  int ownedCount=0;
  ILogger responseLogger=node.getLogger(SyncReplicaVersion.class);
  OperationResponseHandler responseHandler=createErrorLoggingResponseHandler(responseLogger);
  int maxBackupCount=getMaxAllowedBackupCount();
  for (  InternalPartitionImpl partition : partitions) {
    Address owner=partition.getOwnerOrNull();
    if (thisAddress.equals(owner)) {
      for (int i=1; i <= maxBackupCount; i++) {
        Address replicaAddress=partition.getReplicaAddress(i);
        if (replicaAddress != null) {
          if (checkClusterStateForReplicaSync(replicaAddress)) {
            SyncReplicaVersion op=new SyncReplicaVersion(i,callback);
            op.setService(this);
            op.setNodeEngine(nodeEngine);
            op.setOperationResponseHandler(responseHandler);
            op.setPartitionId(partition.getPartitionId());
            nodeEngine.getOperationService().executeOperation(op);
          }
 else {
            s.release();
          }
        }
 else {
          ok.set(false);
          s.release();
        }
      }
      ownedCount++;
    }
 else     if (owner == null) {
      ok.set(false);
    }
  }
  return ownedCount;
}
