{
  final DataSerializable ds;
  final boolean identified=in.readBoolean();
  int id=0;
  String className=null;
  try {
    if (identified) {
      id=in.readInt();
      final DataSerializableFactory dsf=factories.get(id);
      if (dsf == null) {
        throw new IllegalArgumentException("No DataSerializer factory for id: " + id);
      }
      ds=dsf.create();
    }
 else {
      className=in.readUTF();
      ds=(DataSerializable)newInstance(className);
    }
    ds.readData(in);
    return ds;
  }
 catch (  Exception e) {
    if (e instanceof IOException) {
      throw (IOException)e;
    }
    throw new HazelcastSerializationException("Problem while reading DataSerializable " + "id: " + id + ", class: "+ className+ ", exception: "+ e.getMessage(),e);
  }
}
