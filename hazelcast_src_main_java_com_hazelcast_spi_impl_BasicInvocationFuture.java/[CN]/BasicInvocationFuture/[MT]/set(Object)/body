{
  if (response == null) {
    throw new IllegalArgumentException("response can't be null");
  }
  if (response instanceof NormalResponse) {
    response=((NormalResponse)response).getValue();
  }
  if (response == null) {
    response=BasicInvocation.NULL_RESPONSE;
  }
  ExecutionCallbackNode<E> callbackChain;
synchronized (this) {
    if (this.response != null && !(this.response instanceof BasicInvocation.InternalResponse)) {
      throw new IllegalArgumentException("The InvocationFuture.set method can only be called once");
    }
    this.response=response;
    if (response == BasicInvocation.WAIT_RESPONSE) {
      return;
    }
    callbackChain=callbackHead;
    callbackHead=null;
    this.notifyAll();
  }
  BasicOperationService operationService=(BasicOperationService)basicInvocation.nodeEngine.operationService;
  operationService.deregisterBackupCall(basicInvocation.op.getCallId());
  while (callbackChain != null) {
    runAsynchronous(callbackChain.callback,callbackChain.executor);
    callbackChain=callbackChain.next;
  }
}
