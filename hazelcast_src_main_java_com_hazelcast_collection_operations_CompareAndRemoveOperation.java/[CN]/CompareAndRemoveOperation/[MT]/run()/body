{
  CollectionWrapper wrapper=getCollectionWrapper();
  if (wrapper == null) {
    response=false;
    return;
  }
  idSet=new HashSet<Long>();
  List objList=dataList;
  if (!isBinary()) {
    objList=new ArrayList(dataList.size());
    for (    Data data : dataList) {
      objList.add(toObject(data));
    }
  }
  Iterator<CollectionRecord> iter=wrapper.getCollection().iterator();
  while (iter.hasNext()) {
    CollectionRecord record=iter.next();
    boolean contains=objList.contains(record.getObject());
    if ((contains && !retain) || (!contains && retain)) {
      idSet.add(record.getRecordId());
      iter.remove();
    }
  }
  response=!idSet.isEmpty();
  if (wrapper.getCollection().isEmpty()) {
    removeCollection();
  }
}
