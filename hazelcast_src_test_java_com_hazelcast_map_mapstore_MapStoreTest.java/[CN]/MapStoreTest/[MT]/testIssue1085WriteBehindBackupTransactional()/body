{
  Config config=new Config();
  String name="testIssue1085WriteBehindBackupTransactional";
  MapConfig writeBehindBackup=config.getMapConfig(name);
  MapStoreConfig mapStoreConfig=new MapStoreConfig();
  mapStoreConfig.setWriteDelaySeconds(5);
  int size=1000;
  MapStoreWithStoreCount mapStore=new MapStoreWithStoreCount(size,20);
  mapStoreConfig.setImplementation(mapStore);
  writeBehindBackup.setMapStoreConfig(mapStoreConfig);
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(3);
  HazelcastInstance instance=factory.newHazelcastInstance(config);
  HazelcastInstance instance2=factory.newHazelcastInstance(config);
  final IMap map=instance.getMap(name);
  TransactionContext context=instance.newTransactionContext();
  context.beginTransaction();
  TransactionalMap<Object,Object> tmap=context.getMap(name);
  for (int i=0; i < size; i++) {
    tmap.put(i,i);
  }
  context.commitTransaction();
  instance2.getLifecycleService().shutdown();
  mapStore.awaitStores();
}
