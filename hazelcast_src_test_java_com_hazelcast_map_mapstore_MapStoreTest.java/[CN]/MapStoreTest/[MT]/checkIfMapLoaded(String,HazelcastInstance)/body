{
  NodeEngineImpl nodeEngine=TestUtil.getNode(instance).nodeEngine;
  int partitionCount=nodeEngine.getPartitionService().getPartitionCount();
  MapService service=nodeEngine.getService(MapService.SERVICE_NAME);
  boolean loaded=false;
  final long end=System.currentTimeMillis() + TimeUnit.MINUTES.toMillis(1);
  while (!loaded) {
    for (int i=0; i < partitionCount; i++) {
      final RecordStore recordStore=service.getPartitionContainer(i).getRecordStore(mapName);
      if (recordStore != null) {
        loaded=recordStore.isLoaded();
        if (!loaded) {
          break;
        }
      }
    }
    if (System.currentTimeMillis() >= end) {
      break;
    }
    Thread.sleep(10);
  }
  return loaded;
}
