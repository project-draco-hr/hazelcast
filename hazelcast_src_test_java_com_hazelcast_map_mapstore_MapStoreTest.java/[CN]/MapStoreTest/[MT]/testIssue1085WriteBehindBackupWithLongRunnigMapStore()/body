{
  final int size=1000;
  Config config=new Config();
  String name="testIssue1085WriteBehindBackup";
  config.setProperty(GroupProperties.PROP_MAP_REPLICA_WAIT_SECONDS_FOR_SCHEDULED_OPERATIONS,"50");
  MapConfig writeBehindBackupConfig=config.getMapConfig(name);
  MapStoreConfig mapStoreConfig=new MapStoreConfig();
  mapStoreConfig.setWriteDelaySeconds(5);
  MapStoreWithStoreCount mapStore=new MapStoreWithStoreCount(size,120,10);
  mapStoreConfig.setImplementation(mapStore);
  writeBehindBackupConfig.setMapStoreConfig(mapStoreConfig);
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(3);
  HazelcastInstance instance=factory.newHazelcastInstance(config);
  HazelcastInstance instance2=factory.newHazelcastInstance(config);
  final IMap map=instance.getMap(name);
  for (int i=0; i < size; i++) {
    map.put(i,i);
  }
  instance2.getLifecycleService().terminate();
  mapStore.awaitStores();
}
