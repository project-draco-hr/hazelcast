{
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(1);
  final TestMapStore store=new WaitingOnFirstTestMapStore();
  Config cfg=new Config();
  MapStoreConfig mapStoreConfig=new MapStoreConfig();
  mapStoreConfig.setEnabled(true);
  mapStoreConfig.setWriteDelaySeconds(1);
  mapStoreConfig.setImplementation(store);
  cfg.getMapConfig("default").setMapStoreConfig(mapStoreConfig);
  HazelcastInstance h1=nodeFactory.newHazelcastInstance(cfg);
  final IMap<Integer,Integer> map=h1.getMap("testSlowStore");
  int count=1000;
  for (int i=0; i < count; i++) {
    map.put(i,1);
  }
  Thread.sleep(2000);
  for (int i=0; i < count; i++) {
    map.put(i,2);
  }
  Thread.sleep(15000);
  for (int i=0; i < count; i++) {
    assertEquals(map.get(i),store.getStore().get(i));
  }
}
