{
  TestMapStore testMapStore=new TestMapStore(1000,0,0);
  Config config=newConfig(testMapStore,0);
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(3);
  HazelcastInstance h1=nodeFactory.newHazelcastInstance(config);
  HazelcastInstance h2=nodeFactory.newHazelcastInstance(config);
  IMap map1=h1.getMap("default");
  IMap map2=h2.getMap("default");
  for (int i=0; i < 1000; i++) {
    map1.put(i,"value" + i);
  }
  assertOpenEventually("store operations could not be done wisely ",testMapStore.latchStore);
  assertEquals(1000,testMapStore.getStore().size());
  assertEquals(1000,map1.size());
  assertEquals(1000,map2.size());
  testMapStore.assertAwait(10);
  assertEquals(2002,testMapStore.callCount.get());
}
