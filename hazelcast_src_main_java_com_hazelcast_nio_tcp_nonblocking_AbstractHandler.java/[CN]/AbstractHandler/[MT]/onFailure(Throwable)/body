{
  if (e instanceof OutOfMemoryError) {
    ioService.onOutOfMemory((OutOfMemoryError)e);
  }
  if (selectionKey != null) {
    selectionKey.cancel();
  }
  if (e instanceof EOFException) {
    connection.close("Connection closed by the other side",e);
  }
 else {
    connection.close("Exception in " + getClass().getSimpleName(),e);
  }
}
