{
  check();
  if (!buffer.isDirect()) {
    return buffer.array();
  }
 else {
    final ByteBuffer duplicate=buffer.duplicate();
    duplicate.flip();
    final byte newBuffer[]=new byte[duplicate.limit()];
    duplicate.get(newBuffer);
    return newBuffer;
  }
}
