{
  final Config config1=new Config();
  config1.setProperty(GroupProperty.PARTITION_COUNT,String.valueOf(PARTITION_COUNT));
  final TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(2);
  final HazelcastInstance hz1=factory.newHazelcastInstance(config1);
  warmUpPartitions(hz1);
  final InternalMigrationListenerImpl listener=new InternalMigrationListenerImpl();
  final Config config2=new Config();
  config2.setProperty(GroupProperty.PARTITION_COUNT,String.valueOf(PARTITION_COUNT));
  config2.addListenerConfig(new ListenerConfig(listener));
  final HazelcastInstance hz2=factory.newHazelcastInstance(config2);
  waitAllForSafeState(hz1,hz2);
  final List<Integer> hz2PartitionIds=getNodeEngineImpl(hz2).getPartitionService().getMemberPartitions(getAddress(hz2));
  assertEquals(1,hz2PartitionIds.size());
  final int hz2PartitionId=hz2PartitionIds.get(0);
  final List<MigrationProgressNotification> notifications=listener.getNotifications();
  assertEquals(3,notifications.size());
  assertEquals(MigrationProgressEvent.START,notifications.get(0).event);
  assertEquals(hz2PartitionId,notifications.get(0).migrationInfo.getPartitionId());
  assertEquals(MigrationProgressEvent.COMPLETE,notifications.get(1).event);
  assertEquals(hz2PartitionId,notifications.get(1).migrationInfo.getPartitionId());
  assertTrue(notifications.get(1).success);
  assertEquals(MigrationProgressEvent.COMMIT,notifications.get(2).event);
  assertEquals(hz2PartitionId,notifications.get(2).migrationInfo.getPartitionId());
}
