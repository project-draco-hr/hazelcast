{
  NodeServiceImpl nodeService=(NodeServiceImpl)getNodeService();
  final Collection<Operation> tasks=new LinkedList<Operation>();
  for (  Object serviceObject : nodeService.getServices().values()) {
    if (serviceObject instanceof MigrationAwareService) {
      MigrationAwareService service=(MigrationAwareService)serviceObject;
      service.beforeMigration(MigrationEndpoint.SOURCE,partitionId,replicaIndex);
      Operation op=service.prepareMigrationOperation(partitionId,replicaIndex,diffOnly);
      if (op != null) {
        tasks.add(op);
      }
    }
  }
  return tasks;
}
