{
  final ClientEndpoint endpoint=getEndpoint();
  final InternalPartitionService partitionService=getService();
  final PartitionLostListener listener=new PartitionLostListener(){
    @Override public void partitionLost(    PartitionLostEvent event){
      if (endpoint.isAlive()) {
        final PortablePartitionLostEvent portableEvent=new PortablePartitionLostEvent(event.getPartitionId(),event.getLostBackupCount(),event.getEventSource());
        endpoint.sendEvent(null,portableEvent,getCallId());
      }
    }
  }
;
  String registrationId;
  if (localOnly) {
    registrationId=partitionService.addLocalPartitionLostListener(listener);
  }
 else {
    registrationId=partitionService.addPartitionLostListener(listener);
  }
  endpoint.addListenerDestroyAction(SERVICE_NAME,PARTITION_LOST_EVENT_TOPIC,registrationId);
  return registrationId;
}
