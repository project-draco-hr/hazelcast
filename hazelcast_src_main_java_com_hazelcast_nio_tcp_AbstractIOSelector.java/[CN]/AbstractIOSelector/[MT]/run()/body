{
  try {
    while (live) {
      processSelectionQueue();
      if (!live || isInterrupted()) {
        if (logger.isFinestEnabled()) {
          logger.finest(getName() + " is interrupted!");
        }
        live=false;
        return;
      }
      int selectedKeyCount;
      try {
        selectedKeyCount=selector.select(waitTime);
      }
 catch (      Throwable e) {
        logger.warning(e.toString());
        continue;
      }
      if (selectedKeyCount == 0) {
        continue;
      }
      final Set<SelectionKey> setSelectedKeys=selector.selectedKeys();
      final Iterator<SelectionKey> it=setSelectedKeys.iterator();
      while (it.hasNext()) {
        final SelectionKey sk=it.next();
        try {
          it.remove();
          handleSelectionKey(sk);
        }
 catch (        Throwable e) {
          handleSelectorException(e);
        }
      }
    }
  }
 catch (  OutOfMemoryError e) {
    ioService.onOutOfMemory(e);
  }
catch (  Throwable e) {
    logger.warning("Unhandled exception in " + getName(),e);
  }
 finally {
    try {
      if (logger.isFinestEnabled()) {
        logger.finest("Closing selector " + getName());
      }
      selector.close();
    }
 catch (    final Exception ignored) {
    }
  }
}
