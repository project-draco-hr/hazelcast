{
  final int instanceCount=6;
  final TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(instanceCount);
  final Config config=new Config();
  config.setProperty(GroupProperties.PROP_WAIT_SECONDS_BEFORE_JOIN,"0");
  final String mapName=randomMapName();
  config.getMapConfig(mapName).addMapIndexConfig(new MapIndexConfig("name",false));
  final CyclicBarrier barrier=new CyclicBarrier(instanceCount + 1);
  for (int i=0; i < instanceCount; i++) {
    executorService.execute(new Runnable(){
      public void run(){
        final HazelcastInstance hz=nodeFactory.newHazelcastInstance(config);
        hz.getMap(mapName);
        assertClusterSizeEventually(instanceCount,hz,20);
        assertExecutionsDone(barrier);
      }
    }
);
  }
  assertExecutionsDone(barrier);
}
