{
  final int instanceCount=6;
  final TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(instanceCount);
  final Config config=new Config();
  config.setProperty(GroupProperties.PROP_WAIT_SECONDS_BEFORE_JOIN,"0");
  final String mapName=randomMapName();
  config.getMapConfig(mapName).addMapIndexConfig(new MapIndexConfig("name",false));
  ExecutorService ex=Executors.newFixedThreadPool(instanceCount);
  final CountDownLatch latch=new CountDownLatch(instanceCount);
  for (int i=0; i < instanceCount; i++) {
    ex.execute(new Runnable(){
      public void run(){
        final HazelcastInstance hz=nodeFactory.newHazelcastInstance(config);
        hz.getMap(mapName);
        latch.countDown();
      }
    }
);
  }
  assertTrue(latch.await(20,TimeUnit.SECONDS));
}
