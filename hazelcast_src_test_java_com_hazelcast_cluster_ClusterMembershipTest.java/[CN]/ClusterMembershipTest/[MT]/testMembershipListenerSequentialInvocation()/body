{
  final int nodeCount=10;
  final TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(nodeCount);
  final CountDownLatch eventLatch=new CountDownLatch(nodeCount - 1);
  final CountDownLatch nodeLatch=new CountDownLatch(nodeCount - 1);
  Config config=new Config().addListenerConfig(new ListenerConfig().setImplementation(newAddMemberListener(eventLatch)));
  ex=Executors.newFixedThreadPool(nodeCount / 2);
  factory.newHazelcastInstance(config);
  for (int i=1; i < nodeCount; i++) {
    ex.execute(new Runnable(){
      public void run(){
        factory.newHazelcastInstance(new Config());
        nodeLatch.countDown();
      }
    }
);
  }
  assertTrue("Remaining count: " + nodeLatch.getCount(),nodeLatch.await(30,SECONDS));
  assertTrue("Remaining count: " + eventLatch.getCount(),eventLatch.await(30,SECONDS));
}
