{
  if (!connection.live())   return;
  try {
    final int readBytes=socketChannel.read(inBuffer);
    if (readBytes == -1) {
      connection.close();
      return;
    }
    if (readBytes <= 0) {
      return;
    }
  }
 catch (  final Exception e) {
    if (inv != null) {
      inv.returnToContainer();
      inv=null;
    }
    handleSocketException(e);
    return;
  }
  try {
    inBuffer.flip();
    while (true) {
      final int remaining=inBuffer.remaining();
      if (remaining <= 0) {
        inBuffer.clear();
        return;
      }
      if (inv == null) {
        if (remaining >= 12) {
          inv=obtainReadable();
          if (inv == null) {
            throw new RuntimeException(messageRead + " Unknown message type  from " + connection.getEndPoint());
          }
        }
 else {
          inBuffer.compact();
          return;
        }
      }
      final boolean full=inv.read(inBuffer);
      if (full) {
        if (readCount++ % 10000 == 0) {
          logger.log(Level.FINEST,"readHandler count " + readCount);
          readCount=1;
        }
        messageRead++;
        inv.flipBuffers();
        inv.read();
        inv.setFromConnection(connection);
        ClusterService.get().enqueueAndReturn(inv);
        inv=null;
      }
 else {
        if (inBuffer.hasRemaining()) {
          if (DEBUG) {
            throw new RuntimeException("inbuffer has remaining " + inBuffer.remaining());
          }
        }
      }
    }
  }
 catch (  final Throwable t) {
    logger.log(Level.SEVERE,"Fatal Error at ReadHandler for endPoint: " + connection.getEndPoint(),t);
  }
 finally {
    registerOp(inSelector.selector,SelectionKey.OP_READ);
  }
}
