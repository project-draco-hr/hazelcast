{
  if (!connection.live())   return;
  try {
    try {
      final int readBytes=socketChannel.read(inBuffer);
      if (readBytes == -1) {
        connection.close();
        return;
      }
      if (readBytes <= 0) {
        return;
      }
      connection.didRead();
      length+=readBytes;
    }
 catch (    final Exception e) {
      handleSocketException(e);
      return;
    }
    inBuffer.flip();
    while (true) {
      final int remaining=inBuffer.remaining();
      if (remaining <= 0) {
        inBuffer.clear();
        return;
      }
      if (inv == null) {
        if (remaining >= 24) {
          inv=obtainReadable();
          if (inv == null) {
            throw new RuntimeException(messageRead + " Unknown message type  from " + connection.getEndPoint());
          }
        }
 else {
          inBuffer.compact();
          return;
        }
      }
      final boolean full=inv.read(inBuffer);
      if (full) {
        messageRead++;
        inv.flipBuffers();
        inv.read();
        inv.setFromConnection(connection);
        ClusterService.get().enqueueAndReturn(inv);
        inv=null;
      }
 else {
        if (inBuffer.hasRemaining()) {
          if (DEBUG) {
            throw new RuntimeException("inbuffer has remaining " + inBuffer.remaining());
          }
        }
      }
    }
  }
 catch (  final Throwable t) {
    logger.log(Level.INFO,"Fatal Error at ReadHandler : " + t);
  }
 finally {
    registerOp(inSelector.selector,SelectionKey.OP_READ);
  }
}
