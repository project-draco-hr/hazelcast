{
  long joinStartTime=Clock.currentTimeMillis();
  long maxJoinMillis=getMaxJoinMillis();
  while (node.isActive() && !node.joined() && (Clock.currentTimeMillis() - joinStartTime < maxJoinMillis)) {
    Address masterAddressNow=getTargetAddress();
    if (masterAddressNow == null) {
      masterAddressNow=findMasterWithMulticast();
    }
    node.setMasterAddress(masterAddressNow);
    if (node.getMasterAddress() == null || node.getThisAddress().equals(node.getMasterAddress())) {
      node.setAsMaster();
      return;
    }
    if (logger.isFinestEnabled()) {
      logger.finest("Joining to master node: " + node.getMasterAddress());
    }
    if (!node.getMasterAddress().equals(node.getThisAddress())) {
      connectAndSendJoinRequest(node.getMasterAddress());
    }
 else {
      node.setMasterAddress(null);
    }
    try {
      Thread.sleep(500L);
    }
 catch (    InterruptedException ignored) {
    }
  }
}
