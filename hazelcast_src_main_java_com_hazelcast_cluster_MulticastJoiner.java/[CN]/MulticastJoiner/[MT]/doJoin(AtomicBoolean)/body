{
  int tryCount=0;
  long joinStartTime=Clock.currentTimeMillis();
  long maxJoinMillis=node.getGroupProperties().MAX_JOIN_SECONDS.getInteger() * 1000;
  while (node.isActive() && !joined.get() && (Clock.currentTimeMillis() - joinStartTime < maxJoinMillis)) {
    String msg="Joining to master node: " + node.getMasterAddress();
    logger.log(Level.FINEST,msg);
    systemLogService.logJoin(msg);
    Address masterAddressNow=getTargetAddress();
    if (masterAddressNow == null) {
      masterAddressNow=findMasterWithMulticast();
    }
    node.setMasterAddress(masterAddressNow);
    if (masterAddressNow != null) {
      systemLogService.logJoin("Setting master address to " + masterAddressNow);
    }
    if (node.getMasterAddress() == null || node.getThisAddress().equals(node.getMasterAddress())) {
      TcpIpConfig tcpIpConfig=config.getNetworkConfig().getJoin().getTcpIpConfig();
      if (tcpIpConfig != null && tcpIpConfig.isEnabled()) {
        doTCP(joined);
      }
 else {
        node.setAsMaster();
      }
      return;
    }
    if (++tryCount > 49) {
      failedJoiningToMaster(true,tryCount);
    }
    if (!node.getMasterAddress().equals(node.getThisAddress())) {
      connectAndSendJoinRequest(node.getMasterAddress());
    }
 else {
      node.setMasterAddress(null);
      tryCount=0;
    }
    try {
      Thread.sleep(500L);
    }
 catch (    InterruptedException ignored) {
    }
  }
}
