{
  if (recordCachePos == chunkSize) {
    sendChunk(finalRecord);
  }
  int hash=replicatedRecord.getLatestUpdateHash();
  Object key=replicatedRecordStore.unmarshallKey(replicatedRecord.getKey());
  Object value=replicatedRecordStore.unmarshallValue(replicatedRecord.getValue());
  VectorClockTimestamp vectorClockTimestamp=replicatedRecord.getVectorClockTimestamp();
  long originalTtlMillis=replicatedRecord.getTtlMillis();
  long actualTtlMillis=getActualTtl(replicatedRecord);
  if (originalTtlMillis == 0 || actualTtlMillis > 0) {
    recordCache[recordCachePos++]=new ReplicatedRecord(key,value,vectorClockTimestamp,hash,actualTtlMillis);
  }
  if (finalRecord) {
    sendChunk(finalRecord);
  }
}
