{
  if (state != Transaction.State.ACTIVE) {
    throw new IllegalStateException("Transaction is not active!");
  }
  if (threadId != Thread.currentThread().getId()) {
    throw new TransactionException("Transaction cannot span multiple threads!");
  }
  partitions.add(partitionId);
}
