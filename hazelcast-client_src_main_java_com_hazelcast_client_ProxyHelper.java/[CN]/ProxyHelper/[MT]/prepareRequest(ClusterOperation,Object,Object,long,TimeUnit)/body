{
  byte[] k=null;
  byte[] v=null;
  if (key != null) {
    k=toByte(key);
  }
  if (value != null) {
    v=toByte(value);
  }
  Packet packet=createRequestPacket(operation,k,v,ttl,timeunit);
  if (key instanceof PartitionAware) {
    Object partitionKey=((PartitionAware)key).getPartitionKey();
    if (partitionKey == null)     throw new IllegalArgumentException("PartitionKey cannot be null!");
    packet.setKeyHash(Arrays.hashCode(toByte(partitionKey)));
  }
  if (value instanceof PartitionAware) {
    Object partitionKey=((PartitionAware)value).getPartitionKey();
    if (partitionKey == null)     throw new IllegalArgumentException("PartitionKey cannot be null!");
    packet.setValueHash(Arrays.hashCode(toByte(partitionKey)));
  }
  return packet;
}
