{
  Block block=blocks[blockInfo.blockId];
  if (block == null) {
    block=blockInfo;
    blocks[block.blockId]=block;
  }
 else {
    if (thisAddress.equals(block.owner)) {
      if (block.isMigrating()) {
        if (!block.migrationAddress.equals(blockInfo.migrationAddress)) {
          throw new RuntimeException();
        }
      }
 else {
        if (blockInfo.migrationAddress != null) {
          block.migrationAddress=blockInfo.migrationAddress;
        }
      }
    }
 else {
      block.owner=blockInfo.owner;
      block.migrationAddress=blockInfo.migrationAddress;
    }
  }
  if (block.owner != null && block.owner.equals(block.migrationAddress)) {
    block.migrationAddress=null;
  }
}
