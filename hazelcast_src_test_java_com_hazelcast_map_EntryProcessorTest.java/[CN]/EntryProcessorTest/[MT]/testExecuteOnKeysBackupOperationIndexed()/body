{
  Config cfg=getConfig();
  cfg.getMapConfig("test").setBackupCount(1).addMapIndexConfig(new MapIndexConfig("attr1",false));
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(2);
  HazelcastInstance instance1=nodeFactory.newHazelcastInstance(cfg);
  HazelcastInstance instance2=nodeFactory.newHazelcastInstance(cfg);
  IMap<String,TempData> map=instance1.getMap("test");
  HazelcastInstance newPrimary=null;
  map.put("a",new TempData("foo","bar"));
  map.put("b",new TempData("abc","123"));
  map.executeOnKeys(map.keySet(),new DeleteEntryProcessor());
  String a_member_uiid=instance1.getPartitionService().getPartition("a").getOwner().getUuid();
  if (a_member_uiid.equals(instance1.getCluster().getLocalMember().getUuid())) {
    instance1.shutdown();
    newPrimary=instance2;
  }
 else {
    instance2.shutdown();
    newPrimary=instance1;
  }
  IMap<String,TempData> map2=newPrimary.getMap("test");
  Map<String,Object> executedEntries=map2.executeOnEntries(new LoggingEntryProcessor());
  assertEquals(0,executedEntries.size());
}
