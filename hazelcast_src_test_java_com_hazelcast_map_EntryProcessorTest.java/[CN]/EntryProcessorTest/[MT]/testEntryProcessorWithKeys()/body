{
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(2);
  final HazelcastInstance instance1=factory.newHazelcastInstance();
  final HazelcastInstance instance2=factory.newHazelcastInstance();
  final IMap<Object,Object> map=instance2.getMap("map");
  final Set<Object> keys=new HashSet<Object>();
  for (int i=0; i < 4; i++) {
    final String key=generateKeyOwnedBy(instance1);
    keys.add(key);
  }
  SimpleValue simpleValue=new SimpleValue(1);
  for (  Object key : keys) {
    map.put(key,simpleValue);
  }
  map.executeOnKeys(keys,new EntryInc());
  SimpleValue expectedValue=new SimpleValue(2);
  for (  Object key : keys) {
    assertEquals(expectedValue,map.get(key));
  }
  instance1.shutdown();
  for (  Object key : keys) {
    assertEquals(expectedValue,map.get(key));
  }
}
