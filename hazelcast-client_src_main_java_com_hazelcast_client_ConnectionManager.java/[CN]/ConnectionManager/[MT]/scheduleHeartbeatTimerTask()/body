{
  final int TIMEOUT=config.getConnectionTimeout();
  heartbeatTimer.schedule(new TimerTask(){
    @Override public void run(){
      long diff=client.getInRunnable().lastReceived - System.currentTimeMillis();
      try {
        if (diff >= TIMEOUT / 5 && diff < TIMEOUT) {
          logger.log(Level.FINEST,"Being idle for some time, Doing a getMembers() call to ping the server!");
          final CountDownLatch latch=new CountDownLatch(1);
          new Thread(new Runnable(){
            public void run(){
              Set<Member> members=client.getCluster().getMembers();
              if (members != null && members.size() >= 1) {
                latch.countDown();
              }
            }
          }
).start();
          if (!latch.await(10000,TimeUnit.MILLISECONDS)) {
            logger.log(Level.WARNING,"Server didn't respond to client's ping call within 10 seconds!");
          }
        }
 else         if (diff >= TIMEOUT) {
          logger.log(Level.WARNING,"Server didn't respond to client's requests for " + TIMEOUT / 1000 + " seconds. Assuming it is dead, closing the connection!");
          currentConnection.close();
        }
      }
 catch (      InterruptedException e) {
        return;
      }
catch (      IOException ignored) {
      }
    }
  }
,TIMEOUT / 10,TIMEOUT / 10);
}
