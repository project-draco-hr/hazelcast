{
  Integer index;
  if (selectorImbalanceWorkaroundEnabled) {
    String remoteHost=remoteSocketAddress.getHostName();
synchronized (selectorIndexPerHostMap) {
      index=selectorIndexPerHostMap.get(remoteHost);
      if (index == null) {
        index=nextSelectorIndex();
        selectorIndexPerHostMap.put(remoteHost,index);
        logger.info(remoteHost + " no selector index found, retrieving a new one: " + index);
      }
 else {
        logger.info(remoteHost + " selector index found: " + index);
      }
    }
  }
 else {
    index=nextSelectorIndex();
  }
  return index;
}
