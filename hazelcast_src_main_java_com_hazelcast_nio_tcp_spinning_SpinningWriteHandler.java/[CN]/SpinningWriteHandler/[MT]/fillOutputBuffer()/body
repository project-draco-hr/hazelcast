{
  for (; ; ) {
    if (outputBuffer != null && !outputBuffer.hasRemaining()) {
      return;
    }
    if (currentPacket == null) {
      currentPacket=poll();
      if (currentPacket == null) {
        return;
      }
    }
    if (!socketWriter.write(currentPacket,outputBuffer)) {
      return;
    }
    currentPacket=null;
  }
}
