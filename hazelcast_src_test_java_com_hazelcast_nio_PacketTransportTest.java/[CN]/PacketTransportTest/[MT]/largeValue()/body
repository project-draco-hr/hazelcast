{
  HeapData originalData=new HeapData(generateRandomString(100000).getBytes());
  Packet originalPacket=new Packet(originalData);
  Packet clonedPacket=new Packet();
  ByteBuffer bb=ByteBuffer.allocate(20);
  boolean writeCompleted;
  boolean readCompleted;
  do {
    writeCompleted=originalPacket.writeTo(bb);
    bb.flip();
    readCompleted=clonedPacket.readFrom(bb);
    bb.clear();
  }
 while (!writeCompleted);
  assertTrue(readCompleted);
  assertEquals(originalPacket.getHeader(),clonedPacket.getHeader());
  assertEquals(originalPacket.getData(),clonedPacket.getData());
}
