{
  DefaultData originalData=new DefaultData(1,generateRandomString(100000).getBytes());
  Packet originalPacket=new Packet(originalData,mock(PortableContext.class));
  Packet clonedPacket=new Packet(mock(PortableContext.class));
  ByteBuffer bb=ByteBuffer.allocate(20);
  boolean writeCompleted;
  boolean readCompleted;
  do {
    writeCompleted=originalPacket.writeTo(bb);
    bb.flip();
    readCompleted=clonedPacket.readFrom(bb);
    bb.clear();
  }
 while (!writeCompleted);
  assertTrue(readCompleted);
  assertEquals(originalPacket.getHeader(),clonedPacket.getHeader());
  assertEquals(originalPacket.getData(),clonedPacket.getData());
}
