{
  Set<Long> itemIdSet=new HashSet<Long>();
  final Iterator<CollectionItem> iterator=getList().iterator();
  while (iterator.hasNext()) {
    final CollectionItem item=iterator.next();
    final boolean contains=valueSet.contains(item.getValue());
    if ((contains && !retain) || (!contains && retain)) {
      itemIdSet.add(item.getItemId());
      iterator.remove();
    }
  }
  return itemIdSet;
}
