{
  if (listener == null) {
    throw new IllegalArgumentException("Listener required!");
  }
  if (filter == null) {
    throw new IllegalArgumentException("EventFilter required!");
  }
  EventServiceSegment segment=getSegment(serviceName,true);
  Registration reg=new Registration(UUID.randomUUID().toString(),serviceName,topic,filter,nodeEngine.getThisAddress(),listener,localOnly);
  if (!segment.addRegistration(topic,reg)) {
    return null;
  }
  if (!localOnly) {
    invokeRegistrationOnOtherNodes(serviceName,reg);
  }
  return reg;
}
