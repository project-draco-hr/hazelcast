{
  int remaining=src.remaining();
  if (src.hasRemaining()) {
    doCipherUpdate(src);
    cipherBuffer.flip();
    copyToDirectBuffer(cipherBuffer,socketBB);
    if (cipherBuffer.hasRemaining()) {
      cipherBuffer.compact();
    }
 else {
      cipherBuffer.clear();
    }
    return remaining - src.remaining();
  }
  return 0;
}
