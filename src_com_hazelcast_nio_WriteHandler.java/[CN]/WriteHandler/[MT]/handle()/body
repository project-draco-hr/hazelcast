{
  if (writeQueue.size() == 0) {
    ready=true;
    return;
  }
  if (!connection.live())   return;
  try {
    bbOut.clear();
    copyLoop:     while (bbOut.position() < (32 * 1024)) {
      final Invocation inv=(Invocation)writeQueue.poll();
      if (inv == null)       break copyLoop;
      inv.write(bbOut);
      inv.returnToContainer();
    }
    if (bbOut.position() == 0)     return;
    bbOut.flip();
    int remaining=bbOut.remaining();
    int loopCount=0;
    connection.didWrite();
    while (remaining > 0) {
      try {
        final int written=socketChannel.write(bbOut);
        remaining-=written;
        loopCount++;
        if (DEBUG) {
          if (loopCount > 1) {
            logger.log(Level.INFO,"loopcount " + loopCount);
          }
        }
      }
 catch (      final Exception e) {
        handleSocketException(e);
        return;
      }
    }
  }
 catch (  final Throwable t) {
    logger.log(Level.INFO,"Fatal Error: WriteHandler " + t);
  }
 finally {
    ready=false;
    registerWrite();
  }
}
