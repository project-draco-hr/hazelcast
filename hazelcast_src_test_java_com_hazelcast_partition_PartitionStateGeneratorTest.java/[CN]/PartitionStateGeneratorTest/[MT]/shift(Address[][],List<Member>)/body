{
  Set<Address> addresses=new HashSet<Address>();
  for (  Member member : members) {
    addresses.add(((MemberImpl)member).getAddress());
  }
  for (int partitionId=0; partitionId < state.length; partitionId++) {
    Address[] replicas=state[partitionId];
    for (int i=0; i < replicas.length; i++) {
      if (replicas[i] != null && !addresses.contains(replicas[i])) {
        Address[] validAddresses=new Address[PartitionImpl.MAX_REPLICA_COUNT - i];
        int k=0;
        for (int a=i + 1; a < PartitionImpl.MAX_REPLICA_COUNT; a++) {
          Address address=replicas[a];
          if (address != null && addresses.contains(address)) {
            validAddresses[k++]=address;
          }
        }
        for (int a=0; a < k; a++) {
          replicas[i + a]=validAddresses[a];
        }
        for (int a=i + k; a < PartitionImpl.MAX_REPLICA_COUNT; a++) {
          replicas[a]=null;
        }
        break;
      }
    }
  }
}
