{
  NearCacheConfig nearCacheConfig=new NearCacheConfig();
  nearCacheConfig.setInMemoryFormat(inMemoryFormat);
  final NearCacheTestContext nearCacheTestContext=createNearCacheTestAndFillWithData(DEFAULT_CACHE_NAME,nearCacheConfig);
  for (int i=0; i < DEFAULT_RECORD_COUNT; i++) {
    assertNull(nearCacheTestContext.nearCache.get(nearCacheTestContext.serializationService.toData(i)));
  }
  for (int i=0; i < DEFAULT_RECORD_COUNT; i++) {
    nearCacheTestContext.cache.get(i);
  }
  for (int i=0; i < DEFAULT_RECORD_COUNT; i++) {
    final String expectedValue=generateValueFromKey(i);
    final Data keyData=nearCacheTestContext.serializationService.toData(i);
    HazelcastTestSupport.assertTrueEventually(new AssertTask(){
      @Override public void run() throws Exception {
        assertEquals(expectedValue,nearCacheTestContext.nearCache.get(keyData));
      }
    }
);
  }
  nearCacheTestContext.close();
}
