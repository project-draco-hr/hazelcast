{
  final SerializationService ss=client.getSerializationService();
  AuthenticationRequest auth=new AuthenticationRequest(credentials,principal);
  connection.init();
  auth.setOwnerConnection(true);
  SerializableCollection collectionWrapper;
  final ClientInvocation clientInvocation=new ClientInvocation(client,auth,connection);
  final Future<SerializableCollection> future=clientInvocation.invoke();
  try {
    collectionWrapper=ss.toObject(future.get());
  }
 catch (  Exception e) {
    throw ExceptionUtil.rethrow(e,IOException.class);
  }
  final Iterator<Data> iter=collectionWrapper.iterator();
  final Data addressData=iter.next();
  final Address address=ss.toObject(addressData);
  connection.setRemoteEndpoint(address);
  final Data principalData=iter.next();
  principal=ss.toObject(principalData);
}
