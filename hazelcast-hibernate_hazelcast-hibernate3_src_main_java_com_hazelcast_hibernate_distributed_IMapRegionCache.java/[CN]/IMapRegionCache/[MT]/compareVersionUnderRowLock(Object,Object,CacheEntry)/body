{
  if (map.tryLock(key,tryLockAndGetTimeout,TimeUnit.MILLISECONDS)) {
    try {
      final CacheEntry previousEntry=(CacheEntry)map.get(key);
      if (previousEntry == null || versionComparator.compare(currentEntry.getVersion(),previousEntry.getVersion()) > 0) {
        map.set(key,value);
        return true;
      }
 else {
        return false;
      }
    }
  finally {
      map.unlock(key);
    }
  }
 else {
    return false;
  }
}
