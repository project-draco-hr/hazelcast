{
  int testSize=3007;
  SerializationService ss=new DefaultSerializationServiceBuilder().build();
  for (int fetchSize=1; fetchSize < 102; fetchSize++) {
    final CacheConcurrentHashMap<Data,String> cmap=new CacheConcurrentHashMap<Data,String>(1000);
    for (int i=0; i < testSize; i++) {
      Integer key=i;
      final Data data=ss.toData(key);
      String value1="value" + i;
      cmap.put(data,value1);
    }
    int nti=Integer.MAX_VALUE;
    int total=0;
    int remaining=testSize;
    while (remaining > 0 && nti > 0) {
      int fsize=remaining > fetchSize ? fetchSize : remaining;
      final CacheKeyIteratorResult iteratorResult=cmap.fetchNext(nti,fsize);
      final List<Data> keys=iteratorResult.getKeys();
      nti=iteratorResult.getTableIndex();
      remaining-=keys.size();
      total+=keys.size();
    }
    assertEquals(testSize,total);
  }
}
