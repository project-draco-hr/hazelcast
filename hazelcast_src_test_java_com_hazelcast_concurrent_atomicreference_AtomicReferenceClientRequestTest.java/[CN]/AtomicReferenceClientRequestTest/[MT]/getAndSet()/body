{
  IAtomicReference<String> reference=getAtomicReference();
  final SimpleClient client=getClient();
  client.send(new GetAndSetRequest(name,toData(null)));
  assertNull(client.receive());
  assertNull(reference.get());
  client.send(new GetAndSetRequest(name,toData("foo")));
  assertNull(client.receive());
  assertEquals("foo",reference.get());
  client.send(new GetAndSetRequest(name,toData("foo")));
  assertEquals("foo",client.receive());
  assertEquals("foo",reference.get());
  client.send(new GetAndSetRequest(name,toData("bar")));
  assertEquals("foo",client.receive());
  assertEquals("bar",reference.get());
  client.send(new GetAndSetRequest(name,toData(null)));
  assertEquals("bar",client.receive());
  assertNull(reference.get());
}
