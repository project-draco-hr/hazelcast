{
  KeyValueSource<KeyIn,ValueIn> delegate=keyValueSource;
  if (supervisor.getConfiguration().isCommunicateStats()) {
    delegate=new KeyValueSourceFacade<KeyIn,ValueIn>(keyValueSource,supervisor);
  }
  while (true) {
    if (cancelled.get()) {
      return;
    }
    Integer partitionId=findNewPartitionProcessing();
    if (partitionId == null) {
      return;
    }
    if (partitionId == -1) {
      continue;
    }
    try {
      ((PartitionIdAware)keyValueSource).setPartitionId(partitionId);
      delegate.reset();
      if (delegate.open(nodeEngine)) {
        DefaultContext<KeyOut,ValueOut> context=supervisor.getOrCreateContext(MapCombineTask.this);
        processMapping(partitionId,context,delegate);
        delegate.close();
        finalizeMapping(partitionId,context);
      }
 else {
        postponePartitionProcessing(partitionId);
      }
    }
 catch (    Throwable t) {
      notifyRemoteException(supervisor,t);
      if (t instanceof Error) {
        ExceptionUtil.sneakyThrow(t);
      }
    }
  }
}
