{
  if (replicatedMapConfig.getReplicationDelayMillis() == 0) {
    distributeReplicationMessage(message,false);
  }
 else {
    replicationMessageCacheLock.lock();
    try {
      replicationMessageCache.add(message);
      if (replicationMessageCache.size() == 1) {
        ReplicationCachedSenderTask task=new ReplicationCachedSenderTask(this);
        long replicationDelayMillis=replicatedMapConfig.getReplicationDelayMillis();
        executorService.schedule(task,replicationDelayMillis,TimeUnit.MILLISECONDS);
      }
 else {
        if (replicationMessageCache.size() > MAX_MESSAGE_CACHE_SIZE) {
          processMessageCache();
        }
      }
    }
  finally {
      replicationMessageCacheLock.unlock();
    }
  }
}
