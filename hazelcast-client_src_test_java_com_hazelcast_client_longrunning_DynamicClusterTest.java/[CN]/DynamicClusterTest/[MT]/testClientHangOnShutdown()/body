{
  HazelcastInstance h=Hazelcast.newHazelcastInstance(config);
  final HazelcastClient client=newHazelcastClient(h);
  final IMap map=client.getMap("default");
  map.lock("1");
  final CountDownLatch l1=new CountDownLatch(1);
  final CountDownLatch l2=new CountDownLatch(1);
  new Thread(new Runnable(){
    public void run(){
      l1.countDown();
      try {
        map.lock("1");
        fail("Should not lock!!");
      }
 catch (      Exception e) {
        l2.countDown();
      }
    }
  }
).start();
  l1.await(10,SECONDS);
  Thread.sleep(5000);
  h.shutdown();
  assertTrue(l2.await(10,SECONDS));
}
