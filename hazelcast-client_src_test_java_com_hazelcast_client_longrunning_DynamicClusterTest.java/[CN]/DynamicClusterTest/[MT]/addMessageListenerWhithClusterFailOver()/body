{
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(config);
  Map<Integer,HazelcastInstance> memberMap=getMapOfClusterMembers(h1,h2);
  client=newHazelcastClient(h1,h2);
  final ITopic<String> topic=client.getTopic("ABC");
  final CountDownLatch latch=new CountDownLatch(2);
  final String message="Hazelcast Rocks!";
  topic.addMessageListener(new MessageListener<String>(){
    public void onMessage(    String msg){
      if (msg.equals(message)) {
        latch.countDown();
      }
      System.out.println(msg);
    }
  }
);
  topic.publish(message);
  HazelcastInstance h=memberMap.remove(client.getConnectionManager().getConnection().getAddress().getPort());
  h.shutdown();
  System.out.println("Shut down: " + h.getCluster().getLocalMember().getPort());
  Thread.sleep(1000);
  for (int i=0; i < 2; i++) {
    new Thread(new Runnable(){
      public void run(){
        System.out.println("Thread number " + Thread.currentThread().getId());
        topic.publish(message);
      }
    }
).start();
  }
  System.out.println("FINISHED");
  assertTrue(latch.await(5,SECONDS));
}
