{
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance h3=Hazelcast.newHazelcastInstance(config);
  client=newHazelcastClient(h1,h2);
  Map realMap=h3.getMap("default");
  Map<Integer,HazelcastInstance> memberMap=getMapOfClusterMembers(h1,h2);
  Map map=client.getMap("default");
  int counter=0;
  while (counter < 2) {
    try {
      map.put("currentIteratedKey",counter);
    }
 catch (    Throwable e) {
      fail(e.getMessage());
    }
    assertEquals(counter,realMap.get("currentIteratedKey"));
    assertEquals(counter,map.get("currentIteratedKey"));
    final int port=client.getConnectionManager().getConnection().getAddress().getPort();
    memberMap.get(port).shutdown();
    counter++;
  }
  h3.shutdown();
}
