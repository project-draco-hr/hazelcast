{
  Thread[] initialThreads=getAllThreads();
  HazelcastInstance h=Hazelcast.newHazelcastInstance(config);
  HazelcastClient client=newHazelcastClient(h);
  client.getCluster().getMembers();
  h.shutdown();
  Thread.sleep(1000);
  Thread[] threads=getAllThreads();
  List<Thread> listOfThreads=new ArrayList<Thread>(Arrays.asList(threads));
  for (  Thread thread : initialThreads) {
    listOfThreads.remove(thread);
  }
  boolean fail=false;
  for (  Thread t : listOfThreads) {
    if (t != null) {
      if (t.getName().startsWith("hz.")) {
        System.out.println("Thread is active " + t.getName());
        fail=true;
      }
    }
  }
  assertFalse("Some threads are still alive",fail);
}
