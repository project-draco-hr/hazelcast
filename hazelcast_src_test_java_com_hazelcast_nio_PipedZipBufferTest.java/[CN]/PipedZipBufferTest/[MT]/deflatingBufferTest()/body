{
  DeflatingPipedBuffer defBuffer=PipedZipBufferFactory.createDeflatingBuffer(compressedDataLength);
  defBuffer.getOutputStream().write(data);
  int k=defBuffer.deflate();
  Assert.assertTrue("Compressed data should be smaller than actual data!",k < data.length);
  Inflater inf=new Inflater();
  inf.setInput(defBuffer.getOutputBuffer().array(),0,k);
  byte[] data2=new byte[data.length];
  int k2=inf.inflate(data2);
  Assert.assertEquals("Inflated data length should be equal to actual data length!",data.length,k2);
  Assert.assertTrue("Inflated data should be equal to actual data!",Arrays.equals(data,data2));
}
