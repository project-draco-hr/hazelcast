{
  final Node node=nodeEngine.getNode();
  logger.log(Level.FINEST,"Registering core services...");
  registerService(ClusterServiceImpl.SERVICE_NAME,node.getClusterService());
  registerService(PartitionServiceImpl.SERVICE_NAME,node.getPartitionService());
  registerService(ProxyServiceImpl.SERVICE_NAME,nodeEngine.getProxyService());
  registerService(TransactionManagerServiceImpl.SERVICE_NAME,nodeEngine.getTransactionManagerService());
  final ServicesConfig servicesConfigConfig=node.getConfig().getServicesConfig();
  final Map<String,Properties> serviceProps;
  if (servicesConfigConfig != null) {
    if (servicesConfigConfig.isEnableDefaults()) {
      logger.log(Level.FINEST,"Registering default services...");
      registerService(MapService.SERVICE_NAME,new MapService(nodeEngine));
      registerService(LockService.SERVICE_NAME,new LockService(nodeEngine));
      registerService(QueueService.SERVICE_NAME,new QueueService(nodeEngine));
      registerService(TopicService.SERVICE_NAME,new TopicService());
      registerService(CollectionService.SERVICE_NAME,new CollectionService(nodeEngine));
      registerService(DistributedExecutorService.SERVICE_NAME,new DistributedExecutorService());
      registerService(AtomicLongService.SERVICE_NAME,new AtomicLongService());
      registerService(CountDownLatchService.SERVICE_NAME,new CountDownLatchService());
      registerService(SemaphoreService.SERVICE_NAME,new SemaphoreService(nodeEngine));
    }
    serviceProps=new HashMap<String,Properties>();
    final Collection<ServiceConfig> serviceConfigs=servicesConfigConfig.getServiceConfigs();
    for (    ServiceConfig serviceConfig : serviceConfigs) {
      if (serviceConfig.isEnabled()) {
        Object service=serviceConfig.getServiceImpl();
        if (service == null) {
          service=createServiceObject(serviceConfig.getClassName());
        }
        if (service != null) {
          registerService(serviceConfig.getName(),service,serviceConfig.getProperties());
        }
      }
    }
  }
 else {
    serviceProps=Collections.emptyMap();
  }
  for (  Object service : services.values()) {
    if (service instanceof ManagedService) {
      try {
        logger.log(Level.FINEST,"Initializing service -> " + service);
        ((ManagedService)service).init(nodeEngine,serviceProps.get(((ManagedService)service).getServiceName()));
      }
 catch (      Throwable t) {
        logger.log(Level.SEVERE,"Error while initializing service: " + t.getMessage(),t);
      }
    }
    if (service instanceof ClientProtocolService) {
      nodeEngine.getNode().clientCommandService.register((ClientProtocolService)service);
    }
  }
}
