{
  final Node attName=node.getAttributes().getNamedItem("name");
  final String name=getTextContent(attName);
  final Node attSnapshotEnabled=node.getAttributes().getNamedItem("snapshot-enabled");
  final boolean snapshotEnabled=checkTrue(getTextContent(attSnapshotEnabled));
  final WanReplicationConfig wanReplicationConfig=new WanReplicationConfig();
  wanReplicationConfig.setName(name);
  wanReplicationConfig.setSnapshotEnabled(snapshotEnabled);
  for (  Node nodeTarget : new IterableNodeList(node.getChildNodes())) {
    final String nodeName=cleanNodeName(nodeTarget.getNodeName());
    if ("target-cluster".equals(nodeName)) {
      WanTargetClusterConfig wanTarget=new WanTargetClusterConfig();
      String groupName=getAttribute(nodeTarget,"group-name");
      String groupPassword=getAttribute(nodeTarget,"group-password");
      if (groupName != null) {
        wanTarget.setGroupName(groupName);
      }
      if (groupPassword != null) {
        wanTarget.setGroupPassword(groupPassword);
      }
      for (      Node targetChild : new IterableNodeList(nodeTarget.getChildNodes())) {
        final String targetChildName=cleanNodeName(targetChild.getNodeName());
        if ("replication-impl".equals(targetChildName)) {
          String replicationImpl=getTextContent(targetChild);
          if (WanNoDelayReplication.class.getName().equals(replicationImpl) && wanReplicationConfig.isSnapshotEnabled()) {
            throw new InvalidConfigurationException("snapshot-enabled property " + "only can be set to true when used with Enterprise Wan Batch Replication");
          }
          wanTarget.setReplicationImpl(getTextContent(targetChild));
        }
 else         if ("end-points".equals(targetChildName)) {
          for (          Node address : new IterableNodeList(targetChild.getChildNodes())) {
            final String addressNodeName=cleanNodeName(address.getNodeName());
            if ("address".equals(addressNodeName)) {
              String addressStr=getTextContent(address);
              wanTarget.addEndpoint(addressStr);
            }
          }
        }
 else         if ("acknowledge-type".equals(targetChildName)) {
          String acknowledgeType=getTextContent(targetChild);
          wanTarget.setAcknowledgeType(WanAcknowledgeType.valueOf(upperCaseInternal(acknowledgeType)));
        }
      }
      wanReplicationConfig.addTargetClusterConfig(wanTarget);
    }
  }
  config.addWanReplicationConfig(wanReplicationConfig);
}
