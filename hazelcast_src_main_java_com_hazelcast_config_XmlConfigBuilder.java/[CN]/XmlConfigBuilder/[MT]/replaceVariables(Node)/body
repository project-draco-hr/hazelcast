{
  String value=node.getNodeValue();
  StringBuilder sb=new StringBuilder();
  int endIndex=-1;
  int startIndex=value.indexOf("${");
  while (startIndex > -1) {
    endIndex=value.indexOf('}',startIndex);
    if (endIndex == -1) {
      logger.warning("Bad variable syntax. Could not find a closing curly bracket '}' on node: " + node.getLocalName());
      break;
    }
    String variable=value.substring(startIndex + 2,endIndex);
    String variableReplacement=properties.getProperty(variable);
    if (variableReplacement != null) {
      sb.append(variableReplacement);
    }
 else {
      sb.append(value.substring(startIndex,endIndex + 1));
      logger.warning("Could not find a value for property  '" + variable + "' on node: "+ node.getLocalName());
    }
    startIndex=value.indexOf("${",endIndex);
  }
  sb.append(value.substring(endIndex + 1));
  node.setNodeValue(sb.toString());
}
