{
  Config c=new Config();
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(2);
  HazelcastInstance h1=factory.newHazelcastInstance(c);
  Member m1=h1.getCluster().getLocalMember();
  m1.setAttribute("Test",Integer.valueOf(123));
  HazelcastInstance h2=factory.newHazelcastInstance(c);
  assertEquals(2,h2.getCluster().getMembers().size());
  Member member=null;
  for (  Member m : h2.getCluster().getMembers()) {
    if (m == h2.getCluster().getLocalMember())     continue;
    member=m;
  }
  assertNotNull(member);
  assertEquals(m1,member);
  assertNotNull(member.getAttribute("Test"));
  assertEquals(123,member.getAttribute("Test"));
  final CountDownLatch latch=new CountDownLatch(2);
  final MembershipListener listener=new LatchMembershipListener(latch);
  h2.getCluster().addMembershipListener(listener);
  h1.getCluster().addMembershipListener(listener);
  m1.setAttribute("Test2",Integer.valueOf(321));
  latch.await(2,TimeUnit.SECONDS);
  assertNotNull(member.getAttribute("Test2"));
  assertEquals(321,member.getAttribute("Test2"));
  h1.getLifecycleService().shutdown();
  h2.getLifecycleService().shutdown();
}
