{
  validateXID(xid);
switch (flags) {
case TMNOFLAGS:
    if (this.xid != null) {
      final XAException xaException=new XAException(XAException.XAER_DUPID);
      logger.severe("Duplicate xid: " + xid + ", this.xid: "+ this.xid,xaException);
      throw xaException;
    }
  this.xid=xid;
try {
  transactionContext.beginTransaction();
}
 catch (IllegalStateException e) {
  throw new XAException(XAException.XAER_INVAL);
}
break;
case TMRESUME:
case TMJOIN:
break;
default :
throw new XAException(XAException.XAER_INVAL);
}
}
