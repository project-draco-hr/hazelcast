{
  validateXID(xid);
  validateTx(xid,Transaction.State.ACTIVE);
  final Transaction tx=getTransaction();
  try {
    tx.prepare();
  }
 catch (  TransactionException e) {
    throw new XAException(XAException.XAER_RMERR);
  }
  return XAResource.XA_OK;
}
