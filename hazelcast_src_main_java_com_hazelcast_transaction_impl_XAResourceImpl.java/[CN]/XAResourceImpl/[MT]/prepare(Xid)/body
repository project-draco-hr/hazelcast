{
  nullCheck(xid);
  final TransactionImpl transaction=(TransactionImpl)getTransaction();
  final SerializableXid sXid=transaction.getXid();
  if (sXid == null || !sXid.equals(xid)) {
    logger.severe("started xid: " + sXid + " and given xid : "+ xid+ " not equal!!!");
  }
  validateTx(transaction,State.ACTIVE);
  try {
    transaction.prepare();
  }
 catch (  TransactionException e) {
    throw new XAException(XAException.XAER_RMERR);
  }
  return XAResource.XA_OK;
}
