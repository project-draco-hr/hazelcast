{
  nullCheck(xid);
  final Transaction transaction=getTransaction(xid);
  if (onePhase) {
    validateTx(transaction,State.ACTIVE);
    transaction.prepare();
  }
  validateTx(transaction,State.PREPARED);
  try {
    transaction.commit();
    transactionManager.removeManagedTransaction(xid);
  }
 catch (  TransactionException e) {
    throw new XAException(XAException.XAER_RMERR);
  }
}
