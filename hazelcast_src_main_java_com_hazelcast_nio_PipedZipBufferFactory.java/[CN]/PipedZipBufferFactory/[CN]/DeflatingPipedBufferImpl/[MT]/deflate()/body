{
  try {
    deflater.setInput(uncompressedBuffer.array(),0,uncompressedBuffer.position());
    deflater.finish();
    final int count=deflater.deflate(compressedBuffer.array());
    return count;
  }
  finally {
    deflater.reset();
  }
}
