{
  StaticNodeFactory factory=new StaticNodeFactory(5);
  HazelcastInstance hz1=factory.newInstance(new Config());
  HazelcastInstance hz2=factory.newInstance(new Config());
  final ICountDownLatch latch1=hz1.getCountDownLatch("test");
  latch1.setCount(10);
  Thread.sleep(100);
  final ICountDownLatch latch2=hz2.getCountDownLatch("test");
  Assert.assertEquals(10,latch2.getCount());
  latch2.countDown();
  Assert.assertEquals(9,latch1.getCount());
  hz1.getLifecycleService().kill();
  Assert.assertEquals(9,latch2.getCount());
  HazelcastInstance hz3=factory.newInstance(new Config());
  final ICountDownLatch latch3=hz3.getCountDownLatch("test");
  latch3.countDown();
  Assert.assertEquals(8,latch3.getCount());
  hz2.getLifecycleService().kill();
  latch3.countDown();
  Assert.assertEquals(7,latch3.getCount());
  HazelcastInstance hz4=factory.newInstance(new Config());
  HazelcastInstance hz5=factory.newInstance(new Config());
  Thread.sleep(250);
  hz3.getLifecycleService().kill();
  final ICountDownLatch latch4=hz4.getCountDownLatch("test");
  Assert.assertEquals(7,latch4.getCount());
  final ICountDownLatch latch5=hz5.getCountDownLatch("test");
  latch5.countDown();
  Assert.assertEquals(6,latch5.getCount());
  latch5.countDown();
  Assert.assertEquals(5,latch4.getCount());
  Assert.assertEquals(5,latch5.getCount());
}
