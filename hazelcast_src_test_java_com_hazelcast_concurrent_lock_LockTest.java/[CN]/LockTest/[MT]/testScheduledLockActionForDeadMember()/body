{
  final StaticNodeFactory nodeFactory=createNodeFactory(2);
  final HazelcastInstance h1=nodeFactory.newHazelcastInstance(new Config());
  final ILock lock1=h1.getLock("default");
  final HazelcastInstance h2=nodeFactory.newHazelcastInstance(new Config());
  final ILock lock2=h2.getLock("default");
  assertTrue(lock1.tryLock());
  new Thread(new Runnable(){
    public void run(){
      try {
        lock2.lock();
        fail("Shouldn't be able to lock!");
      }
 catch (      Throwable e) {
      }
    }
  }
).start();
  Thread.sleep(5000);
  h2.getLifecycleService().shutdown();
  Thread.sleep(3000);
  lock1.unlock();
  assertTrue(lock1.tryLock());
}
