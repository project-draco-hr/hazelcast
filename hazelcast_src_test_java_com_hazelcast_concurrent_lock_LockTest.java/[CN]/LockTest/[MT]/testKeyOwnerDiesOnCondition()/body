{
  final StaticNodeFactory nodeFactory=createNodeFactory(3);
  final Config config=new Config();
  final HazelcastInstance keyOwner=nodeFactory.newHazelcastInstance(config);
  final HazelcastInstance instance1=nodeFactory.newHazelcastInstance(config);
  final HazelcastInstance instance2=nodeFactory.newHazelcastInstance(config);
  int k=0;
  final AtomicInteger atomicInteger=new AtomicInteger(0);
  while (keyOwner.getCluster().getLocalMember().equals(instance1.getPartitionService().getPartition(k++).getOwner()))   ;
  final int key=k;
  final ILock lock1=instance1.getLock(key);
  final String name="testKeyOwnerDiesOnCondition";
  final ICondition condition1=lock1.newCondition(name);
  Thread t=new Thread(new Runnable(){
    public void run(){
      final ILock lock=instance2.getLock(key);
      final ICondition condition=lock.newCondition(name);
      lock.lock();
      try {
        condition.await();
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
 finally {
        lock.unlock();
      }
      atomicInteger.incrementAndGet();
    }
  }
);
  t.start();
  Thread.sleep(1000);
  lock1.lock();
  keyOwner.getLifecycleService().shutdown();
  condition1.signal();
  lock1.unlock();
  Thread.sleep(1000);
  t.join();
  Assert.assertEquals(1,atomicInteger.get());
}
