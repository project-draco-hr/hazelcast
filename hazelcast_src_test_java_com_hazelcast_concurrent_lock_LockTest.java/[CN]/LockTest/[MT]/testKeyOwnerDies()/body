{
  final TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(3);
  final Config config=new Config();
  final HazelcastInstance keyOwner=nodeFactory.newHazelcastInstance(config);
  final HazelcastInstance instance1=nodeFactory.newHazelcastInstance(config);
  final HazelcastInstance instance2=nodeFactory.newHazelcastInstance(config);
  warmUpPartitions(keyOwner,instance1,instance2);
  final int key=generateKeyOwnedBy(keyOwner);
  final ILock lock1=instance1.getLock(key);
  lock1.lock();
  final CountDownLatch latch=new CountDownLatch(1);
  new Thread(new Runnable(){
    public void run(){
      final ILock lock=instance2.getLock(key);
      lock.lock();
      latch.countDown();
    }
  }
).start();
  keyOwner.getLifecycleService().shutdown();
  Assert.assertTrue(lock1.isLocked());
  Assert.assertTrue(lock1.tryLock());
  lock1.unlock();
  lock1.unlock();
  Assert.assertTrue(latch.await(10,TimeUnit.SECONDS));
}
