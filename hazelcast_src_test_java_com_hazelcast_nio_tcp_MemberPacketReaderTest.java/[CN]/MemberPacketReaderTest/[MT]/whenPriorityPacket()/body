{
  ByteBuffer buffer=ByteBuffer.allocate(1000);
  Packet packet=new Packet(serializationService.toBytes("foobar"));
  packet.setHeader(Packet.HEADER_URGENT);
  packet.writeTo(buffer);
  buffer.flip();
  reader.read(buffer);
  assertEquals(1,packetTransceiver.packets.size());
  Packet found=packetTransceiver.packets.get(0);
  assertEquals(packet,found);
  assertEquals(oldNormalPacketsRead,readHandler.getNormalPacketsReadCounter().get());
  assertEquals(oldPriorityPacketsRead + 1,readHandler.getPriorityPacketsReadCounter().get());
}
