{
  SerializationService ss=new SerializationServiceImpl(1,null);
  final Person person=new Person(111,123L,89.56d,"test-person",new Address("street",987));
  final Data data1=ss.toData(person);
  ObjectDataOutput out=ss.createObjectDataOutput(1024);
  data1.writeData(out);
  byte[] bytes1=out.toByteArray();
  ByteBuffer buffer=ByteBuffer.allocate(1024);
  DataAdapter dataAdapter=new DataAdapter(data1,ss.getSerializationContext());
  dataAdapter.writeTo(buffer);
  Assert.assertEquals(bytes1.length,buffer.position());
  byte[] bytes2=new byte[buffer.position()];
  buffer.flip();
  buffer.get(bytes2);
  Assert.assertEquals(bytes1.length,bytes2.length);
  Assert.assertTrue(Arrays.equals(bytes1,bytes2));
  buffer.flip();
  dataAdapter.reset();
  dataAdapter.readFrom(buffer);
  Data data2=dataAdapter.getData();
  Assert.assertEquals(data1,data2);
}
