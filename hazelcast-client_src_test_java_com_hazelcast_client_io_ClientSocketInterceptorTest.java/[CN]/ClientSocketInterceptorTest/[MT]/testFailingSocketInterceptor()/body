{
  Config config=new Config();
  SocketInterceptorConfig socketInterceptorConfig=new SocketInterceptorConfig();
  MySocketInterceptor mySocketInterceptor=new MySocketInterceptor(true);
  socketInterceptorConfig.setImplementation(mySocketInterceptor).setEnabled(true);
  config.getNetworkConfig().setSocketInterceptorConfig(socketInterceptorConfig);
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(config);
  assertEquals(2,h2.getCluster().getMembers().size());
  assertEquals(2,h1.getCluster().getMembers().size());
  ClientConfig clientConfig=new ClientConfig();
  MySocketInterceptor myClientSocketInterceptor=new MySocketInterceptor(false);
  clientConfig.setSocketInterceptorConfig(new SocketInterceptorConfig().setEnabled(true).setImplementation(myClientSocketInterceptor));
  try {
    HazelcastClient.newHazelcastClient(clientConfig);
    fail("Client should not be able to connect!");
  }
 catch (  IllegalStateException e) {
    assertTrue(mySocketInterceptor.getAcceptFailureCount() > 0);
    assertTrue(myClientSocketInterceptor.getConnectFailureCount() > 0);
  }
}
