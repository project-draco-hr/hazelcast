{
  try {
    while (running) {
      if (!concurrentMapManager.isMaster()) {
        Thread.sleep(1000);
        continue;
      }
      Runnable r;
      while ((r=immediateTasksQueue.poll()) != null) {
        safeRunImmediate(r);
      }
      if (scheduledTasksQueue.isEmpty()) {
        Thread.sleep(1000);
        continue;
      }
      long totalWait=0L;
      while (r == null && totalWait < partitionMigrationInterval) {
        long start=System.currentTimeMillis();
        r=immediateTasksQueue.poll(1,TimeUnit.SECONDS);
        safeRunImmediate(r);
        totalWait+=(System.currentTimeMillis() - start);
      }
      if (running) {
        r=scheduledTasksQueue.poll();
        safeRun(r);
      }
    }
  }
 catch (  InterruptedException e) {
    logger.log(Level.FINEST,"MigrationService is interrupted: " + e.getMessage(),e);
    running=false;
  }
 finally {
    clearTaskQueues();
  }
}
