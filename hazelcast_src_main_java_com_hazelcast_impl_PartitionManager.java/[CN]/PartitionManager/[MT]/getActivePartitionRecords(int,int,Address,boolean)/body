{
  concurrentMapManager.enqueueAndWait(new Processable(){
    public void process(){
      addActiveMigration(partitionId,replicaIndex,newAddress);
    }
  }
);
  long now=System.currentTimeMillis();
  final Collection<CMap> cmaps=concurrentMapManager.maps.values();
  CostAwareRecordList lsResultSet=new CostAwareRecordList(1000);
  for (  final CMap cmap : cmaps) {
    boolean includeCMap=diffOnly ? cmap.getBackupCount() == replicaIndex : cmap.getBackupCount() >= replicaIndex;
    if (includeCMap) {
      for (      Record rec : cmap.mapRecords.values()) {
        if (rec.isActive() && rec.isValid(now)) {
          if (rec.getKeyData() == null || rec.getKeyData().size() == 0) {
            throw new RuntimeException("Record.key is null or empty " + rec.getKeyData());
          }
          if (rec.getBlockId() == partitionId) {
            lsResultSet.add(rec);
            lsResultSet.addCost(rec.getCost());
          }
        }
      }
    }
  }
  return lsResultSet;
}
