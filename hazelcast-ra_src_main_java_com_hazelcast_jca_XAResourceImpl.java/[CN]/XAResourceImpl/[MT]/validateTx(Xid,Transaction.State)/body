{
  final Transaction tx=getTransaction(xid);
  if (tx == null) {
switch (state) {
case ACTIVE:
      if (tx.getState() != Transaction.State.ACTIVE) {
        throw new XAException(XAException.XAER_NOTA);
      }
    break;
case PREPARED:
  if (tx.getState() != Transaction.State.PREPARED) {
    throw new XAException(XAException.XAER_INVAL);
  }
break;
}
}
}
