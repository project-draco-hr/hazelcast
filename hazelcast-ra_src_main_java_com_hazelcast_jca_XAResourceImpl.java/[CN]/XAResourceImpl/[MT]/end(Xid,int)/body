{
  managedConnection.log(Level.FINEST,"XA end: " + xid + ", "+ flags);
  validateXID(xid);
  validateTx(xid,Transaction.State.ACTIVE);
switch (flags) {
case XAResource.TMSUCCESS:
    break;
case XAResource.TMFAIL:
  final Transaction tx=getTransaction(xid);
try {
  tx.rollback();
}
 catch (IllegalStateException e) {
  throw new XAException(XAException.XAER_RMERR);
}
break;
case XAResource.TMSUSPEND:
break;
default :
throw new XAException(XAException.XAER_INVAL);
}
}
