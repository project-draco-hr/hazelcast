{
  AwsConfig awsConfig=new AwsConfig();
  awsConfig.setRegion(TEST_REGION);
  awsConfig.setHostHeader(TEST_HOST);
  awsConfig.setAccessKey(TEST_ACCESS_KEY);
  awsConfig.setSecretKey(TEST_SECRET_KEY);
  DescribeInstances di=new DescribeInstances(awsConfig);
  Field timeField=di.getClass().getDeclaredField("timeStamp");
  timeField.setAccessible(true);
  String timeStamp=(String)timeField.get(di);
  timeStamp=TEST_REQUEST_DATE;
  timeField.set(di,timeStamp);
  Field attributesField=di.getClass().getDeclaredField("attributes");
  attributesField.setAccessible(true);
  Map<String,String> attributes=(Map<String,String>)attributesField.get(di);
  attributes.put("X-Amz-Date",TEST_REQUEST_DATE);
  EC2RequestSigner rs=new EC2RequestSigner(awsConfig,TEST_REQUEST_DATE);
  attributes.put("X-Amz-Credential",rs.createFormattedCredential());
  String signature=rs.sign(TEST_SERVICE,attributes);
  assertEquals(TEST_SIGNATURE_EXPECTED,signature);
}
