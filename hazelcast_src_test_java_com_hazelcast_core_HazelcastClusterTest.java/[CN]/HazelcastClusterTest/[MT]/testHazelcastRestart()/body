{
  HazelcastInstance hz1=Hazelcast.newHazelcastInstance(null);
  HazelcastInstance hz2=Hazelcast.newHazelcastInstance(null);
  assertEquals(2,hz1.getCluster().getMembers().size());
  assertEquals(2,hz2.getCluster().getMembers().size());
  Map map1=hz1.getMap("test");
  Map map2=hz2.getMap("test");
  for (int i=0; i < 1000; i++) {
    map1.put(i,i);
  }
  assertEquals(1000,map2.size());
  hz1.getLifecycleService().restart();
  assertEquals(1000,map2.size());
  assertEquals(1000,map1.size());
  assertEquals(2,hz1.getCluster().getMembers().size());
  assertEquals(2,hz2.getCluster().getMembers().size());
  hz2.getLifecycleService().restart();
  assertEquals(1000,map2.size());
  assertEquals(1000,map1.size());
  assertEquals(2,hz1.getCluster().getMembers().size());
  assertEquals(2,hz2.getCluster().getMembers().size());
}
