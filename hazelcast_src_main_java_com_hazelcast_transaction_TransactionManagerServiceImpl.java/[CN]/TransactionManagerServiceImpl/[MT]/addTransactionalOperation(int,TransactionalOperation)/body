{
  final TransactionKey key=new TransactionKey(transactionalOperation.getTransactionId(),partitionId);
  final TransactionLog transactionLog=ConcurrencyUtil.getOrPutIfAbsent(txLogs,key,logConstructor);
  if (transactionLog.getState() != Transaction.State.ACTIVE) {
    throw new TransactionException("Tx is not active!");
  }
  transactionLog.addOperationRecord(transactionalOperation);
}
