{
  int requestedSyncBackupCount=backupAwareOp.getSyncBackupCount() > 0 ? min(InternalPartition.MAX_BACKUP_COUNT,backupAwareOp.getSyncBackupCount()) : 0;
  int requestedAsyncBackupCount=backupAwareOp.getAsyncBackupCount() > 0 ? min(InternalPartition.MAX_BACKUP_COUNT - requestedSyncBackupCount,backupAwareOp.getAsyncBackupCount()) : 0;
  int totalRequestedBackupCount=requestedSyncBackupCount + requestedAsyncBackupCount;
  if (totalRequestedBackupCount == 0) {
    return 0;
  }
  Operation op=(Operation)backupAwareOp;
  InternalPartitionService partitionService=operationService.node.getPartitionService();
  long[] replicaVersions=partitionService.incrementPartitionReplicaVersions(op.getPartitionId(),totalRequestedBackupCount);
  int maxPossibleBackupCount=partitionService.getMaxBackupCount();
  int syncBackupCount=min(maxPossibleBackupCount,requestedSyncBackupCount);
  int asyncBackupCount=min(maxPossibleBackupCount - syncBackupCount,requestedAsyncBackupCount);
  int totalBackupCount=syncBackupCount + asyncBackupCount;
  if (totalBackupCount == 0) {
    return 0;
  }
  if (!op.returnsResponse()) {
    syncBackupCount=0;
  }
  return makeBackups(backupAwareOp,op.getPartitionId(),replicaVersions,syncBackupCount,totalBackupCount);
}
