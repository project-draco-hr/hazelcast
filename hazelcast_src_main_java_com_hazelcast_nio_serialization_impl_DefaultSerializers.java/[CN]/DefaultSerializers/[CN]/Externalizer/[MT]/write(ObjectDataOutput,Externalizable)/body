{
  out.writeUTF(obj.getClass().getName());
  final ObjectOutputStream objectOutputStream;
  final OutputStream outputStream=(OutputStream)out;
  if (gzipEnabled) {
    objectOutputStream=new ObjectOutputStream(new GZIPOutputStream(outputStream));
  }
 else {
    objectOutputStream=new ObjectOutputStream(outputStream);
  }
  obj.writeExternal(objectOutputStream);
  objectOutputStream.flush();
}
