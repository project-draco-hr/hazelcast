{
  long heapCost=0L;
  final MapService mapService=mapContainer.getMapServiceContext().getService();
  final String mapName=mapContainer.getName();
  final NodeEngine nodeEngine=mapService.getMapServiceContext().getNodeEngine();
  final Address thisAddress=nodeEngine.getThisAddress();
  for (int i=0; i < nodeEngine.getPartitionService().getPartitionCount(); i++) {
    InternalPartition partition=nodeEngine.getPartitionService().getPartition(i,false);
    if (partition.isOwnerOrBackup(thisAddress)) {
      final PartitionContainer container=mapService.getMapServiceContext().getPartitionContainer(i);
      if (container == null) {
        return -1L;
      }
      heapCost+=getRecordStoreHeapCost(mapName,container);
    }
  }
  heapCost+=mapContainer.getNearCacheSizeEstimator().getSize();
  return heapCost;
}
