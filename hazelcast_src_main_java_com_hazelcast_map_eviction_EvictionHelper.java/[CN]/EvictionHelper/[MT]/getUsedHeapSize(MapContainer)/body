{
  long heapCost=0L;
  final MapServiceContext mapServiceContext=mapContainer.getMapServiceContext();
  final String mapName=mapContainer.getName();
  final NodeEngine nodeEngine=mapServiceContext.getNodeEngine();
  final Address thisAddress=nodeEngine.getThisAddress();
  for (int i=0; i < nodeEngine.getPartitionService().getPartitionCount(); i++) {
    InternalPartition partition=nodeEngine.getPartitionService().getPartition(i,false);
    if (partition.isOwnerOrBackup(thisAddress)) {
      final PartitionContainer container=mapServiceContext.getPartitionContainer(i);
      if (container == null) {
        return -1L;
      }
      heapCost+=getRecordStoreHeapCost(mapName,container);
    }
  }
  heapCost+=mapContainer.getNearCacheSizeEstimator().getSize();
  return heapCost;
}
