{
  if (expression != null && returnType == -1) {
    returnType=record.getIndexTypes()[attributeIndex];
  }
  final Long recordId=record.getId();
  Long oldValue=recordValues.get(recordId);
  if (record.isActive()) {
    if (oldValue == null) {
      newRecordIndex(newValue,record);
    }
 else     if (!oldValue.equals(newValue)) {
      removeRecordIndex(oldValue,recordId);
      newRecordIndex(newValue,record);
    }
  }
 else {
    if (oldValue != null) {
      removeRecordIndex(oldValue,recordId);
    }
    recordValues.remove(recordId);
  }
}
