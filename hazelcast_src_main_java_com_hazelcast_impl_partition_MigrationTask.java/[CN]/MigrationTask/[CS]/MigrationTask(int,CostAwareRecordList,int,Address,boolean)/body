{
  this.partitionId=partitionId;
  this.replicaIndex=replicaIndex;
  this.from=from;
  this.recordCount=costAwareRecordList.getRecords().size();
  ByteArrayOutputStream bos=new ByteArrayOutputStream((int)(costAwareRecordList.getCost() / 100));
  DataOutputStream dos=null;
  try {
    bos.write(compress ? 1 : 0);
    if (compress) {
      dos=new DataOutputStream(new DeflaterOutputStream(bos));
    }
 else {
      dos=new DataOutputStream(bos);
    }
    List<Record> lsRecordsToMigrate=costAwareRecordList.getRecords();
    dos.writeInt(lsRecordsToMigrate.size());
    for (    Record record : lsRecordsToMigrate) {
      new DataRecordEntry(record,true).writeData(dos);
    }
  }
  finally {
    IOUtil.closeResource(dos);
  }
  bytesRecordSet=bos.toByteArray();
}
