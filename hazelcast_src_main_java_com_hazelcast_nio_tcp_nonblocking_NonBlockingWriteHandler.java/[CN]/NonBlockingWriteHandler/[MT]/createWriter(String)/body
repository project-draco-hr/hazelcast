{
  if (socketWriter == null) {
    if (CLUSTER.equals(protocol)) {
      configureBuffers(connectionManager.getSocketSendBufferSize());
      socketWriter=new MemberPacketSocketWriter(ioService.createPacketWriter(connection));
      outputBuffer.put(stringToBytes(CLUSTER));
      registerOp(SelectionKey.OP_WRITE);
    }
 else     if (CLIENT_BINARY.equals(protocol)) {
      configureBuffers(connectionManager.getSocketClientSendBufferSize());
      socketWriter=new ClientPacketSocketWriter();
    }
 else     if (CLIENT_BINARY_NEW.equals(protocol)) {
      configureBuffers(connectionManager.getSocketClientSendBufferSize());
      socketWriter=new ClientMessageSocketWriter();
    }
 else {
      configureBuffers(connectionManager.getSocketClientSendBufferSize());
      socketWriter=new SocketTextWriter(connection);
    }
  }
}
