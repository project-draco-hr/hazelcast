{
  bbos.setBufferProvider(bufferProvider);
  bbos.reset();
  if (obj instanceof byte[]) {
    bbos.write((byte)40);
    byte[] bytes=(byte[])obj;
    bbos.writeInt(bytes.length);
    bbos.write((byte[])obj);
  }
 else   if (obj instanceof Long) {
    bbos.write((byte)41);
    bbos.writeLong(((Long)obj).longValue());
  }
 else   if (obj instanceof Integer) {
    bbos.write((byte)42);
    bbos.writeInt(((Integer)obj).intValue());
  }
 else   if (obj instanceof DataSerializable) {
    bbos.write((byte)45);
    bbos.writeUTF(obj.getClass().getName());
    ((DataSerializable)obj).writeData(bbos);
    bbos.writeInt(STREAM_END);
  }
 else   if (obj instanceof String) {
    String str=(String)obj;
    int len=str.length();
    bbos.write((byte)46);
    int block=10000;
    int blockCount=((len / block)) + 1;
    bbos.writeShort(blockCount);
    if (blockCount == 1) {
      bbos.writeUTF(str);
    }
 else {
      for (int i=0; i < blockCount; i++) {
        int start=i * block;
        int end=Math.min((i + 1) * block,len);
        bbos.writeUTF(str.substring(start,end));
      }
    }
  }
 else {
    bbos.write((byte)66);
    ObjectOutputStream os=new ObjectOutputStream(bbos);
    os.writeObject(obj);
  }
  bbos.flush();
}
