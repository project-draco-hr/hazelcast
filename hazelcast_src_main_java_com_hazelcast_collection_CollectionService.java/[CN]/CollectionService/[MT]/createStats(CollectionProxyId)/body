{
  LocalMapStatsImpl stats=new LocalMapStatsImpl();
  long ownedEntryCount=0;
  long backupEntryCount=0;
  long dirtyCount=0;
  long ownedEntryMemoryCost=0;
  long backupEntryMemoryCost=0;
  long hits=0;
  long lockedEntryCount=0;
  long creationTime=Long.MAX_VALUE;
  ClusterServiceImpl clusterService=(ClusterServiceImpl)nodeEngine.getClusterService();
  Address thisAddress=clusterService.getThisAddress();
  for (int i=0; i < nodeEngine.getPartitionService().getPartitionCount(); i++) {
    PartitionInfo partitionInfo=nodeEngine.getPartitionService().getPartitionInfo(i);
    CollectionPartitionContainer partitionContainer=getPartitionContainer(i);
    CollectionContainer collectionContainer=partitionContainer.getCollectionContainer(proxyId);
    if (collectionContainer == null) {
      continue;
    }
    if (partitionInfo.getOwner().equals(thisAddress)) {
      stats.setLastAccessTime(collectionContainer.getLastAccessTime());
      stats.setLastUpdateTime(collectionContainer.getLastUpdateTime());
      creationTime=Math.min(creationTime,collectionContainer.getCreationTime());
      lockedEntryCount+=collectionContainer.getLockedCount();
      for (      CollectionWrapper wrapper : collectionContainer.collections.values()) {
        hits+=wrapper.getHits();
        ownedEntryCount+=wrapper.getCollection().size();
      }
    }
 else {
      int backupCount=collectionContainer.config.getTotalBackupCount();
      for (int j=1; j <= backupCount; j++) {
        Address replicaAddress=partitionInfo.getReplicaAddress(j);
        int memberSize=nodeEngine.getClusterService().getMembers().size();
        int tryCount=3;
        while (memberSize > backupCount && replicaAddress == null && tryCount-- > 0) {
          try {
            Thread.sleep(1000);
          }
 catch (          InterruptedException e) {
            ExceptionUtil.rethrow(e);
          }
          replicaAddress=partitionInfo.getReplicaAddress(j);
        }
        if (replicaAddress != null && replicaAddress.equals(thisAddress)) {
          for (          CollectionWrapper wrapper : collectionContainer.collections.values()) {
            backupEntryCount+=wrapper.getCollection().size();
          }
        }
      }
    }
  }
  stats.setCreationTime(creationTime == Long.MAX_VALUE ? -1 : creationTime);
  stats.setOwnedEntryCount(ownedEntryCount);
  stats.setBackupEntryCount(backupEntryCount);
  stats.setHits(hits);
  stats.setLockedEntryCount(lockedEntryCount);
  stats.setOperationStats(getOrCreateOperationCounter(proxyId).getPublishedStats());
  return stats;
}
