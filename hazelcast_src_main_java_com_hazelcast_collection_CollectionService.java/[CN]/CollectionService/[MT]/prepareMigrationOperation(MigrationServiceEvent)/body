{
  if (event.getPartitionId() < 0 || event.getPartitionId() >= nodeEngine.getPartitionService().getPartitionCount()) {
    return null;
  }
  int replicaIndex=event.getReplicaIndex();
  CollectionPartitionContainer partitionContainer=partitionContainers[event.getPartitionId()];
  Map<CollectionProxyId,Map[]> map=new HashMap<CollectionProxyId,Map[]>(partitionContainer.containerMap.size());
  for (  Map.Entry<CollectionProxyId,CollectionContainer> entry : partitionContainer.containerMap.entrySet()) {
    CollectionProxyId proxyId=entry.getKey();
    CollectionContainer container=entry.getValue();
    if (container.config.getTotalBackupCount() < replicaIndex) {
      continue;
    }
    map.put(proxyId,new Map[]{container.collections,container.locks});
  }
  if (map.isEmpty()) {
    return null;
  }
  return new CollectionMigrationOperation(map);
}
