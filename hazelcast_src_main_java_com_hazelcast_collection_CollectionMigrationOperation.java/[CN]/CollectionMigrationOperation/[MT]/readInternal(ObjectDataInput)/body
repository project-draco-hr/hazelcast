{
  int mapSize=in.readInt();
  map=new HashMap<CollectionProxyId,Map[]>(mapSize);
  for (int i=0; i < mapSize; i++) {
    CollectionProxyId proxyId=new CollectionProxyId();
    proxyId.readData(in);
    int collectionSize=in.readInt();
    Map<Data,Collection<CollectionRecord>> collections=new HashMap<Data,Collection<CollectionRecord>>();
    for (int j=0; j < collectionSize; j++) {
      Data key=new Data();
      key.readData(in);
      int collSize=in.readInt();
      Collection<CollectionRecord> coll=new ArrayList(collSize);
      for (int k=0; k < collSize; k++) {
        long recordId=in.readLong();
        Object obj=in.readObject();
        coll.add(new CollectionRecord(recordId,obj));
      }
      collections.put(key,coll);
    }
    int lockSize=in.readInt();
    Map<Data,LockInfo> locks=new HashMap<Data,LockInfo>(lockSize);
    for (int j=0; j < lockSize; j++) {
      Data key=new Data();
      key.readData(in);
      LockInfo lockInfo=new LockInfo();
      lockInfo.readData(in);
      locks.put(key,lockInfo);
    }
    map.put(proxyId,new Map[]{collections,locks});
  }
}
