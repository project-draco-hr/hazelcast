{
  out.writeInt(map.size());
  for (  Map.Entry<CollectionProxyId,Map[]> entry : map.entrySet()) {
    CollectionProxyId proxyId=entry.getKey();
    proxyId.writeData(out);
    Map<Data,Collection<CollectionRecord>> collections=entry.getValue()[0];
    out.writeInt(collections.size());
    for (    Map.Entry<Data,Collection<CollectionRecord>> collectionEntry : collections.entrySet()) {
      Data key=collectionEntry.getKey();
      key.writeData(out);
      Collection<CollectionRecord> coll=collectionEntry.getValue();
      out.writeInt(coll.size());
      for (      CollectionRecord record : coll) {
        out.writeLong(record.getRecordId());
        out.writeObject(record.getObject());
      }
    }
    Map<Data,LockInfo> locks=entry.getValue()[1];
    out.writeInt(locks.size());
    for (    Map.Entry<Data,LockInfo> lockEntry : locks.entrySet()) {
      Data key=lockEntry.getKey();
      key.writeData(out);
      LockInfo lockInfo=lockEntry.getValue();
      lockInfo.writeData(out);
    }
  }
}
