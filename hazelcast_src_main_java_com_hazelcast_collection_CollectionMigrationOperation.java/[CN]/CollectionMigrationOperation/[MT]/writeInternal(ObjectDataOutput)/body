{
  out.writeInt(map.size());
  for (  Map.Entry<CollectionProxyId,Map> entry : map.entrySet()) {
    CollectionProxyId proxyId=entry.getKey();
    proxyId.writeData(out);
    Map<Data,CollectionWrapper> collections=entry.getValue();
    out.writeInt(collections.size());
    for (    Map.Entry<Data,CollectionWrapper> collectionEntry : collections.entrySet()) {
      Data key=collectionEntry.getKey();
      key.writeData(out);
      CollectionWrapper wrapper=collectionEntry.getValue();
      Collection<CollectionRecord> coll=wrapper.getCollection();
      out.writeInt(coll.size());
      for (      CollectionRecord record : coll) {
        out.writeLong(record.getRecordId());
        out.writeObject(record.getObject());
      }
    }
  }
}
