{
  final Iterator<EventRegistration> iter=registrations.iterator();
  Data eventData=null;
  while (iter.hasNext()) {
    EventRegistration registration=iter.next();
    if (!(registration instanceof Registration)) {
      throw new IllegalArgumentException();
    }
    final Registration reg=(Registration)registration;
    if (reg.isLocal()) {
      executeLocal(serviceName,event,reg);
    }
 else {
      if (eventData == null) {
        eventData=nodeEngine.toData(event);
      }
      final Address subscriber=registration.getSubscriber();
      final Data data=nodeEngine.toData(new EventPacket(registration.getId(),serviceName,eventData));
      sendEventPacket(subscriber,data);
    }
  }
}
