{
  if (isClosed()) {
    throw new IllegalStateException();
  }
  if (cacheName == null) {
    throw new NullPointerException("cacheName must not be null");
  }
  if (configuration == null) {
    throw new NullPointerException("configuration must not be null");
  }
  final CacheConfig<K,V> newCacheConfig=createCacheConfig(cacheName,configuration);
  final ICache<K,V> cacheProxy=createCacheProxy(newCacheConfig);
  final boolean created=createConfigOnPartition(newCacheConfig);
  if (created) {
    addCacheConfigIfAbsentToLocal(newCacheConfig);
    caches.put(newCacheConfig.getNameWithPrefix(),cacheProxy);
    registerListeners(newCacheConfig,cacheProxy);
    return cacheProxy;
  }
 else {
    ICache<?,?> cache=getCacheUnchecked(cacheName);
    CacheConfig cacheConfig=cache.getConfiguration(CacheConfig.class);
    if (cacheConfig.equals(configuration)) {
      return (ICache<K,V>)cache;
    }
  }
  throw new CacheException("A cache named " + cacheName + " already exists.");
}
