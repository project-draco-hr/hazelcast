{
  checkTransactionState();
  final Set<Data> keySet=keySetInternal();
  final Set<Object> keys=new HashSet<Object>(keySet.size());
  final MapService service=getService();
  for (  final Data data : keySet) {
    keys.add(service.toObject(data));
  }
  for (  final Map.Entry<Object,TxnValueWrapper> entry : txMap.entrySet()) {
    if (TxnValueWrapper.Type.NEW.equals(entry.getValue().type)) {
      keys.add(entry.getKey());
    }
 else     if (TxnValueWrapper.Type.REMOVED.equals(entry.getValue().type)) {
      keys.remove(entry.getKey());
    }
  }
  return keys;
}
