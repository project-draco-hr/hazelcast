{
  long callId=op.getCallId();
  Connection conn=op.getConnection();
  if (!sent.compareAndSet(false,true)) {
    throw new ResponseAlreadySentException("Response already sent for call: " + callId + " to "+ conn.getEndPoint()+ ", current-response: "+ obj);
  }
  if (!(obj instanceof Response)) {
    obj=new Response(obj,op.getCallId(),0);
  }
  NodeEngineImpl impl=(NodeEngineImpl)nodeEngine;
  Data data=impl.toData(obj);
  Packet packet=new Packet(data,impl.getSerializationContext());
  packet.setHeader(Packet.HEADER_OP);
  packet.setHeader(Packet.HEADER_RESPONSE);
  if (op instanceof UrgentSystemOperation) {
    packet.setHeader(Packet.HEADER_URGENT);
  }
  impl.send(packet,op.getConnection());
}
