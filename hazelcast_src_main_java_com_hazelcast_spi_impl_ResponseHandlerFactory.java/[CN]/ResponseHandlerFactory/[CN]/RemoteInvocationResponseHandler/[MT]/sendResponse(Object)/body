{
  if (!sent.compareAndSet(false,true)) {
    throw new IllegalStateException("Response already sent for call: " + callId + " to "+ conn.getEndPoint());
  }
  if (!(response instanceof Operation)) {
    response=new Response(response);
  }
  Operation responseOp=(Operation)response;
  responseOp.setCallId(callId);
  nodeService.send(responseOp,partitionId,conn);
}
