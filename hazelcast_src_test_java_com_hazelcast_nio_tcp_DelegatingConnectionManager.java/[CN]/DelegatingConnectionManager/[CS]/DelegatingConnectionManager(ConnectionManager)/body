{
  Preconditions.checkNotNull(connectionManager);
  this.connectionManager=connectionManager;
  if (connectionManager instanceof PacketHandler) {
    packetHandler=(PacketHandler)connectionManager;
  }
 else {
    packetHandler=new PacketHandler(){
      @Override public void handle(      Packet packet) throws Exception {
        throw new UnsupportedOperationException();
      }
    }
;
  }
}
