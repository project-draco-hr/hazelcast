{
  checkIfLoaded();
  final Record record=getRecordOrNull(key,false);
  if (record == null || record.getValue() == null) {
    return null;
  }
  final Object oldValue=record.getValue();
  update=mapServiceContext.interceptPut(name,oldValue,update);
  final long now=getNow();
  update=mapDataStore.add(key,update,now);
  onStore(record);
  updateSizeEstimator(-calculateRecordHeapCost(record));
  setRecordValue(record,update,now);
  updateSizeEstimator(calculateRecordHeapCost(record));
  saveIndex(record);
  evictEntries(now,false);
  return oldValue;
}
