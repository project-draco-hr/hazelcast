{
  resetSizeEstimator();
  resetAccessSequenceNumber();
  Set<Data> keysToPreserve=Collections.emptySet();
  final Map<Data,Record> recordsToPreserve=getLockedRecords();
  if (!recordsToPreserve.isEmpty()) {
    keysToPreserve=recordsToPreserve.keySet();
    updateSizeEstimator(calculateRecordHeapCost(recordsToPreserve.values()));
  }
  addToStagingArea(recordsToPreserve);
  clearRecordsMap(recordsToPreserve);
  return keysToPreserve;
}
