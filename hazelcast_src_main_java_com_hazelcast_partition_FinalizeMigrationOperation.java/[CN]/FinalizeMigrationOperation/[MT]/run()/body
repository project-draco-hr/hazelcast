{
  final Collection<MigrationAwareService> services=getServices();
  final MigrationServiceEvent event=new MigrationServiceEvent(endpoint,getPartitionId(),getReplicaIndex(),type,copyBackReplicaIndex);
  for (  MigrationAwareService service : services) {
    try {
      if (success) {
        service.commitMigration(event);
      }
 else {
        service.rollbackMigration(event);
      }
    }
 catch (    Throwable e) {
      getNodeService().getLogger(FinalizeMigrationOperation.class.getName()).log(Level.WARNING,"Error while finalizing migration -> " + event,e);
    }
  }
  PartitionService partitionService=getService();
  MigrationInfo migrationInfo=partitionService.removeActiveMigration(getPartitionId());
  if (success) {
    NodeServiceImpl nodeService=(NodeServiceImpl)getNodeService();
    nodeService.onPartitionMigrate(migrationInfo);
  }
}
