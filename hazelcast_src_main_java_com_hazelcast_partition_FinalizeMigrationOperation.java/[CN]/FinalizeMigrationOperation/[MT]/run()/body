{
  PartitionServiceImpl partitionService=getService();
  MigrationInfo migrationInfo=partitionService.getActiveMigration(getPartitionId());
  NodeEngineImpl nodeEngine=(NodeEngineImpl)getNodeEngine();
  if (migrationInfo != null) {
    final Collection<MigrationAwareService> services=nodeEngine.getServices(MigrationAwareService.class);
    final PartitionMigrationEvent event=new PartitionMigrationEvent(endpoint,getPartitionId());
    for (    MigrationAwareService service : services) {
      try {
        if (success) {
          service.commitMigration(event);
        }
 else {
          service.rollbackMigration(event);
        }
      }
 catch (      Throwable e) {
        getLogger().warning("Error while finalizing migration -> " + event,e);
      }
    }
    partitionService.removeActiveMigration(getPartitionId());
    if (success) {
      nodeEngine.onPartitionMigrate(migrationInfo);
    }
  }
}
