{
  StringBuilder dump=new StringBuilder();
  ThreadMXBean threadMXBean=ManagementFactory.getThreadMXBean();
  ThreadInfo[] threadInfos=threadMXBean.dumpAllThreads(true,true);
  long currentThreadId=Thread.currentThread().getId();
  for (  ThreadInfo threadInfo : threadInfos) {
    if (threadInfo.getThreadId() == currentThreadId) {
      continue;
    }
    dump.append('"');
    dump.append(threadInfo.getThreadName());
    dump.append("\" ");
    Thread.State state=threadInfo.getThreadState();
    dump.append("\n\tjava.lang.Thread.State: ");
    dump.append(state);
    if (threadInfo.getLockName() != null) {
      dump.append(" on lock=").append(threadInfo.getLockName());
    }
    if (threadInfo.getLockOwnerName() != null) {
      dump.append(" owned by ").append(threadInfo.getLockOwnerName());
      dump.append(" id=").append(threadInfo.getLockOwnerId());
    }
    StackTraceElement[] stackTraceElements=threadInfo.getStackTrace();
    for (    StackTraceElement stackTraceElement : stackTraceElements) {
      dump.append("\n\t\tat ");
      dump.append(stackTraceElement);
    }
    dump.append("\n\n");
  }
  return dump.toString();
}
