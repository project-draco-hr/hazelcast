{
  List<ReplicationMessage> copy=null;
  replicationMessageCacheLock.lock();
  try {
    copy=new ArrayList<ReplicationMessage>(replicationMessageCache);
    replicationMessageCache.clear();
  }
  finally {
    replicationMessageCacheLock.unlock();
  }
  if (copy != null) {
    ReplicationMessage[] replicationMessages=copy.toArray(new ReplicationMessage[copy.size()]);
    MultiReplicationMessage message=new MultiReplicationMessage(name,replicationMessages);
    Collection<EventRegistration> registrations=filterEventRegistrations(eventService.getRegistrations(ReplicatedMapService.SERVICE_NAME,ReplicatedMapService.EVENT_TOPIC_NAME));
    eventService.publishEvent(ReplicatedMapService.SERVICE_NAME,registrations,message,name.hashCode());
  }
}
