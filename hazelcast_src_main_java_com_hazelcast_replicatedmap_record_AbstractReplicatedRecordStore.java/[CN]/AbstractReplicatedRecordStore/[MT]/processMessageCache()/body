{
  ReplicationMessage[] replicationMessages=null;
  replicationMessageCacheLock.lock();
  try {
    final int size=replicationMessageCache.size();
    if (size > 0) {
      replicationMessages=replicationMessageCache.toArray(new ReplicationMessage[size]);
      replicationMessageCache.clear();
    }
  }
  finally {
    replicationMessageCacheLock.unlock();
  }
  if (replicationMessages != null) {
    MultiReplicationMessage message=new MultiReplicationMessage(name,replicationMessages);
    Collection<EventRegistration> registrations=filterEventRegistrations(eventService.getRegistrations(ReplicatedMapService.SERVICE_NAME,ReplicatedMapService.EVENT_TOPIC_NAME));
    eventService.publishEvent(ReplicatedMapService.SERVICE_NAME,registrations,message,name.hashCode());
  }
}
