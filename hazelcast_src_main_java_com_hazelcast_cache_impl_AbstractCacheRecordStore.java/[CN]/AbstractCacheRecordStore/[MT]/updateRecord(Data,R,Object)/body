{
  final Data dataOldValue;
  final Data dataValue;
  Object v=value;
switch (cacheConfig.getInMemoryFormat()) {
case BINARY:
    if (!(value instanceof Data)) {
      v=valueToData(value);
    }
  dataValue=(Data)v;
dataOldValue=(Data)record.getValue();
break;
case OBJECT:
if (value instanceof Data) {
v=dataToValue((Data)value);
dataValue=(Data)value;
}
 else {
dataValue=valueToData(value);
}
dataOldValue=valueToData(record.getValue());
break;
case OFFHEAP:
if (value instanceof Data) {
v=dataToValue((Data)value);
dataValue=(Data)value;
}
 else {
dataValue=valueToData(value);
}
dataOldValue=recordToValue(record);
break;
default :
throw new IllegalArgumentException("Invalid storage format: " + cacheConfig.getInMemoryFormat());
}
record.setValue(v);
if (isEventsEnabled) {
publishEvent(name,CacheEventType.UPDATED,key,dataOldValue,dataValue,true);
}
return record;
}
