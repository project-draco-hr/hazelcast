{
  final int heartBeatInterval=invocation.getHeartBeatInterval();
  if (response == null) {
    long waitMillis=unit.toMillis(timeout);
    if (waitMillis > 0) {
synchronized (this) {
        while (waitMillis > 0 && response == null) {
          long start=Clock.currentTimeMillis();
          this.wait(Math.min(heartBeatInterval,waitMillis));
          long elapsed=Clock.currentTimeMillis() - start;
          waitMillis-=elapsed;
          if (!invocation.isConnectionHealthy(elapsed)) {
            invocation.notifyException(new TargetDisconnectedException());
          }
        }
      }
    }
  }
  return resolveResponse();
}
