{
  if (!connection.headerRead) {
    final byte[] b=new byte[3];
    connection.getInputStream().readFully(b);
    if (!Arrays.equals(HEADER,b)) {
      throw new IllegalStateException("Illegal header " + Arrays.toString(b));
    }
    connection.headerRead=true;
  }
  DataInputStream dis=connection.getInputStream();
  Packet response=new Packet();
  response.readFrom(dis);
  return response;
}
