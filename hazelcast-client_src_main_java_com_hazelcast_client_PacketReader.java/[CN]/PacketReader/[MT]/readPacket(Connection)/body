{
  final DataInputStream dis=connection.getInputStream();
  if (connection.headerRead.compareAndSet(false,true)) {
    final byte[] b=new byte[3];
    dis.readFully(b);
    if (!Arrays.equals(HEADER,b)) {
      throw new IllegalStateException("Illegal header " + Arrays.toString(b));
    }
  }
  Packet response=new Packet();
  response.readFrom(dis);
  return response;
}
