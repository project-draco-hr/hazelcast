{
  try {
    boolean finished=socketChannel.finishConnect();
    if (!finished) {
      socketChannel.register(selector,SelectionKey.OP_CONNECT,Connector.this);
      return;
    }
    if (DEBUG) {
      System.out.println("connected to " + address);
    }
    Connection connection=initChannel(socketChannel,false);
    connection.localPort=localPort;
    ConnectionManager.get().bind(address,connection,false);
  }
 catch (  Exception e) {
    try {
      if (DEBUG) {
        String msg="Couldn't connect to " + address + ", cause: "+ e.getMessage();
        System.out.println(msg);
        ClusterManager.get().publishLog(msg);
        e.printStackTrace();
      }
      socketChannel.close();
      if (numberOfConnectionError++ < 5) {
        if (DEBUG) {
          System.out.println("Couldn't finish connecting, will try again. cause: " + e.getMessage());
        }
        addTask(Connector.this);
      }
 else {
        ConnectionManager.get().failedConnection(address);
      }
    }
 catch (    Exception ignored) {
    }
  }
}
