{
  TestHazelcastInstanceFactory instanceFactory=new TestHazelcastInstanceFactory();
  final HazelcastInstance instance1=instanceFactory.newHazelcastInstance();
  final HazelcastInstance instance2=instanceFactory.newHazelcastInstance();
  final HazelcastInstance instance3=instanceFactory.newHazelcastInstance();
  TestHazelcastInstanceFactory instanceFactory2=new TestHazelcastInstanceFactory();
  final HazelcastInstance instance1_2=instanceFactory2.newHazelcastInstance();
  final HazelcastInstance instance2_2=instanceFactory2.newHazelcastInstance();
  assertTrueEventually(new AssertTask(){
    @Override public void run() throws Exception {
      assertEquals(2,instance1_2.getCluster().getMembers().size());
      assertEquals(2,instance2_2.getCluster().getMembers().size());
    }
  }
);
  assertTrueEventually(new AssertTask(){
    @Override public void run() throws Exception {
      assertEquals(3,instance1.getCluster().getMembers().size());
      assertEquals(3,instance2.getCluster().getMembers().size());
      assertEquals(3,instance3.getCluster().getMembers().size());
    }
  }
);
  instanceFactory.terminateAll();
  instanceFactory2.terminateAll();
}
