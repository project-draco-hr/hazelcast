{
  final HazelcastInstance hz1=Hazelcast.newHazelcastInstance();
  final HazelcastInstance hz2=Hazelcast.newHazelcastInstance();
  ClientConfig clientConfig=new ClientConfig();
  clientConfig.setRedoOperation(true);
  HazelcastInstance client=HazelcastClient.newHazelcastClient(clientConfig);
  final Thread thread=new Thread(){
    public void run(){
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
      hz1.getLifecycleService().shutdown();
    }
  }
;
  final IMap map=client.getMap("m");
  thread.start();
  int expected=1000;
  for (int i=0; i < expected; i++) {
    map.put(i,"item" + i);
  }
  thread.join();
  assertEquals(expected,map.size());
}
