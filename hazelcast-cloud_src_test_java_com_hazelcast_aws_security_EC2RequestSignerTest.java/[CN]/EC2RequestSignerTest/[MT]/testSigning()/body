{
  AwsConfig awsConfig=new AwsConfig();
  awsConfig.setRegion(TEST_REGION).setHostHeader(TEST_HOST).setAccessKey(TEST_ACCESS_KEY).setSecretKey(TEST_SECRET_KEY);
  DescribeInstances di=new DescribeInstances(awsConfig,TEST_HOST);
  Field attributesField=di.getClass().getDeclaredField("attributes");
  attributesField.setAccessible(true);
  Map<String,String> attributes=(Map<String,String>)attributesField.get(di);
  attributes.put("X-Amz-Date",TEST_REQUEST_DATE);
  EC2RequestSigner rs=new EC2RequestSigner(awsConfig,TEST_REQUEST_DATE,TEST_HOST);
  attributes.put("X-Amz-Credential",rs.createFormattedCredential());
  String signature=rs.sign(TEST_SERVICE,attributes);
  assertEquals(TEST_SIGNATURE_EXPECTED,signature);
}
