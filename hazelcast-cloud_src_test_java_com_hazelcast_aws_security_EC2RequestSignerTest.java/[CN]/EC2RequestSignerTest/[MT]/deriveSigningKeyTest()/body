{
  AwsConfig awsConfig=new AwsConfig();
  awsConfig.setRegion(TEST_REGION).setHostHeader(TEST_HOST).setAccessKey(TEST_ACCESS_KEY).setSecretKey(TEST_SECRET_KEY);
  DescribeInstances di=new DescribeInstances(awsConfig,TEST_HOST);
  Field field=di.getClass().getDeclaredField("attributes");
  field.setAccessible(true);
  Map<String,String> attributes=(Map<String,String>)field.get(di);
  attributes.put("X-Amz-Date",TEST_REQUEST_DATE);
  field.set(di,attributes);
  EC2RequestSigner rs=new EC2RequestSigner(awsConfig,TEST_REQUEST_DATE,TEST_HOST);
  field=rs.getClass().getDeclaredField("service");
  field.setAccessible(true);
  field.set(rs,"ec2");
  Method method=rs.getClass().getDeclaredMethod("deriveSigningKey",null);
  method.setAccessible(true);
  byte[] derivedKey=(byte[])method.invoke(rs);
  assertEquals(TEST_DERIVED_EXPECTED,bytesToHex(derivedKey));
}
