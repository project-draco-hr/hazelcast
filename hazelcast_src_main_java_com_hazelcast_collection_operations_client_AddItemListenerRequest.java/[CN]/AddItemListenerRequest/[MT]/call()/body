{
  final ClientEndpoint endpoint=getEndpoint();
  final ClientEngine clientEngine=getClientEngine();
  final CollectionService service=getService();
  ItemListener listener=new ItemListener(){
    public void itemAdded(    ItemEvent item){
      send(item);
    }
    public void itemRemoved(    ItemEvent item){
      send(item);
    }
    private void send(    ItemEvent event){
      if (endpoint.live()) {
        Data item=clientEngine.toData(event.getItem());
        PortableItemEvent portableItemEvent=new PortableItemEvent(item,event.getEventType(),event.getMember().getUuid());
        clientEngine.sendResponse(endpoint,portableItemEvent);
      }
    }
  }
;
  String registrationId=service.addListener(proxyId.getName(),listener,key,includeValue,false);
  endpoint.setListenerRegistration(MapService.SERVICE_NAME,proxyId.getName(),registrationId);
  return registrationId;
}
