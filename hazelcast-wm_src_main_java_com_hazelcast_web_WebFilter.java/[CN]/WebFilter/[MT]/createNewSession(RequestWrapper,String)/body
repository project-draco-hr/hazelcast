{
  String id=existingSessionId != null ? existingSessionId : generateSessionId();
  if (requestWrapper.getOriginalSession(false) != null) {
    LOGGER.finest("Original session exists!!!");
  }
  HttpSession originalSession=requestWrapper.getOriginalSession(true);
  HazelcastHttpSession hazelcastSession=new HazelcastHttpSession(WebFilter.this,id,originalSession,deferredWrite);
  MAP_SESSIONS.put(hazelcastSession.getId(),hazelcastSession);
  String oldHazelcastSessionId=MAP_ORIGINAL_SESSIONS.put(originalSession.getId(),hazelcastSession.getId());
  if (oldHazelcastSessionId != null) {
    if (LOGGER.isFinestEnabled()) {
      LOGGER.finest("!!! Overriding an existing hazelcastSessionId " + oldHazelcastSessionId);
    }
  }
  if (LOGGER.isFinestEnabled()) {
    LOGGER.finest("Created new session with id: " + id);
    LOGGER.finest(MAP_SESSIONS.size() + " is sessions.size and originalSessions.size: " + MAP_ORIGINAL_SESSIONS.size());
  }
  addSessionCookie(requestWrapper,id);
  if (deferredWrite) {
    loadHazelcastSession(hazelcastSession);
  }
  return hazelcastSession;
}
