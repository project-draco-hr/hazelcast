{
  if (session == null || mapSession == null)   return;
  final Enumeration<String> atts=session.getAttributeNames();
  while (atts.hasMoreElements()) {
    session.removeAttribute(atts.nextElement());
  }
  Map mapData=null;
  final Set<Map.Entry> entries=mapSession.entrySet();
  for (  final Map.Entry entry : entries) {
    session.setAttribute((String)entry.getKey(),entry.getValue());
    if (mapData == null) {
      mapData=new HashMap<String,Object>();
    }
    mapData.put(entry.getKey(),entry.getValue());
  }
  session.sessionChanged(session.writeObject(mapData));
  session.setDirty(false);
}
