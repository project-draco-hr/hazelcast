{
  ClassDefinition classDefinition=context.lookupClassDefinition(data);
  FieldDefinition fieldDefinition=context.getFieldDefinition(classDefinition,fieldName);
  if (fieldDefinition != null) {
    FieldType fieldType=fieldDefinition.getType();
    int fieldTypeId=fieldType.getId();
    if (fieldTypeId < 0 || fieldTypeId >= FIELD_EXTRACTORS.length) {
      throw new ArrayIndexOutOfBoundsException("Invalid fieldType: " + fieldTypeId);
    }
    PortableFieldExtractor fieldExtractor=FIELD_EXTRACTORS[fieldTypeId];
    if (fieldExtractor == null) {
      throw new QueryException("Field extractor is not defined: " + fieldTypeId);
    }
    return fieldExtractor;
  }
 else {
    return NULL_PORTABLE_FIELD_EXTRACTOR;
  }
}
