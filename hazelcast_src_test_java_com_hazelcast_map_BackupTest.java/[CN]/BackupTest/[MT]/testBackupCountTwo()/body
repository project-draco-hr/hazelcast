{
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(4);
  Config config=new Config();
  final String name="default";
  final int partitionCount=1111;
  config.setProperty(GroupProperties.PROP_PARTITION_COUNT,String.valueOf(partitionCount));
  MapConfig mapConfig=config.getMapConfig(name);
  final int backupCount=2;
  mapConfig.setBackupCount(backupCount).setStatisticsEnabled(true);
  HazelcastInstance h1=nodeFactory.newHazelcastInstance(config);
  HazelcastInstance h2=nodeFactory.newHazelcastInstance(config);
  IMap map1=h1.getMap(name);
  IMap map2=h2.getMap(name);
  int size=100000;
  for (int i=0; i < size; i++) {
    map1.put(i,i);
  }
  assertEquals(size,getTotalOwnedEntryCount(map1,map2));
  assertEquals(size,getTotalBackupEntryCount(map1,map2));
  HazelcastInstance h3=nodeFactory.newHazelcastInstance(config);
  IMap map3=h3.getMap(name);
  Thread.sleep(3000);
  assertEquals(size,getTotalOwnedEntryCount(map1,map2,map3));
  assertEquals(backupCount * size,getTotalBackupEntryCount(map1,map2,map3));
  HazelcastInstance h4=nodeFactory.newHazelcastInstance(config);
  IMap map4=h4.getMap(name);
  Thread.sleep(3000);
  assertEquals(size,getTotalOwnedEntryCount(map1,map2,map3,map4));
  assertEquals(backupCount * size,getTotalBackupEntryCount(map1,map2,map3,map4));
}
