{
  int size=50000;
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(4);
  final Config config=new Config();
  HazelcastInstance h1=nodeFactory.newHazelcastInstance(config);
  IMap<Integer,Integer> m1=h1.getMap(MAP_NAME);
  for (int i=0; i < size; i++) {
    m1.put(i,i);
  }
  HazelcastInstance h2=nodeFactory.newHazelcastInstance(config);
  IMap<Integer,Integer> m2=h2.getMap(MAP_NAME);
  shutdownAndWait(h1);
  waitForMigrationAndCheckSize(size,h2,m2);
  HazelcastInstance h3=nodeFactory.newHazelcastInstance(config);
  IMap<Integer,Integer> m3=h3.getMap(MAP_NAME);
  shutdownAndWait(h2);
  waitForMigrationAndCheckSize(size,h3,m3);
  HazelcastInstance h4=nodeFactory.newHazelcastInstance(config);
  IMap<Integer,Integer> m4=h4.getMap(MAP_NAME);
  shutdownAndWait(h3);
  waitForMigrationAndCheckSize(size,h4,m4);
}
