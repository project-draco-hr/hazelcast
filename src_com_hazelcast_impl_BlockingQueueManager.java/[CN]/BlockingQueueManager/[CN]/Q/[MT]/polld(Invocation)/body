{
  if (blCurrentTake == null) {
    setCurrentTake();
  }
  boolean invalid=false;
  if (inv.blockId != blCurrentTake.blockId) {
    if (inv.blockId > blCurrentTake.blockId) {
      int size=lsBlocks.size();
      for (int i=0; i < size; i++) {
        Block block=lsBlocks.get(i);
        if (block.blockId == inv.blockId) {
          if (thisAddress.equals(block.address)) {
            blCurrentTake=block;
          }
        }
      }
    }
 else {
      invalid=true;
    }
  }
  if ((blCurrentTake.size() == 0 && blCurrentTake.isFull()) || !thisAddress.equals(blCurrentTake.address)) {
    invalid=true;
  }
  if (invalid) {
    sendRedoResponse(inv);
    return;
  }
  remoteReq.setInvocation(inv);
  if (blCurrentTake.size() == 0) {
    if (remoteReq.hasEnoughTimeToSchedule()) {
      schedulePoll(remoteReq.softCopy());
      inv.returnToContainer();
      return;
    }
  }
 else {
    Data value=null;
    if (inv.operation == OP_B_PEEK) {
      value=peek();
    }
 else {
      value=poll(remoteReq);
    }
    inv.doSet(value,inv.data);
  }
  sendResponse(inv);
}
