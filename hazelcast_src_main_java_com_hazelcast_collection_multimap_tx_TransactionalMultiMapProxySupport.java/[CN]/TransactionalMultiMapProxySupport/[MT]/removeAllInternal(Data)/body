{
  throwExceptionIfNull(key);
  long timeout=tx.getTimeoutMillis();
  long ttl=timeout * 3 / 2;
  Collection<CollectionRecord> coll=txMap.get(key);
  final MultiMapTransactionLog log;
  if (coll == null) {
    CollectionResponse response=lockAndGet(key,timeout,ttl);
    if (response == null) {
      throw new ConcurrentModificationException("Transaction couldn't obtain lock " + getThreadId());
    }
    log=new MultiMapTransactionLog(key,proxyId,ttl,getThreadId(),version);
    version=response.getTxVersion();
    coll=createCollection(response.getRecordCollection(getNodeEngine()));
  }
 else {
    log=(MultiMapTransactionLog)tx.getTransactionLog(getTxLogKey(key));
  }
  txMap.put(key,createCollection());
  TxnRemoveAllOperation operation=new TxnRemoveAllOperation(proxyId,key,coll);
  log.addOperation(operation);
  return coll;
}
