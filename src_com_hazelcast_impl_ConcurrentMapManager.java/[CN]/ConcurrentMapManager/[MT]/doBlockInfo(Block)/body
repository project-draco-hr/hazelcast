{
  Block block=mapBlocks.get(blockInfo.blockId);
  if (block == null) {
    block=blockInfo;
    mapBlocks.put(block.blockId,block);
  }
 else {
    if (block.owner.equals(thisAddress)) {
      if (block.isMigrating()) {
        if (!block.migrationAddress.equals(blockInfo.migrationAddress)) {
          throw new RuntimeException();
        }
      }
 else {
        if (blockInfo.migrationAddress != null) {
          block.migrationAddress=blockInfo.migrationAddress;
        }
      }
    }
 else {
      block.owner=blockInfo.owner;
      block.migrationAddress=blockInfo.migrationAddress;
    }
  }
  if (block.owner.equals(block.migrationAddress)) {
    block.migrationAddress=null;
  }
}
