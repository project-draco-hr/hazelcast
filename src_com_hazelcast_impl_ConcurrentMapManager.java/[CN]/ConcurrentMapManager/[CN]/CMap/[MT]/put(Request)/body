{
  Record record=getRecord(req.key);
  Data oldValue=null;
  if (record == null) {
    record=createNewRecord(req.key,req.value);
  }
 else {
    oldValue=record.getValue();
    record.setValue(req.value);
    record.version++;
    req.key.setNoData();
  }
  req.version=record.version;
  req.longValue=record.copyCount;
  req.key=null;
  req.value=null;
  if (oldValue == null) {
    fireMapEvent(mapListeners,name,EntryEvent.TYPE_ADDED,record,null);
  }
 else {
    fireMapEvent(mapListeners,name,EntryEvent.TYPE_UPDATED,record,null);
  }
  return oldValue;
}
