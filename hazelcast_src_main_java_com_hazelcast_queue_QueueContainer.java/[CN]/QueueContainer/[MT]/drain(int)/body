{
  if (maxSize < 0 || maxSize > getItemQueue().size()) {
    maxSize=getItemQueue().size();
  }
  LinkedHashMap<Long,Data> map=new LinkedHashMap<Long,Data>(maxSize);
  Iterator<QueueItem> iter=getItemQueue().iterator();
  for (int i=0; i < maxSize; i++) {
    QueueItem item=iter.next();
    if (store.isEnabled() && item.getData() == null) {
      try {
        load(item);
      }
 catch (      Exception e) {
        throw new HazelcastException(e);
      }
    }
    map.put(item.getItemId(),item.getData());
  }
  if (store.isEnabled()) {
    try {
      store.deleteAll(map.keySet());
    }
 catch (    Exception e) {
      throw new HazelcastException(e);
    }
  }
  long current=Clock.currentTimeMillis();
  for (int i=0; i < maxSize; i++) {
    QueueItem item=getItemQueue().poll();
    age(item,current);
  }
  scheduleEvictionIfEmpty();
  return map;
}
