{
  final Collection<MemberGroup> oldGroups=memberGroupFactory.createMemberGroups(oldMembers);
  final LinkedList<NodeGroup> groups=createNodeGroups(memberGroupFactory.createMemberGroups(members));
  boolean immediateZero=false;
  boolean immediateOne=false;
  if (oldGroups.size() == 1 && groups.size() > 1) {
    immediateZero=true;
    immediateOne=true;
  }
 else   if (oldGroups.size() > 2 && groups.size() == 2) {
    immediateOne=true;
  }
  PartitionInfo[] newState=arrange(groups,partitionCount,new CopyStateInitializer(currentState));
  finalizeArrangement(currentState,newState,Math.min(groups.size(),PartitionInfo.MAX_REPLICA_COUNT),scheduledQueue,immediateQueue,immediateZero,immediateOne);
  return newState;
}
