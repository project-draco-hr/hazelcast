{
  final BlockingQueue q=new LinkedBlockingQueue();
  MulticastListener listener=new MulticastListener(){
    public void onMessage(    Object msg){
      systemLogService.logJoin("MulticastListener onMessage " + msg);
      if (msg != null && msg instanceof JoinInfo) {
        JoinInfo joinInfo=(JoinInfo)msg;
        if (node.getThisAddress() != null && !node.getThisAddress().equals(joinInfo.address)) {
          q.offer(msg);
        }
      }
    }
  }
;
  node.multicastService.addMulticastListener(listener);
  node.multicastService.send(node.createJoinInfo());
  systemLogService.logJoin("Sent multicast join request");
  try {
    JoinInfo joinInfo=(JoinInfo)q.poll(3,TimeUnit.SECONDS);
    if (joinInfo != null) {
      if (joinInfo.getMemberCount() == 1) {
        Thread.sleep(node.groupProperties.WAIT_SECONDS_BEFORE_JOIN.getInteger() * 1000L * 2);
      }
      if (shouldMerge(joinInfo)) {
        logger.log(Level.WARNING,node.getThisAddress() + " is merging [multicast] to " + joinInfo.address);
        targetAddress=joinInfo.address;
        sendClusterMergeToOthers(targetAddress);
        splitBrainHandler.restart();
        return;
      }
    }
  }
 catch (  InterruptedException ignored) {
  }
catch (  Exception e) {
    if (logger != null) {
      logger.log(Level.WARNING,e.getMessage(),e);
    }
  }
 finally {
    node.multicastService.removeMulticastListener(listener);
  }
}
