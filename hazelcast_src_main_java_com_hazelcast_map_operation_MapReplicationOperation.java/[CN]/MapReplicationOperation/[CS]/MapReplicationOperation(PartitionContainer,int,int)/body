{
  this.setPartitionId(partitionId).setReplicaIndex(replicaIndex);
  SerializationService ss=container.getMapService().getSerializationService();
  data=new HashMap<String,Set<RecordReplicationInfo>>(container.getMaps().size());
  mapInitialLoadInfo=new HashMap<String,Boolean>(container.getMaps().size());
  for (  Entry<String,RecordStore> entry : container.getMaps().entrySet()) {
    RecordStore recordStore=entry.getValue();
    MapContainer mapContainer=recordStore.getMapContainer();
    final MapConfig mapConfig=mapContainer.getMapConfig();
    if (mapConfig.getTotalBackupCount() < replicaIndex) {
      continue;
    }
    String name=entry.getKey();
    if (mapContainer.getStore() != null) {
      mapInitialLoadInfo.put(name,recordStore.isLoaded());
    }
    Set<RecordReplicationInfo> recordSet=new HashSet<RecordReplicationInfo>(recordStore.size());
    for (    Entry<Data,Record> recordEntry : recordStore.getReadonlyRecordMap().entrySet()) {
      Data key=recordEntry.getKey();
      Record record=recordEntry.getValue();
      if (record.getValue() == null) {
        continue;
      }
      RecordReplicationInfo recordReplicationInfo;
      if (replicaIndex == 0) {
        recordReplicationInfo=createScheduledRecordState(mapContainer,recordEntry,key);
      }
 else {
        recordReplicationInfo=new RecordReplicationInfo(record.getKey(),ss.toData(record.getValue()),record.getStatistics());
      }
      recordSet.add(recordReplicationInfo);
    }
    data.put(name,recordSet);
  }
}
