{
  ByteBuffer buffer=ByteBuffer.allocate(1000);
  Packet packet1=new Packet(serializationService.toBytes("packet1"));
  packet1.writeTo(buffer);
  Packet packet2=new Packet(serializationService.toBytes("packet2"));
  packet2.writeTo(buffer);
  Packet packet3=new Packet(serializationService.toBytes("packet3"));
  packet3.writeTo(buffer);
  Packet packet4=new Packet(serializationService.toBytes("packet4"));
  packet4.setHeader(Packet.HEADER_URGENT);
  packet4.writeTo(buffer);
  buffer.flip();
  reader.read(buffer);
  assertEquals(4,dispatcher.packets.size());
  assertEquals(packet1,dispatcher.packets.get(0));
  assertEquals(packet2,dispatcher.packets.get(1));
  assertEquals(packet3,dispatcher.packets.get(2));
  assertEquals(packet4,dispatcher.packets.get(3));
  assertEquals(oldNormalPacketsRead + 3,readHandler.getNormalPacketsReadCounter().get());
  assertEquals(oldPriorityPacketsRead + 1,readHandler.getPriorityPacketsReadCounter().get());
}
