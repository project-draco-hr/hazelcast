{
  Context context=Context.get();
  if (context == null) {
    throw new IllegalStateException("You don't seem to have a lock to unlock.");
  }
  Protocol response=doCommand(key,command,args,data);
  if (context.decrementAndGet(name,key.hashCode()) == 0 && context.noMoreLocks()) {
    Connection connection=context.getConnection();
    Member member=key2Member(key);
    cp.releaseConnection(connection,member);
    Context.remove();
  }
  return response;
}
