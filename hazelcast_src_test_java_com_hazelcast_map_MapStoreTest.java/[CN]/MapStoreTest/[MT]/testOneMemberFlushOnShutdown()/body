{
  TestMapStore testMapStore=new TestMapStore(1,1,1);
  testMapStore.setLoadAllKeys(false);
  Config config=newConfig(testMapStore,200);
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory(3);
  HazelcastInstance h1=nodeFactory.newHazelcastInstance(config);
  IMap map1=h1.getMap("default");
  assertEquals(0,map1.size());
  for (int i=0; i < 100; i++) {
    map1.put(i,i);
  }
  assertEquals(100,map1.size());
  assertEquals(0,testMapStore.getStore().size());
  h1.getLifecycleService().shutdown();
  assertEquals(100,testMapStore.getStore().size());
  assertEquals(1,testMapStore.getDestroyCount());
}
