{
  TestEventBasedMapStore testMapStore=new TestEventBasedMapStore();
  Config config=newConfig(testMapStore,1);
  config.getMapConfig("default").setMaxIdleSeconds(4);
  StaticNodeFactory nodeFactory=new StaticNodeFactory(1);
  HazelcastInstance h1=nodeFactory.newHazelcastInstance(config);
  IMap map=h1.getMap("default");
  final int total=10;
  final CountDownLatch latch=new CountDownLatch(total);
  map.addEntryListener(new EntryAdapter(){
    public void entryEvicted(    EntryEvent event){
      latch.countDown();
    }
  }
,true);
  assertEquals(TestEventBasedMapStore.STORE_EVENTS.LOAD_ALL_KEYS,testMapStore.waitForEvent(10));
  for (int i=0; i < total; i++) {
    map.put(i,"value" + i);
    assertEquals(TestEventBasedMapStore.STORE_EVENTS.LOAD,testMapStore.waitForEvent(5));
  }
  assertNotNull(testMapStore.waitForEvent(20));
  latch.await(10,TimeUnit.SECONDS);
  assertEquals(0,map.size());
  assertEquals(total,testMapStore.getStore().size());
}
