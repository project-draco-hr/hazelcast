{
  final HazelcastInstance[] instances=new HazelcastInstance[count];
  if (MOCK_NETWORK) {
    config=init(config);
    Address[] addresses=createAddresses(count);
    StaticNodeRegistry staticNodeRegistry=new StaticNodeRegistry(addresses);
    for (int i=0; i < count; i++) {
      NodeContext nodeContext=staticNodeRegistry.createNodeContext(addresses[i]);
      instances[i]=HazelcastInstanceFactory.newHazelcastInstance(config,null,nodeContext);
    }
  }
 else {
    for (int i=0; i < count; i++) {
      instances[i]=TEST_CLIENT ? newHazelcastClient() : HazelcastInstanceFactory.newHazelcastInstance(config);
    }
  }
  return instances;
}
