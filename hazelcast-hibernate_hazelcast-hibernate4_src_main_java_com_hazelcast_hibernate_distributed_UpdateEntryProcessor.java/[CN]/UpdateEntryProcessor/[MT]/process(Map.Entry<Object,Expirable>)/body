{
  Expirable expirable=entry.getValue();
  boolean updated;
  if (expirable == null) {
    expirable=new Value(newVersion,timestamp,newValue);
    updated=true;
  }
 else {
    if (expirable.matches(lock)) {
      final ExpiryMarker marker=(ExpiryMarker)expirable;
      if (marker.isConcurrent()) {
        expirable=marker.expire(timestamp);
        updated=false;
      }
 else {
        expirable=new Value(newVersion,timestamp,newValue);
        updated=true;
      }
    }
 else     if (expirable.getValue() == null) {
      return false;
    }
 else {
      expirable=new ExpiryMarker(newVersion,timestamp,nextMarkerId).expire(timestamp);
      updated=false;
    }
  }
  entry.setValue(expirable);
  return updated;
}
