{
  ByteBuffer header=getHeader();
  int headerSize=header.position();
  outputStream.writeInt(headerSize);
  outputStream.writeInt((key == null) ? 0 : key.length);
  outputStream.writeInt((value == null) ? 0 : value.length);
  outputStream.writeByte(PACKET_VERSION);
  outputStream.write(header.array(),0,headerSize);
  if (key != null)   outputStream.write(key);
  if (value != null)   outputStream.write(value);
}
