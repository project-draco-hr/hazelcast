{
  final ByteBuffer writeHeaderBuffer=packetWriter.writeHeaderBuffer;
  writeHeaderBuffer.clear();
  writeHeaderBuffer.position(13);
  writeHeader(packetWriter);
  int size=writeHeaderBuffer.position();
  int headerSize=size - 13;
  writeHeaderBuffer.position(0);
  writeHeaderBuffer.putInt(headerSize);
  writeHeaderBuffer.putInt((key == null) ? 0 : key.length);
  writeHeaderBuffer.putInt((value == null) ? 0 : value.length);
  writeHeaderBuffer.put(PACKET_VERSION);
  outputStream.write(writeHeaderBuffer.array(),0,size);
  if (key != null)   outputStream.write(key);
  if (value != null)   outputStream.write(value);
}
