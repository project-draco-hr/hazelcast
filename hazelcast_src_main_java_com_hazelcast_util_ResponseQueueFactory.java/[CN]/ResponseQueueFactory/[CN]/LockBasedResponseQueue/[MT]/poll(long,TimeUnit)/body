{
  if (timeout < 0) {
    throw new IllegalArgumentException();
  }
  long remaining=unit.toMillis(timeout);
  lock.lock();
  try {
    boolean timedOut=false;
    while (response == null && remaining > 0 && !timedOut) {
      long start=Clock.currentTimeMillis();
      timedOut=noValue.await(remaining,TimeUnit.MILLISECONDS);
      remaining-=(Clock.currentTimeMillis() - start);
    }
    return getAndRemoveResponse();
  }
  finally {
    lock.unlock();
  }
}
