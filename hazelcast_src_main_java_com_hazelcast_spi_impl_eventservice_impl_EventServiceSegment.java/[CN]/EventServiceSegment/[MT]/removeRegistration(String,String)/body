{
  final Registration registration=registrationIdMap.remove(id);
  if (registration != null) {
    final Collection<Registration> all=registrations.get(topic);
    if (all != null) {
      all.remove(registration);
      for (      Registration reg : all) {
        Object listener=reg.getListener();
        if (listener instanceof NotifiableEventListener) {
          ((NotifiableEventListener)listener).onDeregister(service,serviceName,topic,reg);
        }
      }
    }
  }
  return registration;
}
