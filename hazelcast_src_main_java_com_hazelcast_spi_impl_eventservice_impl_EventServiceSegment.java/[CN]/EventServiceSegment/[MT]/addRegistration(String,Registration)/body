{
  final Collection<Registration> registrations=getRegistrations(topic,true);
  if (registrations.add(registration)) {
    registrationIdMap.put(registration.getId(),registration);
    Object listener=registration.getListener();
    if (listener instanceof NotifiableEventListener) {
      ((NotifiableEventListener)listener).onRegister(service,serviceName,topic,registration);
    }
    return true;
  }
  return false;
}
