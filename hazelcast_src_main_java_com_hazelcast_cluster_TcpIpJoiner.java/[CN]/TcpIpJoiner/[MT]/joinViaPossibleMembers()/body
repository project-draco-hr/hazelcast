{
  try {
    blacklistedAddresses.clear();
    Collection<Address> possibleAddresses=getPossibleAddresses();
    boolean foundConnection=tryInitialConnection(possibleAddresses);
    removeBlacklistedAddresses(possibleAddresses);
    if (!foundConnection) {
      logger.finest("This node will assume master role since no possible member where connected to.");
      node.setAsMaster();
      return;
    }
    long maxJoinMillis=getMaxJoinMillis();
    long startTime=Clock.currentTimeMillis();
    while (node.isActive() && !node.joined() && (Clock.currentTimeMillis() - startTime < maxJoinMillis)) {
      tryToJoinPossibleAddresses(possibleAddresses);
      if (node.joined()) {
        return;
      }
      removeBlacklistedAddresses(possibleAddresses);
      if (possibleAddresses.size() == 0) {
        logger.finest("This node will assume master role since none of the possible members accepted join request.");
        node.setAsMaster();
        return;
      }
      boolean masterCandidate=isThisNodeMasterCandidate(possibleAddresses);
      if (masterCandidate) {
        boolean consensus=claimMastership(possibleAddresses);
        if (consensus) {
          if (logger.isFinestEnabled()) {
            logger.finest("Setting myself as master after consensus! " + "Voting endpoints: " + possibleAddresses);
          }
          node.setAsMaster();
          claimingMaster=false;
          return;
        }
      }
      claimingMaster=false;
      lookForMaster(possibleAddresses);
    }
  }
 catch (  Throwable t) {
    logger.severe(t);
  }
}
