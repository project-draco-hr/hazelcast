{
  final SerializationService ss=getNodeEngine().getSerializationService();
  final ExecutorService executor=getNodeEngine().getExecutionService().getExecutor(ExecutionService.QUERY_EXECUTOR);
  final List<Future<ConcurrentMap<Object,QueryableEntry>>> lsFutures=new ArrayList<Future<ConcurrentMap<Object,QueryableEntry>>>(initialPartitions.size());
  for (  final Integer partition : initialPartitions) {
    Future<ConcurrentMap<Object,QueryableEntry>> f=executor.submit(new Callable<ConcurrentMap<Object,QueryableEntry>>(){
      public ConcurrentMap<Object,QueryableEntry> call(){
        final PartitionContainer container=mapService.getPartitionContainer(partition);
        final RecordStore recordStore=container.getRecordStore(name);
        ConcurrentMap<Object,QueryableEntry> partitionResult=null;
        for (        Record record : recordStore.getRecords().values()) {
          Data key=record.getKey();
          Object value=null;
          if (record instanceof CachedDataRecord) {
            CachedDataRecord cachedDataRecord=(CachedDataRecord)record;
            value=cachedDataRecord.getCachedValue();
            if (value == null) {
              value=ss.toObject(cachedDataRecord.getValue());
              cachedDataRecord.setCachedValue(value);
            }
          }
 else           if (record instanceof DataRecord) {
            value=ss.toObject(((DataRecord)record).getValue());
          }
 else {
            value=record.getValue();
          }
          if (value == null) {
            continue;
          }
          final QueryEntry queryEntry=new QueryEntry(ss,key,key,value);
          if (predicate.apply(queryEntry)) {
            if (partitionResult == null) {
              partitionResult=new ConcurrentHashMap<Object,QueryableEntry>();
            }
            partitionResult.put(queryEntry.getIndexKey(),queryEntry);
          }
        }
        return partitionResult;
      }
    }
);
    lsFutures.add(f);
  }
  for (  Future<ConcurrentMap<Object,QueryableEntry>> future : lsFutures) {
    final ConcurrentMap<Object,QueryableEntry> r=future.get();
    if (r != null) {
      for (      QueryableEntry entry : r.values()) {
        result.add(new QueryResultEntryImpl(entry.getKeyData(),entry.getKeyData(),entry.getValueData()));
      }
    }
  }
}
