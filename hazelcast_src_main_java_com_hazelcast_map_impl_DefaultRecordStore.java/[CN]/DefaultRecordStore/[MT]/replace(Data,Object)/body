{
  checkIfLoaded();
  final long now=getNow();
  final Record record=getRecordOrNull(key,now,false);
  if (record == null || record.getValue() == null) {
    return null;
  }
  final Object oldValue=record.getValue();
  update=mapServiceContext.interceptPut(name,oldValue,update);
  update=mapDataStore.add(key,update,now);
  onStore(record);
  updateSizeEstimator(-calculateRecordHeapCost(record));
  updateRecord(record,update,now);
  updateSizeEstimator(calculateRecordHeapCost(record));
  saveIndex(record);
  return oldValue;
}
