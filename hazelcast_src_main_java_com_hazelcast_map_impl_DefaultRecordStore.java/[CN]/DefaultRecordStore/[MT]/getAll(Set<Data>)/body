{
  checkIfLoaded();
  final long now=getNow();
  final MapEntrySet mapEntrySet=new MapEntrySet();
  final Iterator<Data> iterator=keys.iterator();
  while (iterator.hasNext()) {
    final Data key=iterator.next();
    final Record record=getRecordOrNull(key,now,false);
    if (record != null) {
      addMapEntrySet(record.getKey(),record.getValue(),mapEntrySet);
      accessRecord(record);
      iterator.remove();
    }
  }
  final Map entriesLoaded=mapDataStore.loadAll(keys);
  addMapEntrySet(entriesLoaded,mapEntrySet);
  Set<Map.Entry<Data,Data>> entrySet=mapEntrySet.getEntrySet();
  for (  Map.Entry<Data,Data> entry : entrySet) {
    putTransient(entry.getKey(),entry.getValue(),DEFAULT_TTL);
  }
  return mapEntrySet;
}
