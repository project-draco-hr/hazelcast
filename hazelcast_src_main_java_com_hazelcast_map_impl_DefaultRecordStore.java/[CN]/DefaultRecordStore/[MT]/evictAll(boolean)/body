{
  checkIfLoaded();
  final int sizeBeforeEviction=size();
  resetSizeEstimator();
  resetAccessSequenceNumber();
  Map<Data,Record> recordsToPreserve=getLockedRecords();
  updateSizeEstimator(calculateRecordHeapCost(recordsToPreserve.values()));
  flush(recordsToPreserve,backup);
  removeIndexByPreservingKeys(records.keySet(),recordsToPreserve.keySet());
  clearRecordsMap(recordsToPreserve);
  return sizeBeforeEviction - recordsToPreserve.size();
}
