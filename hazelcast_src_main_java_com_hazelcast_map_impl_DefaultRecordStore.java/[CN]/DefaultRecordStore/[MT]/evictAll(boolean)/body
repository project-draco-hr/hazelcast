{
  checkIfLoaded();
  final int sizeBeforeEviction=size();
  resetSizeEstimator();
  resetAccessSequenceNumber();
  Map<Data,Record> recordsToPreserve=getLockedRecords(backup);
  updateSizeEstimator(calculateRecordHeapCost(recordsToPreserve.values()));
  flush(recordsToPreserve,backup);
  removeIndexByPreservingKeys(records.keySet(),recordsToPreserve.keySet());
  clearRecordsMap(recordsToPreserve);
  final int numberOfEvictedEntries=sizeBeforeEviction - recordsToPreserve.size();
  return numberOfEvictedEntries;
}
