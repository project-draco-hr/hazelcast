{
  HazelcastClient client=mock(HazelcastClient.class);
  InetSocketAddress inetSocketAddress=new InetSocketAddress("localhost",5701);
  final Connection connection=mock(Connection.class);
  final CountDownLatch latch=new CountDownLatch(2);
  ConnectionManager connectionManager=new ConnectionManager(client,inetSocketAddress){
    protected Connection getNextConnection(){
      latch.countDown();
      return connection;
    }
  }
;
  ClientBinder binder=mock(ClientBinder.class);
  connectionManager.setBinder(binder);
  connectionManager.getConnection();
  assertEquals(connection,connectionManager.getConnection());
  verify(binder).bind(connection);
  assertEquals(connection,connectionManager.getConnection());
  assertEquals(1,latch.getCount());
}
