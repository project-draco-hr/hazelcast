{
  OperationAccessor.setStartTime(op,Clock.currentTimeMillis());
  try {
    op.beforeRun();
    if (op instanceof WaitSupport) {
      WaitSupport waitSupport=(WaitSupport)op;
      if (waitSupport.shouldWait()) {
        nodeEngine.waitNotifyService.await(waitSupport);
        return;
      }
    }
    op.run();
    final boolean returnsResponse=op.returnsResponse();
    Object response=null;
    if (op instanceof BackupAwareOperation) {
      final BackupAwareOperation backupAwareOp=(BackupAwareOperation)op;
      if (backupAwareOp.shouldBackup()) {
        int syncBackupCount=sendBackups(backupAwareOp);
        if (returnsResponse) {
          response=new ResponseObj(op.getResponse(),op.getCallId(),syncBackupCount);
        }
      }
    }
    if (returnsResponse) {
      if (response == null) {
        response=op.getResponse();
      }
      ResponseHandler responseHandler=op.getResponseHandler();
      if (responseHandler == null) {
        throw new IllegalStateException("ResponseHandler should not be null!");
      }
      responseHandler.sendResponse(response);
    }
    op.afterRun();
    if (op instanceof Notifier) {
      final Notifier notifier=(Notifier)op;
      if (notifier.shouldNotify()) {
        nodeEngine.waitNotifyService.notify(notifier);
      }
    }
  }
 catch (  Throwable e) {
    handleOperationError(op,e);
  }
}
