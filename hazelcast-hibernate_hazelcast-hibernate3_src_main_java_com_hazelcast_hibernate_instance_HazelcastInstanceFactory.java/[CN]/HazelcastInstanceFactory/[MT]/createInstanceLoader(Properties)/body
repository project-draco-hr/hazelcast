{
  boolean useNativeClient=false;
  if (props != null) {
    useNativeClient=CacheEnvironment.isNativeClient(props);
  }
  IHazelcastInstanceLoader loader=null;
  Class loaderClass=null;
  ClassLoader cl=HazelcastInstanceFactory.class.getClassLoader();
  try {
    if (useNativeClient) {
      loaderClass=cl.loadClass(HZ_CLIENT_LOADER_CLASSNAME);
    }
 else {
      loaderClass=cl.loadClass(HZ_INSTANCE_LOADER_CLASSNAME);
    }
    loader=(IHazelcastInstanceLoader)loaderClass.newInstance();
  }
 catch (  Exception e) {
    throw new CacheException(e);
  }
  loader.configure(props);
  return loader;
}
