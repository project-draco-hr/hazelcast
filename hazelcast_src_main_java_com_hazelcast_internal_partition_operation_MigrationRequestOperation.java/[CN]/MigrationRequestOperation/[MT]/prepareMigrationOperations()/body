{
  NodeEngineImpl nodeEngine=(NodeEngineImpl)getNodeEngine();
  PartitionReplicationEvent replicationEvent=new PartitionReplicationEvent(migrationInfo.getPartitionId(),migrationInfo.getDestinationNewReplicaIndex());
  boolean ownerMigration=nodeEngine.getThisAddress().equals(migrationInfo.getSource());
  PartitionMigrationEvent migrationEvent=null;
  if (ownerMigration) {
    migrationEvent=new PartitionMigrationEvent(MigrationEndpoint.SOURCE,migrationInfo.getPartitionId(),migrationInfo.getSourceCurrentReplicaIndex(),migrationInfo.getSourceNewReplicaIndex());
  }
  Collection<Operation> tasks=new LinkedList<Operation>();
  for (  ServiceInfo serviceInfo : nodeEngine.getServiceInfos(MigrationAwareService.class)) {
    MigrationAwareService service=(MigrationAwareService)serviceInfo.getService();
    if (ownerMigration) {
      service.beforeMigration(migrationEvent);
    }
    Operation op=service.prepareReplicationOperation(replicationEvent);
    if (op != null) {
      op.setServiceName(serviceInfo.getName());
      tasks.add(op);
    }
  }
  return tasks;
}
