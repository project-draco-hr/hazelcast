{
  if (!locks.containsKey(threadId)) {
synchronized (locks) {
      if (!locks.containsKey(threadId)) {
        Map<IMap,List<Data>> mapOfLocks=new ConcurrentHashMap<IMap,List<Data>>();
        locks.put(threadId,mapOfLocks);
      }
    }
  }
  Map<IMap,List<Data>> mapOfLocks=locks.get(threadId);
  if (!mapOfLocks.containsKey(map)) {
synchronized (locks.get(threadId)) {
      if (!mapOfLocks.containsKey(map)) {
        List<Data> list=new CopyOnWriteArrayList<Data>();
        mapOfLocks.put(map,list);
      }
    }
  }
  mapOfLocks.get(map).add(keyData);
}
