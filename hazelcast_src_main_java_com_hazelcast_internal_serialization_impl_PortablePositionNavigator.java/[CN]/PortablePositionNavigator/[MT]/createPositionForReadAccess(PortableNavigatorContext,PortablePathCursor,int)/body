{
  FieldType type=ctx.getCurrentFieldType();
  if (type.isArrayType()) {
    if (type == FieldType.PORTABLE_ARRAY) {
      if (index >= 0) {
        return createPositionForPortableArrayAccess(ctx,path,index,SINGLE_CELL_ACCESS);
      }
 else {
        return createPositionForPortableArrayAccess(ctx,path,index,WHOLE_ARRAY_ACCESS);
      }
    }
 else {
      if (index >= 0) {
        return createPositionForSingleCellPrimitiveArrayAccess(ctx,path,index);
      }
      return createPositionForPrimitiveFieldAccess(ctx,path,index);
    }
  }
 else {
    validateNonArrayPosition(path,index);
    if (type == FieldType.PORTABLE) {
      return createPositionForPortableFieldAccess(ctx,path);
    }
    return createPositionForPrimitiveFieldAccess(ctx,path,index);
  }
}
