{
  final long requestId=lastRequestId.incrementAndGet();
  LocalRequestId.set(requestId);
  try {
    final IMap<String,HazelcastAttribute> sessionAttrMap=HazelcastClusterSupport.get().getAttributesMap();
    getNext().invoke(request,response);
    final HazelcastSessionFacade session=(HazelcastSessionFacade)request.getSession(false);
    if (session != null) {
      final List<HazelcastAttribute> touchedAttributes=session.getTouchedAttributes(requestId);
      for (      HazelcastAttribute attribute : touchedAttributes) {
        sessionAttrMap.put(attribute.getKey(),attribute);
      }
    }
  }
  finally {
    LocalRequestId.reset();
  }
}
