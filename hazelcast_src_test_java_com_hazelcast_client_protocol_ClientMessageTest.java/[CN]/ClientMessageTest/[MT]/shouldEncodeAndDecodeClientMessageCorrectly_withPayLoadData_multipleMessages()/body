{
  SafeBuffer byteBuffer=new SafeBuffer(new byte[1024]);
  ClientMessage cmEncode=TestClientMessage.createForEncode(byteBuffer,0);
  cmEncode.setMessageType(7).setVersion((short)3).addFlag(ClientMessage.BEGIN_AND_END_FLAGS).setCorrelationId(1).setPartitionId(77);
  cmEncode.set(BYTE_DATA);
  cmEncode.updateFrameLength();
  final int calculatedFrame1Size=ClientMessage.HEADER_SIZE + ParameterUtil.calculateByteArrayDataSize(BYTE_DATA);
  final int nexMessageOffset=cmEncode.getFrameLength();
  ClientMessage cmEncode2=TestClientMessage.createForEncode(byteBuffer,nexMessageOffset);
  cmEncode2.setMessageType(7).setVersion((short)3).addFlag(ClientMessage.BEGIN_AND_END_FLAGS).setCorrelationId(2).setPartitionId(77);
  cmEncode2.set(BYTE_DATA);
  cmEncode2.updateFrameLength();
  final int calculatedFrame2Size=ClientMessage.HEADER_SIZE + ParameterUtil.calculateByteArrayDataSize(BYTE_DATA);
  ClientMessage cmDecode1=ClientMessage.createForDecode(byteBuffer,0);
  final byte[] cmDecodeVarData=cmDecode1.getByteArray();
  assertEquals(7,cmDecode1.getMessageType());
  assertEquals(3,cmDecode1.getVersion());
  assertEquals(ClientMessage.BEGIN_AND_END_FLAGS,cmDecode1.getFlags());
  assertEquals(1,cmDecode1.getCorrelationId());
  assertEquals(77,cmDecode1.getPartitionId());
  assertEquals(calculatedFrame1Size,cmDecode1.getFrameLength());
  assertArrayEquals(cmDecodeVarData,BYTE_DATA);
  ClientMessage cmDecode2=ClientMessage.createForDecode(byteBuffer,cmDecode1.getFrameLength());
  byte[] cmDecodeVarData2=cmDecode2.getByteArray();
  assertEquals(7,cmDecode2.getMessageType());
  assertEquals(3,cmDecode2.getVersion());
  assertEquals(ClientMessage.BEGIN_AND_END_FLAGS,cmDecode2.getFlags());
  assertEquals(2,cmDecode2.getCorrelationId());
  assertEquals(77,cmDecode2.getPartitionId());
  assertEquals(calculatedFrame2Size,cmDecode2.getFrameLength());
  assertArrayEquals(cmDecodeVarData2,BYTE_DATA);
}
