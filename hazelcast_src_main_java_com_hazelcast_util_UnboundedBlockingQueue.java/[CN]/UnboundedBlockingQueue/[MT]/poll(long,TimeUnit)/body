{
  E e=queue.poll();
  long timeLeft=unit.toMillis(timeout);
synchronized (lock) {
    while (e == null && timeLeft > 0) {
      long now=System.currentTimeMillis();
      lock.wait(Math.min(100,timeLeft));
      timeLeft-=(System.currentTimeMillis() - now);
      e=queue.poll();
    }
  }
  return e;
}
