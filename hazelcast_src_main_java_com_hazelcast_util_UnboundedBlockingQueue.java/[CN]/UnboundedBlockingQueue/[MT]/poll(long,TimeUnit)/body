{
  T t=queue.poll();
  long timeLeft=unit.toMillis(timeout);
synchronized (lock) {
    while (t == null && timeLeft > 0) {
      long now=System.currentTimeMillis();
      lock.wait(Math.min(100,timeLeft));
      timeLeft-=(System.currentTimeMillis() - now);
      t=queue.poll();
    }
  }
  return t;
}
