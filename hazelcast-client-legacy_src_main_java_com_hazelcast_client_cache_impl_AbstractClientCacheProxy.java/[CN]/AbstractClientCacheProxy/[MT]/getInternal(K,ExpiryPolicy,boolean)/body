{
  final long start=System.nanoTime();
  ensureOpen();
  validateNotNull(key);
  final Data keyData=toData(key);
  Object cached=getFromNearCache(keyData,async);
  if (cached != null) {
    return cached;
  }
  CacheGetRequest request=new CacheGetRequest(nameWithPrefix,keyData,expiryPolicy,cacheConfig.getInMemoryFormat());
  ClientInvocationFuture future;
  try {
    final int partitionId=clientContext.getPartitionService().getPartitionId(key);
    final HazelcastClientInstanceImpl client=(HazelcastClientInstanceImpl)clientContext.getHazelcastInstance();
    final ClientInvocation clientInvocation=new ClientInvocation(client,request,partitionId);
    future=clientInvocation.invoke();
  }
 catch (  Exception e) {
    throw ExceptionUtil.rethrow(e);
  }
  if (async) {
    if (nearCache != null) {
      future.andThenInternal(new ExecutionCallback<Data>(){
        public void onResponse(        Data valueData){
          storeInNearCache(keyData,valueData,null);
          if (statisticsEnabled) {
            handleStatisticsOnGet(start,valueData);
          }
        }
        public void onFailure(        Throwable t){
        }
      }
);
    }
    return new DelegatingFuture<V>(future,clientContext.getSerializationService());
  }
 else {
    try {
      Object value=future.get();
      Object result=toObject(value);
      if (nearCache != null) {
        storeInNearCache(keyData,toData(value),(V)result);
      }
      if (statisticsEnabled) {
        handleStatisticsOnGet(start,result);
      }
      return result;
    }
 catch (    Throwable e) {
      throw ExceptionUtil.rethrowAllowedTypeFirst(e,CacheException.class);
    }
  }
}
