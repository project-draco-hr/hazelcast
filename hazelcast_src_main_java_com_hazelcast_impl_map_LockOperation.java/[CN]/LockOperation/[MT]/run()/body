{
  ResponseHandler responseHandler=getResponseHandler();
  MapService mapService=(MapService)getService();
  MapPartition mapPartition=mapService.getMapPartition(getPartitionId(),name);
  LockInfo lock=mapPartition.getOrCreateLock(getKey());
  if (lock.testLock(threadId,getCaller())) {
    boolean locked=lock.lock(getCaller(),threadId,ttl);
    if (locked) {
      GenericBackupOperation backupOp=new GenericBackupOperation(name,dataKey,ttl);
      backupOp.setBackupOpType(GenericBackupOperation.BackupOpType.LOCK);
      int partitionId=getPartitionId();
      int backupCount=mapPartition.getBackupCount();
      try {
        getNodeService().takeBackups(MapService.MAP_SERVICE_NAME,backupOp,partitionId,backupCount,60);
      }
 catch (      Exception ignored) {
      }
    }
    responseHandler.sendResponse(locked);
  }
 else {
    mapPartition.schedule(LockOperation.this);
  }
}
