{
  OperationContext context=getOperationContext();
  ResponseHandler responseHandler=context.getResponseHandler();
  MapService mapService=(MapService)context.getService();
  MapPartition mapPartition=mapService.getMapPartition(context.getPartitionId(),name);
  LockInfo lock=mapPartition.getOrCreateLock(getKey());
  if (lock.testLock(threadId,context.getCaller())) {
    boolean locked=lock.lock(context.getCaller(),threadId,ttl);
    if (locked) {
      GenericBackupOperation backupOp=new GenericBackupOperation(name,dataKey,ttl);
      backupOp.setBackupOpType(GenericBackupOperation.BackupOpType.LOCK);
      int partitionId=context.getPartitionId();
      int backupCount=mapPartition.getBackupCount();
      try {
        context.getNodeService().takeBackups(MapService.MAP_SERVICE_NAME,backupOp,partitionId,backupCount,60);
      }
 catch (      Exception ignored) {
      }
    }
    responseHandler.sendResponse(locked);
  }
 else {
    mapPartition.schedule(LockOperation.this);
  }
}
