{
  IMap<String,Object> map=hz.getMap("default");
  CookieStore cookieStore=new BasicCookieStore();
  assertEquals("true",executeRequest("write",serverPort1,cookieStore));
  String sessionId=findHazelcastSessionId(map);
  assertEquals(2,map.size());
  assertEquals("Writing to the session should have initialized the reference count to 1",1,((Integer)map.get(sessionId)).intValue());
  Thread.sleep(TimeUnit.SECONDS.toMillis(30L));
  assertEquals("value",executeRequest("read",serverPort2,cookieStore));
  assertEquals(2,map.size());
  assertEquals("Accessing the same session from a different node should have incremented the reference count to 2",2,((Integer)map.get(sessionId)).intValue());
  Thread.sleep(TimeUnit.SECONDS.toMillis(45));
  assertEquals(2,map.size());
  assertEquals("Session timeout on one node should have reduced the reference count to 1",1,((Integer)map.get(sessionId)).intValue());
  Thread.sleep(TimeUnit.SECONDS.toMillis(30L));
  assertTrue("Session timeout on both nodes should have removed the IMap entries",map.isEmpty());
}
