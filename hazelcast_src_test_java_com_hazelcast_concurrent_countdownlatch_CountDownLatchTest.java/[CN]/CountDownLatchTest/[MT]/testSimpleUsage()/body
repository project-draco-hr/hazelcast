{
  final int k=5;
  final Config config=new Config();
  TestHazelcastInstanceFactory factory=createHazelcastInstanceFactory(k);
  final HazelcastInstance[] instances=factory.newInstances(config);
  ICountDownLatch latch=instances[0].getCountDownLatch("test");
  latch.trySetCount(k - 1);
  Assert.assertEquals(k - 1,latch.getCount());
  new Thread(){
    public void run(){
      for (int i=1; i < k; i++) {
        try {
          sleep(100);
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
        final ICountDownLatch l=instances[i].getCountDownLatch("test");
        l.countDown();
        Assert.assertEquals(k - 1 - i,l.getCount());
      }
    }
  }
.start();
  try {
    Assert.assertTrue(latch.await(5000,TimeUnit.MILLISECONDS));
  }
 catch (  Exception e) {
    e.printStackTrace();
    Assert.fail(e.getMessage());
  }
  Assert.assertEquals(0,latch.getCount());
}
