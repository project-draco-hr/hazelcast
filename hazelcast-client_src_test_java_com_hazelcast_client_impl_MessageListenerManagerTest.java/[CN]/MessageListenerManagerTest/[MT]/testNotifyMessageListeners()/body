{
  final MessageListenerManager manager=new MessageListenerManager();
  final String name="default";
  assertTrue(manager.noListenerRegistered(name));
  final String myMessage="my myMessage";
  final CountDownLatch latch=new CountDownLatch(1);
  MessageListener listener=new MessageListener(){
    public void onMessage(    Object message){
      if (message.equals(myMessage)) {
        latch.countDown();
      }
    }
  }
;
  manager.registerListener(name,listener);
  assertFalse(manager.noListenerRegistered(name));
  new Thread(new Runnable(){
    public void run(){
      Packet packet=new Packet();
      packet.setName(name);
      packet.setKey(toByte(myMessage));
      manager.notifyMessageListeners(packet);
    }
  }
).start();
  assertTrue(latch.await(10,TimeUnit.SECONDS));
}
