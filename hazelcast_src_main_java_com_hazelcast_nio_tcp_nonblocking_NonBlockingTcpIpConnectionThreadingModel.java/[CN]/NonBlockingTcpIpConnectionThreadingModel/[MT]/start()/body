{
  NonBlockingIOThreadOutOfMemoryHandler oomeHandler=new NonBlockingIOThreadOutOfMemoryHandler(){
    @Override public void handle(    OutOfMemoryError error){
      ioService.onOutOfMemory(error);
    }
  }
;
  for (int i=0; i < inputThreads.length; i++) {
    NonBlockingInputThread thread=new NonBlockingInputThread(ioService.getThreadGroup(),ioService.getThreadPrefix() + "in-" + i,ioService.getLogger(NonBlockingInputThread.class.getName()),oomeHandler);
    inputThreads[i]=thread;
    metricsRegistry.scanAndRegister(thread,"tcp." + thread.getName());
    thread.start();
  }
  for (int i=0; i < outputThreads.length; i++) {
    NonBlockingOutputThread thread=new NonBlockingOutputThread(ioService.getThreadGroup(),ioService.getThreadPrefix() + "out-" + i,ioService.getLogger(NonBlockingOutputThread.class.getName()),oomeHandler);
    outputThreads[i]=thread;
    metricsRegistry.scanAndRegister(thread,"tcp." + thread.getName());
    thread.start();
  }
  startIOBalancer();
}
