{
  final InternalPartitionService partitionService=getService(getServiceName());
  final PartitionLostListener listener=new PartitionLostListener(){
    @Override public void partitionLost(    PartitionLostEvent event){
      if (endpoint.isAlive()) {
        ClientMessage eventMessage=ClientAddPartitionLostListenerCodec.encodePartitionLostEvent(event.getPartitionId(),event.getLostBackupCount(),event.getEventSource());
        sendClientMessage(null,eventMessage);
      }
    }
  }
;
  final String registrationId=partitionService.addPartitionLostListener(listener);
  endpoint.setListenerRegistration(getServiceName(),PARTITION_LOST_EVENT_TOPIC,registrationId);
  return registrationId;
}
