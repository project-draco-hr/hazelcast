{
  if (state != Transaction.State.ACTIVE) {
    throw new TransactionNotActiveException("Transaction is not active!");
  }
  if (transactionLog instanceof KeyAwareTransactionLog) {
    KeyAwareTransactionLog keyAwareTransactionLog=(KeyAwareTransactionLog)transactionLog;
    TransactionLog removed=txLogMap.remove(keyAwareTransactionLog.getKey());
    if (removed != null) {
      txLogs.remove(removed);
    }
  }
  txLogs.add(transactionLog);
  if (transactionLog instanceof KeyAwareTransactionLog) {
    KeyAwareTransactionLog keyAwareTransactionLog=(KeyAwareTransactionLog)transactionLog;
    txLogMap.put(keyAwareTransactionLog.getKey(),keyAwareTransactionLog);
  }
}
