{
  try {
    if (!running && multicastSocket.isClosed()) {
      return;
    }
    try {
      multicastSocket.close();
    }
 catch (    Throwable ignored) {
    }
    running=false;
    if (!stopLatch.await(5,TimeUnit.SECONDS)) {
      logger.log(Level.WARNING,"Failed to shutdown MulticastService in 5 seconds!");
    }
  }
 catch (  Throwable e) {
    logger.log(Level.WARNING,e.getMessage(),e);
  }
}
