{
  try {
    try {
      multicastSocket.close();
    }
 catch (    Throwable ignored) {
    }
    final CountDownLatch l=new CountDownLatch(1);
    queue.put(new Runnable(){
      public void run(){
        running=false;
        try {
          inflatingBuffer.destroy();
          deflatingBuffer.destroy();
          datagramPacketReceive.setData(new byte[0]);
          datagramPacketSend.setData(new byte[0]);
        }
  finally {
          l.countDown();
        }
      }
    }
);
    if (!l.await(5,TimeUnit.SECONDS)) {
      logger.log(Level.WARNING,"Failed to shutdown MulticastService in 5 seconds!");
    }
  }
 catch (  Throwable e) {
    logger.log(Level.WARNING,e.getMessage(),e);
  }
}
