{
  ensureOpen();
  validateNotNull(keys);
  if (keys.isEmpty()) {
    return Collections.EMPTY_MAP;
  }
  final Set<Data> keySet=new HashSet(keys.size());
  for (  K key : keys) {
    final Data k=toData(key);
    keySet.add(k);
  }
  Map<K,V> result=getAllFromNearCache(keySet);
  if (keySet.isEmpty()) {
    return result;
  }
  final Data expiryPolicyData=expiryPolicy != null ? toData(expiryPolicy) : DefaultData.NULL_DATA;
  final ClientMessage request=CacheGetAllParameters.encode(nameWithPrefix,keySet,expiryPolicyData);
  final ClientMessage responseMessage=invoke(request);
  final Map<Data,Data> mapEntrySet=MapDataDataResultParameters.decode(responseMessage).map;
  final Set<Map.Entry<Data,Data>> entrySet=mapEntrySet.entrySet();
  for (  Map.Entry<Data,Data> dataEntry : entrySet) {
    final Data keyData=dataEntry.getKey();
    final Data valueData=dataEntry.getValue();
    final K key=toObject(keyData);
    final V value=toObject(valueData);
    result.put(key,value);
    storeInNearCache(keyData,valueData,value);
  }
  return result;
}
