{
  IndexImpl index=new IndexImpl(null,ordered);
  assertEquals(0,index.getRecords(0L).size());
  assertEquals(0,index.getSubRecordsBetween(0L,1000L).size());
  QueryRecord record5=newRecord(5L,55L);
  index.saveEntryIndex(record5);
  assertEquals(1,index.getRecordValues().size());
  assertEquals(55L,index.getRecordValues().get(record5.getIndexKey()));
  QueryRecord record6=newRecord(6L,66L);
  index.saveEntryIndex(record6);
  assertEquals(2,index.getRecordValues().size());
  assertEquals(new Long(66L),index.getRecordValues().get(record6.getIndexKey()));
  record5.changeAttribute(555L);
  index.saveEntryIndex(record5);
  assertEquals(2,index.getRecordValues().size());
  assertEquals(new Long(555L),index.getRecordValues().get(record5.getIndexKey()));
  assertEquals(1,index.getRecords(555L).size());
  assertEquals(2,index.getSubRecordsBetween(55L,555L).size());
  assertEquals(2,index.getSubRecordsBetween(66L,555L).size());
  assertEquals(1,index.getSubRecordsBetween(555L,555L).size());
  QueryRecord record50=newRecord(50L,555L);
  index.saveEntryIndex(record50);
  assertEquals(3,index.getRecordValues().size());
  assertEquals(new Long(555L),index.getRecordValues().get(record5.getIndexKey()));
  assertEquals(new Long(555L),index.getRecordValues().get(record50.getIndexKey()));
  ConcurrentMap<Data,QueryableEntry> records=index.getRecordMap(555L);
  assertNotNull(records);
  assertEquals(2,records.size());
  assertEquals(record5,records.get(record5.getIndexKey()));
  assertEquals(record50,records.get(record50.getIndexKey()));
  assertEquals(2,index.getRecords(555L).size());
  assertEquals(3,index.getSubRecordsBetween(55L,555L).size());
  assertEquals(3,index.getSubRecordsBetween(66L,555L).size());
  assertEquals(2,index.getSubRecordsBetween(555L,555L).size());
  assertEquals(0,index.getSubRecords(ComparisonType.LESSER,66L).size());
  assertEquals(1,index.getSubRecords(ComparisonType.LESSER_EQUAL,66L).size());
  assertEquals(1,index.getSubRecords(ComparisonType.LESSER_EQUAL,67L).size());
  assertEquals(2,index.getSubRecords(ComparisonType.GREATER,66L).size());
  assertEquals(3,index.getSubRecords(ComparisonType.GREATER_EQUAL,66L).size());
  assertEquals(3,index.getSubRecords(ComparisonType.GREATER_EQUAL,61L).size());
  assertEquals(3,index.getSubRecords(ComparisonType.NOT_EQUAL,61L).size());
  assertEquals(2,index.getSubRecords(ComparisonType.NOT_EQUAL,66L).size());
  assertEquals(1,index.getSubRecords(ComparisonType.NOT_EQUAL,555L).size());
  assertEquals(3,index.getRecords(new Comparable[]{66L,555L,34234L}).size());
  assertEquals(2,index.getRecords(new Comparable[]{555L,34234L}).size());
  index.removeEntryIndex(record5.getIndexKey());
  assertEquals(2,index.getRecordValues().size());
  assertEquals(new Long(555L),index.getRecordValues().get(record50.getIndexKey()));
  assertEquals(null,index.getRecordValues().get(record5.getIndexKey()));
  records=index.getRecordMap(555L);
  assertNotNull(records);
  assertEquals(null,records.get(5L));
  assertEquals(record50,records.get(toData(50L)));
  assertEquals(1,index.getRecords(555L).size());
  assertEquals(2,index.getSubRecordsBetween(55L,555L).size());
  assertEquals(2,index.getSubRecordsBetween(66L,555L).size());
  assertEquals(1,index.getSubRecordsBetween(555L,555L).size());
  assertEquals(0,index.getSubRecords(ComparisonType.LESSER,66L).size());
  assertEquals(1,index.getSubRecords(ComparisonType.LESSER_EQUAL,66L).size());
  assertEquals(1,index.getSubRecords(ComparisonType.LESSER_EQUAL,67L).size());
  assertEquals(1,index.getSubRecords(ComparisonType.GREATER,66L).size());
  assertEquals(2,index.getSubRecords(ComparisonType.GREATER_EQUAL,66L).size());
  assertEquals(2,index.getSubRecords(ComparisonType.GREATER_EQUAL,61L).size());
  index.removeEntryIndex(record50.getIndexKey());
  assertEquals(1,index.getRecordValues().size());
  assertEquals(null,index.getRecordValues().get(50L));
  records=index.getRecordMap(555L);
  assertNull(records);
  assertEquals(0,index.getRecords(555L).size());
  assertEquals(1,index.getSubRecordsBetween(55L,555L).size());
  assertEquals(1,index.getSubRecordsBetween(66L,555L).size());
  assertEquals(0,index.getSubRecordsBetween(555L,555L).size());
  index.removeEntryIndex(record6.getIndexKey());
  assertEquals(0,index.getRecordValues().size());
  assertEquals(null,index.getRecordValues().get(6L));
  assertNull(index.getRecordMap(66L));
  assertEquals(0,index.getRecords(555L).size());
  assertEquals(0,index.getSubRecordsBetween(55L,555L).size());
  assertEquals(0,index.getSubRecordsBetween(66L,555L).size());
  assertEquals(0,index.getSubRecordsBetween(555L,555L).size());
}
