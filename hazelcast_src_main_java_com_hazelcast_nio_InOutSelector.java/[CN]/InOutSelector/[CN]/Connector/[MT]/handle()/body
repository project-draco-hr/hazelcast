{
  try {
    final boolean finished=socketChannel.finishConnect();
    if (!finished) {
      long now=System.currentTimeMillis();
      if (now - lastCheck > 5000) {
        logger.log(Level.WARNING,"Couldn't connect to " + address + " for "+ ((now - startTime) / 1000)+ " seconds!");
        lastCheck=now;
      }
      socketChannel.register(selector,SelectionKey.OP_CONNECT,Connector.this);
      return;
    }
    logger.log(Level.FINEST,"connected to " + address);
    final SocketChannelWrapper socketChannelWrapper=connectionManager.wrapSocketChannel(socketChannel,true);
    final Connection connection=connectionManager.createConnection(socketChannelWrapper,InOutSelector.this);
    connectionManager.bind(address,connection,false);
  }
 catch (  Throwable e) {
    try {
      final String msg="Couldn't connect to " + address + ", cause: "+ e.getMessage();
      logger.log(Level.FINEST,msg,e);
      socketChannel.close();
      connectionManager.failedConnection(address,e);
    }
 catch (    final Exception ignored) {
    }
  }
}
