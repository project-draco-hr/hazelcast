{
  final Enumeration<NetworkInterface> networkInterfaces=NetworkInterface.getNetworkInterfaces();
  while (networkInterfaces.hasMoreElements()) {
    final NetworkInterface ni=networkInterfaces.nextElement();
    final Enumeration<InetAddress> e=ni.getInetAddresses();
    while (e.hasMoreElements()) {
      final InetAddress inetAddress=e.nextElement();
      if (interfaces != null && !interfaces.isEmpty()) {
        final String address=inetAddress.getHostAddress();
        if (matchAddress(address,interfaces)) {
          return inetAddress;
        }
      }
 else       if (!inetAddress.isLoopbackAddress()) {
        return inetAddress;
      }
    }
  }
  return null;
}
