{
  AddressDefinition addressDef=getSystemConfiguredAddress();
  if (addressDef == null) {
    final NetworkConfig networkConfig=config.getNetworkConfig();
    final Collection<InterfaceDefinition> interfaces=getInterfaces(networkConfig);
    if (interfaces.contains(new InterfaceDefinition("127.0.0.1")) || interfaces.contains(new InterfaceDefinition("localhost"))) {
      addressDef=pickLoopbackAddress();
    }
 else {
      if (preferIPv4Stack()) {
        logger.log(Level.INFO,"Prefer IPv4 stack is true.");
      }
      if (interfaces.size() > 0) {
        addressDef=pickMatchingAddress(interfaces);
      }
      if (addressDef == null) {
        if (networkConfig.getInterfaces().isEnabled()) {
          String msg="Hazelcast CANNOT start on this node. No matching network interface found. ";
          msg+="\nInterface matching must be either disabled or updated in the hazelcast.xml config file.";
          logger.log(Level.SEVERE,msg);
          throw new RuntimeException(msg);
        }
 else {
          if (networkConfig.getJoin().getTcpIpConfig().isEnabled()) {
            logger.log(Level.WARNING,"Could not find a matching address to start with! " + "Picking one of non-loopback addresses.");
          }
          addressDef=pickMatchingAddress(null);
        }
      }
    }
  }
  if (addressDef != null) {
    addressDef.inetAddress=AddressUtil.fixScopeIdAndGetInetAddress(addressDef.inetAddress);
  }
  if (addressDef == null) {
    addressDef=pickLoopbackAddress();
  }
  return addressDef;
}
