{
  this.factory=factoryImpl;
  this.instanceFilterMap=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_MAP_EXCLUDES.getString());
  this.instanceFilterQueue=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_QUEUE_EXCLUDES.getString());
  this.instanceFilterTopic=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_TOPIC_EXCLUDES.getString());
  thisAddress=((MemberImpl)factory.getCluster().getLocalMember()).getAddress();
  updateMemberOrder();
  logger=factory.node.getLogger(ManagementCenterService.class.getName());
  for (int i=0; i < 100; i++) {
    qClientHandlers.offer(new ClientHandler());
  }
  factory.getCluster().addMembershipListener(this);
  MemberImpl memberLocal=(MemberImpl)factory.getCluster().getLocalMember();
  int port=memberLocal.getInetSocketAddress().getPort() + 100;
  datagramSocket=new DatagramSocket(port);
  serverSocket=new SocketReadyServerSocket(port);
  udpListener=new UDPListener(datagramSocket);
  udpListener.start();
  udpSender=new UDPSender(datagramSocket);
  udpSender.start();
  tcpListener=new TCPListener(serverSocket);
  tcpListener.start();
  commandHandler=new ConsoleCommandHandler(factory);
  logger.log(Level.INFO,"Hazelcast Management Center started at port " + port + ".");
}
