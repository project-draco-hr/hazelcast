{
  this.factory=factoryImpl;
  this.instanceFilterMap=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_MAP_EXCLUDES.getString());
  this.instanceFilterQueue=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_QUEUE_EXCLUDES.getString());
  this.instanceFilterTopic=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_TOPIC_EXCLUDES.getString());
  this.instanceFilterAtomicNumber=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_ATOMIC_NUMBER_EXCLUDES.getString());
  this.instanceFilterCountDownLatch=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_COUNT_DOWN_LATCH_EXCLUDES.getString());
  this.instanceFilterSemaphore=new StatsInstanceFilter(factoryImpl.node.getGroupProperties().MC_SEMAPHORE_EXCLUDES.getString());
  updateMemberOrder();
  logger=factory.node.getLogger(ManagementCenterService.class.getName());
  for (int i=0; i < 100; i++) {
    qClientHandlers.offer(new ClientHandler());
  }
  maxVisibleInstanceCount=factory.node.groupProperties.MC_MAX_INSTANCE_COUNT.getInteger();
  factory.getCluster().addMembershipListener(this);
  final MemberImpl memberLocal=(MemberImpl)factory.getCluster().getLocalMember();
  thisAddress=memberLocal.getAddress();
  int port=calculatePort(thisAddress);
  datagramSocket=new DatagramSocket(port);
  serverSocket=new SocketReadyServerSocket(port,1000,factory.node.config.isReuseAddress());
  udpListener=new UDPListener(datagramSocket,1000,factory.node.config.isReuseAddress());
  udpListener.start();
  udpSender=new UDPSender(datagramSocket);
  udpSender.start();
  tcpListener=new TCPListener(serverSocket);
  tcpListener.start();
  commandHandler=new ConsoleCommandHandler(factory);
  logger.log(Level.INFO,"Hazelcast Management Center started at port " + port + ".");
}
