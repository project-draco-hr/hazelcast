{
  AuthenticationRequest auth=new AuthenticationRequest(credentials,principal);
  final SerializationServiceImpl serializationService=getSerializationService();
  connection.write(serializationService.toData(auth));
  final Data data=connection.read();
  Object response=serializationService.toObject(data);
  if (response instanceof GenericError) {
    throw new AuthenticationException(((GenericError)response).getMessage());
  }
  System.err.println("principal = " + response);
  principal=(ClientPrincipal)response;
}
