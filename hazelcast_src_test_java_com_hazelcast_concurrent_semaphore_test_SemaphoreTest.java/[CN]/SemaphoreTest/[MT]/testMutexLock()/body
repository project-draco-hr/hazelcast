{
  int k=5;
  final Object sync=new Object();
  final AtomicBoolean atomicBoolean=new AtomicBoolean(false);
  final Lock lock=new ReentrantLock();
  final CountDownLatch latch=new CountDownLatch(k);
  for (int i=0; i < k; i++) {
    new Thread(){
      public void run(){
        for (int j=0; j < 10000; j++) {
          lock.lock();
synchronized (sync) {
            Assert.assertEquals(atomicBoolean.compareAndSet(false,true),true);
          }
synchronized (sync) {
            lock.unlock();
            atomicBoolean.set(false);
          }
        }
        latch.countDown();
      }
    }
.start();
  }
  try {
    Assert.assertEquals(latch.await(15,TimeUnit.SECONDS),true);
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
    Assert.fail();
  }
}
