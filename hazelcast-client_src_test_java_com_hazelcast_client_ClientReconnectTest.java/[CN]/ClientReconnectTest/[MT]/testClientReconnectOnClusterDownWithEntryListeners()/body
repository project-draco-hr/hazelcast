{
  HazelcastInstance h1=Hazelcast.newHazelcastInstance();
  final HazelcastInstance client=HazelcastClient.newHazelcastClient();
  final IMap<String,String> m=client.getMap("default");
  final CountDownLatch latch=new CountDownLatch(1);
  final EntryAdapter<String,String> listener=new EntryAdapter<String,String>(){
    public void onEntryEvent(    EntryEvent<String,String> event){
      latch.countDown();
    }
  }
;
  m.addEntryListener(listener,true);
  h1.shutdown();
  Thread.sleep(1000);
  final HazelcastInstance newInstance=Hazelcast.newHazelcastInstance();
  waitForClientReconnect(client,newInstance);
  m.put("key","value");
  assertOpenEventually(latch,10);
}
