{
  final long start=System.nanoTime();
  final Set<Data> keysData;
  if (keys != null) {
    keysData=new HashSet<Data>();
    for (    K key : keys) {
      keysData.add(toData(key));
    }
  }
 else {
    keysData=null;
  }
  final int partitionCount=clientContext.getPartitionService().getPartitionCount();
  int completionId=registerCompletionLatch(partitionCount);
  CacheClearRequest request=new CacheClearRequest(nameWithPrefix,keysData,isRemoveAll,completionId);
  try {
    final Map<Integer,Object> results=invoke(request);
    int completionCount=0;
    for (    Object result : results.values()) {
      if (result != null && result instanceof CacheClearResponse) {
        final Object response=((CacheClearResponse)result).getResponse();
        if (response instanceof Boolean) {
          completionCount++;
        }
        if (response instanceof Throwable) {
          throw (Throwable)response;
        }
      }
    }
    waitCompletionLatch(completionId,partitionCount - completionCount,null);
    if (statisticsEnabled) {
      if (keysData != null) {
        statistics.increaseCacheRemovals(keysData.size());
        statistics.addRemoveTimeNanos(System.nanoTime() - start);
      }
 else {
        statistics.setLastUpdateTime(System.currentTimeMillis());
      }
    }
  }
 catch (  Throwable t) {
    deregisterCompletionLatch(completionId);
    throw ExceptionUtil.rethrowAllowedTypeFirst(t,CacheException.class);
  }
}
