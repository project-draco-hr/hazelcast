{
  runningThread=Thread.currentThread();
  final ThreadContext threadContext=ThreadContext.getOrCreate();
  threadContext.setCallerUuid(clientEndpoint.uuid);
  try {
    if (!valid)     return;
    if (node.securityContext == null) {
      handleCommand();
    }
 else {
      final Subject subject=clientEndpoint.getSubject();
      final PrivilegedExceptionAction<Void> action=new ClientPrivilegedAction();
      node.securityContext.doAsPrivileged(subject,action);
    }
  }
 catch (  Throwable e) {
    logger.log(Level.WARNING,e.getMessage(),e);
    if (node.isActive()) {
      ExceptionUtil.rethrow(e);
    }
  }
 finally {
    runningThread=null;
    threadContext.setCallerUuid(null);
  }
}
