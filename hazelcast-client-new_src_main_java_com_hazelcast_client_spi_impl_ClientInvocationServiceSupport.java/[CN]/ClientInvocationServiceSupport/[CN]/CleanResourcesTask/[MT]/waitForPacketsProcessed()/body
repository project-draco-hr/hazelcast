{
  final long begin=System.currentTimeMillis();
  int count=connection.getPacketCount();
  while (count != 0) {
    try {
      Thread.sleep(WAIT_TIME_FOR_PACKETS_TO_BE_CONSUMED);
    }
 catch (    InterruptedException e) {
      logger.warning(e);
      break;
    }
    long elapsed=System.currentTimeMillis() - begin;
    if (elapsed > WAIT_TIME_FOR_PACKETS_TO_BE_CONSUMED_THRESHOLD) {
      logger.warning("There are packets which are not processed " + count);
      break;
    }
    count=connection.getPacketCount();
  }
}
