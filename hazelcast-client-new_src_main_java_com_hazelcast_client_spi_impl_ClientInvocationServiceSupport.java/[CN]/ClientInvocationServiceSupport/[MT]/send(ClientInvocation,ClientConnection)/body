{
  if (isShutdown) {
    throw new HazelcastClientNotActiveException("Client is shut down");
  }
  registerInvocation(invocation);
  if (!isAllowedToSendRequest(connection,invocation.getClientMessage()) || !connection.write(invocation.getClientMessage())) {
    final int callId=invocation.getClientMessage().getCorrelationId();
    deRegisterCallId(callId);
    deRegisterEventHandler(callId);
    throw new IOException("Packet not send to " + connection.getRemoteEndpoint());
  }
  invocation.setSendConnection(connection);
}
