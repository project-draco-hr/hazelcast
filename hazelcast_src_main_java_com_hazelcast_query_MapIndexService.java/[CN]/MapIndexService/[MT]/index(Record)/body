{
  final long recordId=record.getId();
  if (record.isActive()) {
    records.putIfAbsent(recordId,record);
  }
 else {
    remove(record);
  }
  int newValueIndex=-1;
  if (record.isActive() && record.getValue() != null) {
    newValueIndex=record.getValue().hashCode();
  }
  if (indexValue != null) {
    indexValue.index(newValueIndex,record);
  }
  long[] indexValues=record.getIndexes();
  byte[] indexTypes=record.getIndexTypes();
  if (indexValues != null && hasIndexedAttributes) {
    if (indexTypes == null || indexValues.length != indexTypes.length) {
      throw new IllegalArgumentException("index and types don't match " + indexTypes);
    }
    Collection<Index> indexes=mapIndexes.values();
    for (    Index index : indexes) {
      if (indexValues.length > index.getAttributeIndex()) {
        long newValue=indexValues[index.getAttributeIndex()];
        index.index(newValue,record);
      }
    }
  }
}
