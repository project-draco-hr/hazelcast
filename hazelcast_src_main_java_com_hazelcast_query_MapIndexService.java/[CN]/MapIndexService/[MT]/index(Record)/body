{
  final Long recordId=record.getId();
  if (record.isActive()) {
    final Record anotherRecord=records.putIfAbsent(recordId,record);
    if (anotherRecord != null) {
      record=anotherRecord;
    }
 else {
      size++;
    }
  }
 else {
    remove(record);
  }
  if (indexValue != null) {
    Long newValueIndex=-1L;
    if (record.isActive() && record.getValue() != null) {
      newValueIndex=(long)record.getValue().hashCode();
    }
    indexValue.index(newValueIndex,record);
  }
  Long[] indexValues=record.getIndexes();
  if (indexValues != null && hasIndexedAttributes) {
    byte[] indexTypes=record.getIndexTypes();
    if (indexTypes == null || indexValues.length != indexTypes.length) {
      throw new IllegalArgumentException("index and types don't match " + Arrays.toString(indexTypes));
    }
    Collection<Index> indexes=mapIndexes.values();
    for (    Index index : indexes) {
      if (indexValues.length > index.getAttributeIndex()) {
        Long newValue=indexValues[index.getAttributeIndex()];
        index.index(newValue,record);
      }
    }
  }
}
