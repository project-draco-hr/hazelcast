{
  try {
    System.out.println("Thread " + getName() + " is running");
    request.onEnqueue();
    writer.write(connection,request);
    writer.flush(connection);
    Future<Protocol> f=null;
    while (running) {
      Protocol response=reader.read(connection);
      if (Command.EVENT.equals(response.command)) {
        listenerResponseHandler.handleResponse(response,ss);
      }
 else {
        throw new RuntimeException(response.args[0]);
      }
    }
    cleanup();
  }
 catch (  Exception e) {
    if (!running)     return;
 else     listenerResponseHandler.onError(e);
  }
 finally {
    cleanup();
  }
}
