{
  final ClientEndpoint endpoint=getEndpoint();
  final MapService mapService=getService();
  final MapServiceContext mapServiceContext=mapService.getMapServiceContext();
  MapListenerAdapter<Object,Object> listener=new MapListenerAdapter<Object,Object>(){
    @Override public void onEntryEvent(    EntryEvent<Object,Object> event){
      if (endpoint.isAlive()) {
        if (!(event instanceof DataAwareEntryEvent)) {
          throw new IllegalArgumentException("Expecting: DataAwareEntryEvent, Found: " + event.getClass().getSimpleName());
        }
        DataAwareEntryEvent dataAwareEntryEvent=(DataAwareEntryEvent)event;
        Data key=dataAwareEntryEvent.getKeyData();
        Data value=dataAwareEntryEvent.getNewValueData();
        Data oldValue=dataAwareEntryEvent.getOldValueData();
        Data mergingValue=dataAwareEntryEvent.getMergingValueData();
        PortableEntryEvent portableEntryEvent=new PortableEntryEvent(key,value,oldValue,mergingValue,event.getEventType(),event.getMember().getUuid());
        endpoint.sendEvent(key,portableEntryEvent,getCallId());
      }
    }
    @Override public void onMapEvent(    MapEvent event){
      if (endpoint.isAlive()) {
        final EntryEventType type=event.getEventType();
        final String uuid=event.getMember().getUuid();
        PortableEntryEvent portableEntryEvent=new PortableEntryEvent(type,uuid,event.getNumberOfEntriesAffected());
        endpoint.sendEvent(null,portableEntryEvent,getCallId());
      }
    }
  }
;
  EventFilter eventFilter=getEventFilter();
  EventFilter eventListenerFilter=new EventListenerFilter(listenerFlags,eventFilter);
  String registrationId=mapServiceContext.addEventListener(listener,eventListenerFilter,name);
  endpoint.addListenerDestroyAction(MapService.SERVICE_NAME,name,registrationId);
  return registrationId;
}
