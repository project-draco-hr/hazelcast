{
  MapService mapService=getService();
  MapServiceContext mapServiceContext=mapService.getMapServiceContext();
  ClientEndpoint endpoint=getEndpoint();
  Object listener=newMapListener(endpoint);
  EventFilter eventFilter=getEventFilter();
  EventFilter eventListenerFilter=new EventListenerFilter(listenerFlags,eventFilter);
  String registrationId;
  if (localOnly) {
    registrationId=mapServiceContext.addLocalEventListener(listener,eventListenerFilter,name);
  }
 else {
    registrationId=mapServiceContext.addEventListener(listener,eventListenerFilter,name);
  }
  endpoint.addListenerDestroyAction(MapService.SERVICE_NAME,name,registrationId);
  return registrationId;
}
