{
  final Packet packet=(Packet)socketWritable;
  if (nodeEngine.getNode().isActive()) {
    Packet newPacket=new Packet(nodeEngine.getSerializationService().getPortableContext());
    ByteBuffer buffer=ByteBuffer.allocate(4096);
    boolean writeDone;
    boolean readDone;
    do {
      writeDone=packet.writeTo(buffer);
      buffer.flip();
      readDone=newPacket.readFrom(buffer);
      if (buffer.hasRemaining()) {
        throw new IllegalStateException("Buffer should be empty! " + buffer);
      }
      buffer.clear();
    }
 while (!writeDone);
    if (!readDone) {
      throw new IllegalStateException("Read should be completed!");
    }
    newPacket.setConn(localConnection);
    MemberImpl member=nodeEngine.getClusterService().getMember(localEndpoint);
    if (member != null) {
      member.didRead();
    }
    nodeEngine.handlePacket(newPacket);
    return true;
  }
  return false;
}
