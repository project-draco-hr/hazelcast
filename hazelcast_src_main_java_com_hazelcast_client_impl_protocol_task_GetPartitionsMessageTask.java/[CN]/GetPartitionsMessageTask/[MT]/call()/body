{
  InternalPartitionService service=getService(InternalPartitionService.SERVICE_NAME);
  service.firstArrangement();
  ClusterService clusterService=getService(ClusterServiceImpl.SERVICE_NAME);
  Collection<Member> memberList=clusterService.getMembers();
  Map<Address,Set<Integer>> partitionsMap=new HashMap<Address,Set<Integer>>(memberList.size());
  for (  Member member : memberList) {
    Address address=member.getAddress();
    partitionsMap.put(address,new HashSet<Integer>());
  }
  for (  InternalPartition partition : service.getPartitions()) {
    Address owner=partition.getOwnerOrNull();
    if (owner == null) {
      partitionsMap.clear();
      return ClientGetPartitionsCodec.encodeResponse(partitionsMap);
    }
    Set<Integer> indexes=partitionsMap.get(owner);
    indexes.add(partition.getPartitionId());
  }
  return ClientGetPartitionsCodec.encodeResponse(partitionsMap);
}
