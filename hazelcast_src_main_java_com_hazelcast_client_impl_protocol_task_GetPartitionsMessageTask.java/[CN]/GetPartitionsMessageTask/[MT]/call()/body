{
  InternalPartitionService service=getService(InternalPartitionService.SERVICE_NAME);
  service.firstArrangement();
  ClusterService clusterService=getService(ClusterServiceImpl.SERVICE_NAME);
  Collection<MemberImpl> memberList=clusterService.getMemberList();
  Address[] addresses=new Address[memberList.size()];
  Map<Address,Integer> addressMap=new HashMap<Address,Integer>(memberList.size());
  int k=0;
  for (  MemberImpl member : memberList) {
    Address address=member.getAddress();
    addresses[k]=address;
    addressMap.put(address,k);
    k++;
  }
  InternalPartition[] partitions=service.getPartitions();
  int[] indexes=new int[partitions.length];
  for (int i=0; i < indexes.length; i++) {
    Address owner=partitions[i].getOwnerOrNull();
    int index=-1;
    if (owner == null) {
      return GetPartitionsResultParameters.encode(new Address[0],new int[0]);
    }
    final Integer idx=addressMap.get(owner);
    if (idx != null) {
      index=idx;
    }
    indexes[i]=index;
  }
  return GetPartitionsResultParameters.encode(addresses,indexes);
}
