{
  InternalPartitionService service=getService(InternalPartitionService.SERVICE_NAME);
  service.firstArrangement();
  Map<Address,Set<Integer>> partitionsMap=new HashMap<Address,Set<Integer>>();
  for (  InternalPartition partition : service.getPartitions()) {
    Address owner=partition.getOwnerOrNull();
    if (owner == null) {
      partitionsMap.clear();
      return ClientGetPartitionsCodec.encodeResponse(partitionsMap);
    }
    Set<Integer> indexes=partitionsMap.get(owner);
    if (indexes == null) {
      indexes=new HashSet<Integer>();
      partitionsMap.put(owner,indexes);
    }
    indexes.add(partition.getPartitionId());
  }
  return ClientGetPartitionsCodec.encodeResponse(partitionsMap);
}
