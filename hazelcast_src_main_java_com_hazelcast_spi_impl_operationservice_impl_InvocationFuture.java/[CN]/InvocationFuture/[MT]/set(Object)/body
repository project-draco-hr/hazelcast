{
  offeredResponse=resolveInternalResponse(offeredResponse);
  ExecutionCallbackNode<E> callbackChain;
synchronized (this) {
    if (response != null && !(response instanceof Invocation.InternalResponse)) {
      ILogger logger=invocation.logger;
      if (logger.isFinestEnabled()) {
        logger.info("Future response is already set! Current response: " + response + ", Offered response: "+ offeredResponse+ ", Invocation: "+ invocation);
      }
      return;
    }
    response=offeredResponse;
    if (offeredResponse == Invocation.WAIT_RESPONSE) {
      return;
    }
    callbackChain=callbackHead;
    callbackHead=null;
    notifyAll();
  }
  operationService.deregisterInvocation(invocation);
  notifyCallbacks(callbackChain);
}
