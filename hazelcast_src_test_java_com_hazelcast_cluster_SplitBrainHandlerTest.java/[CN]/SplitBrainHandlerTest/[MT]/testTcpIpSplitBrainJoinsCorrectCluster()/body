{
  Config c1=buildConfig(false,15702);
  Config c2=buildConfig(false,15704);
  Config c3=buildConfig(false,15703);
  Config c4=buildConfig(false,15701);
  List<String> clusterOneMembers=Arrays.asList("127.0.0.1:15702","127.0.0.1:15704");
  List<String> clusterTwoMembers=Arrays.asList("127.0.0.1:15703","127.0.0.1:15701");
  c1.getNetworkConfig().getJoin().getTcpIpConfig().setMembers(clusterOneMembers);
  c2.getNetworkConfig().getJoin().getTcpIpConfig().setMembers(clusterOneMembers);
  c3.getNetworkConfig().getJoin().getTcpIpConfig().setMembers(clusterTwoMembers);
  c4.getNetworkConfig().getJoin().getTcpIpConfig().setMembers(clusterTwoMembers);
  final CountDownLatch latch=new CountDownLatch(2);
  c3.addListenerConfig(new ListenerConfig(new MergedEventLifeCycleListener(latch)));
  c4.addListenerConfig(new ListenerConfig(new MergedEventLifeCycleListener(latch)));
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(c1);
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(c2);
  HazelcastInstance h3=Hazelcast.newHazelcastInstance(c3);
  HazelcastInstance h4=Hazelcast.newHazelcastInstance(c4);
  assertEquals(2,h1.getCluster().getMembers().size());
  assertEquals(2,h2.getCluster().getMembers().size());
  assertEquals(2,h3.getCluster().getMembers().size());
  assertEquals(2,h4.getCluster().getMembers().size());
  List<String> allMembers=Arrays.asList("127.0.0.1:15701","127.0.0.1:15704","127.0.0.1:15703","127.0.0.1:15702");
  h3.getConfig().getNetworkConfig().getJoin().getTcpIpConfig().setMembers(allMembers);
  h4.getConfig().getNetworkConfig().getJoin().getTcpIpConfig().clear().setMembers(Collections.<String>emptyList());
  assertTrue(latch.await(60,TimeUnit.SECONDS));
  assertEquals(4,h1.getCluster().getMembers().size());
  assertEquals(4,h2.getCluster().getMembers().size());
  assertEquals(4,h3.getCluster().getMembers().size());
  assertEquals(4,h4.getCluster().getMembers().size());
}
