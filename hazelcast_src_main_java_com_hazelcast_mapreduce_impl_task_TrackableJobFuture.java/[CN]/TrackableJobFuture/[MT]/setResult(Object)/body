{
  if (result instanceof Throwable && !(result instanceof CancellationException)) {
    if (!(result instanceof CancellationException)) {
      result=new ExecutionException((Throwable)result);
    }
    super.setResult(result);
    latch.countDown();
    return;
  }
  Object finalResult=result;
  if (collator != null) {
    finalResult=collator.collate(((Map)finalResult).entrySet());
  }
  if (finalResult instanceof Throwable && !(finalResult instanceof CancellationException)) {
    finalResult=new ExecutionException((Throwable)finalResult);
  }
  super.setResult(finalResult);
  latch.countDown();
}
