{
  ValidationUtil.isNotNull(unit,"unit");
  long deadline=timeout == 0L ? -1 : Clock.currentTimeMillis() + unit.toMillis(timeout);
  for (; ; ) {
    Thread.sleep(100);
    if (isDone()) {
      break;
    }
    long delta=deadline - Clock.currentTimeMillis();
    if (delta <= 0L) {
      throw new TimeoutException("timeout reached");
    }
  }
  return getResult();
}
