{
  if (address == null) {
    throw new NullPointerException("Address is required!");
  }
  if (!smartRouting) {
    address=waitForOwnerConnection();
  }
  ClientConnection clientConnection=connections.get(address);
  if (clientConnection == null) {
    final Object lock=getLock(address);
synchronized (lock) {
      clientConnection=connections.get(address);
      if (clientConnection == null) {
        final ConnectionProcessor connectionProcessor=new ConnectionProcessor(address,authenticator,false);
        final ICompletableFuture<ClientConnection> future=executionService.submitInternal(connectionProcessor);
        try {
          clientConnection=future.get(connectionTimeout + TIMEOUT_PLUS,TimeUnit.MILLISECONDS);
        }
 catch (        Exception e) {
          future.cancel(true);
          throw new RetryableIOException(e);
        }
        ClientConnection current=connections.putIfAbsent(clientConnection.getRemoteEndpoint(),clientConnection);
        if (current != null) {
          clientConnection.innerClose();
          clientConnection=current;
        }
      }
    }
  }
  return clientConnection;
}
