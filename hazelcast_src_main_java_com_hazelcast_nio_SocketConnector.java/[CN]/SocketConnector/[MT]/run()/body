{
  if (!connectionManager.isLive()) {
    logger.log(Level.FINEST,"ConnectionManager is not live, connection attempt to " + address + " is cancelled!");
    return;
  }
  try {
    connectionManager.ioService.onIOThreadStart();
    final Address thisAddress=connectionManager.ioService.getThisAddress();
    if (address.isIPv4()) {
      tryConnect(address.getInetSocketAddress());
    }
 else     if (thisAddress.isIPv6() && thisAddress.getScopeId() != null) {
      final Inet6Address inetAddress=AddressUtil.getInetAddressFor((Inet6Address)address.getInetAddress(),thisAddress.getScopeId());
      tryConnect(new InetSocketAddress(inetAddress,address.getPort()));
    }
 else {
      final Collection<Inet6Address> possibleInetAddresses=AddressUtil.getPossibleInetAddressesFor((Inet6Address)address.getInetAddress());
      boolean connected=false;
      Exception error=null;
      for (      Inet6Address inetAddress : possibleInetAddresses) {
        try {
          tryConnect(new InetSocketAddress(inetAddress,address.getPort()));
          connected=true;
          break;
        }
 catch (        Exception e) {
          error=e;
        }
      }
      if (!connected) {
        throw error;
      }
    }
  }
 catch (  Throwable e) {
    logger.log(Level.FINEST,e.getMessage(),e);
    connectionManager.failedConnection(address,e);
  }
}
