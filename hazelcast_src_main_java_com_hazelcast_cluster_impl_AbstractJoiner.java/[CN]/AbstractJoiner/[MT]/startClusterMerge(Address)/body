{
  final OperationService operationService=node.nodeEngine.getOperationService();
  final Collection<Member> memberList=node.getClusterService().getMembers();
  final Collection<Future> calls=new ArrayList<Future>();
  for (  Member member : memberList) {
    if (!member.localMember()) {
      Operation operation=new PrepareMergeOperation(targetAddress);
      Future f=operationService.createInvocationBuilder(ClusterServiceImpl.SERVICE_NAME,operation,member.getAddress()).setTryCount(3).invoke();
      calls.add(f);
    }
  }
  waitWithDeadline(calls,3,TimeUnit.SECONDS,whileWaitMergeExceptionHandler);
  final PrepareMergeOperation prepareMergeOperation=new PrepareMergeOperation(targetAddress);
  prepareMergeOperation.setNodeEngine(node.nodeEngine).setService(node.getClusterService()).setOperationResponseHandler(createEmptyResponseHandler());
  operationService.runOperationOnCallingThread(prepareMergeOperation);
  for (  Member member : memberList) {
    if (!member.localMember()) {
      operationService.createInvocationBuilder(ClusterServiceImpl.SERVICE_NAME,new MergeClustersOperation(targetAddress),member.getAddress()).setTryCount(1).invoke();
    }
  }
  final MergeClustersOperation mergeClustersOperation=new MergeClustersOperation(targetAddress);
  mergeClustersOperation.setNodeEngine(node.nodeEngine).setService(node.getClusterService()).setOperationResponseHandler(createEmptyResponseHandler());
  operationService.runOperationOnCallingThread(mergeClustersOperation);
}
