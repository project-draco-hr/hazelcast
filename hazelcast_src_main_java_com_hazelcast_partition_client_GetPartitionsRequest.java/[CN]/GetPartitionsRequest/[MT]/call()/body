{
  InternalPartitionService service=getService();
  service.firstArrangement();
  ClusterService clusterService=getClientEngine().getClusterService();
  Collection<Member> memberList=clusterService.getMembers();
  Address[] addresses=new Address[memberList.size()];
  Map<Address,Integer> addressMap=new HashMap<Address,Integer>(memberList.size());
  int k=0;
  for (  Member member : memberList) {
    Address address=member.getAddress();
    addresses[k]=address;
    addressMap.put(address,k);
    k++;
  }
  InternalPartition[] partitions=service.getPartitions();
  int[] indexes=new int[partitions.length];
  for (int i=0; i < indexes.length; i++) {
    Address owner=partitions[i].getOwnerOrNull();
    int index=-1;
    if (owner == null) {
      return null;
    }
    final Integer idx=addressMap.get(owner);
    if (idx != null) {
      index=idx;
    }
    indexes[i]=index;
  }
  return new PartitionsResponse(addresses,indexes);
}
