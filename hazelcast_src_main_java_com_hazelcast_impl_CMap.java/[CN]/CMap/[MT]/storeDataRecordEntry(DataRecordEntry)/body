{
  Record existing=getRecord(dataRecordEntry.getKeyData());
  if (existing != null) {
    mapIndexService.remove(existing);
  }
  Record record;
  if (isMultiMap()) {
    record=getRecord(dataRecordEntry.getKeyData());
    if (record == null) {
      record=createAndAddNewRecord(dataRecordEntry.getKeyData(),null);
    }
    if (record.getMultiValues() == null) {
      record.setMultiValues(createMultiValuesCollection());
    }
    record.getMultiValues().add(new ValueHolder(dataRecordEntry.getValueData()));
  }
 else {
    record=createAndAddNewRecord(dataRecordEntry.getKeyData(),dataRecordEntry.getValueData());
    record.setCreationTime(dataRecordEntry.getCreationTime());
    record.setExpirationTime(dataRecordEntry.getExpirationTime());
    record.setMaxIdle(dataRecordEntry.getRemainingIdle());
    record.setIndexes(dataRecordEntry.getIndexes(),dataRecordEntry.getIndexTypes());
    if (dataRecordEntry.getLockAddress() != null && dataRecordEntry.getLockThreadId() != -1) {
      record.lock(dataRecordEntry.getLockThreadId(),dataRecordEntry.getLockAddress());
    }
  }
  record.setVersion(dataRecordEntry.getVersion());
  markAsActive(record);
  return record;
}
