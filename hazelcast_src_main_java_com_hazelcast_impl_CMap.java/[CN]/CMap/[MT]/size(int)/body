{
  PartitionManager partitionManager=concurrentMapManager.partitionManager;
  if (partitionManager.getVersion() != expectedPartitionVersion)   return -1;
  long now=Clock.currentTimeMillis();
  int size=0;
  Collection<Record> records=mapRecords.values();
  for (  Record record : records) {
    Member owner=concurrentMapManager.partitionServiceImpl.getPartition(record.getBlockId()).getOwner();
    if (owner != null && owner.localMember()) {
      if (record.isActive() && record.isValid(now)) {
        size+=record.valueCount();
      }
    }
  }
  if (partitionManager.getVersion() != expectedPartitionVersion)   return -1;
  return size;
}
