{
  int valueHash=(record.getValue() != null) ? record.getValue().hashCode() : Integer.MIN_VALUE;
  if (request.indexes != null) {
    int indexCount=request.indexes.length;
    if (indexCount == 0)     throw new RuntimeException(node.getName() + " request countains no index " + request.indexes);
    if (getMapIndexes().size() > indexCount) {
      throw new RuntimeException(node.getName() + ": indexCount=" + indexCount+ " but expected "+ getMapIndexes().size());
    }
    long[] newIndexes=request.indexes;
    request.indexes=null;
    byte[] indexTypes=request.indexTypes;
    request.indexTypes=null;
    if (newIndexes.length != indexTypes.length) {
      throw new RuntimeException();
    }
    node.queryService.updateIndex(getName(),newIndexes,indexTypes,record,valueHash);
  }
 else   if (created || record.getValueHash() != valueHash) {
    node.queryService.updateIndex(getName(),null,null,record,valueHash);
  }
}
