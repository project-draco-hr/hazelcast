{
  if (dirtyRecords.size() > 0) {
    concurrentMapManager.node.executorManager.executeStoreTask(new Runnable(){
      public void run(){
        try {
          Set<Object> keysToDelete=new HashSet<Object>();
          Set<Record> toStore=new HashSet<Record>();
          Map<Object,Object> updates=new HashMap<Object,Object>();
          for (          Record dirtyRecord : dirtyRecords) {
            if (!dirtyRecord.isActive()) {
              keysToDelete.add(dirtyRecord.getKey());
            }
 else {
              toStore.add(dirtyRecord);
              updates.put(dirtyRecord.getKey(),dirtyRecord.getValue());
            }
          }
          if (keysToDelete.size() == 1) {
            store.delete(keysToDelete.iterator().next());
          }
 else           if (keysToDelete.size() > 1) {
            store.deleteAll(keysToDelete);
          }
          if (updates.size() == 1) {
            Map.Entry entry=updates.entrySet().iterator().next();
            store.store(entry.getKey(),entry.getValue());
          }
 else           if (updates.size() > 1) {
            store.storeAll(updates);
          }
          for (          Record stored : toStore) {
            stored.setLastStoredTime(System.currentTimeMillis());
          }
        }
 catch (        Exception e) {
          for (          Record dirtyRecord : dirtyRecords) {
            dirtyRecord.setDirty(true);
          }
        }
      }
    }
);
  }
}
