{
  final Collection<Record> records=mapRecords.values();
  final Collection<Record> result=new LinkedList<Record>();
  final long now=Clock.currentTimeMillis();
  for (  Record record : records) {
    if (record.isActive() && record.isValid(now) && record.isLocked()&& acquiredAtLeastFor < (now - record.getLockAcquireTime())) {
      result.add(record);
    }
  }
  return result;
}
