{
  Data reqValue=request.value;
  Record rec=concurrentMapManager.ensureRecord(request);
  if (request.operation == CONCURRENT_MAP_TRY_LOCK_AND_GET) {
    if (reqValue == null) {
      request.value=rec.getValueData();
      if (rec.getMultiValues() != null) {
        Values values=new Values(rec.getMultiValues());
        request.value=toData(values);
      }
    }
  }
  DistributedLock lock=rec.getLock();
  Long response=(lock == null || !lock.isLocked()) ? 0L : 1L;
  rec.lock(request.lockThreadId,request.lockAddress);
  rec.incrementVersion();
  request.version=rec.getVersion();
  request.lockCount=rec.getLockCount();
  markAsActive(rec);
  request.response=response;
}
