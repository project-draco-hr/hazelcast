{
  Data reqValue=request.value;
  request.value=null;
  Record rec=concurrentMapManager.ensureRecord(request);
  if (request.operation == CONCURRENT_MAP_LOCK_AND_GET_VALUE) {
    if (reqValue == null) {
      request.value=rec.getValueData();
      if (rec.getMultiValues() != null) {
        Values values=new Values(rec.getMultiValues());
        request.value=toData(values);
      }
    }
 else {
      if (!rec.containsValue(reqValue)) {
        request.value=null;
      }
 else {
        request.value=reqValue;
      }
    }
  }
  rec.lock(request.lockThreadId,request.lockAddress);
  rec.incrementVersion();
  request.version=rec.getVersion();
  request.lockCount=rec.getLockCount();
  markAsActive(rec);
  request.response=Boolean.TRUE;
}
