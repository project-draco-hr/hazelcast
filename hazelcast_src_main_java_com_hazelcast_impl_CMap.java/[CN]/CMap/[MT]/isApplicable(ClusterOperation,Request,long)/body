{
  Record record=getRecord(req);
  if (ClusterOperation.CONCURRENT_MAP_PUT_IF_ABSENT.equals(operation)) {
    return record == null || !record.isActive() || !record.isValid(now) || record.getValueData() == null;
  }
 else   if (ClusterOperation.CONCURRENT_MAP_REPLACE_IF_NOT_NULL.equals(operation)) {
    return record != null && record.isActive() && record.isValid(now) && record.getValueData() != null;
  }
 else   if (ClusterOperation.CONCURRENT_MAP_REPLACE_IF_SAME.equals(operation)) {
    if (record != null && record.isActive() && record.isValid(now)) {
      MultiData multiData=(MultiData)toObject(req.value);
      if (multiData == null || multiData.size() != 2) {
        throw new RuntimeException("Illegal replaceIfSame argument: " + multiData);
      }
      Data expectedOldValue=multiData.getData(0);
      return expectedOldValue.equals(record.getValueData());
    }
 else {
      return false;
    }
  }
  return true;
}
