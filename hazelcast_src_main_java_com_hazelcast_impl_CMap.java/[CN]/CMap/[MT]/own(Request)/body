{
  if (req.key == null || req.key.size() == 0) {
    throw new RuntimeException("Key cannot be null " + req.key);
  }
  Record record=toRecord(req);
  if (req.ttl <= 0 || req.timeout <= 0) {
    record.setInvalid();
  }
 else {
    record.setExpirationTime(req.ttl);
    record.setMaxIdle(req.timeout);
  }
  markAsActive(record);
  if (store != null && writeDelayMillis > 0) {
    markAsDirty(record);
  }
  if (req.value != null) {
    updateIndexes(record);
  }
  record.setVersion(req.version);
}
