{
  if (req.key == null || req.key.size() == 0) {
    throw new RuntimeException("Key cannot be null " + req.key);
  }
  if (req.value == null) {
    req.value=new Data();
  }
  Record record=toRecordAndStats(req,true);
  if (req.ttl <= 0 || req.timeout <= 0) {
    record.setInvalid();
  }
 else {
    record.setExpirationTime(req.ttl);
    record.setMaxIdle(req.timeout);
  }
  markAsActive(record);
  markAsDirty(record);
  updateIndexes(record);
  if (record.isLocked()) {
    updateStats(LOCK,record,true,null);
  }
  record.setVersion(req.version);
}
