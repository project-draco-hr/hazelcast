{
  Map<Data,Record> targetMap=(owned) ? mapOwnedRecords : mapBackupRecords;
  Record record=targetMap.get(req.key);
  if (record == null) {
    if (isMultiMap()) {
      record=createNewRecord(req.key,null);
      record.addValue(req.value);
    }
 else {
      record=createNewRecord(req.key,req.value);
    }
    targetMap.put(req.key,record);
  }
 else {
    if (req.value != null) {
      if (isMultiMap()) {
        record.addValue(req.value);
      }
 else {
        record.setValue(req.value);
      }
    }
  }
  record.setIndexes(req.indexes,req.indexTypes);
  record.setCopyCount((int)req.longValue);
  if (req.lockCount >= 0) {
    record.setLockAddress(req.lockAddress);
    record.setLockThreadId(req.lockThreadId);
    record.setLockCount(req.lockCount);
  }
  return record;
}
