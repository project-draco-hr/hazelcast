{
  Config config=new Config();
  config.setProperty("hazelcast.map.cleanup.delay.seconds","5");
  MapConfig mapConfig=config.getMapConfig("testStoreAllShouldNotBlockPut");
  MapStoreConfig msConfig=new MapStoreConfig();
  msConfig.setWriteDelaySeconds(5);
  mapConfig.setMapStoreConfig(msConfig);
  msConfig.setEnabled(true);
  msConfig.setImplementation(new MapStore(){
    public void store(    Object key,    Object value){
    }
    public void storeAll(    Map map){
      try {
        Thread.sleep(5000);
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
    }
    public void delete(    Object key){
    }
    public void deleteAll(    Collection keys){
    }
    public Object load(    Object key){
      return null;
    }
    public Map loadAll(    Collection keys){
      return null;
    }
    public Set loadAllKeys(){
      return null;
    }
  }
);
  HazelcastInstance instance=Hazelcast.newHazelcastInstance(config);
  IMap map=instance.getMap("testStoreAllShouldNotBlockPut");
  for (int i=0; i < 30000; i++) {
    try {
      long start=Clock.currentTimeMillis();
      map.put(i,i);
      long end=Clock.currentTimeMillis();
      assertTrue((end - start) < 1000);
      Thread.sleep(1);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
  Hazelcast.shutdownAll();
}
