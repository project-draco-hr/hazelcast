{
  FailAwareMapStore testMapStore=new FailAwareMapStore();
  testMapStore.setFail(false);
  Config config=newConfig(testMapStore,0);
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  IMap map=h1.getMap("default");
  Transaction txn=h1.getTransaction();
  txn.begin();
  assertEquals(0,map.size());
  assertEquals(0,testMapStore.dbSize());
  map.put("1","value1");
  map.put("2","value2");
  txn.commit();
  assertEquals(2,map.size());
  assertEquals(2,testMapStore.dbSize());
  txn=h1.getTransaction();
  txn.begin();
  assertEquals(2,map.size());
  assertEquals(2,testMapStore.dbSize());
  map.put("3","value3");
  assertEquals(3,map.size());
  assertEquals(2,testMapStore.dbSize());
  testMapStore.setFail(true);
  map.put("4","value4");
  try {
    txn.commit();
    fail("Should not commit the txn");
  }
 catch (  Exception e) {
  }
  assertEquals(2,map.size());
  assertEquals(2,testMapStore.dbSize());
}
