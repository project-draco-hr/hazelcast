{
  TestMapStore mapStore=new TestMapStore(1,1,0);
  Config c=new Config();
  c.setProperty(GroupProperties.PROP_CLEANUP_DELAY_SECONDS,"1");
  c.getMapConfig("test").setMapStoreConfig(new MapStoreConfig().setEnabled(true).setWriteDelaySeconds(5).setImplementation(mapStore));
  mapStore.setLoadAllKeys(false);
  c.getMapConfig("test").setTimeToLiveSeconds(1);
  final CountDownLatch latch=new CountDownLatch(2);
  IMap map=Hazelcast.newHazelcastInstance(c).getMap("test");
  map.addEntryListener(new EntryAdapter(){
    public void entryEvicted(    final EntryEvent entryEvent){
      if (entryEvent.getKey().equals(2)) {
        latch.countDown();
      }
 else {
        fail("Should not evict: " + entryEvent);
      }
    }
    public void entryRemoved(    final EntryEvent entryEvent){
      if (entryEvent.getKey().equals(1)) {
        latch.countDown();
      }
 else {
        fail("Should not remove: " + entryEvent);
      }
    }
  }
,true);
  map.put(1,"value");
  map.put(2,"value");
  Thread.sleep(1500);
  assertEquals("value",map.remove(1));
  assertTrue("EntryListener failed!",latch.await(10,TimeUnit.SECONDS));
  mapStore.assertAwait(10);
}
