{
  TestMapStore testMapStore=new TestMapStore(1,1,1);
  testMapStore.setLoadAllKeys(false);
  Config config=newConfig(testMapStore,200);
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  IMap map=h1.getMap("default");
  assertEquals(0,map.size());
  for (int i=0; i < 100; i++) {
    map.put(i,i);
  }
  assertEquals(100,map.size());
  assertEquals(0,testMapStore.getStore().size());
  assertEquals(100,map.getLocalMapStats().getDirtyEntryCount());
  getConcurrentMapManager(h1).flush(Prefix.MAP + "default");
  assertEquals(100,testMapStore.getStore().size());
  assertEquals(0,map.getLocalMapStats().getDirtyEntryCount());
  assertEquals(100,map.size());
  for (int i=0; i < 50; i++) {
    map.remove(i);
  }
  assertEquals(50,map.size());
  assertEquals(100,testMapStore.getStore().size());
  getConcurrentMapManager(h1).flush(Prefix.MAP + "default");
  assertEquals(50,testMapStore.getStore().size());
  assertEquals(50,map.size());
}
