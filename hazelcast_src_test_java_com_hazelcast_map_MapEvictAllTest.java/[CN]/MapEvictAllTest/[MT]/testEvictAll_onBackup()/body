{
  final String mapName=randomMapName();
  final CountDownLatch countDownLatch=new CountDownLatch(10000);
  final TestHazelcastInstanceFactory instanceFactory=new TestHazelcastInstanceFactory(5);
  final HazelcastInstance node1=instanceFactory.newHazelcastInstance();
  final HazelcastInstance node2=instanceFactory.newHazelcastInstance();
  final IMap map=node1.getMap(mapName);
  map.addEntryListener(new EntryAdapter(){
    @Override public void evictedAll(    MapWideEvent event){
      System.out.println("event = " + event);
      final int numberOfEntries=event.getNumberOfEntriesAffected();
      for (int i=0; i < numberOfEntries; i++) {
        countDownLatch.countDown();
      }
    }
  }
,false);
  for (int i=0; i < 10000; i++) {
    map.put(i,i);
  }
  map.evictAll();
  assertOpenEventually(countDownLatch);
  assertEquals(0,countDownLatch.getCount());
}
