{
  TestHazelcastInstanceFactory nodeFactory=createHazelcastInstanceFactory();
  String mapName=randomMapName();
  Config config=new Config();
  ReplicatedMapConfig replicatedMapConfig=config.getReplicatedMapConfig(mapName);
  replicatedMapConfig.setAsyncFillup(false);
  HazelcastInstance instance1=nodeFactory.newHazelcastInstance(config);
  final ReplicatedMap<Integer,Integer> map1=instance1.getReplicatedMap(mapName);
  int first=1000;
  int second=2000;
  int third=3000;
  fillMap(map1,0,first);
  HazelcastInstance instance2=nodeFactory.newHazelcastInstance(config);
  final ReplicatedMap<Integer,Integer> map2=instance2.getReplicatedMap(mapName);
  assertEquals(first,map1.size());
  assertEquals(first,map2.size());
  fillMap(map2,first,second);
  HazelcastInstance instance3=nodeFactory.newHazelcastInstance(config);
  final ReplicatedMap<Integer,Integer> map3=instance3.getReplicatedMap(mapName);
  assertEquals(second,map1.size());
  assertEquals(second,map2.size());
  assertEquals(second,map3.size());
  fillMap(map3,second,third);
  HazelcastInstance instance4=nodeFactory.newHazelcastInstance(config);
  final ReplicatedMap<Integer,Integer> map4=instance4.getReplicatedMap(mapName);
  assertEquals(third,map1.size());
  assertEquals(third,map2.size());
  assertEquals(third,map3.size());
  assertEquals(third,map4.size());
}
