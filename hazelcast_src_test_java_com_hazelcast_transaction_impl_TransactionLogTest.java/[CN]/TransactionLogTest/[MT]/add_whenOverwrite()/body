{
  TransactionLog log=new TransactionLog();
  String key="foo";
  KeyAwareTransactionLogRecord oldRecord=mock(KeyAwareTransactionLogRecord.class);
  when(oldRecord.getKey()).thenReturn(key);
  log.add(oldRecord);
  KeyAwareTransactionLogRecord newRecord=mock(KeyAwareTransactionLogRecord.class);
  when(newRecord.getKey()).thenReturn(key);
  log.add(newRecord);
  assertSame(newRecord,log.get(key));
  assertEquals(1,log.size());
}
