{
  final ByteArrayOutputStream bos=new ByteArrayOutputStream();
  final ZipOutputStream out=new ZipOutputStream(bos);
  final ZipInputStream zin=new ZipInputStream(in);
  try {
    while (true) {
      final ZipEntry entry=zin.getNextEntry();
      if (entry == null)       break;
      out.putNextEntry(new ZipEntry(entry.getName()));
      log("war file " + entry.getName());
      if (entry.isDirectory()) {
        continue;
      }
      if (entry.getName().equals("WEB-INF/web.xml")) {
        final ByteArrayOutputStream bosWebXml=new ByteArrayOutputStream();
        StreamUtil.copyStream(zin,bosWebXml);
        bosWebXml.flush();
        final byte[] webxmlBytes=bosWebXml.toByteArray();
        bosWebXml.close();
        final ByteArrayInputStream binWebXml=new ByteArrayInputStream(webxmlBytes);
        readModifyWrite(binWebXml,out);
        binWebXml.close();
      }
 else {
        StreamUtil.copyStream(zin,out);
      }
      out.flush();
    }
  }
 catch (  final Exception e) {
    e.printStackTrace();
    if (DEBUG)     System.exit(0);
  }
 finally {
    try {
      out.flush();
      out.close();
      bos.writeTo(os);
    }
 catch (    final IOException e) {
      e.printStackTrace();
    }
  }
}
