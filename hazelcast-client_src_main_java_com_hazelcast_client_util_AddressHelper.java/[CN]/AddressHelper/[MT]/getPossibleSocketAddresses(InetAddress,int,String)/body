{
  int possiblePort=port;
  int portTryCount=1;
  if (possiblePort == -1) {
    portTryCount=MAX_PORT_TRIES;
    possiblePort=INITIAL_FIRST_PORT;
  }
  final Collection<InetSocketAddress> socketAddresses=new LinkedList<InetSocketAddress>();
  if (inetAddress == null) {
    for (int i=0; i < portTryCount; i++) {
      socketAddresses.add(new InetSocketAddress(scopedAddress,possiblePort + i));
    }
  }
 else   if (inetAddress instanceof Inet4Address) {
    for (int i=0; i < portTryCount; i++) {
      socketAddresses.add(new InetSocketAddress(inetAddress,possiblePort + i));
    }
  }
 else   if (inetAddress instanceof Inet6Address) {
    final Collection<Inet6Address> addresses=getPossibleInetAddressesFor((Inet6Address)inetAddress);
    for (    Inet6Address inet6Address : addresses) {
      for (int i=0; i < portTryCount; i++) {
        socketAddresses.add(new InetSocketAddress(inet6Address,possiblePort + i));
      }
    }
  }
  return socketAddresses;
}
