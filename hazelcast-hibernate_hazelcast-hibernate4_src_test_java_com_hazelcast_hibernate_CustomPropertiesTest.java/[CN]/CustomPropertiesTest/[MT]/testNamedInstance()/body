{
  TestHazelcastFactory factory=new TestHazelcastFactory();
  Config config=new Config();
  config.setInstanceName("hibernate");
  HazelcastInstance hz=factory.newHazelcastInstance(config);
  Properties props=new Properties();
  props.setProperty(Environment.CACHE_REGION_FACTORY,HazelcastCacheRegionFactory.class.getName());
  props.put(CacheEnvironment.HAZELCAST_INSTANCE_NAME,"hibernate");
  props.put(CacheEnvironment.SHUTDOWN_ON_STOP,"false");
  props.setProperty("hibernate.dialect","org.hibernate.dialect.HSQLDialect");
  Configuration configuration=new Configuration();
  configuration.addProperties(props);
  SessionFactory sf=configuration.buildSessionFactory();
  assertTrue(hz.equals(HazelcastAccessor.getHazelcastInstance(sf)));
  sf.close();
  assertTrue(hz.getLifecycleService().isRunning());
  factory.shutdownAll();
}
