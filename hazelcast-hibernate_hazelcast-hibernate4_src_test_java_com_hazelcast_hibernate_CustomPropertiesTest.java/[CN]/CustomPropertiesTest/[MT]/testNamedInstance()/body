{
  TestHazelcastFactory factory=new TestHazelcastFactory();
  Config config=new Config();
  config.setInstanceName("hibernate");
  HazelcastInstance hz=factory.newHazelcastInstance(config);
  Properties props=getDefaultProperties();
  props.setProperty(Environment.CACHE_REGION_FACTORY,HazelcastCacheRegionFactory.class.getName());
  props.put(CacheEnvironment.HAZELCAST_INSTANCE_NAME,"hibernate");
  props.put(CacheEnvironment.SHUTDOWN_ON_STOP,"false");
  HazelcastMockInstanceLoader instanceLoader=new HazelcastMockInstanceLoader();
  instanceLoader.configure(props);
  instanceLoader.setInstanceFactory(factory);
  final SessionFactory sf=createSessionFactory(props,instanceLoader);
  assertTrue(hz.equals(HazelcastAccessor.getHazelcastInstance(sf)));
  sf.close();
  assertTrue(hz.getLifecycleService().isRunning());
  factory.shutdownAll();
}
