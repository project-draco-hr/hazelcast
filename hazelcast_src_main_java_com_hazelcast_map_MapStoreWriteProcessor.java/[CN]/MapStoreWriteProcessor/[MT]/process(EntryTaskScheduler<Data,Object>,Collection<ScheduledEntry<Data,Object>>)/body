{
  if (entries.isEmpty())   return;
  NodeEngine nodeEngine=mapService.getNodeEngine();
  if (entries.size() == 1) {
    ScheduledEntry<Data,Object> entry=entries.iterator().next();
    int partitionId=nodeEngine.getPartitionService().getPartitionId(entry.getKey());
    if (nodeEngine.getThisAddress().equals(nodeEngine.getPartitionService().getPartitionOwner(partitionId))) {
      Exception exception=tryStore(scheduler,entry);
      if (exception != null) {
        logger.severe(exception);
      }
    }
  }
 else {
    final Queue<ScheduledEntry> duplicateKeys=new LinkedList<ScheduledEntry>();
    final Map<Object,Object> map=new HashMap<Object,Object>(entries.size());
    for (    ScheduledEntry<Data,Object> entry : entries) {
      int partitionId=nodeEngine.getPartitionService().getPartitionId(entry.getKey());
      if (nodeEngine.getThisAddress().equals(nodeEngine.getPartitionService().getPartitionOwner(partitionId))) {
        final Object key=mapService.toObject(entry.getKey());
        if (map.get(key) != null) {
          duplicateKeys.offer(new ScheduledEntry<Object,Object>(key,entry.getValue(),entry.getScheduledDelayMillis(),entry.getActualDelaySeconds(),entry.getScheduleTimeNanos()));
          continue;
        }
        map.put(key,mapService.toObject(entry.getValue()));
      }
    }
    for (    ScheduledEntry duplicateKey : duplicateKeys) {
      Object key=duplicateKey.getKey();
      Object removed=map.remove(key);
      if (removed != null) {
        final Exception ex=tryStore(scheduler,new AbstractMap.SimpleEntry(key,removed));
        if (ex != null) {
          logger.severe(ex);
        }
      }
    }
    Exception exception=null;
    try {
      mapContainer.getStore().storeAll(map);
    }
 catch (    Exception e) {
      logger.warning(mapContainer.getStore().getMapStore().getClass() + " --> storeAll was failed, " + "now Hazelcast is trying to store one by one: ",e);
      for (      ScheduledEntry<Data,Object> entry : entries) {
        Exception temp=tryStore(scheduler,entry);
        if (temp != null) {
          exception=temp;
        }
      }
    }
    ScheduledEntry entry;
    while ((entry=duplicateKeys.poll()) != null) {
      final Exception temp=tryStore(scheduler,entry);
      if (temp != null) {
        exception=temp;
      }
    }
    if (exception != null) {
      logger.severe(exception);
    }
  }
}
