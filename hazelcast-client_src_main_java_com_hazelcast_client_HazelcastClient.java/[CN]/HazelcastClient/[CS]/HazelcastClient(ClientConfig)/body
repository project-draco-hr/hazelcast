{
  this.config=config;
  final GroupConfig groupConfig=config.getGroupConfig();
  name="hz.client_" + id + (groupConfig != null ? "_" + groupConfig.getName() : "");
  threadGroup=new ThreadGroup(name);
  lifecycleService=new LifecycleServiceImpl(this);
  SerializationService ss;
  try {
    ss=new SerializationServiceBuilder().setManagedContext(new HazelcastClientManagedContext(this,config.getManagedContext())).setClassLoader(config.getClassLoader()).setConfig(config.getSerializationConfig()).build();
  }
 catch (  Exception e) {
    throw ExceptionUtil.rethrow(e);
  }
  serializationService=ss;
  proxyManager=new ProxyManager(this);
  executionService=new ClientExecutionServiceImpl(name,threadGroup,Thread.currentThread().getContextClassLoader(),config.getExecutorPoolSize());
  clusterService=new ClientClusterServiceImpl(this);
  LoadBalancer loadBalancer=config.getLoadBalancer();
  if (loadBalancer == null) {
    loadBalancer=new RoundRobinLB();
  }
  if (config.isSmart()) {
    connectionManager=new SmartClientConnectionManager(this,clusterService.getAuthenticator(),loadBalancer);
  }
 else {
    connectionManager=new DummyClientConnectionManager(this,clusterService.getAuthenticator(),loadBalancer);
  }
  invocationService=new ClientInvocationServiceImpl(this);
  userContext=new ConcurrentHashMap<String,Object>();
  clusterService.start();
  loadBalancer.init(getCluster(),config);
  proxyManager.init(config.getProxyFactoryConfig());
  lifecycleService.setStarted();
  partitionService=new ClientPartitionServiceImpl(this);
  partitionService.start();
}
