{
  if (config == null) {
    config=new XmlClientConfigBuilder().build();
  }
  final ClassLoader tccl=Thread.currentThread().getContextClassLoader();
  HazelcastClientProxy proxy;
  try {
    Thread.currentThread().setContextClassLoader(HazelcastClient.class.getClassLoader());
    final HazelcastClient client=new HazelcastClient(config);
    client.start();
    OutOfMemoryErrorDispatcher.setClientHandler(OUT_OF_MEMORY_HANDLER);
    OutOfMemoryErrorDispatcher.register(client);
    proxy=new HazelcastClientProxy(client);
    CLIENTS.put(client.id,proxy);
  }
  finally {
    Thread.currentThread().setContextClassLoader(tccl);
  }
  return proxy;
}
