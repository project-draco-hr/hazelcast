{
  Record record=null;
  MapContainer mapContainer=getMapContainer(name);
  final MapConfig.InMemoryFormat inMemoryFormat=mapContainer.getMapConfig().getInMemoryFormat();
  boolean statisticsEnabled=mapContainer.getMapConfig().isStatisticsEnabled();
  if (inMemoryFormat == MapConfig.InMemoryFormat.BINARY) {
    record=new DataRecord(dataKey,toData(value),statisticsEnabled);
  }
 else   if (inMemoryFormat == MapConfig.InMemoryFormat.OBJECT) {
    record=new ObjectRecord(dataKey,toObject(value),statisticsEnabled);
  }
 else   if (inMemoryFormat == MapConfig.InMemoryFormat.CACHED) {
    record=new CachedDataRecord(dataKey,toData(value),statisticsEnabled);
  }
 else {
    throw new IllegalArgumentException("Should not happen!");
  }
  if (shouldSchedule) {
    if (ttl < 0 && mapContainer.getMapConfig().getTimeToLiveSeconds() > 0) {
      scheduleTtlEviction(name,record,mapContainer.getMapConfig().getTimeToLiveSeconds() * 1000);
    }
    if (ttl > 0) {
      scheduleTtlEviction(name,record,ttl);
    }
    if (mapContainer.getMapConfig().getMaxIdleSeconds() > 0) {
      scheduleIdleEviction(name,dataKey,mapContainer.getMapConfig().getMaxIdleSeconds() * 1000);
    }
  }
  return record;
}
