{
  if (portables == null || portables.length == 0) {
    throw new HazelcastSerializationException("Cannot write null portable array without explicitly " + "registering class definition!");
  }
  final Portable p=portables[0];
  final int classId=p.getClassId();
  for (int i=1; i < portables.length; i++) {
    if (portables[i].getClassId() != classId) {
      throw new IllegalArgumentException("Detected different class-ids in portable array!");
    }
  }
  final int version=PortableVersionHelper.getVersion(p,context.getVersion());
  ClassDefinition nestedClassDef=createNestedClassDef(p,new ClassDefinitionBuilder(p.getFactoryId(),classId,version));
  builder.addPortableArrayField(fieldName,nestedClassDef);
}
