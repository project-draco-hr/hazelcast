{
  while (!sizeRead && bb.hasRemaining() && bbSizes.hasRemaining()) {
    IOUtil.copyToHeapBuffer(bb,bbSizes);
  }
  if (!sizeRead && !bbSizes.hasRemaining()) {
    sizeRead=true;
    bbSizes.flip();
    bbHeader.limit(bbSizes.getInt());
    key=new Data(bbSizes.getInt());
    value=new Data(bbSizes.getInt());
    if (bbHeader.limit() == 0) {
      throw new RuntimeException("read.bbHeader size cannot be 0");
    }
  }
  if (sizeRead) {
    while (bb.hasRemaining() && bbHeader.hasRemaining()) {
      IOUtil.copyToHeapBuffer(bb,bbHeader);
    }
    while (bb.hasRemaining() && key.shouldRead()) {
      key.read(bb);
    }
    while (bb.hasRemaining() && value.shouldRead()) {
      value.read(bb);
    }
  }
  if (sizeRead && !bbHeader.hasRemaining() && !key.shouldRead()&& !value.shouldRead()) {
    sizeRead=false;
    key.postRead();
    value.postRead();
    return true;
  }
  return false;
}
