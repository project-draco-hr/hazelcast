{
  if (!isStatusSet(ST_HEADER)) {
    if (!destination.hasRemaining()) {
      return false;
    }
    destination.put(header);
    setStatus(ST_HEADER);
  }
  if (!isStatusSet(ST_SIZE)) {
    if (destination.remaining() < 4) {
      return false;
    }
    destination.putInt(value != null ? value.size() : 0);
    setStatus(ST_SIZE);
  }
  if (isStatusSet(ST_SIZE) && !isStatusSet(ST_VALUE)) {
    if (value != null) {
      IOUtil.copyToHeapBuffer(value.buffer,destination);
      if (value.buffer.hasRemaining()) {
        return false;
      }
    }
    setStatus(ST_VALUE);
  }
  return true;
}
