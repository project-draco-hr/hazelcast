{
  if (!isStatusSet(stHeader)) {
    if (!destination.hasRemaining()) {
      return false;
    }
    destination.put(header);
    setStatus(stHeader);
  }
  if (!isStatusSet(stType)) {
    if (destination.remaining() < 4) {
      return false;
    }
    destination.putInt(value.type);
    setStatus(stType);
  }
  if (!isStatusSet(stClassId)) {
    if (destination.remaining() < 4) {
      return false;
    }
    final int classId=value.cd == null ? Data.NO_CLASS_ID : value.cd.getClassId();
    destination.putInt(classId);
    if (classId == Data.NO_CLASS_ID) {
      setStatus(stVersion);
      setStatus(stClassDefSize);
      setStatus(stClassDef);
    }
    setStatus(stClassId);
  }
  if (!isStatusSet(stVersion)) {
    if (destination.remaining() < 4) {
      return false;
    }
    final int version=value.cd.getVersion();
    destination.putInt(version);
    setStatus(stVersion);
  }
  if (!isStatusSet(stClassDefSize)) {
    if (destination.remaining() < 4) {
      return false;
    }
    final byte[] binary=value.cd.getBinary();
    classDefSize=binary == null ? 0 : binary.length;
    destination.putInt(classDefSize);
    setStatus(stClassDefSize);
    if (classDefSize == 0) {
      setStatus(stClassDef);
    }
 else {
      buffer=ByteBuffer.wrap(binary);
    }
  }
  if (!isStatusSet(stClassDef)) {
    IOUtil.copyToHeapBuffer(buffer,destination);
    if (buffer.hasRemaining()) {
      return false;
    }
    setStatus(stClassDef);
  }
  if (!isStatusSet(stSize)) {
    if (destination.remaining() < 4) {
      return false;
    }
    final int size=value.bufferSize();
    destination.putInt(size);
    setStatus(stSize);
    if (size <= 0) {
      setStatus(stValue);
    }
 else {
      buffer=ByteBuffer.wrap(value.buffer);
    }
  }
  if (!isStatusSet(stValue)) {
    IOUtil.copyToHeapBuffer(buffer,destination);
    if (buffer.hasRemaining()) {
      return false;
    }
    setStatus(stValue);
  }
  if (!isStatusSet(stHash)) {
    if (destination.remaining() < 4) {
      return false;
    }
    destination.putInt(value.getPartitionHash());
    setStatus(stHash);
  }
  return true;
}
