{
  nullCheck(xid);
switch (flags) {
case TMNOFLAGS:
    if (getTransaction(xid) != null) {
      final XAException xaException=new XAException(XAException.XAER_DUPID);
      logger.severe("Duplicate xid: " + xid,xaException);
      throw xaException;
    }
  try {
    final TransactionProxy transaction=getTransaction();
    transactionManager.addManagedTransaction(xid,transaction);
    transaction.begin();
  }
 catch (  IllegalStateException e) {
    throw new XAException(XAException.XAER_INVAL);
  }
break;
case TMRESUME:
case TMJOIN:
break;
default :
throw new XAException(XAException.XAER_INVAL);
}
}
