{
  InternalPartitionServiceImpl partitionService=getService();
  int partitionId=getPartitionId();
  MigrationManager migrationManager=partitionService.getMigrationManager();
  MigrationInfo migrationInfo=migrationManager.getActiveMigration(partitionId);
  if (migrationInfo == null) {
    return;
  }
  NodeEngineImpl nodeEngine=(NodeEngineImpl)getNodeEngine();
  PartitionMigrationEvent event=new PartitionMigrationEvent(endpoint,partitionId);
  for (  MigrationAwareService service : nodeEngine.getServices(MigrationAwareService.class)) {
    finishMigration(event,service);
  }
  if (endpoint == MigrationEndpoint.SOURCE && success) {
    partitionService.clearPartitionReplicaVersions(partitionId);
  }
 else   if (endpoint == MigrationEndpoint.DESTINATION && !success) {
    partitionService.clearPartitionReplicaVersions(partitionId);
  }
  migrationManager.removeActiveMigration(partitionId);
  if (success) {
    nodeEngine.onPartitionMigrate(migrationInfo);
  }
}
