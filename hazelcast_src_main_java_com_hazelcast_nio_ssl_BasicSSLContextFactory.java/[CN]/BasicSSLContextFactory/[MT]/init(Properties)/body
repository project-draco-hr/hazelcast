{
  KeyStore ks=KeyStore.getInstance("JKS");
  KeyStore ts=KeyStore.getInstance("JKS");
  String keyStorePassword=getProperty(properties,"keyStorePassword","javax.net.ssl.keyStorePassword");
  String keyStore=getProperty(properties,"keyStore","javax.net.ssl.keyStore");
  if (keyStore == null || keyStorePassword == null) {
    throw new RuntimeException("SSL is enabled but keyStore[Password] properties aren't set!");
  }
  String trustStore=getProperty(properties,"trustStore","javax.net.ssl.trustStore",keyStore);
  String trustStorePassword=getProperty(properties,"trustStorePassword","javax.net.ssl.trustStorePassword",keyStorePassword);
  String keyManagerAlgorithm=properties.getProperty("keyManagerAlgorithm","SunX509");
  String trustManagerAlgorithm=properties.getProperty("trustManagerAlgorithm","SunX509");
  String protocol=properties.getProperty("protocol","TLS");
  final char[] keyStorePassPhrase=keyStorePassword.toCharArray();
  loadKeyStore(ks,keyStorePassPhrase,keyStore);
  KeyManagerFactory kmf=KeyManagerFactory.getInstance(keyManagerAlgorithm);
  kmf.init(ks,keyStorePassPhrase);
  loadKeyStore(ts,trustStorePassword.toCharArray(),trustStore);
  TrustManagerFactory tmf=TrustManagerFactory.getInstance(trustManagerAlgorithm);
  tmf.init(ts);
  sslContext=SSLContext.getInstance(protocol);
  sslContext.init(kmf.getKeyManagers(),tmf.getTrustManagers(),null);
}
