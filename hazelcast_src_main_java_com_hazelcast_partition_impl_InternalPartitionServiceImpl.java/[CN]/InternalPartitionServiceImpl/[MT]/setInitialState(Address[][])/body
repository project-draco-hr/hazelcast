{
  lock.lock();
  try {
    if (initialized) {
      throw new IllegalStateException("Partition table is already initialized!");
    }
    logger.info("Setting cluster partition table ...");
    for (int partitionId=0; partitionId < partitionCount; partitionId++) {
      InternalPartitionImpl partition=partitions[partitionId];
      Address[] replicas=newState[partitionId];
      partition.setInitialReplicaAddresses(replicas);
    }
    initialized=true;
  }
  finally {
    lock.unlock();
  }
}
