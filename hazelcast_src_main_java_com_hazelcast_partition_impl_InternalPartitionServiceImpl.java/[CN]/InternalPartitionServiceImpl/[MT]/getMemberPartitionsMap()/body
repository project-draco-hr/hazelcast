{
  final int members=node.getClusterService().getSize();
  Map<Address,List<Integer>> memberPartitions=new HashMap<Address,List<Integer>>(members);
  for (int i=0; i < partitionCount; i++) {
    Address owner;
    while ((owner=getPartitionOwner(i)) == null) {
      try {
        Thread.sleep(PARTITION_OWNERSHIP_WAIT_MILLIS);
      }
 catch (      InterruptedException e) {
        throw new HazelcastException(e);
      }
    }
    List<Integer> ownedPartitions=memberPartitions.get(owner);
    if (ownedPartitions == null) {
      ownedPartitions=new ArrayList<Integer>();
      memberPartitions.put(owner,ownedPartitions);
    }
    ownedPartitions.add(i);
  }
  return memberPartitions;
}
