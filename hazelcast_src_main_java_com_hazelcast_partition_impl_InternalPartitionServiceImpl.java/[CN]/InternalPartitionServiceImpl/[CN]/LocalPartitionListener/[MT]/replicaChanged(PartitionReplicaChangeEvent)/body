{
  final int partitionId=event.getPartitionId();
  final int replicaIndex=event.getReplicaIndex();
  final Address newAddress=event.getNewAddress();
  final Address oldAddress=event.getOldAddress();
  final PartitionReplicaChangeReason reason=event.getReason();
  final boolean initialAssignment=event.getOldAddress() == null;
  if (replicaIndex > 0) {
    if (thisAddress.equals(oldAddress)) {
      clearPartition(partitionId,replicaIndex);
    }
 else     if (thisAddress.equals(newAddress)) {
      synchronizePartition(partitionId,replicaIndex,reason,initialAssignment);
    }
  }
 else {
    if (!initialAssignment && thisAddress.equals(newAddress)) {
      promoteFromBackups(partitionId,reason,oldAddress);
    }
    partitionService.cancelReplicaSync(partitionId);
  }
  Node node=partitionService.node;
  if (replicaIndex == 0 && newAddress == null && node.getState() == NodeState.ACTIVE && node.joined()) {
    logOwnerOfPartitionIsRemoved(event);
  }
  if (node.isMaster()) {
    partitionService.stateVersion.incrementAndGet();
  }
}
