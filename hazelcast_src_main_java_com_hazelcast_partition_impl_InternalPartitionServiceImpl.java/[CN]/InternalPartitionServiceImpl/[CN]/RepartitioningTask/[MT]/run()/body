{
  if (!node.isMaster()) {
    return;
  }
  lock.lock();
  try {
    if (!initialized) {
      return;
    }
    if (!isMigrationAllowed()) {
      return;
    }
    migrationQueue.clear();
    PartitionStateGenerator psg=partitionStateGenerator;
    Collection<MemberImpl> members=node.getClusterService().getMemberImpls();
    Collection<MemberGroup> memberGroups=memberGroupFactory.createMemberGroups(members);
    Address[][] newState=psg.reArrange(memberGroups,partitions);
    if (!isMigrationAllowed()) {
      return;
    }
    processNewPartitionState(newState);
    syncPartitionRuntimeState(members);
  }
  finally {
    lock.unlock();
  }
}
