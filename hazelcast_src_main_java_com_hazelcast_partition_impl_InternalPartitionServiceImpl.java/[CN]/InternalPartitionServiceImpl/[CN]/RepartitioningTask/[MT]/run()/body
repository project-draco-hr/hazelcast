{
  if (!node.isMaster()) {
    return;
  }
  lock.lock();
  try {
    if (!initialized) {
      return;
    }
    if (!isMigrationAllowed()) {
      return;
    }
    migrationQueue.clear();
    PartitionStateGenerator psg=partitionStateGenerator;
    Collection<MemberGroup> memberGroups=createMemberGroups();
    Address[][] newState=psg.reArrange(memberGroups,partitions);
    if (newState == null) {
      if (logger.isFinestEnabled()) {
        logger.finest("partition rearrangement couldn't be done. size of member groups: " + memberGroups.size());
      }
      return;
    }
    if (!isMigrationAllowed()) {
      return;
    }
    processNewPartitionState(newState);
    syncPartitionRuntimeState();
  }
  finally {
    lock.unlock();
  }
}
