{
  this.node=node;
  this.socketChannel=socketChannel;
  this.connection=connection;
  this.logger=node.getLogger(SocketPacketWriter.class.getName());
  boolean symmetricEncryptionEnabled=CipherHelper.isSymmetricEncryptionEnabled(node);
  boolean asymmetricEncryptionEnabled=CipherHelper.isAsymmetricEncryptionEnabled(node);
  if (asymmetricEncryptionEnabled || symmetricEncryptionEnabled) {
    if (asymmetricEncryptionEnabled && symmetricEncryptionEnabled) {
      if (true) {
        logger.log(Level.INFO,"Incorrect encryption configuration.");
        logger.log(Level.INFO,"You can enable either SymmetricEncryption or AsymmetricEncryption.");
        throw new RuntimeException();
      }
      packetWriter=new ComplexCipherPacketWriter();
      logger.log(Level.INFO,"Writer started with ComplexEncryption");
    }
 else     if (symmetricEncryptionEnabled) {
      packetWriter=new SymmetricCipherPacketWriter();
      logger.log(Level.INFO,"Writer started with SymmetricEncryption");
    }
 else {
      packetWriter=new AsymmetricCipherPacketWriter();
      logger.log(Level.INFO,"Writer started with AsymmetricEncryption");
    }
  }
 else {
    packetWriter=new DefaultPacketWriter();
  }
}
