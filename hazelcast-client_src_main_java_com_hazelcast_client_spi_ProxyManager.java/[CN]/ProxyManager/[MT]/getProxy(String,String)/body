{
  final ObjectNamespace ns=new DefaultObjectNamespace(service,id);
  ClientProxyFuture proxyFuture=proxies.get(ns);
  if (proxyFuture != null) {
    return proxyFuture.get();
  }
  final ClientProxyFactory factory=proxyFactories.get(service);
  if (factory == null) {
    throw new IllegalArgumentException("No factory registered for service: " + service);
  }
  final ClientProxy clientProxy=factory.create(id);
  final ClientProxyFuture future=new ClientProxyFuture();
  final ClientProxyFuture current=proxies.putIfAbsent(ns,future);
  if (current != null) {
    return current.get();
  }
  initialize(clientProxy);
  future.set(clientProxy);
  return clientProxy;
}
