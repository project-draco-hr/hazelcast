{
  NodeEngineImpl nodeEngine=findAliveNodeEngine();
  if (nodeEngine == null) {
    masterAddress=node.getThisAddress();
    return;
  }
  Address master;
  if (nodeEngine.getNode().isMaster()) {
    master=nodeEngine.getThisAddress();
  }
 else {
    master=nodeEngine.getMasterAddress();
  }
  if (master == null) {
    masterAddress=node.getThisAddress();
    return;
  }
  NodeEngineImpl masterNodeEngine=nodes.get(master);
  if (masterNodeEngine != null && masterNodeEngine.isRunning() && masterNodeEngine.getNode().joined()) {
    masterAddress=master;
  }
}
