{
  NodeEngineImpl nodeEngine=findAliveNodeEngine();
  if (nodeEngine == null) {
    logger.fine("Picking this node as master, no other running NodeEngine has been detected.");
    masterAddress=node.getThisAddress();
    return;
  }
  Address master;
  if (nodeEngine.getNode().isMaster()) {
    master=nodeEngine.getThisAddress();
    logger.fine("Found node itself is master: " + master);
  }
 else {
    master=nodeEngine.getMasterAddress();
    logger.fine("Found node " + nodeEngine.getThisAddress() + " knows master as: "+ master);
  }
  if (master == null) {
    logger.fine("Picking this node as master, found NodeEngine has no master information.");
    masterAddress=node.getThisAddress();
    return;
  }
  NodeEngineImpl masterNodeEngine=nodes.get(master);
  if (masterNodeEngine == null) {
    logger.fine("NodeEngine for discovered master " + master + " is null.");
    return;
  }
  if (!masterNodeEngine.isRunning()) {
    logger.fine("NodeEngine for discovered master " + master + " is not running. -> "+ masterNodeEngine.getNode().getState());
    return;
  }
  if (!masterNodeEngine.getNode().joined()) {
    logger.fine("NodeEngine for discovered master " + master + " is not joined.");
    return;
  }
  logger.fine("Found possible master. Will try to connect to " + master);
  masterAddress=master;
}
