{
  NodeEngineImpl nodeEngine=null;
  for (  Address address : joinAddresses) {
    NodeEngineImpl ne=nodes.get(address);
    if (ne != null && ne.isRunning() && ne.getNode().joined()) {
      nodeEngine=ne;
      break;
    }
  }
  Address master=null;
  if (nodeEngine != null) {
    if (nodeEngine.getNode().isMaster()) {
      master=nodeEngine.getThisAddress();
    }
 else {
      master=nodeEngine.getMasterAddress();
    }
  }
  if (master == null) {
    master=node.getThisAddress();
  }
  return master;
}
