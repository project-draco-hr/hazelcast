{
synchronized (joinerLock) {
    ClusterJoinManager clusterJoinManager=node.clusterService.getClusterJoinManager();
    long joinStartTime=Clock.currentTimeMillis();
    long maxJoinMillis=getMaxJoinMillis();
    while (node.isRunning() && !node.joined() && (Clock.currentTimeMillis() - joinStartTime < maxJoinMillis)) {
      try {
        lookupMasterAddress();
        if (node.getThisAddress().equals(masterAddress)) {
          node.setJoined();
          node.setAsMaster();
          break;
        }
        if (masterAddress != null) {
          node.setMasterAddress(masterAddress);
          clusterJoinManager.sendJoinRequest(masterAddress,true);
        }
        Thread.sleep(50);
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
        break;
      }
    }
    if (!node.joined()) {
      logger.severe("Node[" + node.getThisAddress() + "] should have been joined to "+ node.getMasterAddress());
      node.shutdown(true);
    }
  }
}
