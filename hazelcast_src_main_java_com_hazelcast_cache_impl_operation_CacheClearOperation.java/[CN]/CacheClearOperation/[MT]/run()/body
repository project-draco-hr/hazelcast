{
  CacheService service=getService();
  final InternalPartitionService partitionService=getNodeEngine().getPartitionService();
  cache=service.getCacheRecordStore(name,getPartitionId());
  if (cache != null) {
    Set<Data> filteredKeys=new HashSet<Data>();
    if (keys != null) {
      for (      Data k : keys) {
        if (partitionService.getPartitionId(k) == getPartitionId()) {
          filteredKeys.add(k);
        }
      }
    }
    try {
      if (keys == null || keys.size() == 0 || !filteredKeys.isEmpty()) {
        if (isRemoveAll) {
          cache.removeAll(filteredKeys);
        }
 else {
          cache.clear();
        }
        response=new CacheClearResponse(Boolean.TRUE);
        int orderKey=keys != null ? keys.hashCode() : 1;
        cache.publishCompletedEvent(name,completionId,new HeapData(),orderKey);
      }
    }
 catch (    CacheException e) {
      response=new CacheClearResponse(e);
    }
    shouldBackup=!filteredKeys.isEmpty();
    if (shouldBackup) {
      for (      Data key : filteredKeys) {
        backupKeys.add(key);
      }
    }
  }
}
