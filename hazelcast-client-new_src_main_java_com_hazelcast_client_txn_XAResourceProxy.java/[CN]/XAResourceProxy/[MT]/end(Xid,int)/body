{
  nullCheck(xid);
  final TransactionProxy transaction=getTransaction();
  final SerializableXID sXid=transaction.getXid();
  if (sXid == null || !sXid.equals(xid)) {
    logger.severe("started xid: " + sXid + " and given xid : "+ xid+ " not equal!!!");
  }
  validateTx(transaction,ACTIVE);
switch (flags) {
case XAResource.TMSUCCESS:
    break;
case XAResource.TMFAIL:
  try {
    transaction.rollback();
    transactionManager.removeManagedTransaction(xid);
  }
 catch (  IllegalStateException e) {
    throw new XAException(XAException.XAER_RMERR);
  }
break;
case XAResource.TMSUSPEND:
break;
default :
throw new XAException(XAException.XAER_INVAL);
}
}
