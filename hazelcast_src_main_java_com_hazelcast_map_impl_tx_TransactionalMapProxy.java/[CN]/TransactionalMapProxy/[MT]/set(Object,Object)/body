{
  checkTransactionState();
  MapService service=getService();
  MapServiceContext mapServiceContext=service.getMapServiceContext();
  Data keyData=mapServiceContext.toData(key,partitionStrategy);
  Data dataBeforeTxn=putInternal(keyData,mapServiceContext.toData(value),-1,MILLISECONDS);
  if (value != null) {
    Type type=dataBeforeTxn == null ? Type.NEW : Type.UPDATED;
    TxnValueWrapper wrapper=new TxnValueWrapper(value,type);
    txMap.put(keyData,wrapper);
  }
}
