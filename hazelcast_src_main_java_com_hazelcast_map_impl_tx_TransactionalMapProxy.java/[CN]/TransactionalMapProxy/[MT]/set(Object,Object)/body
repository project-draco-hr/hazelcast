{
  checkTransactionState();
  MapService service=getService();
  MapServiceContext mapServiceContext=service.getMapServiceContext();
  Data keyData=mapServiceContext.toData(key,partitionStrategy);
  Data dataBeforeTxn=putInternal(keyData,mapServiceContext.toData(value));
  if (value != null) {
    TxnValueWrapper wrapper=(dataBeforeTxn == null) ? new TxnValueWrapper(value,TxnValueWrapper.Type.NEW) : new TxnValueWrapper(value,TxnValueWrapper.Type.UPDATED);
    txMap.put(keyData,wrapper);
  }
}
