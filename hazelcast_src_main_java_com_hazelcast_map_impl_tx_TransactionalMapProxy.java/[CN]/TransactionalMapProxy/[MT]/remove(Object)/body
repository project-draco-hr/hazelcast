{
  checkTransactionState();
  MapService service=getService();
  MapServiceContext mapServiceContext=service.getMapServiceContext();
  Data keyData=mapServiceContext.toData(key,partitionStrategy);
  Object valueBeforeTxn=mapServiceContext.toObject(removeInternal(keyData));
  TxnValueWrapper wrapper=null;
  if (valueBeforeTxn != null || txMap.containsKey(keyData)) {
    wrapper=txMap.put(keyData,new TxnValueWrapper(valueBeforeTxn,TxnValueWrapper.Type.REMOVED));
  }
  return wrapper == null ? valueBeforeTxn : checkIfRemoved(wrapper);
}
