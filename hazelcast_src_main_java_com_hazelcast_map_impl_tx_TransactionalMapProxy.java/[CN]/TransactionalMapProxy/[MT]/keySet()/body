{
  checkTransactionState();
  Set<Data> keySet=keySetInternal();
  MapService service=getService();
  MapServiceContext mapServiceContext=service.getMapServiceContext();
  for (  Map.Entry<Data,TxnValueWrapper> entry : txMap.entrySet()) {
    if (TxnValueWrapper.Type.NEW.equals(entry.getValue().type)) {
      keySet.add(entry.getKey());
    }
 else     if (TxnValueWrapper.Type.REMOVED.equals(entry.getValue().type)) {
      keySet.remove(entry.getKey());
    }
  }
  HashSet<Object> keys=new HashSet<Object>();
  for (  Data keyData : keySet) {
    keys.add(mapServiceContext.toObject(keyData));
  }
  return keys;
}
