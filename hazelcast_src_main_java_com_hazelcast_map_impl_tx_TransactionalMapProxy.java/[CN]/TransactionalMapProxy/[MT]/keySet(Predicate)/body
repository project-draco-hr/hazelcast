{
  checkTransactionState();
  if (predicate == null) {
    throw new NullPointerException("Predicate should not be null!");
  }
  if (predicate instanceof PagingPredicate) {
    throw new NullPointerException("Paging is not supported for Transactional queries!");
  }
  final MapService service=getService();
  final MapServiceContext mapServiceContext=service.getMapServiceContext();
  final QueryResultSet queryResultSet=(QueryResultSet)queryInternal(predicate,IterationType.KEY,false);
  final Set<Object> keySet=new HashSet<Object>(queryResultSet);
  final SerializationService ss=getNodeEngine().getSerializationService();
  for (  final Map.Entry<Data,TxnValueWrapper> entry : txMap.entrySet()) {
    Object key=ss.toObject(entry.getKey());
    if (!TxnValueWrapper.Type.REMOVED.equals(entry.getValue().type)) {
      Object value=entry.getValue().value instanceof Data ? mapServiceContext.toObject(entry.getValue().value) : entry.getValue().value;
      QueryEntry queryEntry=new QueryEntry(ss,entry.getKey(),key,value);
      if (predicate.apply(queryEntry)) {
        keySet.add(key);
      }
    }
 else {
      keySet.remove(key);
    }
  }
  return keySet;
}
