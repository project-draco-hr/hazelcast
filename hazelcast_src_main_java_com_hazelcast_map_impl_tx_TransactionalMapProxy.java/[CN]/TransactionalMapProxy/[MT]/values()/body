{
  checkTransactionState();
  final List<Map.Entry<Data,Data>> entries=getEntries();
  final MapService service=getService();
  final MapServiceContext mapServiceContext=service.getMapServiceContext();
  final Collection<Object> values=new ArrayList<Object>(entries.size());
  final Set<Object> keyWontBeIncluded=new HashSet<Object>();
  for (  final Map.Entry<Object,TxnValueWrapper> entry : txMap.entrySet()) {
    final boolean isRemoved=TxnValueWrapper.Type.REMOVED.equals(entry.getValue().type);
    final boolean isUpdated=TxnValueWrapper.Type.UPDATED.equals(entry.getValue().type);
    Object objectKey=entry.getKey();
    if (isRemoved) {
      keyWontBeIncluded.add(objectKey);
    }
 else {
      if (isUpdated) {
        keyWontBeIncluded.add(objectKey);
      }
      Object entryValue=entry.getValue().value;
      values.add(entryValue);
    }
  }
  Iterator<Map.Entry<Data,Data>> iterator=entries.iterator();
  while (iterator.hasNext()) {
    final Map.Entry entry=iterator.next();
    Object key=mapServiceContext.toObject(entry.getKey());
    if (keyWontBeIncluded.contains(key)) {
      continue;
    }
    Object value=mapServiceContext.toObject(entry.getValue());
    values.add(value);
  }
  return values;
}
