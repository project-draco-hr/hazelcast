{
  for (; ; ) {
    boolean urgent=true;
    OutboundFrame frame=urgentWriteQueue.poll();
    if (frame == null) {
      urgent=false;
      frame=writeQueue.poll();
    }
    if (frame == null) {
      return null;
    }
    if (frame instanceof TaskFrame) {
      ((TaskFrame)frame).run();
      continue;
    }
    if (urgent) {
      priorityFramesWritten.inc();
    }
 else {
      normalFramesWritten.inc();
    }
    return frame;
  }
}
