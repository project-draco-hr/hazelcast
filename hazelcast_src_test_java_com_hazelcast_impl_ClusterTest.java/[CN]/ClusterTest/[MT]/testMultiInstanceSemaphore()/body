{
  final Random random=new Random();
  HazelcastInstance instance1=Hazelcast.newHazelcastInstance(new Config());
  HazelcastInstance instance2=Hazelcast.newHazelcastInstance(new Config());
  HazelcastInstance instance3=Hazelcast.newHazelcastInstance(new Config());
  final ISemaphore semaphore1=instance1.getSemaphore("testMultiSemaphore");
  final ISemaphore semaphore2=instance2.getSemaphore("testMultiSemaphore");
  final ISemaphore semaphore3=instance3.getSemaphore("testMultiSemaphore");
  assertEquals(1,semaphore1.availablePermits());
  assertEquals(1,semaphore2.availablePermits());
  assertEquals(1,semaphore3.availablePermits());
  ExecutorService executorService=Executors.newCachedThreadPool();
  executorService.execute(new Runnable(){
    public void run(){
      for (int i=0; i < 10; i++) {
        semaphore1.tryAcquire();
        assertEquals(0,semaphore1.availablePermits());
        try {
          Thread.sleep(random.nextInt(100));
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
        semaphore1.release();
      }
    }
  }
);
  executorService.execute(new Runnable(){
    public void run(){
      for (int i=0; i < 20; i++) {
        semaphore2.tryAcquire();
        assertEquals(0,semaphore2.availablePermits());
        try {
          Thread.sleep(random.nextInt(100));
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
        semaphore2.release();
      }
    }
  }
);
  executorService.execute(new Runnable(){
    public void run(){
      for (int i=0; i < 30; i++) {
        semaphore3.tryAcquire();
        assertEquals(0,semaphore3.availablePermits());
        try {
          Thread.sleep(random.nextInt(100));
        }
 catch (        InterruptedException e) {
          e.printStackTrace();
        }
        semaphore3.release();
      }
    }
  }
);
  try {
    executorService.shutdown();
    executorService.awaitTermination(10,TimeUnit.SECONDS);
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
}
