{
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(new Config());
  IMap map1=h1.getMap("default");
  map1.put("1","value");
  assertEquals(1,map1.size());
  assertEquals(1,map1.keySet().size());
  CMap cmap1=getCMap(h1,"default");
  assertEquals(1,cmap1.mapRecords.size());
  assertEquals(1,cmap1.getMapIndexService().getOwnedRecords().size());
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(new Config());
  MigrationCompletionLatch l=new MigrationCompletionLatch("1",h1,h2);
  l.await(3,TimeUnit.SECONDS);
  IMap map2=h2.getMap("default");
  CMap cmap2=getCMap(h2,"default");
  assertEquals(1,cmap1.mapRecords.size());
  assertEquals(1,cmap2.mapRecords.size());
  assertEquals(1,cmap1.getMapIndexService().getOwnedRecords().size() + cmap2.getMapIndexService().getOwnedRecords().size());
  assertEquals(1,map1.size());
  assertEquals(1,map1.keySet().size());
  assertEquals(1,map2.size());
  assertEquals(1,map2.keySet().size());
  h1.getLifecycleService().shutdown();
  assertEquals(1,map2.size());
  assertEquals(1,map2.keySet().size());
  assertEquals(1,cmap2.mapRecords.size());
  assertEquals(1,cmap2.getMapIndexService().getOwnedRecords().size());
}
