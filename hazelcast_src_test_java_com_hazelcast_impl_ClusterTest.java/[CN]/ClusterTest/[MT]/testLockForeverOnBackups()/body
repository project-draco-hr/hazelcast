{
  HazelcastInstance h=Hazelcast.newHazelcastInstance(new Config());
  ILock lock=h.getLock("FOO");
  lock.lock();
  lock.unlock();
  final HazelcastInstance h2=Hazelcast.newHazelcastInstance(new Config());
  final ILock lock2=h2.getLock("FOO");
  lock2.lock();
  final CountDownLatch latch=new CountDownLatch(2);
  h2.getCluster().addMembershipListener(new MembershipListener(){
    public void memberAdded(    MembershipEvent membershipEvent){
    }
    public void memberRemoved(    MembershipEvent membershipEvent){
      lock2.lock();
      latch.countDown();
      lock2.unlock();
      latch.countDown();
    }
  }
);
  lock2.unlock();
  sleep(1000);
  h.getLifecycleService().shutdown();
  assertTrue(latch.await(5,TimeUnit.SECONDS));
}
