{
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(new Config());
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(new Config());
  final MultiMap<Integer,Integer> m1=h1.getMultiMap("default");
  final MultiMap<Integer,Integer> m2=h2.getMultiMap("default");
  for (int i=0; i < 999; i++) {
    m1.put(i,i);
  }
  assertTrue(m1.containsKey(1));
  assertTrue(m2.containsKey(1));
  m1.destroy();
  Thread.sleep(1000);
  String longName=Prefix.MULTIMAP + "default";
  assertFalse(TestUtil.getNode(h1).factory.proxies.containsKey(new FactoryImpl.ProxyKey(longName,null)));
  assertFalse(TestUtil.getNode(h1).factory.proxiesByName.containsKey(longName));
  assertFalse(TestUtil.getNode(h2).factory.proxies.containsKey(new FactoryImpl.ProxyKey(longName,null)));
  assertFalse(TestUtil.getNode(h2).factory.proxiesByName.containsKey(longName));
  assertNull(getCMap(h1,longName));
  assertNull(getCMap(h2,longName));
  assertFalse(m1.containsKey(1));
  assertFalse(m2.containsKey(1));
}
