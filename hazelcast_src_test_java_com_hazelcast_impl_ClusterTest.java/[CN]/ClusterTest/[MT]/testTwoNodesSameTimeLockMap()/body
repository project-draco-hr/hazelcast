{
  final String MAP_NAME="testmap";
  final String KEY="testkey";
  final CountDownLatch latch=new CountDownLatch(10000);
  final CountDownLatch start=new CountDownLatch(2);
  for (int i=0; i < 2; i++) {
    new Thread(new Runnable(){
      public void run(){
        HazelcastInstance h=Hazelcast.newHazelcastInstance(null);
        IMap<String,Integer> map=h.getMap(MAP_NAME);
        start.countDown();
        try {
          start.await();
        }
 catch (        InterruptedException e) {
          return;
        }
        while (latch.getCount() > 0) {
          if (!map.lockMap(1,TimeUnit.SECONDS)) {
            continue;
          }
          try {
            Integer value=map.get(KEY);
            if (value == null)             value=0;
            map.put(KEY,value + 1);
          }
  finally {
            map.unlockMap();
            latch.countDown();
          }
        }
        h.getLifecycleService().shutdown();
      }
    }
).start();
  }
  assertTrue(latch.await(200,TimeUnit.SECONDS));
}
