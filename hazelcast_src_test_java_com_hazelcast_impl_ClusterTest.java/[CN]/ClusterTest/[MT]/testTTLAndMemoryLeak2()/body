{
  Runtime.getRuntime().gc();
  long initialUsedMemory=getUsedMemoryAsMB();
  Config config=new Config();
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance h3=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance h4=Hazelcast.newHazelcastInstance(config);
  IMap map1=h1.getMap("default");
  final int size=20000;
  for (int i=0; i < size; i++) {
    map1.put(i,new byte[10000],20,TimeUnit.SECONDS);
  }
  long usedMemoryStart=getUsedMemoryAsMB();
  assertTrue("UsedMemoryStart: " + usedMemoryStart,usedMemoryStart > 300);
  for (int i=0; i < size; i++) {
    h1.getMap("default").get(i);
    h2.getMap("default").get(i);
    h3.getMap("default").get(i);
    h4.getMap("default").get(i);
  }
  sleep(50000);
  Runtime.getRuntime().gc();
  sleep(5000);
  Runtime.getRuntime().gc();
  long usedMemoryEnd=getUsedMemoryAsMB();
  assertTrue(initialUsedMemory + ", UsedMemory now: " + usedMemoryEnd,(usedMemoryEnd - initialUsedMemory) < 50);
}
