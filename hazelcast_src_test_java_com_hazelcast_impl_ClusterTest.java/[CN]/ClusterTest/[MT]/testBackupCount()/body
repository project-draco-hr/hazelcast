{
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(null);
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(null);
  IMap map1=h1.getMap("default");
  IMap map2=h2.getMap("default");
  for (int i=0; i < 10000; i++) {
    map1.put(i,i);
  }
  assertEquals(map1.getLocalMapStats().getBackupEntryCount(),map2.getLocalMapStats().getOwnedEntryCount());
  assertEquals(map2.getLocalMapStats().getBackupEntryCount(),map1.getLocalMapStats().getOwnedEntryCount());
  HazelcastInstance h3=Hazelcast.newHazelcastInstance(null);
  IMap map3=h3.getMap("default");
  final CountDownLatch latch=new CountDownLatch(1);
  h2.getPartitionService().addMigrationListener(new MigrationListener(){
    public void migrationStarted(    MigrationEvent migrationEvent){
    }
    public void migrationCompleted(    MigrationEvent migrationEvent){
      latch.countDown();
    }
  }
);
  latch.await();
  assertEquals(map2.getLocalMapStats().getBackupEntryCount(),map1.getLocalMapStats().getOwnedEntryCount());
  assertEquals(map1.getLocalMapStats().getBackupEntryCount(),map3.getLocalMapStats().getOwnedEntryCount());
  assertEquals(map3.getLocalMapStats().getBackupEntryCount(),map2.getLocalMapStats().getOwnedEntryCount());
}
