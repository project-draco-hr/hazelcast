{
  Config config=new Config();
  final CountDownLatch latch=new CountDownLatch(1);
  config.addListenerConfig(new ListenerConfig(new MigrationListener(){
    public void migrationStarted(    MigrationEvent migrationEvent){
    }
    public void migrationCompleted(    MigrationEvent migrationEvent){
      latch.countDown();
    }
    public void migrationFailed(    final MigrationEvent migrationEvent){
    }
  }
));
  HazelcastInstance h1=Hazelcast.newHazelcastInstance(config);
  ISet set1=h1.getSet("mySet");
  for (int i=0; i < 1000; i++) {
    set1.add(i);
  }
  assertEquals(1000,set1.size());
  HazelcastInstance h2=Hazelcast.newHazelcastInstance(new Config());
  HazelcastInstance h3=Hazelcast.newHazelcastInstance(new Config());
  ISet set2=h2.getSet("mySet");
  ISet set3=h3.getSet("mySet");
  assertTrue(latch.await(30,TimeUnit.SECONDS));
  assertEquals(1000,set1.size());
  assertEquals(1000,set2.size());
  assertEquals(1000,set3.size());
  h2.getLifecycleService().shutdown();
  assertEquals(1000,set1.size());
  assertEquals(1000,set3.size());
}
