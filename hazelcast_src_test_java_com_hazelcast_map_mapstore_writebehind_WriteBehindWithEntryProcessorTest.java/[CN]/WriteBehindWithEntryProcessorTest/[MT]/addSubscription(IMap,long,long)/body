{
  map.executeOnKey(customerId,new AbstractEntryProcessor(){
    @Override public Object process(    Map.Entry entry){
      final Customer customer=(Customer)entry.getValue();
      customer.addSubscription(new Subscription(productId));
      entry.setValue(customer);
      return customer.getSubscriptions().size();
    }
  }
);
}
