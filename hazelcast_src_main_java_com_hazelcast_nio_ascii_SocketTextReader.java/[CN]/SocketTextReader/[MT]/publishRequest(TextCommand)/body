{
  if (!connectionTypeSet) {
    if (command instanceof HttpCommand) {
      if (!restEnabled) {
        connection.close();
      }
      connection.setType(TcpIpConnection.Type.REST_CLIENT);
    }
 else {
      if (!memcacheEnabled) {
        connection.close();
      }
      connection.setType(TcpIpConnection.Type.MEMCACHE_CLIENT);
    }
    connectionTypeSet=true;
  }
  long requestId=(command.shouldReply()) ? requestIdGen++ : -1;
  command.init(this,requestId);
  textCommandService.processRequest(command);
}
