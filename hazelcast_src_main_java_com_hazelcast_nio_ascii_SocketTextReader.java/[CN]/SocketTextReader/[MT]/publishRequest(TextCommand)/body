{
  if (!connectionTypeSet) {
    if (command instanceof HttpCommand) {
      connection.setType(Connection.Type.REST_CLIENT);
    }
 else {
      connection.setType(Connection.Type.MEMCACHE_CLIENT);
    }
    connectionTypeSet=true;
  }
  long requestId=(command.shouldReply()) ? requestIdGen++ : -1;
  command.init(this,requestId);
  textCommandService.processRequest(command);
}
