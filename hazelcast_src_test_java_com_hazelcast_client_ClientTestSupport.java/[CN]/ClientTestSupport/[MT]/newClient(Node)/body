{
  if (node.getState() == NodeState.ACTIVE) {
    if (TestEnvironment.isMockNetwork()) {
      ClientEngineImpl engine=node.clientEngine;
      return new MockSimpleClient(engine,node.getSerializationService());
    }
 else {
      return new SocketSimpleClient(node);
    }
  }
  throw new IllegalArgumentException("Node is not active: " + node.getThisAddress());
}
