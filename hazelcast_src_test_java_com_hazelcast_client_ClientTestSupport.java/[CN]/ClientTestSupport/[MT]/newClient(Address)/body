{
  Set<HazelcastInstance> instances=Hazelcast.getAllHazelcastInstances();
  for (  HazelcastInstance hz : instances) {
    Node node=TestUtil.getNode(hz);
    if (node.isActive()) {
      MemberImpl m;
      try {
        m=(MemberImpl)hz.getCluster().getLocalMember();
      }
 catch (      HazelcastInstanceNotActiveException ignored) {
        continue;
      }
      if (m.getAddress().equals(nodeAddress)) {
        if (TestEnvironment.isMockNetwork()) {
          ClientEngineImpl engine=node.clientEngine;
          return new MockSimpleClient(engine);
        }
 else {
          return new SocketSimpleClient(node);
        }
      }
    }
  }
  throw new IllegalArgumentException("Cannot connect to node: " + nodeAddress);
}
