{
  Packet packet=null;
  int retval=0;
  try {
    packetQueue.drainTo(packetBulk,PACKET_BULK_SIZE);
    final int size=packetBulk.size();
    if (size > 0) {
      for (int i=0; i < size; i++) {
        packet=packetBulk.remove();
        checkPeriodics();
        processPacket(packet);
      }
    }
    retval=size;
  }
 catch (  final Throwable e) {
    logger.log(Level.SEVERE,"error processing messages  packet=" + packet,e);
  }
  return retval;
}
