{
  Packet packet=null;
  try {
    for (int i=0; i < PACKET_BULK_SIZE; i++) {
      checkPeriodics();
      packet=packetQueue.poll();
      if (packet == null) {
        return i;
      }
      processPacket(packet);
    }
  }
 catch (  OutOfMemoryError e) {
    throw e;
  }
catch (  Throwable e) {
    logger.log(Level.SEVERE,"error processing messages  packet=" + packet,e);
    throw e;
  }
  return PACKET_BULK_SIZE;
}
