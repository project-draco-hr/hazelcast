{
  final Config config=new Config();
  config.setProperty("hazelcast.wait.seconds.before.join","1");
  config.setProperty(GroupProperties.PROP_BACKUP_REDO_ENABLED,"true");
  final String name="test";
  final HazelcastInstance hz=Hazelcast.newHazelcastInstance(config);
  final HazelcastInstance hz2=Hazelcast.newHazelcastInstance(config);
  final IMap<Object,Object> map=hz2.getMap(name);
  final int size=100000;
  final byte[] data=new byte[250];
  final int threads=100;
  final int l=size / threads;
  final CountDownLatch latch=new CountDownLatch(threads);
  ExecutorService ex=Executors.newFixedThreadPool(threads);
  new Thread(){
    public void run(){
      while (hz.getMap(name).size() < size / 2) {
        try {
          sleep(5);
        }
 catch (        InterruptedException ignored) {
        }
      }
      TestUtil.getNode(hz).getConnectionManager().shutdown();
    }
  }
.start();
  for (int i=0; i < threads; i++) {
    final int n=i;
    ex.execute(new Runnable(){
      public void run(){
        for (int j=(n * l); j < (n + 1) * l; j++) {
          map.put(j,data);
          try {
            Thread.sleep(1);
          }
 catch (          InterruptedException ignored) {
          }
        }
        latch.countDown();
      }
    }
);
  }
  latch.await();
  ex.shutdown();
  assertEquals("Data lost!",size,map.size());
}
