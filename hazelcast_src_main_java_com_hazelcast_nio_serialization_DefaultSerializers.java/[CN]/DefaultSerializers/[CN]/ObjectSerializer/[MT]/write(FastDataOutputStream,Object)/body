{
  final ObjectOutputStream out;
  if (gzipEnabled) {
    out=new ObjectOutputStream(new BufferedOutputStream(new GZIPOutputStream(dataOut)));
  }
 else {
    out=new ObjectOutputStream(dataOut);
  }
  try {
    if (shared) {
      out.writeObject(obj);
    }
 else {
      out.writeUnshared(obj);
    }
    out.flush();
  }
  finally {
    closeResource(out);
  }
}
