{
  final ObjectOutputStream objectOutputStream;
  final OutputStream outputStream=(OutputStream)out;
  if (gzipEnabled) {
    objectOutputStream=new ObjectOutputStream(new BufferedOutputStream(new GZIPOutputStream(outputStream)));
  }
 else {
    objectOutputStream=new ObjectOutputStream(outputStream);
  }
  try {
    if (shared) {
      objectOutputStream.writeObject(obj);
    }
 else {
      objectOutputStream.writeUnshared(obj);
    }
  }
  finally {
    IOUtil.closeResource(objectOutputStream);
  }
}
