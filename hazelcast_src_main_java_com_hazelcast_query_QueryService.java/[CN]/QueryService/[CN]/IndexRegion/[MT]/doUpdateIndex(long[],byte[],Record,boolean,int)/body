{
  if (active) {
    updateValueIndex(valueHash,record);
    ownedRecords.add(record);
  }
 else {
    removeValueIndex(record);
    ownedRecords.remove(record);
  }
  if (indexes != null) {
    long[] oldValues=record.getIndexes();
    int indexCount=indexes.length;
    if (active && newValues != null && indexCount != newValues.length) {
      throw new RuntimeException(indexCount + " is expected but newValues " + newValues.length);
    }
    for (int i=0; i < indexCount; i++) {
      Index index=indexes[i];
      long oldValue=(oldValues == null) ? Long.MIN_VALUE : oldValues[i];
      if (active) {
        if (oldValue == Long.MIN_VALUE) {
          index.addNewIndex(newValues[i],types[i],record);
        }
 else {
          index.updateIndex(oldValue,newValues[i],types[i],record);
        }
      }
 else {
        index.removeIndex(oldValue,record);
      }
    }
    record.setIndexes(newValues,types);
  }
}
