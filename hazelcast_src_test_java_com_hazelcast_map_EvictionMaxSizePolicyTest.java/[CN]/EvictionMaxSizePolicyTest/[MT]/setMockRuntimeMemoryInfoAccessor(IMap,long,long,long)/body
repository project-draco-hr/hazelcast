{
  final MapProxyImpl mapProxy=(MapProxyImpl)map;
  final MapService mapService=(MapService)mapProxy.getService();
  final MapServiceContext mapServiceContext=mapService.getMapServiceContext();
  EvictionChecker evictionChecker=new EvictionChecker(mapServiceContext);
  MemoryInfoAccessor memoryInfoAccessor=new MemoryInfoAccessor(){
    @Override public long getTotalMemory(){
      return MemoryUnit.MEGABYTES.toBytes(totalMemoryMB);
    }
    @Override public long getFreeMemory(){
      return MemoryUnit.MEGABYTES.toBytes(freeMemoryMB);
    }
    @Override public long getMaxMemory(){
      return MemoryUnit.MEGABYTES.toBytes(maxMemoryMB);
    }
  }
;
  evictionChecker.setMemoryInfoAccessor(memoryInfoAccessor);
  MapContainer mapContainer=mapServiceContext.getMapContainer(map.getName());
  MapEvictionPolicy evictionPolicy=getMapEvictionPolicy(mapContainer.getMapConfig().getEvictionPolicy());
  IPartitionService partitionService=mapServiceContext.getNodeEngine().getPartitionService();
  Evictor evictor=new TestEvictor(evictionChecker,evictionPolicy,partitionService);
  mapServiceContext.getMapContainer(map.getName()).setEvictor(evictor);
}
