{
  final MapProxyImpl mapProxy=(MapProxyImpl)map;
  final MapService mapService=(MapService)mapProxy.getService();
  final MapServiceContext mapServiceContext=mapService.getMapServiceContext();
  EvictionCheckerImpl evictionChecker=new EvictionCheckerImpl(mapServiceContext);
  MemoryInfoAccessor memoryInfoAccessor=new MemoryInfoAccessor(){
    @Override public long getTotalMemory(){
      return MemoryUnit.MEGABYTES.toBytes(totalMemoryMB);
    }
    @Override public long getFreeMemory(){
      return MemoryUnit.MEGABYTES.toBytes(freeMemoryMB);
    }
    @Override public long getMaxMemory(){
      return MemoryUnit.MEGABYTES.toBytes(maxMemoryMB);
    }
  }
;
  evictionChecker.setMemoryInfoAccessor(memoryInfoAccessor);
  Evictor evictor=new EvictorImpl(evictionChecker,mapServiceContext);
  mapServiceContext.getMapContainer(map.getName()).setEvictor(evictor);
}
