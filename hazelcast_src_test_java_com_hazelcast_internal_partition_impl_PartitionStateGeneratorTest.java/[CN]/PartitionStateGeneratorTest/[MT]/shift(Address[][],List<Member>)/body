{
  Set<Address> addresses=new HashSet<Address>();
  for (  Member member : members) {
    addresses.add(((MemberImpl)member).getAddress());
  }
  for (  Address[] replicas : state) {
    for (int i=0; i < replicas.length; i++) {
      if (replicas[i] != null && !addresses.contains(replicas[i])) {
        Address[] validAddresses=new Address[InternalPartition.MAX_REPLICA_COUNT - i];
        int k=0;
        for (int a=i + 1; a < InternalPartition.MAX_REPLICA_COUNT; a++) {
          Address address=replicas[a];
          if (address != null && addresses.contains(address)) {
            validAddresses[k++]=address;
          }
        }
        System.arraycopy(validAddresses,0,replicas,i,k);
        for (int a=i + k; a < InternalPartition.MAX_REPLICA_COUNT; a++) {
          replicas[a]=null;
        }
        break;
      }
    }
  }
}
