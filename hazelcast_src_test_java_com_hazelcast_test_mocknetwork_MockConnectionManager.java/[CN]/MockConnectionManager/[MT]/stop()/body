{
  logger.fine("Stopping connection manager");
  live=false;
  for (  Address address : nodes.keySet()) {
    if (address.equals(node.getThisAddress())) {
      continue;
    }
    final NodeEngineImpl otherNodeEngine=nodes.get(address);
    if (otherNodeEngine != null && otherNodeEngine.getNode().getState() != NodeState.SHUT_DOWN) {
      if (otherNodeEngine.getClusterService().getMember(node.getThisAddress()) == null) {
        continue;
      }
      logger.fine(otherNodeEngine.getThisAddress() + " is instructed to remove this node.");
      otherNodeEngine.getExecutionService().execute(ExecutionService.SYSTEM_EXECUTOR,new Runnable(){
        public void run(){
          ClusterServiceImpl clusterService=(ClusterServiceImpl)otherNodeEngine.getClusterService();
          clusterService.removeAddress(node.getThisAddress());
        }
      }
);
    }
  }
  for (  MockConnection connection : mapConnections.values()) {
    connection.close();
  }
}
