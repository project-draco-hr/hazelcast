{
  logger.fine("Stopping connection manager");
  live=false;
  for (  Address address : registry.getAddresses()) {
    if (address.equals(node.getThisAddress())) {
      continue;
    }
    final Node otherNode=registry.getNode(address);
    if (otherNode != null && otherNode.getState() != NodeState.SHUT_DOWN) {
      if (otherNode.getClusterService().getMember(node.getThisAddress()) == null) {
        continue;
      }
      logger.fine(otherNode.getThisAddress() + " is instructed to remove this node.");
      otherNode.getNodeEngine().getExecutionService().execute(ExecutionService.SYSTEM_EXECUTOR,new Runnable(){
        public void run(){
          ClusterServiceImpl clusterService=(ClusterServiceImpl)otherNode.getClusterService();
          clusterService.removeAddress(node.getThisAddress());
        }
      }
);
    }
  }
  for (  MockConnection connection : mapConnections.values()) {
    connection.close();
  }
}
