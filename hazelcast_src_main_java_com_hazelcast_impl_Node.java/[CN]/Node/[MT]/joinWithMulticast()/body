{
  int tryCount=0;
  while (!joined) {
    logger.log(Level.FINEST,"joining... " + masterAddress);
    Address masterAddressNow=findMasterWithMulticast();
    if (masterAddressNow != null && masterAddressNow.equals(masterAddress)) {
      tryCount--;
    }
    masterAddress=masterAddressNow;
    if (masterAddress == null || address.equals(masterAddress)) {
      TcpIpConfig tcpIpConfig=config.getNetworkConfig().getJoin().getTcpIpConfig();
      if (tcpIpConfig != null && tcpIpConfig.isEnabled()) {
        masterAddress=null;
        logger.log(Level.FINEST,"Multicast couldn't find cluster. Trying TCP/IP");
        joinWithTCP();
      }
 else {
        setAsMaster();
      }
      return;
    }
    if (tryCount++ > 22) {
      failedJoiningToMaster(true,tryCount);
    }
    if (!masterAddress.equals(address)) {
      connectAndSendJoinRequest(masterAddress);
    }
 else {
      masterAddress=null;
      tryCount=0;
    }
    try {
      Thread.sleep(500L);
    }
 catch (    InterruptedException ignored) {
    }
  }
}
