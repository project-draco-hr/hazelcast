{
  try {
    final StringBuffer sb=new StringBuffer();
    if (ex != null) {
      sb.append(BufferUtil.exceptionToString(ex,address));
    }
    sb.append("Hazelcast.version : ").append(version).append("\n");
    sb.append("Hazelcast.build   : ").append(build).append("\n");
    sb.append("Hazelcast.address   : ").append(address).append("\n");
    sb.append("joined : ").append(joined).append("\n");
    sb.append(AddressPicker.createCoreDump());
    coreDump.getPrintWriter().write(sb.toString());
    coreDump.getPrintWriter().write("\n");
    coreDump.getPrintWriter().write("\n");
    for (    final Thread thread : threads) {
      thread.interrupt();
    }
    if (!joined) {
      if (firstMainThread != null) {
        try {
          firstMainThread.interrupt();
        }
 catch (        final Exception ignore) {
        }
      }
    }
    String fileName="hz-core";
    if (address != null)     fileName+="-" + address.getHost() + "_"+ address.getPort();
    fileName+=".txt";
    final FileOutputStream fos=new FileOutputStream(fileName);
    Util.writeText(coreDump.toString(),fos);
    fos.flush();
    fos.close();
  }
 catch (  final Exception e) {
    e.printStackTrace();
  }
}
