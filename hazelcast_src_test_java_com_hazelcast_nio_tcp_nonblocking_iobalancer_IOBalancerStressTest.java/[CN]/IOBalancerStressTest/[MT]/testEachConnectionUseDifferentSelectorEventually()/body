{
  Config config=new Config();
  config.setProperty(GroupProperty.IO_BALANCER_INTERVAL_SECONDS,"1");
  config.setProperty(GroupProperty.IO_THREAD_COUNT,"2");
  HazelcastInstance instance1=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance instance2=Hazelcast.newHazelcastInstance(config);
  HazelcastInstance instance3=Hazelcast.newHazelcastInstance(config);
  instance2.shutdown();
  instance2=Hazelcast.newHazelcastInstance(config);
  IMap<Integer,Integer> map=instance1.getMap(randomMapName());
  long deadLine=System.currentTimeMillis() + TEST_DURATION_SECONDS * 1000;
  for (int i=0; System.currentTimeMillis() < deadLine && map.size() < 1000; i++) {
    map.put(i % 1000,i);
  }
  assertBalanced(instance1);
  assertBalanced(instance2);
  assertBalanced(instance3);
}
