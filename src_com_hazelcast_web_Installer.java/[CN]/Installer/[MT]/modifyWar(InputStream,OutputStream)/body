{
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  ZipOutputStream out=new ZipOutputStream(bos);
  ZipInputStream zin=new ZipInputStream(in);
  try {
    while (true) {
      ZipEntry entry=zin.getNextEntry();
      if (entry == null)       break;
      out.putNextEntry(new ZipEntry(entry.getName()));
      log("war file " + entry.getName());
      if (entry.isDirectory()) {
        continue;
      }
      if (entry.getName().equals("WEB-INF/web.xml")) {
        ByteArrayOutputStream bosWebXml=new ByteArrayOutputStream();
        Util.copyStream(zin,bosWebXml);
        bosWebXml.flush();
        byte[] webxmlBytes=bosWebXml.toByteArray();
        bosWebXml.close();
        ByteArrayInputStream binWebXml=new ByteArrayInputStream(webxmlBytes);
        readModifyWrite(binWebXml,out);
        binWebXml.close();
      }
 else       if (entry.getName().endsWith(".jsp")) {
        modifyJSP(zin,out);
      }
 else {
        Util.copyStream(zin,out);
      }
      out.flush();
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    if (DEBUG)     System.exit(0);
  }
 finally {
    try {
      out.flush();
      out.close();
      bos.writeTo(os);
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
  }
}
