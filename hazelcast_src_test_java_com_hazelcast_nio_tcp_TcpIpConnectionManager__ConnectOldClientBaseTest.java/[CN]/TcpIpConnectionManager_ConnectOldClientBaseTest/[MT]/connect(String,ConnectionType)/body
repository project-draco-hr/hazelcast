{
  socket=new Socket(addressA.getHost(),addressA.getPort());
  final TcpIpConnection connection=getConnection(connManagerA,socket.getLocalSocketAddress());
  assertTrue(connection.isAlive());
  assertEquals(socket.getLocalSocketAddress(),connection.getRemoteSocketAddress());
  assertEquals(ConnectionType.NONE,connection.getType());
  assertFalse(connection.isClient());
  assertEquals(addressA.getInetAddress(),connection.getInetAddress());
  write(socket,Protocols.CLIENT_BINARY.getBytes());
  write(socket,clientType.getBytes());
  assertTrueEventually(new AssertTask(){
    @Override public void run() throws Exception {
      assertTrue(connection.isClient());
      assertEquals(expectedConnectionType,connection.getType());
    }
  }
);
}
