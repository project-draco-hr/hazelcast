{
  boolean returnsResponse=op.returnsResponse();
  Object response=null;
  if (op instanceof BackupAwareOperation) {
    BackupAwareOperation backupAwareOp=(BackupAwareOperation)op;
    int syncBackupCount=0;
    if (backupAwareOp.shouldBackup()) {
      syncBackupCount=operationService.operationBackupHandler.backup(backupAwareOp);
    }
    if (returnsResponse) {
      response=new NormalResponse(op.getResponse(),op.getCallId(),syncBackupCount,op.isUrgent());
    }
  }
  if (!returnsResponse) {
    return;
  }
  if (response == null) {
    response=op.getResponse();
  }
  ResponseHandler responseHandler=op.getResponseHandler();
  if (responseHandler == null) {
    throw new IllegalStateException("ResponseHandler should not be null! " + op);
  }
  responseHandler.sendResponse(response);
}
