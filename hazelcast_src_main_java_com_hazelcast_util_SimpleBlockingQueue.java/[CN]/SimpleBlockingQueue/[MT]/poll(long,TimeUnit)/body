{
  long timeLeft=unit.toMillis(timeout);
  long start=Clock.currentTimeMillis();
synchronized (lock) {
    E e=removeFirst();
    while (e == null && timeLeft > 0) {
      lock.wait(timeLeft);
      e=removeFirst();
      long now=Clock.currentTimeMillis();
      timeLeft-=(now - start);
      start=now;
    }
    return e;
  }
}
