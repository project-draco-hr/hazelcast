{
  WaitNotifyKey key=notifier.getNotifiedKey();
  Queue<WaitingOp> q=mapWaitingOps.get(key);
  if (q == null)   return;
  WaitingOp waitingOp=q.peek();
  while (waitingOp != null) {
    final Operation op=waitingOp.getOperation();
    if (notifier == op) {
      throw new IllegalStateException("Found cyclic wait-notify! -> " + notifier);
    }
    if (waitingOp.isValid()) {
      if (waitingOp.isExpired()) {
        waitingOp.onExpire();
      }
 else {
        if (waitingOp.shouldWait()) {
          return;
        }
        nodeEngine.operationService.runOperationOnCallingThread(op);
      }
      waitingOp.setValid(false);
    }
    q.poll();
    waitingOp=q.peek();
  }
}
