{
  WaitNotifyKey key=notifier.getNotifiedKey();
  Queue<WaitingOp> q=mapWaitingOps.get(key);
  if (q == null)   return;
  WaitingOp waitingOp=q.peek();
  while (waitingOp != null) {
    if (notifier == waitingOp.getOperation()) {
      throw new IllegalStateException("Found cyclic wait-notify! -> " + notifier);
    }
    if (waitingOp.isValid()) {
      if (waitingOp.isExpired()) {
        waitingOp.onExpire();
      }
 else {
        if (waitingOp.shouldWait()) {
          return;
        }
        waitingOpProcessor.processUnderExistingLock(waitingOp.getOperation());
      }
      waitingOp.setValid(false);
    }
    q.poll();
    waitingOp=q.peek();
  }
}
