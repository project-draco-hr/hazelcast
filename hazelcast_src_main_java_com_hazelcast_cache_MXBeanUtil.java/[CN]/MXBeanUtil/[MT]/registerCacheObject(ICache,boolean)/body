{
  MBeanServer mBeanServer=ManagementFactory.getPlatformMBeanServer();
  ObjectName registeredObjectName=calculateObjectName(cache,stats);
  try {
    if (!stats) {
      if (!isRegistered(cache,stats)) {
        mBeanServer.registerMBean(cache.getCacheMXBean(),registeredObjectName);
      }
    }
 else     if (stats) {
      if (!isRegistered(cache,stats)) {
        mBeanServer.registerMBean(cache.getCacheStatisticsMXBean(),registeredObjectName);
      }
    }
  }
 catch (  Exception e) {
    throw new CacheException("Error registering cache MXBeans for CacheManager " + registeredObjectName + " . Error was "+ e.getMessage(),e);
  }
}
